<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="June 2019">
<link rel="icon" type="image/x-icon" href="images/favicon.ico">
<title>Zimbra Collaboration Administrator Guide</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Zimbra Collaboration Administrator Guide</h1>
<div class="details">
<span id="author" class="author">June 2019</span><br>
<span id="revnumber">version Zimbra Network Edition V 8.8.15,</span>
<span id="revdate">revised 2022-12-12</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_license">License</a></li>
<li><a href="#_introduction">Introduction</a>
<ul class="sectlevel2">
<li><a href="#_audience">Audience</a></li>
<li><a href="#_third_party_components">Third-Party Components</a></li>
<li><a href="#_support_and_contact_information">Support and Contact Information</a></li>
</ul>
</li>
<li><a href="#lifecycle">Product Life Cycle</a>
<ul class="sectlevel2">
<li><a href="#_component_deprecation_statements">Component Deprecation Statements</a></li>
</ul>
</li>
<li><a href="#overview">Product Overview</a>
<ul class="sectlevel2">
<li><a href="#_architectural_overview">Architectural Overview</a></li>
<li><a href="#_core_email_calendar_and_collaboration_functionality">Core Email, Calendar and Collaboration Functionality</a></li>
<li><a href="#_zimbra_components">Zimbra Components</a></li>
<li><a href="#_zimbra_application_packages">Zimbra Application Packages</a></li>
<li><a href="#_mail_flowmulti_server_configuration">Mail Flow&#8201;&#8212;&#8201;Multi-Server Configuration</a></li>
<li><a href="#_zimbra_system_directory_tree">Zimbra System Directory Tree</a></li>
<li><a href="#_zimbra_web_clients">Zimbra Web Clients</a></li>
<li><a href="#_web_services_and_desktop_clients">Web Services and Desktop Clients</a></li>
<li><a href="#offline_mode">Offline Mode</a></li>
<li><a href="#_security_measures">Security Measures</a></li>
</ul>
</li>
<li><a href="#_licensing">Licensing</a>
<ul class="sectlevel2">
<li><a href="#_license_types">License Types</a></li>
<li><a href="#License_Requirements">Zimbra License Requirements</a></li>
<li><a href="#_license_usage_by_account_type">License Usage by Account Type</a></li>
<li><a href="#_license_activation">License Activation</a></li>
<li><a href="#_obtain_a_license">Obtain a License</a></li>
<li><a href="#_managing_licenses">Managing Licenses</a></li>
<li><a href="#_updating_your_license">Updating Your License</a></li>
<li><a href="#_license_reconciliation_and_data_collection_notice">License Reconciliation and Data Collection Notice</a></li>
</ul>
</li>
<li><a href="#zimbra_mailbox_server">Zimbra Mailbox Server</a>
<ul class="sectlevel2">
<li><a href="#_mailbox_server">Mailbox Server</a></li>
<li><a href="#_web_application_server">Web Application Server</a></li>
<li><a href="#_web_application_server_split">Web Application Server Split</a></li>
<li><a href="#_backing_up_the_mailbox_server">Backing Up the Mailbox Server</a></li>
<li><a href="#_mailbox_server_logs">Mailbox Server Logs</a></li>
</ul>
</li>
<li><a href="#_imap">IMAP</a>
<ul class="sectlevel2">
<li><a href="#_common_imap_configuration_settings">Common IMAP Configuration settings</a></li>
</ul>
</li>
<li><a href="#zimbra_ldap_service">Zimbra LDAP Service</a>
<ul class="sectlevel2">
<li><a href="#_ldap_traffic_flow">LDAP Traffic Flow</a></li>
<li><a href="#_ldap_directory_hierarchy">LDAP Directory Hierarchy</a></li>
<li><a href="#_zimbra_collaboration_ldap_schema">Zimbra Collaboration LDAP Schema</a></li>
<li><a href="#_account_authentication">Account Authentication</a></li>
<li><a href="#_global_address_list">Global Address List</a></li>
<li><a href="#_flushing_ldap_cache">Flushing LDAP Cache</a></li>
</ul>
</li>
<li><a href="#_zimbra_mail_transfer_agent">Zimbra Mail Transfer Agent</a>
<ul class="sectlevel2">
<li><a href="#_incoming_mail_routing_overview">Incoming Mail Routing Overview</a></li>
<li><a href="#_zimbra_mta_deployment">Zimbra MTA Deployment</a></li>
<li><a href="#_smtp_authentication">SMTP Authentication</a></li>
<li><a href="#_anti_virus_and_anti_spam_protection">Anti-Virus and Anti-Spam Protection</a></li>
<li><a href="#_receiving_and_sending_mail">Receiving and Sending Mail</a></li>
<li><a href="#_message_banner_for_mails_from_external_domains">Message banner for mails from external domains</a></li>
</ul>
</li>
<li><a href="#zimbra_proxy_server">Zimbra Proxy Server</a>
<ul class="sectlevel2">
<li><a href="#_benefits_of_using_zimbra_proxy">Benefits of Using Zimbra Proxy</a></li>
<li><a href="#zimbra_proxy_components">Zimbra Proxy Components</a></li>
<li><a href="#_proxy_architecture_and_flow">Proxy Architecture and Flow</a></li>
<li><a href="#_changing_the_zimbra_proxy_configuration">Changing the Zimbra Proxy Configuration</a></li>
<li><a href="#_zimbra_proxy">Zimbra Proxy</a></li>
<li><a href="#_configuring_zimbra_http_proxy">Configuring Zimbra HTTP Proxy</a></li>
<li><a href="#_configuring_zimbra_proxy_for_kerberos_authentication">Configuring Zimbra Proxy for Kerberos Authentication</a></li>
</ul>
</li>
<li><a href="#_zimbra_administration_console">Zimbra Administration Console</a>
<ul class="sectlevel2">
<li><a href="#_administrator_accounts">Administrator Accounts</a></li>
<li><a href="#_logging_into_the_administration_console">Logging into the Administration Console</a></li>
<li><a href="#_managing_tasks">Managing Tasks</a></li>
<li><a href="#_navigating_the_user_interface">Navigating the User Interface</a></li>
<li><a href="#_message_of_the_day">Message of the Day</a></li>
<li><a href="#_functional_reference">Functional Reference</a></li>
<li><a href="#zimbra-pst-migration">Zimbra PST Migration Wizard</a></li>
<li><a href="#_migration_wizard_gui">Migration Wizard GUI</a></li>
<li><a href="#_migration_wizard_cli">Migration Wizard CLI</a></li>
</ul>
</li>
<li><a href="#managing_configuration">Managing Configuration</a>
<ul class="sectlevel2">
<li><a href="#_global_configuration">Global Configuration</a></li>
<li><a href="#general_information_configuration">General Information Configuration</a></li>
<li><a href="#attachments_confirguration">Attachments Configuration</a></li>
<li><a href="#mta_configuration">MTA Configuration</a></li>
<li><a href="#_working_with_domains">Working With Domains</a></li>
<li><a href="#_managing_server_settings">Managing Server Settings</a></li>
<li><a href="#_using_dkim_to_authenticate_email_message">Using DKIM to Authenticate Email Message</a></li>
<li><a href="#_anti_spam_settings">Anti-spam Settings</a></li>
<li><a href="#_anti_virus_settings">Anti-virus Settings</a></li>
<li><a href="#_zimbra_freebusy_calendar_scheduling">Zimbra Free/Busy Calendar Scheduling</a></li>
<li><a href="#_setting_up_smime">Setting Up S/MIME</a></li>
<li><a href="#_storage_management">Storage Management</a></li>
<li><a href="#_email_retention_management">Email Retention Management</a></li>
<li><a href="#_customized_admin_extensions">Customized Admin Extensions</a></li>
</ul>
</li>
<li><a href="#ephemeral_data">Ephemeral Data</a>
<ul class="sectlevel2">
<li><a href="#_configuring_a_running_zimbra_collaboration_to_use_ssdb">Configuring a Running Zimbra Collaboration to Use SSDB</a></li>
<li><a href="#_migration_procedure">Migration Procedure</a></li>
<li><a href="#_migration_details">Migration Details</a></li>
</ul>
</li>
<li><a href="#_ssdb_installation_and_configuration">SSDB Installation and Configuration</a>
<ul class="sectlevel2">
<li><a href="#_installation">Installation</a></li>
<li><a href="#ssdb_configuration_options">Overview of Configuration Options</a></li>
<li><a href="#_master_slave_replication">Master-Slave Replication</a></li>
<li><a href="#_master_master_replication">Master-Master Replication</a></li>
<li><a href="#_multi_master_scaling_replication">Multi-Master Scaling / Replication</a></li>
<li><a href="#_ldap_attributes">LDAP Attributes</a></li>
<li><a href="#_scaling_ssdb_for_production_load_with_zimbra_collaboration">Scaling SSDB for Production Load with Zimbra Collaboration</a></li>
<li><a href="#_conclusion">Conclusion</a></li>
</ul>
</li>
<li><a href="#class_of_service_and_accounts">Class of Service and Accounts</a>
<ul class="sectlevel2">
<li><a href="#_managing_features_and_settings_with_a_cos">Managing Features and Settings with a COS</a></li>
<li><a href="#_selecting_features_and_preferences">Selecting Features and Preferences</a></li>
<li><a href="#_using_server_pools">Using Server Pools</a></li>
<li><a href="#_setting_account_quota">Setting Account Quota</a></li>
<li><a href="#_managing_passwords">Managing Passwords</a></li>
<li><a href="#_managing_login_policies">Managing Login Policies</a></li>
<li><a href="#_managing_session_timeout_policies">Managing Session Timeout Policies</a></li>
<li><a href="#_managing_default_external_cos">Managing Default External COS</a></li>
</ul>
</li>
<li><a href="#customizing_accounts">Customizing Accounts</a>
<ul class="sectlevel2">
<li><a href="#_messaging_and_collaboration_applications">Messaging and Collaboration Applications</a></li>
<li><a href="#_contacts_features">Contacts Features</a></li>
<li><a href="#_calendar_features">Calendar Features</a></li>
<li><a href="#_zimbra_web_client_user_interface_themes">Zimbra Web Client User Interface Themes</a></li>
<li><a href="#two_factor_auth">Two Factor Authentication</a></li>
<li><a href="#_other_configuration_settings_for_accounts">Other Configuration Settings for Accounts</a></li>
</ul>
</li>
<li><a href="#hierarchical_address_book">Hierarchical Address Book (HAB) in Zimbra</a>
<ul class="sectlevel2">
<li><a href="#_what_is_a_hab">What is a HAB?</a></li>
<li><a href="#_using_hierarchical_address_book">Using Hierarchical Address Book</a></li>
<li><a href="#SeniorityIndex">Seniority Index</a></li>
<li><a href="#_configuring_hierarchical_address_books">Configuring hierarchical address books</a></li>
<li><a href="#_manage_organisational_units_ous">Manage Organisational Units (OUs)</a></li>
</ul>
</li>
<li><a href="#_provisioning_user_accounts">Provisioning User Accounts</a>
<ul class="sectlevel2">
<li><a href="#_creating_a_single_user_accounts">Creating a Single User Accounts</a></li>
<li><a href="#_migrating_accounts_and_importing_account_email">Migrating Accounts and Importing Account Email</a></li>
<li><a href="#_auto_provisioning_new_accounts_from_external_ldap">Auto Provisioning New Accounts from External LDAP</a></li>
<li><a href="#_managing_resources">Managing Resources</a></li>
</ul>
</li>
<li><a href="#_managing_user_accounts">Managing User Accounts</a>
<ul class="sectlevel2">
<li><a href="#_status_of_user_accounts">Status of User Accounts</a></li>
<li><a href="#_deleting_an_account">Deleting an Account</a></li>
<li><a href="#_viewing_an_accounts_mailbox">Viewing an Accounts Mailbox</a></li>
<li><a href="#_using_an_email_alias">Using an Email Alias</a></li>
<li><a href="#_working_with_distribution_lists">Working with Distribution Lists</a></li>
<li><a href="#using_dynamic_distribution_lists">Using Dynamic Distribution Lists</a></li>
<li><a href="#_moving_a_mailbox">Moving a Mailbox</a></li>
</ul>
</li>
<li><a href="#delegated_administration">Delegated Administration (*)</a>
<ul class="sectlevel2">
<li><a href="#_target_types_for_granting_administrative_rights">Target Types for Granting Administrative Rights</a></li>
<li><a href="#_rights">Rights</a></li>
<li><a href="#_implementing_delegated_administration">Implementing Delegated Administration</a></li>
<li><a href="#_revoking_rights">Revoking Rights</a></li>
<li><a href="#_view_rights_granted_to_administrators">View Rights Granted to Administrators</a></li>
<li><a href="#_predefined_delegated_administrator_role">Predefined Delegated Administrator Role</a></li>
<li><a href="#_creating_delegated_administrator_roles">Creating Delegated Administrator Roles</a></li>
</ul>
</li>
<li><a href="#monitoring_zcs_servers">Monitoring ZCS Servers</a>
<ul class="sectlevel2">
<li><a href="#_zimbra_logger">Zimbra Logger</a></li>
<li><a href="#_configuring_disk_space_notifications">Configuring Disk Space Notifications</a></li>
<li><a href="#_monitoring_servers">Monitoring Servers</a></li>
<li><a href="#_configuring_denial_of_service_filter_parameters">Configuring Denial of Service Filter Parameters</a></li>
<li><a href="#_working_with_mail_queues">Working with Mail Queues</a></li>
<li><a href="#monitoring_mailbox_quotas">Monitoring Mailbox Quotas</a></li>
<li><a href="#_viewing_mobilesync_statistics">Viewing MobileSync Statistics</a></li>
<li><a href="#_monitoring_authentication_failures">Monitoring Authentication Failures</a></li>
<li><a href="#_viewing_log_files">Viewing Log Files</a></li>
<li><a href="#_reading_a_message_header">Reading a Message Header</a></li>
<li><a href="#_fixing_corrupted_mailbox_index">Fixing Corrupted Mailbox Index</a></li>
<li><a href="#_snmp_monitoring_and_configuration">SNMP Monitoring and Configuration</a></li>
<li><a href="#_checking_mariadb">Checking MariaDB</a></li>
<li><a href="#_checking_for_zimbra_collaboration_software_updates">Checking for Zimbra Collaboration Software Updates</a></li>
<li><a href="#_updating_zimbra_connector_for_microsoft_outlook">Updating Zimbra Connector for Microsoft Outlook</a></li>
<li><a href="#_notifications_and_alerts_sent_by_zimbra_collaboration">Notifications and Alerts Sent by Zimbra Collaboration</a></li>
</ul>
</li>
<li><a href="#backup_and_restore">Backup and Restore (*)</a>
<ul class="sectlevel2">
<li><a href="#_backing_up_the_mailbox_server_2">Backing Up the Mailbox Server</a></li>
<li><a href="#_backup_methods">Backup Methods</a></li>
<li><a href="#_directory_structure_for_backup_files">Directory Structure for Backup Files</a></li>
<li><a href="#_backup_and_restore_using_the_administration_console">Backup and Restore Using the Administration Console</a></li>
<li><a href="#_backup_and_restore_using_the_command_line_interface">Backup and Restore Using the Command Line Interface</a></li>
<li><a href="#_backing_up_using_the_standard_method">Backing up using the Standard Method</a></li>
<li><a href="#_aborting_a_full_backup_in_progress">Aborting a Full Backup in Progress</a></li>
<li><a href="#_backup_using_the_auto_grouped_method">Backup using the Auto-Grouped Method</a></li>
<li><a href="#_backup_options">Backup Options</a></li>
<li><a href="#_managing_disk_space_for_backups">Managing Disk Space for Backups</a></li>
<li><a href="#_restoring_data">Restoring Data</a></li>
<li><a href="#_general_steps_for_disaster_recovery">General Steps for Disaster Recovery</a></li>
<li><a href="#_using_snapshots_to_backup_and_restore">Using snapshots to Backup and Restore</a></li>
<li><a href="#_notes_on_ephemeral_data">Notes on Ephemeral Data</a></li>
</ul>
</li>
<li><a href="#_archiving_and_discovery">Archiving and Discovery</a>
<ul class="sectlevel2">
<li><a href="#_how_archiving_works">How Archiving Works</a></li>
<li><a href="#_how_discovery_works">How Discovery Works</a></li>
<li><a href="#_installing_the_archiving_package">Installing the Archiving Package</a></li>
<li><a href="#_manage_archiving_from_the_administration_console">Manage Archiving From the Administration Console</a></li>
<li><a href="#_archive_mailboxes">Archive Mailboxes</a></li>
<li><a href="#_searching_across_mailboxes">Searching Across Mailboxes</a></li>
</ul>
</li>
<li><a href="#_legal_requests_for_information">Legal Requests for Information</a>
<ul class="sectlevel2">
<li><a href="#_legal_intercept_settings">Legal Intercept Settings</a></li>
<li><a href="#_creating_mailbox_snapshots_for_legal_discovery">Creating Mailbox Snapshots for Legal Discovery</a></li>
</ul>
</li>
<li><a href="#color_and_logo_management">Color and Logo Management</a>
<ul class="sectlevel2">
<li><a href="#_changing_theme_color_and_logos_on_the_zimbra_web_client">Changing Theme Color and Logos on the Zimbra Web Client</a></li>
</ul>
</li>
<li><a href="#zimlets">Zimlets</a>
<ul class="sectlevel2">
<li><a href="#_managing_zimlets_from_the_administration_console">Managing Zimlets from the Administration Console</a></li>
<li><a href="#_managing_zimlets_from_the_command_line_interface">Managing Zimlets from the Command Line Interface</a></li>
</ul>
</li>
<li><a href="#voice_service">Using the Voice Service</a>
<ul class="sectlevel2">
<li><a href="#_order_of_configuration">Order of Configuration</a></li>
<li><a href="#_voice_service_requirements">Voice Service Requirements</a></li>
<li><a href="#_using_a_third_party_unified_communications_server">Using a Third-Party Unified Communications Server</a></li>
<li><a href="#_cisco_urls">Cisco URLs</a></li>
<li><a href="#_mitel_urls">Mitel URLs</a></li>
<li><a href="#_creating_the_voicechat_service">Creating the Voice/Chat Service</a></li>
<li><a href="#_configure_presence_cisco_only">Configure Presence (Cisco only)</a></li>
<li><a href="#_enabling_the_voicechat_service">Enabling the Voice/Chat Service</a></li>
<li><a href="#_enable_voicechat_service_on_a_domain">Enable Voice/Chat Service on a Domain</a></li>
<li><a href="#_enable_voicechat_service_on_a_cos">Enable Voice/Chat Service on a COS</a></li>
<li><a href="#_enable_voicechat_service_on_a_user_account">Enable Voice/Chat Service on a User Account</a></li>
<li><a href="#_enabling_the_voicechat_zimlets">Enabling the Voice/Chat Zimlets</a></li>
</ul>
</li>
<li><a href="#backup-ng-guide">Backup NG</a>
<ul class="sectlevel2">
<li><a href="#real-time-scan">Real-Time Scan</a></li>
<li><a href="#blobless-backup-mode">Blobless Backup Mode</a></li>
<li><a href="#smartscan">SmartScan</a></li>
<li><a href="#purge">Purge</a></li>
<li><a href="#external-backup">External Backup</a></li>
<li><a href="#restore-on-new-account">Restore on New Account</a></li>
<li><a href="#undelete-restore">Undelete Restore</a></li>
<li><a href="#external-restore">External Restore</a></li>
<li><a href="#restore-deleted-account">Restore Deleted Account</a></li>
<li><a href="#item-restore">Item Restore</a></li>
<li><a href="#raw-restore">Raw Restore</a></li>
<li><a href="#disaster-recovery">Disaster Recovery</a></li>
<li><a href="#unrestorable-items">Unrestorable Items</a></li>
<li><a href="#docoherencycheck">doCoherencyCheck</a></li>
<li><a href="#taking-additional-and-offsite-backups-of-backup-ngs-datastore">Taking Additional and Offsite Backups of Backup NG&#8217;s Datastore</a></li>
<li><a href="#multistore-informations">Multistore Information</a></li>
<li><a href="#operation-queue-and-queue-management">Operation Queue and Queue Management</a></li>
<li><a href="#cos-level-backup-management">COS-level Backup Management</a></li>
<li><a href="#incremental-migration-with-backup">Incremental Migration with Backup NG</a></li>
</ul>
</li>
<li><a href="#mobile-ng-guide">Mobile NG</a>
<ul class="sectlevel2">
<li><a href="#enable-for-whole-cos">Enable Mobile NG Synchronization for a COS</a></li>
<li><a href="#how-to-enable-the-mobile-ng-module-for-all-users-in-a-class-of-service">How to Enable Mobile NG for all Users in a Class Of Service</a></li>
<li><a href="#from-the-administration-console">From the Administration Console</a></li>
<li><a href="#from-the-zimbra-cli">From the Zimbra CLI</a></li>
<li><a href="#how-to-disable-the-mobile-ng-module-for-all-users-in-a-class-of-service">How to Disable Mobile NG for all Users in a Class Of Service</a></li>
<li><a href="#from-the-administration-console-1">From the Administration Console</a></li>
<li><a href="#from-the-zimbra-cli-1">From the Zimbra CLI</a></li>
<li><a href="#enable-for-single-user">Enable Mobile NG for a Single User</a></li>
<li><a href="#the-mobile-password-feature">The Mobile Password Feature</a></li>
<li><a href="#_data_storage">Data Storage</a></li>
<li><a href="#_application_password_qr_code">Application Password (QR Code)</a></li>
<li><a href="#mobile-device-management-a.k.a.-mobile-provisioning">Mobile Device Management a.k.a. Mobile Provisioning</a></li>
<li><a href="#syncstates">SyncStates</a></li>
<li><a href="#advanced-settings">Advanced Settings</a></li>
<li><a href="#and-shared-folders">Shared Folders</a></li>
<li><a href="#_eas_filters">EAS Filters</a></li>
<li><a href="#_mobile_account_loggers">Mobile Account Loggers</a></li>
</ul>
</li>
<li><a href="#hsm-ng-guide">HSM NG</a>
<ul class="sectlevel2">
<li><a href="#hierarchical-storage-management">Hierarchical Storage Management</a></li>
<li><a href="#zimbra-stores">Zimbra Stores</a></li>
<li><a href="#domoveblobs">doMoveBlobs</a></li>
<li><a href="#volume-management">Volume Management</a></li>
<li><a href="#centralized-storage">Centralized Storage</a></li>
<li><a href="#policy-management">Policy Management</a></li>
<li><a href="#_volumes_on_amazon_s3_compatible_services">Volumes on Amazon S3 Compatible Services</a></li>
<li><a href="#item-deduplication">Item Deduplication</a></li>
<li><a href="#advanced-volume-operations">Advanced Volume Operations</a></li>
<li><a href="#_moving_mailboxes_between_mailstores">Moving Mailboxes Between Mailstores</a></li>
<li><a href="#hsm-ng-attachment-indexing">HSM NG Attachment Indexing</a></li>
</ul>
</li>
<li><a href="#_abq_service">ABQ Service</a>
<ul class="sectlevel2">
<li><a href="#_components">Components</a></li>
<li><a href="#_abq_modes">ABQ Modes</a></li>
<li><a href="#_abq_mode_control">ABQ Mode Control</a></li>
<li><a href="#_dummy_data">Dummy data</a></li>
<li><a href="#_custom_abq_emails">Custom ABQ emails</a></li>
<li><a href="#_notifications">Notifications</a></li>
<li><a href="#_abq_cli">ABQ CLI</a></li>
</ul>
</li>
<li><a href="#admin-ng-guide">Admin NG</a>
<ul class="sectlevel2">
<li><a href="#delegated-admin-provisioning">Delegated Admin Provisioning</a></li>
<li><a href="#quota-management">Quota Management</a></li>
<li><a href="#domain-limits">Domain Limits</a></li>
<li><a href="#zimbra-administration-as-a-delegated-admin">Zimbra Administration as a Delegated Admin</a></li>
<li><a href="#delegated-admin-log-browsing">Delegated Admin Log Browsing</a></li>
<li><a href="#reports-and-informations">Reports and Information</a></li>
<li><a href="#configuration-reset">Configuration Reset</a></li>
</ul>
</li>
<li><a href="#cli-ng-guide">NG Modules CLI</a>
<ul class="sectlevel2">
<li><a href="#nwtwork-ng-modules-cli">Network NG Modules CLI</a></li>
<li><a href="#zxsuite---network-ng-modules-command-line-interface"><em>zxsuite</em> - Network NG Modules Command-Line Interface</a></li>
</ul>
</li>
<li><a href="#MIG-88-incremental-migration-with-backup-from-old-to-88">Incremental Migration to Zimbra 8.8.0 with Backup NG</a>
<ul class="sectlevel2">
<li><a href="#MIG-88-description">Description</a></li>
<li><a href="#MIG-88-source-data">Source Data</a></li>
<li><a href="#MIG-88-pre-migration-checks">Pre-migration Checks</a></li>
<li><a href="#MIG-88-the-setup">Setting up the Migration</a></li>
<li><a href="#MIG-88-the-situation-so-far">The Situation so Far</a></li>
<li><a href="#MIG-88-the-migration">The Migration</a></li>
<li><a href="#MIG-88-incremental-migration-faq">Incremental Migration FAQ</a></li>
</ul>
</li>
<li><a href="#_zimbra_chat">Zimbra Chat</a>
<ul class="sectlevel2">
<li><a href="#about-this-document">About this document</a></li>
<li><a href="#_overview_5">Overview</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#upgrade">Upgrade</a></li>
<li><a href="#troubleshooting">Troubleshooting</a></li>
<li><a href="#sect:tools">Tools</a></li>
<li><a href="#sect:gatheringinfo">Gathering System Information</a></li>
<li><a href="#sect:faq">F.A.Q.</a></li>
<li><a href="#advanced-topics">Advanced Topics</a></li>
</ul>
</li>
<li><a href="#_zimbra_connect">Zimbra Connect</a>
<ul class="sectlevel2">
<li><a href="#_what_is_zimbra_connect">What is Zimbra Connect</a></li>
<li><a href="#_licensing_2">Licensing</a></li>
<li><a href="#_zimbra_chat_and_zimbra_connect">Zimbra Chat and Zimbra Connect</a></li>
<li><a href="#_zimbra_connect_zimlet_installation">Zimbra Connect Zimlet installation</a></li>
<li><a href="#_urls_and_ports">URLs and Ports</a></li>
<li><a href="#_zimbra_connect_administration">Zimbra Connect administration</a></li>
<li><a href="#_browser_compatibility">Browser compatibility</a></li>
<li><a href="#_ui">UI</a></li>
<li><a href="#_instant_messaging_and_corporate_communication">Instant Messaging and Corporate Communication</a></li>
<li><a href="#_file_sharing">File sharing</a></li>
<li><a href="#_video_chat">Video Chat</a></li>
<li><a href="#_instant_meetings">Instant Meetings</a></li>
<li><a href="#_autocomplete">Autocomplete</a></li>
<li><a href="#_presence">Presence</a></li>
<li><a href="#_unread_messages">Unread Messages</a></li>
<li><a href="#_chat_history">Chat History</a></li>
<li><a href="#_stunturn_server">STUN/TURN Server</a></li>
</ul>
</li>
<li><a href="#_zimbra_connect_video_server">Zimbra Connect Video Server</a>
<ul class="sectlevel2">
<li><a href="#_requirements">Requirements</a></li>
<li><a href="#_client_configuration">Client Configuration</a></li>
<li><a href="#_installation_2">Installation</a></li>
<li><a href="#_service_control">Service Control</a></li>
<li><a href="#_bandwidth_and_codecs">Bandwidth and Codecs</a></li>
<li><a href="#_advanced_settings">Advanced settings</a></li>
<li><a href="#_uninstallation">Uninstallation</a></li>
</ul>
</li>
<li><a href="#_zimbra_open_drive">Zimbra Open Drive</a>
<ul class="sectlevel2">
<li><a href="#_about_this_document">About this Document</a></li>
<li><a href="#_overview_6">Overview</a></li>
<li><a href="#_installation_3">Installation</a></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#_upgrade">Upgrade</a></li>
<li><a href="#uninstallation">Uninstallation</a></li>
<li><a href="#advanced">Advanced Topics</a></li>
<li><a href="#manual-upgrade">Manual Upgrade</a></li>
</ul>
</li>
<li><a href="#_zimbra_drive">Zimbra Drive</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">Introduction</a></li>
<li><a href="#_browser_compatibility_2">Browser compatibility</a></li>
<li><a href="#_features">Features</a></li>
<li><a href="#_differences_between_briefcase_and_zimbra_drive">Differences between Briefcase and Zimbra Drive</a></li>
<li><a href="#_zimbra_drive_ui">Zimbra Drive UI</a></li>
<li><a href="#_feature_description">Feature Description</a></li>
<li><a href="#_technical_information">Technical information</a></li>
<li><a href="#_zimbra_drive_backup_and_hsm">Zimbra Drive Backup and HSM</a></li>
<li><a href="#_zimbra_drive_installation_and_migration">Zimbra Drive Installation and Migration</a></li>
</ul>
</li>
<li><a href="#_zimbra_docs">Zimbra Docs</a>
<ul class="sectlevel2">
<li><a href="#_introduction_3">Introduction</a></li>
<li><a href="#_components_3">Components</a></li>
<li><a href="#_browser_compatibility_3">Browser compatibility</a></li>
<li><a href="#_document_management_flow">Document Management Flow</a></li>
<li><a href="#_networking_and_ports">Networking and ports</a></li>
<li><a href="#_installation_and_configuration">Installation and Configuration</a></li>
<li><a href="#_licensing_3">Licensing</a></li>
<li><a href="#_removal">Removal</a></li>
<li><a href="#_commands">Commands</a></li>
<li><a href="#_troubleshooting">Troubleshooting</a></li>
</ul>
</li>
<li><a href="#command_line_utilities">Appendix A: Command Line Utilities</a>
<ul class="sectlevel2">
<li><a href="#_general_tool_information">General Tool Information</a></li>
<li><a href="#cli_commands">Zimbra CLI Commands</a></li>
</ul>
</li>
<li><a href="#_configuring_spnego_single_sign_on">Appendix B: Configuring SPNEGO Single Sign-On</a>
<ul class="sectlevel2">
<li><a href="#_configuration_process">Configuration Process</a></li>
<li><a href="#_create_the_kerberos_keytab_file">Create the Kerberos Keytab File</a></li>
<li><a href="#_configure_zcs">Configure ZCS</a></li>
<li><a href="#configure_your_browser">Configure Your Browser</a></li>
<li><a href="#_test_your_setup">Test your setup</a></li>
<li><a href="#_troubleshooting_setup">Troubleshooting setup</a></li>
<li><a href="#_configure_kerberos_auth_with_spnego_auth">Configure Kerberos Auth with SPNEGO Auth</a></li>
<li><a href="#setting_up_single_sign_on_options_for_zco">Setting Up Single Sign-On Options for ZCO</a></li>
</ul>
</li>
<li><a href="#zcs_crontab_jobs">Appendix C: ZCS Crontab Jobs</a>
<ul class="sectlevel2">
<li><a href="#_how_to_read_the_crontab">How to read the crontab</a></li>
<li><a href="#_zcs_cron_jobs">ZCS Cron Jobs</a></li>
<li><a href="#_single_server_crontab_l_example">Single Server Crontab -l Example</a></li>
</ul>
</li>
<li><a href="#_abq_soap_api">Appendix D: ABQ - SOAP API</a>
<ul class="sectlevel2">
<li><a href="#_introduction_4">Introduction</a></li>
<li><a href="#_abq_api">ABQ API</a></li>
</ul>
</li>
<li><a href="#_glossary">Glossary</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you are upgrading/migrating from a previous version of Zimbra and plan to enable the new mobile sync module for Zimbra, please read <a href="https://wiki.zimbra.com/wiki/Zimbra_Next_Generation_Modules/Things_To_Know_Before_Upgrading">"Things to Know Before Upgrading"</a> and <a href="https://zimbra.github.io/installguides/latest/single.html#mobile-ng">the install guide</a> for critical information.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_license">License</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" alt="CC BY-SA"></span> Synacor, Inc., 2019-2022</p>
</div>
<div class="paragraph">
<p>&#169; 2019-2022 by Synacor, Inc. Zimbra Collaboration Administrator Guide</p>
</div>
<div class="paragraph">
<p>This work is licensed under the Creative Commons Attribution-ShareAlike 4.0
International License unless another license agreement between you and
Synacor, Inc. provides otherwise. To view a copy of this license, visit
<a href="https://creativecommons.org/licenses/by-sa/4.0" class="bare">https://creativecommons.org/licenses/by-sa/4.0</a> or send a letter to Creative
Commons, PO Box 1866, Mountain View, CA 94042, USA.</p>
</div>
<div class="paragraph">
<p>Synacor, Inc., 2019-2022<br>
40 La Riviere Drive, Suite 300<br>
Buffalo, New York 14202</p>
</div>
<div class="paragraph">
<p><a href="https://www.synacor.com" class="bare">https://www.synacor.com</a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra Collaboration is a full-featured messaging and collaboration solution that includes email, address book, calendaring, tasks, and Web document authoring.</p>
</div>
<div class="sect2">
<h3 id="_audience">Audience</h3>
<div class="paragraph">
<p>This guide is for system administrators responsible for installing, maintaining, and supporting the server deployment of Zimbra Collaboration.</p>
</div>
<div class="paragraph">
<p>Readers of this guide should have the following recommended knowledge and skill sets:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Familiarity with the associated technologies and standards</p>
</li>
<li>
<p>Linux operating system and open source concepts</p>
</li>
<li>
<p>Industry practices for mail system management</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_third_party_components">Third-Party Components</h3>
<div class="paragraph">
<p>Where possible, Zimbra Collaboration adheres to existing industry standards and open source implementations for backup management, user authentication, operating platform, and database management.
However, it only supports the specific implementations described in the Zimbra Collaboration architecture overview in the Product Overview chapter as officially tested and certified.
This document might occasionally note when other tools are available in the marketplace, but such mention does not constitute an endorsement or certification.</p>
</div>
</div>
<div class="sect2">
<h3 id="_support_and_contact_information">Support and Contact Information</h3>
<div class="paragraph">
<p>Visit <a href="https://www.zimbra.com"><strong>www.zimbra.com</strong></a> to join the community and to be a part of building the best open source messaging solution.
We appreciate your feedback and suggestions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Contact <a href="mailto:sales@zimbra.com">sales@zimbra.com</a> to purchase Zimbra Collaboration</p>
</li>
<li>
<p>Network Edition customers can contact support at <a href="mailto:support@zimbra.com">support@zimbra.com</a></p>
</li>
<li>
<p>Explore the <a href="https://forums.zimbra.org/">Zimbra Forums</a> for answers to installation or configurations problems</p>
</li>
<li>
<p>Join the <a href="https://forums.zimbra.org/">Zimbra Forums</a> to participate and learn more about the Zimbra Collaboration</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For additional product information, the following resources are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.zimbra.com">Zimbra Wiki</a></p>
</li>
<li>
<p><a href="https://wiki.zimbra.com/wiki/Security_Center">Security Center</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let us know what you like about the product and what you would like to see in the product.
Post your ideas to the Zimbra Forum.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lifecycle">Product Life Cycle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides information about the Product Life Cycle stages of Zimbra components.</p>
</div>
<div class="sect2">
<h3 id="_component_deprecation_statements">Component Deprecation Statements</h3>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Deprecation Statement</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPD was released as Beta with Zimbra 8.8.5, and has not been released as Stable. It has been deprecated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS Migration Wizard for Exchange</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This tool is supported only for PST file import, with End of Technical Guidance set for 31 December 2020.
We recommend <a href="https://zimbra.audriga.com">Audriga&#8217;s self-service migration solution</a> as a preferred alternative for all account migrations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS Migration Wizard for Domino</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS Account Migration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS Account Migration within the Zimbra Admin UI is no longer supported, with End of Technical Guidance set for 17 December 2019.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enterprise modules</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Classic HSM, Classic Backup, and Classic Mobile are deprecated and will be removed in the next release of Zimbra 8.8.
Installations that have not yet migrated to new Network Edition NG Modules or ZSP are encouraged to do so.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Desktop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This desktop user client is no longer supported, with End of Technical Guidance set for 1 October 2019.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Touch Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Mobile Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deprecated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No longer supported, with End of Technical Guidance set for 1 July 2022.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview">Product Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter provides a system overview of Zimbra components.</p>
</div>
<div class="sect2">
<h3 id="_architectural_overview">Architectural Overview</h3>
<div class="paragraph">
<p>The Zimbra Collaboration architecture is built with well-known open source
technologies and standards-based protocols. The architecture consists of
client interfaces and server components that can run as a single node
configuration or be deployed across multiple servers for high availability
and increased scalability.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/arch_overview.svg" alt="Architectural Overview" width="395">
</div>
</div>
<div class="paragraph">
<p>The architecture includes the following core advantages:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Core Advantage</th>
<th class="tableblock halign-left valign-top">Components/Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open source integrations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Linux&#174;, Jetty, Postfix, MariaDB, OpenLDAP&#174;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Industry-standard open protocols</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP, LMTP, SOAP, XML, IMAP, POP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Modern technology Design</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML5, Javascript, XML, and Java</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scalability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each Zimbra mailbox server includes its own mailbox accounts and associated
message store and indexes. The Zimbra platform scales vertically (by adding
more system resources) and horizontally (by adding more servers)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser-based client interface</p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock">Easy, intuitive access to Zimbra Collaboration features, using a standard
web platform.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser-based Administration Console</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_core_email_calendar_and_collaboration_functionality">Core Email, Calendar and Collaboration Functionality</h3>
<div class="paragraph">
<p>Zimbra Collaboration is an innovative messaging and collaboration application
that offers the following state-of-the-art solutions that are accessed
through the browser based web client.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Intuitive message management, search, tagging, and sharing.</p>
</li>
<li>
<p>Personal, external, and shared calendar.</p>
</li>
<li>
<p>Personal and shared Address Books and Distribution Lists.</p>
</li>
<li>
<p>Personal and Shared Task lists.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_components">Zimbra Components</h3>
<div class="paragraph">
<p>Zimbra architecture includes open-source integrations using industry
standard protocols. The third-party software listed in
<a href="#table_tps">Third-Party Software</a>
is bundled with Zimbra software and installed as part of the
installation process. These components have been tested and configured
to work with the software.</p>
</div>
<table id="table_tps" class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 1. Third-Party Software</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">3rd-Party Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jetty</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Web application server that runs Zimbra software.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfix</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Open source mail transfer agent (MTA) that routes mail messages to the
appropriate Zimbra server</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open LDAP software</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Open source implementation of the Lightweight Directory Access Protocol
(LDAP) that stores Zimbra system configuration, the Zimbra Global Address
List, and provides user authentication. Zimbra can also work with GAL and
authentication services provided by external LDAP directories such as
Active Directory</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MariaDB</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Database software</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lucene</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Open source full-featured text and search engine</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Third-party source that converts certain attachment file types to HTML</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anti-virus/anti-spam</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Open source components that include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ClamAV, an anti-virus scanner that protects against malicious files</p>
</li>
<li>
<p>SpamAssassin, a mail filter that attempts to identify spam</p>
</li>
<li>
<p>Amavisd-new interfaces between the MTA and one or more content checkers</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache JSieve</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Manages filters for email</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LibreOffice</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>High fidelity document preview</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_zimbra_application_packages">Zimbra Application Packages</h3>
<div class="paragraph">
<p>Zimbra Collaboration provides the application packages listed in
<a href="#table_app_pkgs">Application Packages</a>.</p>
</div>
<table id="table_app_pkgs" class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 2. Application Packages</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Core</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The libraries, utilities, monitoring tools, and basic configuration
files. <code>zmconfigd</code> is contained in the zimbra-core and is automatically
enabled to run on all systems.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Store</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The components for the mailbox server (including Jetty). The Zimbra mailbox
server includes the following components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Data store</strong>&#8201;&#8212;&#8201;A MariaDB database.</p>
</li>
<li>
<p><strong>Message store</strong>&#8201;&#8212;&#8201;Location of all email messages and file attachments.</p>
</li>
<li>
<p><strong>Index store</strong>&#8201;&#8212;&#8201;Index and search technology is provided through
Lucene. Index files are maintained for each mailbox.</p>
</li>
<li>
<p><strong>Web application services</strong>&#8201;&#8212;&#8201;The Jetty web application server runs web
applications (webapps) on any store server. It provides one or more web
application services.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra LDAP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Zimbra Collaboration uses the OpenLDAP&#174; software, which is an open source LDAP
directory server. User authentication, the Zimbra Global Address List, and
configuration attributes are services provided through OpenLDAP. Note that
the Zimbra GAL and authentication services can be provided by an external
LDAP Directory such as Active Directory.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra MTA</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Postfix is the open source mail transfer agent (MTA) that receives email
via SMTP and routes each message to the appropriate Zimbra mailbox server
using Local Mail Transfer Protocol (LMTP). The Zimbra MTA also includes the
anti-virus and anti-spam components.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Proxy</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Zimbra Proxy is a high-performance reverse proxy service for passing
IMAP[S]/POP[S]/HTTP[S] client requests to other internal ZCS
services.This package is normally installed on the MTA server(s) or on its
own independent server(s). When the zimbra-proxy package is installed, the
proxy feature is enabled by default. Installing the Zimbra Proxy is highly
recommended, and required if using a separate web application server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Memcached</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Memcached is automatically selected when the zimbra-proxy is installed. At
least one server must run zimbra-memcached when the proxy is in use. You
can use a single memcached server with one or more Zimbra
proxies. zimbra-memcached is required if using a separate web application
server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra SNMP (Optional)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If you choose to install zimbra-SNMP for monitoring, this package should be
installed on every Zimbra server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Logger (Optional)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If used, this is installed on one mailbox server, and must be installed at
the same time as the mailbox server.The Zimbra Logger installs tools for
syslog aggregation and reporting. If you do not install Logger, the <strong>server
statistics</strong> section of the Administration Console will not display.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Spell (Optional)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Aspell is the open source spell checker used on the Zimbra Web Client. When
Zimbra-Spell is installed, the Zimbra-Apache package is also installed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Apache</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This package is installed automatically when Zimbra Spell or Zimbra
Convertd is installed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Convertd</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This package is installed on the zimbra-store server. Only one
Zimbra-convertd package needs to be present in the Zimbra Collaboration
environment. The default is to install one zimbra-convertd on each
zimbra-store server. When Zimbra-Convertd is installed, the Zimbra-Apache
package is also installed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Archiving (Optional)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Archiving and Discovery offers the ability to store and search all messages
delivered to, or sent by the Zimbra Collaboration Server. This package includes
the cross mailbox search function which can be used for both live and
archive mailbox searches. Note: Using Archiving and Discovery can trigger
additional mailbox license usage. To find out more about Zimbra Archiving
and Discovery, contact Zimbra sales.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_mail_flowmulti_server_configuration">Mail Flow&#8201;&#8212;&#8201;Multi-Server Configuration</h3>
<div class="paragraph">
<p>The configuration for each deployment is dependent on numerous variables
such as the number of mailboxes, mailbox quotas, performance requirements,
existing network infrastructure, IT policies, security methodologies, spam
filtering requirements, and more. In general, deployments share common
characteristics for incoming traffic and user connectivity, as depicted in
the following diagram. Alternate methods for configuring numerous points
within the network are also possible.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mailflow.png" alt="Mail Flow - Multi-Server Configuration">
</div>
</div>
<div class="paragraph">
<p>The numbered sequences are described below:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Inbound Internet mail goes through a firewall and load balancing to the
edge MTA for spam filtering.</p>
</li>
<li>
<p>The filtered mail then goes through a second load balancer.</p>
</li>
<li>
<p>An external user connecting to the messaging server also goes through a
firewall to the second load balancer.</p>
</li>
<li>
<p>The inbound Internet mail goes to any of the Zimbra Collaboration MTA servers
and goes through spam and virus filtering.</p>
</li>
<li>
<p>The designated Zimbra Collaboration MTA server looks up the addressee’s
directory information from the Zimbra Collaboration LDAP replica server.</p>
</li>
<li>
<p>After obtaining the user’s information from the Zimbra Collaboration LDPA
server, the MTA server sends the mail to the appropriate Zimbra Collaboration
server.</p>
</li>
<li>
<p>Internal end-user connections are made directly to any Zimbra Collaboration
server that then obtains the user’s directory information from
Zimbra Collaboration LDAP and redirects the user, as needed.</p>
</li>
<li>
<p>The backups from the Zimbra Collaboration servers can be processed to a mounted
disk.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_system_directory_tree">Zimbra System Directory Tree</h3>
<div class="paragraph">
<p>The following table lists the main directories created by the Zimbra
installation packages. The directory organization is identical for any
server in the Zimbra Collaboration, when installing under (parent) <code>/opt/zimbra</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The directories not listed in the following table are
libraries used for building the core Zimbra software or
miscellaneous third-party tools.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 3. System Directory Tree under <code>/opt/zimbra</code></caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>backup/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backup target contains full and incremental backup data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bin/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaboration application files, including the utilities described
in <a href="#command_line_utilities">Command-Line Utilities</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cdpolicyd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy functions, throttling</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clamav/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clam AV application files for virus and spam controls</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>conf/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>contrib/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Third-party scripts for conveyance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>convertd/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Convert service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cyrus-sasl/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SASL AUTH daemon</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>data/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes data directories for LDAP, mailboxd, postfix, amavisd, clamav</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docs/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAP txt files and technical txt files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extensions-extra/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server extensions for different authentication types</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>extensions-network-extra/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server extensions for different network version authentication types</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>httpd/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the Apache Web server. Used for both aspell and convertd as
separate processes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains Java application files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jetty/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailboxd application server instance. In this directory, the
<code>webapps/zimbra/skins</code> folder includes the Zimbra UI theme files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lib/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Libraries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libexec/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internally used executables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Local logs for Zimbra Collaboration server application</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logger/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RRD and SQLite data files for logger services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mariadb/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MariaDB database files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>net-snmp/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for collecting statistics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openldap/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenLDAP server installation, pre-configured to work</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postfix/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfix server installation, pre-configured to work with Zimbra Collaboration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>redolog/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains current transaction logs for the Zimbra Collaboration server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>snmp/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SNMP monitoring files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ssl/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>store/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbramon/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains control scripts and Perl modules</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimlets/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains Zimlet <code>zip</code> files that are installed with Zimbra</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimlets-deployed/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains Zimlets that are available with the Zimbra Web Client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimlets-network/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains Zimlet <code>zip</code> files for features that are installed with the network
edition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstat/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mailboxd statistics, saved as <code>.csv</code> files</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_zimbra_web_clients">Zimbra Web Clients</h3>
<div class="paragraph">
<p>Zimbra offers multiple Web Client types for the use of Zimbra features.
The Web Clients provide mail, calendar, address book, and task functions.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 4. Zimbra Web Clients</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Client Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced Web Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes Ajax capability and offers a full set of web collaboration
features. This web client works best with newer browsers and fast Internet
connections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard Web Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A good option when Internet connections are slow or users prefer HTML-based
messaging for navigating within their mailbox</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobile HTML Client</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides mobile access to Zimbra when using the Standard Web Client
version.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When users sign in, they view the advanced Zimbra Web Client, unless they use the menu on the login screen to change to the standard version.
If the Web Client detects the screen resolution to be 800x600, users are automatically redirected to the standard Zimbra Web Client.
Users can still choose the advanced Web Client but see a warning message suggesting the use of the standard Web Client for better screen view.</p>
</div>
</div>
<div class="sect2">
<h3 id="_web_services_and_desktop_clients">Web Services and Desktop Clients</h3>
<div class="paragraph">
<p>In addition to using a web browser or mobile device to connect to
Zimbra Collaboration, connection is available using a web service, such as
Exchange Web Services (EWS), or a desktop client such as Zimbra Connector
to Microsoft Outlook. The following are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Exchange Web Services (EWS)</strong> provides client access to enable
Zimbra Collaboration to communicate with the Exchange Server when using Microsoft
Outlook on a Mac device. To enable EWS client access, see the Class of
Service section. EWS is a separately licensed add-on feature.</p>
</li>
<li>
<p><strong>Messaging Application Programming Interface (MAPI)</strong> synchronizes
to supported versions of Microsoft Outlook with full delegate, offline
access and support for S/MIME. Use the Zimbra Connector for Outlook to
connect to Zimbra Collaboration when using Microsoft Outlook on a Windows
device. To enable MAPI (Microsoft Outlook) Connector, see the Class of
Service section.</p>
</li>
<li>
<p>Support for all POP3, IMAP4, Calendaring Extensions to Web Distributed
Authoring and Versioning (CalDAV), and vCard Extensions to Web Distributed Authoring and Versioning (CardDAV) clients.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="offline_mode">Offline Mode</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Offline mode is no more supported for Chrome versions 85 and above (affects <strong>Joule8815-Patch16</strong> onwards). Users can still continue to use Offline mode in previous browser versions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zimbra Offline Mode allows access to data&#8201;&#8212;&#8201;without network connectivity&#8201;&#8212;&#8201;when using the Zimbra Web Client.</p>
</div>
<div class="paragraph">
<p>For example, if there is no server connectivity or if server connectivity is lost, the Web Client automatically transitions to &#8220;offline mode&#8221;.
When server connectivity is restored, the Web Client automatically reverts to &#8220;online mode&#8221;.</p>
</div>
<div class="paragraph">
<p>This offline mode uses the caching capability provided by HTML5 in modern browsers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_security_measures">Security Measures</h3>
<div class="paragraph">
<p>The coordinated use of multiple security measures, targeted to increase the
security of the whole system, is one of the best approaches to securing
your information infrastructure. These measures are implemented in the
Zimbra Collaboration platform as a result of defense mechanisms summarized in the
following topics:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To view current and detailed security news and alerts, please refer to
<a href="https://wiki.zimbra.com/wiki/Security_Center">Security Center</a> on the
<a href="https://wiki.zimbra.com/">Zimbra Wiki</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_identity_and_access_management">Identity and Access Management</h4>
<div class="paragraph">
<p>Key functions built into the system for user identity management are
summarized in the following table:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 5. Identity and Access Management Functions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity Lifecycle Management</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The leveraging of LDAP directory for all Create, Read, Update, and Delete
(CRUD) functions associated to user administration with
Zimbra Collaboration. LDAP usage is optional but all attributes specific to
Zimbra Collaboration are stored and managed through the native LDAP directory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">First Factor Authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The combined user name and password primarily employed by authorized users
when attempting to access the system. These credentials are retained in the
user store: the passwords are stored as salted hash that is compared
against that of the entered password, for rejection (no match) or
acceptance (matched). If external directory (LDAP or Active Directory) is
preferred, the appropriate login credentials can be stored in this external
LDAP directory. See also
<a href="#zimbra_ldap_service">Zimbra LDAP Service</a> for more details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two Factor Authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A second layer of identity security that is configured at the Admin Console
to enable or disable passcode generation to mobile devices associated with
Zimbra Collaboration. When enabled, user or COS accounts must use the generated
passcode to gain access to their client services. See also
<a href="#about_two_factor_auth">About 2 Factor Authentication</a> and
<a href="#two_factor_auth">Two Factor Authentication</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorized Access</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User accounts are defined by various attributes, permission levels, and
policies to allow or disallow what data can be viewed and which functions
can be performed. Admin Console administrators can create groups and assign
access permissions to support targeted business objectives.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_information_security_and_privacy">Information Security and Privacy</h4>
<div class="paragraph">
<p>Functions built into the system to secure data are summarized in the
following table:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Information Security and Privacy Functions</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key Concept</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Management of security, integrity, and privacy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Collaboration supports the use of S/MIME certificates (provided by
publicly trusted Certification Authority (CA), as well as internal PKI;
DomainKeys Identified Mail (DKIM); Domain-based Message Authentication,
Reporting and Conformance (DMARC); Amavisd-new, which is housed in the Mail
Transfer Agent (MTA) to manage incoming and out going DMARC policies.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><strong>Encryption methods:</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In-transit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure connections between endpoints and services use TLS in addition to
various other protocols: SMTP, LMTP+STARTTLS, HTTPS, IMAPS/IMAP+STARTTLS,
POP3S/POP3+STARTTLS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">At-rest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With S/MIME for end-to-end encryption, data stored in a Zimbra Collaboration
message store is encrypted until decryption occurs with the appropriate
private key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anti-virus and Anti-spam</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Both malware and spam are challenged by the Zimbra Collaboration native
functionality and third-party plugins: Amavisd-new, ClamAV, and Spam
Assassin.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_system_logs">System Logs</h4>
<div class="paragraph">
<p>The Zimbra Collaboration system logs&#8201;&#8212;&#8201;generated by SNMP triggers&#8201;&#8212;&#8201;can be used
to record data such as user and administrator activity, login failures,
slow queries, mailbox activity, mobile synchronization activity, and data
based errors. Events, alerts and traps can be forwarded to log management
and event correlation system to create centralized polices and
notifications based on your security and compliance requirements.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 7. Security Data</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Function</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Incident response</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administrators can use remote device wiping and/or account lockout in the
event of a malicious or accidental activities (such as stolen user account
credential, or lost smart phone).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archiving and discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This optional feature allows administrators to select specific user email
messages for archival and application of retention policies, which can be
used for both archived and live mailboxes.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_licensing">Licensing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A Zimbra Collaboration license is required in order to create accounts.
When you purchase, renew, or change the Zimbra Collaboration license, you update the Zimbra server with the new license information.</p>
</div>
<div class="sect2">
<h3 id="_license_types">License Types</h3>
<div class="paragraph">
<p>Zimbra Collaboration licensing gives administrators visibility and control of the licensed features they plan to deploy.
You can monitor usages and manage the following license types.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">License limitations</th>
<th class="tableblock halign-left valign-top">To set maximum number of&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts you can create.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobile accounts limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts that can have the native mail mobile feature enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Touch Client accounts limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts that can have the touch client mobile feature enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MAPI accounts limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts that can use Zimbra Connector for Microsoft Outlook (ZCO).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exchange web services (EWS) accounts limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts that can use EWS for connecting to an Exchange server.
EWS is a separately licensed add-on feature.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">High-fidelity document preview</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts that can use the High-Fidelity document preview facility.
LibreOffice installation is required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archiving accounts limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allowed archive accounts.
The archive feature installation is required.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="License_Requirements">Zimbra License Requirements</h3>
<div class="paragraph">
<p>A Zimbra license is required to create accounts in the Network Edition of Zimbra Collaboration.</p>
</div>
<div class="paragraph">
<p>To try out Zimbra Collaboration, you can obtain trial versions free of charge.
Once you are ready to install a production environment, you need to purchase a subscription or a perpetual license.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">License Types</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trial</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can obtain a free Trial license from the Zimbra website, at <a href="https://www.zimbra.com" class="bare">https://www.zimbra.com</a>.
The trial license allows you to create up to 50 users.
It expires in 60 days.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trial extended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You can obtain a Trial Extended license from Zimbra Sales by contacting <a href="mailto:sales@zimbra.com">sales@zimbra.com</a> or calling 1-972-407-0688.
This license allows you to create up to 50 users and is valid for an extended period.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Zimbra Subscription license can only be obtained through purchase.
This license is valid for a specific Zimbra Collaboration system, is encrypted with the number of Zimbra accounts (seats) you have purchased, the effective date, and the expiration date of the subscription license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perpetual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Zimbra Perpetual license can only be obtained through purchase.
This license is similar to a subscription license.
It is valid for a specific Zimbra Collaboration system, is encrypted with the number of Zimbra accounts (seats) you have purchased, the effective date, and an expiration date of 2099-12-31.
When you renew your support agreement, you receive no new perpetual license, but your Account record in the system gets updated with your new support end date.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_license_usage_by_account_type">License Usage by Account Type</h3>
<div class="paragraph">
<p>An account assigned to a person, including an account created for archiving, requires a mailbox license.
Distribution lists, aliases, locations, and resources do not count against the license.</p>
</div>
<div class="paragraph">
<p>Below is a description of types of Zimbra Collaboration accounts and if they impact your license limit.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">License Account Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System accounts are specific accounts used by Zimbra Collaboration.
They include the spam filter accounts for junk mail (spam and ham), the virus quarantine account for email messages with viruses, and the GALsync account if you configure GAL for your domain.</p>
<p class="tableblock"><strong>Do not delete these accounts!</strong> These accounts do not count against your license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administrator account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administrator and delegated administrator accounts count against your license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User accounts count against your license account limit.</p>
<p class="tableblock">When you delete an account, the license account limit reflects the change.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias account</p></td>
<td class="tableblock halign-center valign-middle" rowspan="3"><p class="tableblock">These types do not count against your license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource account</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_license_activation">License Activation</h3>
<div class="paragraph">
<p>All Network Edition installations require license activation.
New installations have a 10 day grace period from the license issue date before requiring activation.
You can activate your license in the Administration Console.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; License</strong>, from the <strong>Gear</strong> icon select <strong>Activate License</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can also activate your license from the command line interface.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Upgraded Zimbra Collaboration versions require an immediate activation to maintain network feature functionality.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_automatic_license_activation">Automatic License Activation</h4>
<div class="paragraph">
<p>Licenses are automatically activated if the Zimbra Collaboration server has a connection to the Internet and can communicate with the Zimbra License server.
If you are unable to activate your license this way, see the next section on <a href="#Manual_License_Activation">Manual License Activation</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="Manual_License_Activation">Manual License Activation</h4>
<div class="paragraph">
<p>For systems that do not have external access to the Zimbra License server, you can use the Zimbra Support Portal to activate your license manually.</p>
</div>
<div class="paragraph">
<p>Go to the Zimbra website at <a href="https://www.zimbra.com" class="bare">https://www.zimbra.com</a> and click on <strong>Support</strong> to display the Zimbra Technical Support page.
Click on the <strong>Support Portal Login</strong> button to display the Zimbra Support Portal page.
Enter your email and password to log in.</p>
</div>
<div class="paragraph">
<p>If you have problems accessing the Support Portal, contact Zimbra Sales at <a href="mailto:sales@zimbra.com">sales@zimbra.com</a> or by calling 1-972-407-0688.688.</p>
</div>
</div>
<div class="sect3">
<h4 id="_when_licenses_are_not_installed_or_activated">When Licenses are not Installed or Activated</h4>
<div class="paragraph">
<p>If you fail to install or activate your Zimbra Collaboration server license, the following scenarios describe the impact on your Zimbra Collaboration server.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">License Condition</th>
<th class="tableblock halign-left valign-top">Description/Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not installed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">With no installed license, the Zimbra Collaboration server defaults to single user mode where all license-limited features are limited to one user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not valid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the license file appears forged or fails validation for other reasons, the Zimbra Collaboration server defaults to single-user mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not activated</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A license activation grace period is 10 days.
If this period passes without activation, the Zimbra Collaboration server defaults to single-user mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">For future date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the license starting date is in the future, the Zimbra Collaboration server defaults to single-user mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">In grace period</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the license ending date has passed and is within the 30 day grace period, all license-limited features are still enabled, but administrators may see license renewal prompts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expired</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the license ending date has passed and the 30 day grace period expired, the Zimbra Collaboration server defaults to the feature set of the Open Source Edition.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_obtain_a_license">Obtain a License</h3>
<div class="paragraph">
<p>Go to the Zimbra Website <a href="https://www.zimbra.com" class="bare">https://www.zimbra.com</a> to obtain a trial license from the Network Downloads area.
Contact Zimbra sales regarding a trial extended license, or to purchase a subscription license or perpetual license, by emailing <a href="mailto:sales@zimbra.com">sales@zimbra.com</a> or calling 1-972-407-0688.</p>
</div>
<div class="paragraph">
<p>A subscription or perpetual license can only install on the Zimbra Collaboration system identified during purchase.
Only one Zimbra license is required for your Zimbra Collaboration environment.
This license sets the maximum number of accounts on the system.</p>
</div>
<div class="paragraph">
<p>View current license information, including the number of purchased accounts, the number of accounts used, and the expiration date, in the Admin Console.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; License</strong>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_managing_licenses">Managing Licenses</h3>
<div class="paragraph">
<p>Use the <strong>Update License</strong> wizard on the Administration Console&#8217;s <strong>Global Settings</strong> page to upload and install a new license.
The <strong>Activate License</strong> link on the toolbar activates the license.</p>
</div>
<div class="paragraph">
<p>View current license information, including the number of purchased accounts, the number of accounts used, and the expiration date, in the Admin Console.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; License</strong>.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_license_information">License Information</h4>
<div class="paragraph">
<p>You must have a Zimbra Collaboration license to create accounts.
When you purchase, renew, or change the Zimbra license, you must update the Zimbra server with the new license information.
The <strong>Update License Wizard</strong> from the Administration Console&#8217;s Global Settings is used to upload and install a new license.
The <strong>Activate License</strong> link on the toolbar activates the license.</p>
</div>
<div class="paragraph">
<p>View current license information, including the number of purchased accounts, the number of accounts used, and the expiration date, in the Admin Console.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; License</strong>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_license_expiration">License Expiration</h4>
<div class="paragraph">
<p>When your Zimbra Collaboration Network Edition License expires, a license expiration warning appears in the administrative console and web interface for all users.
From the date of the license expiration, there is a 30-day grace period during which the administrator sees the warning message, but no features are disabled.</p>
</div>
<div class="paragraph">
<p>Upon expiration of the grace period, the server reverts to the feature set of the Open Source Edition.
The following is a list of some of the major functions that are no longer available upon license expiration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Backup/Restore</p>
</li>
<li>
<p>Exchange Web Services (EWS)&#8201;&#8212;&#8201;<em>a separately licensed add-on</em></p>
</li>
<li>
<p>High-Fidelity Document Preview</p>
</li>
<li>
<p>Zimbra Connector for Outlook</p>
</li>
<li>
<p>S/MIME
If you do not plan to renew your license, you can regain the ability to create or delete accounts by downgrading to Zimbra Collaboration free and open-source software (FOSS).
You should choose the same version of FOSS that you are currently running on the Zimbra Collaboration Network Edition for this transition, after which you can upgrade to the latest version of Zimbra Collaboration FOSS.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_renewal">Renewal</h4>
<div class="paragraph">
<p>If you exhaust your licensed user limit, you are no longer able to create accounts.
You can buy additional user licenses, or you can delete existing accounts.
Contact Zimbra sales to purchase additional licenses.</p>
</div>
<div class="paragraph">
<p>You must renew your license within 30 days of the expiration date.
Starting 30 days before the license expires, when you log on to the Administration Console, a reminder notice is displayed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_updating_your_license">Updating Your License</h3>
<div class="paragraph">
<p>When you renew or change the Zimbra license, you update Zimbra Collaboration mailbox servers with the new license information.
Perform this operation from either the CLI or the Administration Console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlicense</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; License</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Updating a license:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Save the license on the computer you use to access the Administration Console.</p>
</li>
<li>
<p>Log on to the Administration Console, go to <strong>Home &#8594; Configure &#8594; Global Settings &#8594; License</strong>, from the <strong>Gear</strong> icon select <strong>Update License</strong>. The License Installation Wizard opens.</p>
</li>
<li>
<p>Browse to select the license file and click <strong>Next</strong>. The license file is now uploaded.</p>
</li>
<li>
<p>Click <strong>Install</strong> to install the license file.</p>
</li>
<li>
<p>Click <strong>Activate License</strong>. Upgraded Zimbra Collaboration versions require an immediate activation to maintain network feature functionality.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Your license information is updated automatically, and the cached account license count refreshes on each mailbox server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_license_reconciliation_and_data_collection_notice">License Reconciliation and Data Collection Notice</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
By consenting to the End-User License Agreement, you grant Synacor Inc.
and certain of its licensees permission to collect licensing and non-personally-identifiable usage data from your Zimbra Collaboration Network Edition server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>During installation, upgrades, and periodically while in use, the Zimbra Collaboration server transmits information for reconciliation of billing and license data.</p>
</div>
<div class="paragraph">
<p>Permission for this data collection is granted under sections 11.4 and 11.6 of the End User License Agreement for Network Edition.
Copies of the license can be found at <a href="https://www.zimbra.com/legal/licensing/" class="bare">https://www.zimbra.com/legal/licensing/</a>.</p>
</div>
<div class="paragraph">
<p>The data that is being collected consists of elements of the current license information and is governed by Synacor&#8217;s Privacy Policy, which can be found at <a href="https://www.synacor.com/privacy-policy/" class="bare">https://www.synacor.com/privacy-policy/</a>.</p>
</div>
<div class="paragraph">
<p>This data is being furnished to Synacor&#8217;s licensor, ZeXtras, for the purposes of license reconciliation and is therefore also governed by the ZeXtras Privacy Policy, which can be found at <a href="https://www.zextras.com/privacy-legal/" class="bare">https://www.zextras.com/privacy-legal/</a>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zimbra_mailbox_server">Zimbra Mailbox Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Zimbra mailbox server is a dedicated server that manages all the
mailbox content, including messages, contacts, calendar, and
attachments.</p>
</div>
<div class="paragraph">
<p>The Zimbra mailbox server has dedicated volumes for backup and log
files. Each Zimbra mailbox server can see only its own storage volumes.
Zimbra mailbox servers cannot see, read, or write to another server.</p>
</div>
<div class="sect2">
<h3 id="_mailbox_server">Mailbox Server</h3>
<div class="paragraph">
<p>Each account is configured on one mailbox server, and this account is
associated with a mailbox that contains email messages, attachments,
calendar, contacts and collaboration files for that account.</p>
</div>
<div class="paragraph">
<p>Each mailbox server has its own standalone message store, data store,
and index store for the mailboxes on that server. The following is an
overview of each store and their directory location.</p>
</div>
<div class="sect3">
<h4 id="_message_store">Message Store</h4>
<div class="paragraph">
<p>All email messages are stored in MIME format in the Message Store,
including the message body and file attachments.</p>
</div>
<div class="paragraph">
<p>By default, the message store is located on each mailbox server under
<code>/opt/zimbra/store</code>. Each mailbox has its own directory named after its
internal mailbox ID. Mailbox IDs are unique per server, not system-wide.</p>
</div>
<div class="paragraph">
<p>Messages with multiple recipients are stored as a single -copy on the
message store. On UNIX systems, the mailbox directory for each user
contains a hard link to the actual file.</p>
</div>
<div class="paragraph">
<p>When Zimbra Collaboration is installed, one index volume and one message
volume are configured on each mailbox server. Each mailbox is assigned to a
permanent directory on the current index volume. When a new message is
delivered or created, the message is saved in the current message volume.</p>
</div>
<div class="paragraph">
<p>To manage your email storage resources, you can configure storage
volumes for older messages by implementing a Hierarchical Storage
Management (HSM) policy.
See <a href="#managing_configuration">Managing Configuration</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_store">Data Store</h4>
<div class="paragraph">
<p>The Data Store is a SQL database where internal mailbox IDs are
linked with user accounts. All the message metadata including tags,
conversations, and pointers indicate where the messages are stored in
the file system. The SQL database files are located in
<code>/opt/zimbra/db</code>.</p>
</div>
<div class="paragraph">
<p>Each account (mailbox) resides only on one server. Each server has its
own standalone data store containing data for the mailboxes on that
server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The data store maps the mailbox IDs to the users' LDAP
accounts. The primary identifier within the Zimbra Collaboration database
is the mailbox ID, rather than a user name or account name. The mailbox
ID is only unique within a single mailbox server.</p>
</li>
<li>
<p>Metadata including user&#8217;s set of tag definitions, folders, contacts,
calendar appointments, tasks, Briefcase folders, and filter rules are in
the data store database.</p>
</li>
<li>
<p>Information about each mail message, including whether it is read or
unread, and which tags are associated is stored in the data store
database.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_index_store">Index Store</h4>
<div class="paragraph">
<p>The index and search technology is provided through Apache Lucene. Each
email message and attachment is automatically indexed when the message
arrives. An index file is associated with each account. Index files are
located in <code>/opt/zimbra/index</code>.</p>
</div>
<div class="paragraph">
<p>The tokenizing and indexing process is not configurable by
administrators or users.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Tokenization.jpg" alt="Index Store">
</div>
</div>
<div class="paragraph">
<p>The process is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Zimbra MTA routes the incoming email to the mailbox server that
contains the account&#8217;s mailbox.</p>
</li>
<li>
<p>The mailbox server parses the message, including the header, the
body, and all readable file attachments such as PDF files or Microsoft
Word documents, in order to tokenize the words.</p>
</li>
<li>
<p>The mailbox server passes the tokenized information to Lucene to
create the index files.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tokenization is the method for indexing by each word.  Certain common
patterns, such as phone numbers, email addresses, and domain names are
tokenized as shown in the Message Tokenization illustration.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_application_server">Web Application Server</h3>
<div class="paragraph">
<p>The Jetty web application server runs web applications (webapps) on any
store server. It provides one or more web application services.</p>
</div>
<div class="sect3">
<h4 id="_mailstore_services">Mailstore Services</h4>
<div class="paragraph">
<p>Mailstore services provides the back-end access to mailbox/account data.
Webapps for the mailstore include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mailstore (mail server) = <code>/opt/zimbra/jetty/webapps/service</code></p>
</li>
<li>
<p>Zimlets = <code>/opt/zimbra/jetty/webapps/zimlet</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_user_interface_services">User Interface Services</h4>
<div class="paragraph">
<p>User Interface services provide front-end user interface access to the
mailbox account data and Administration Console, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Web Clients = <code>/opt/zimbra/jetty/webapps/zimbra</code></p>
</li>
<li>
<p>Zimbra administrator console = <code>/opt/zimbra/jetty/webapps/zimbraAdmin</code></p>
</li>
<li>
<p>Zimlets = <code>/opt/zimbra/jetty/webapps/zimlet</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_web_application_server_split">Web Application Server Split</h3>
<div class="paragraph">
<p>The Web Application Server Split functionality provides an option to
separate the mailstore services (mail server) and the user interface
services (web client server).</p>
</div>
<div class="paragraph">
<p>For example, a web client server running 'zimbra,zimbraAdmin' webapps
serving the static UI content like html/css pages, and mail server
running 'service' webapp serving all the SOAP requests. These servers
are running in split mode.</p>
</div>
<div class="paragraph">
<p>The Web Application Server Split benefits include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Splitting the web client server from the mail server makes the
customization process more agile, allowing the roll out of new or
updated web UI customization without having to restart the mail servers.
This means zero down time.</p>
</li>
<li>
<p>If you want to customize the Zimbra Web Client or Zimbra
Administration Console, you can take the web client server offline and
run customization or maintenance, while not having to take down the mail
server.</p>
</li>
<li>
<p>The web client server is completely decoupled from mailbox accounts.
This means any web client server can service any account request.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_installation_and_configuration_of_the_web_application_server_split">Installation and Configuration of the Web Application Server Split</h4>
<div class="paragraph">
<p>For installation and configuration of the Web Application Server Split,
see the Zimbra Collaboration Multi-Server Installation Guide.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backing_up_the_mailbox_server">Backing Up the Mailbox Server</h3>
<div class="paragraph">
<p>Zimbra Collaboration includes a configurable backup manager that resides on
every Zimbra Collaboration server and performs both backup and restore
functions. You do not have to stop the Zimbra Collaboration server in order
to run the backup process. The backup manager can be used to restore a
single user, rather than having to restore the entire system in the event
that one user&#8217;s mailbox becomes corrupted. Full and incremental backups are
in <code>/opt/zimbra/backup</code>.
See <a href="#backup_and_restore">Backup and Restore</a>.</p>
</div>
<div class="paragraph">
<p>Each Zimbra mailbox server generates redo logs that contain current and
archived transactions processed by the message store server since the
last incremental backup. When the server is restored, after the backed
up files are fully restored, any redo logs in the archive and the
current redo log in use are replayed to bring the system to the point
before the failure.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mailbox_server_logs">Mailbox Server Logs</h3>
<div class="paragraph">
<p>A Zimbra Collaboration deployment consists of various third-party
components with one or more mailbox servers. Each of the components may
generate its own logging output. Local logs are in <code>/opt/zimbra/log</code>.</p>
</div>
<div class="paragraph">
<p>Selected Zimbra Collaboration log messages generate SNMP traps, which you
can capture using any SNMP monitoring software.
See <a href="#monitoring_zcs_servers">Monitoring ZCS Servers</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
System logs, redo logs, and backup sessions should be on separate disks to
minimize the possibility of unrecoverable data loss in the event that one
of those disks fails.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_imap">IMAP</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra Collaboration has a built-in IMAP server which is installed by default and is part of zimbra-mailboxd process (<a href="#zimbra_mailbox_server">Zimbra Mailbox Server</a>).</p>
</div>
<div class="sect2">
<h3 id="_common_imap_configuration_settings">Common IMAP Configuration settings</h3>
<div class="paragraph">
<p>The following global and server level configuration attributes are available to control and tune the IMAP service.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>zimbraImapServerEnabled</strong>. When set to TRUE, in-process IMAP server is enabled. When set to FALSE, in-process IMAP server is disabled. Default value is TRUE.</p>
</li>
<li>
<p><strong>zimbraImapSSLServerEnabled</strong>. When set to TRUE, in-process IMAP SSL server is enabled. When set to FALSE, in-process IMAP SSL server is disabled. Default value is TRUE</p>
</li>
<li>
<p><strong>zimbraImapBindAddress</strong> (can be set only on server level). Specifies interface address on which in-process IMAP server should listen; if empty, binds to all interfaces.</p>
</li>
<li>
<p><strong>zimbraImapBindPort</strong>. Specifies port number on which in-process IMAP server should listen. Default value is 7143.</p>
</li>
<li>
<p><strong>zimbraImapSSLBindAddress</strong> (can be set only on server level). Specifies interface address on which in-process IMAP SSL server should listen; if empty, binds to all interfaces.</p>
</li>
<li>
<p><strong>zimbraImapSSLBindPort</strong>. Specifies port number on which in-process IMAP SSL server should listen on. Default value is 7993.</p>
</li>
<li>
<p><strong>zimbraImapNumThreads</strong>. Specifies number of threads in IMAP handler&#8217;s thread pool. Zimbra Collaboration uses IMAP NIO by default, which allows each IMAP handler thread to handle multiple connections. The default value of 200 is sufficient to handle up to 10,000 active IMAP clients.</p>
</li>
<li>
<p><strong>zimbraImapCleartextLoginEnabled</strong>. Specifies whether or not to allow cleartext logins over a non SSL/TLS connection. Default value is FALSE.</p>
</li>
<li>
<p><strong>zimbraImapProxyBindPort</strong>. Specifies port number on which IMAP proxy server should listen. Default value is 143. See <a href="#zimbra_proxy_components">Zimbra Proxy Components</a> for more information.</p>
</li>
<li>
<p><strong>zimbraImapSSLProxyBindPort</strong>. Specifies port number on which IMAP SSL proxy server should listen. Default value is 993. See <a href="#zimbra_proxy_components">Zimbra Proxy Components</a> for more information.</p>
</li>
<li>
<p><strong>zimbraImapMaxRequestSize</strong>. Specifies maximum size of IMAP request in bytes excluding literal data. <strong>Note:</strong> this setting does not apply to IMAP LOGIN requests. IMAP LOGIN requests are handled by IMAP Proxy (<a href="#zimbra_proxy_components">Zimbra Proxy Components</a>) and are limited to 256 characters.</p>
</li>
<li>
<p><strong>zimbraImapInactiveSessionCacheMaxDiskSize</strong>. Specifies the maximum disk size of inactive IMAP cache in Bytes before eviction. By default this value is 10GB. This is a rough limit, because due to internals of Ehcache actual size on disk will often exceed this limit by a modest margin.</p>
</li>
<li>
<p><strong>zimbraImapInactiveSessionEhcacheSize</strong>. Specifies the maximum heap size of the inactive session cache in Bytes before eviction. By default this value is 1 megabyte. This is a rough limit, because due to internals of Ehcache actual size in memory will often exceed this limit by a modest margin.</p>
</li>
<li>
<p><strong>zimbraImapActiveSessionEhcacheMaxDiskSize</strong>. Specifies the maximum amount of disk space the imap active session cache will consume in Bytes before eviction. By default this value is 100 gigabytes. This is a rough limit, because due to internals of ehcache actual size in memory will often exceed this limit by a modest margin.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zimbra_ldap_service">Zimbra LDAP Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LDAP directory services provide a centralized repository for information
about users and devices that are authorized to use your Zimbra service.
The central repository used for Zimbra&#8217;s LDAP data is the OpenLDAP
directory server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Zimbra Collaboration supports integration with Microsoft&#8217;s Active Directory
Server.  Contact support for information on specific directory
implementation scenarios.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The LDAP server is installed when ZCS is installed.  Each
server has its own LDAP entry that includes attributes specifying operating
parameters.  In addition, a global configuration object sets defaults for
any server whose entry does not specify every attribute.</p>
</div>
<div class="paragraph">
<p>A subset of these attributes can be modified through the Zimbra
administration console and others through the zmprov commands.</p>
</div>
<div class="sect2">
<h3 id="_ldap_traffic_flow">LDAP Traffic Flow</h3>
<div class="paragraph">
<p>The LDAP Directory Traffic figure shows traffic between the Zimbra-LDAP
directory server and the other servers in the Zimbra Collaboration system.  The
Zimbra MTA and the Zimbra Collaboration mailbox server read from, or write to,
the LDAP database on the directory server.</p>
</div>
<div class="paragraph">
<p>The Zimbra clients connect through the Zimbra server, which connects to
LDAP.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ldap_traffic_flow.png" alt="LDAP Traffic Flow">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_directory_hierarchy">LDAP Directory Hierarchy</h3>
<div class="paragraph">
<p>LDAP directories are arranged in an hierarchal tree-like structure with two
types of branches, the mail branches and the config branch.  Mail branches
are organized by domain.  Entries belong to a domain, such as accounts,
groups, aliases, are provisioned under the domain DN in the directory.  The
config branch contains admin system entries that are not part of a domain.
Config branch entries include system admin accounts, global config, global
grants, COS, servers, mime types, and Zimlets.</p>
</div>
<div class="paragraph">
<p>The Zimbra LDAP Hierarchy figure shows the Zimbra LDAP hierarchy.  Each
type of entry (object) has certain associated object classes.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/ldap_directory_hierarchy.png" alt="LDAP Directory Hierarchy">
</div>
</div>
<div class="paragraph">
<p>An LDAP directory entry consists of a collection of attributes and has a
globally unique distinguished name (<code>dn</code>).  The attributes allowed for an
entry are determined by the <em>object classes</em> associated with that entry.
The values of the object class attributes determine the schema rules the
entry must follow.</p>
</div>
<div class="paragraph">
<p>An entry&#8217;s object class that determines what kind of entry it is, is called
a structural object class and cannot be changed.  Other object classes are
called auxiliary and may be added to or deleted from the entry.</p>
</div>
<div class="paragraph">
<p>Use of auxiliary object classes in LDAP allows for an object class to be
combined with an existing object class.  For example, an entry with
structural object class <strong>inetOrgPerson</strong>, and auxiliary object class
<strong>zimbraAccount</strong>, would be an account.  An entry with the structural object
class <strong>zimbraServer</strong> would be a server in the Zimbra system that has one or
more Zimbra packages installed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_collaboration_ldap_schema">Zimbra Collaboration LDAP Schema</h3>
<div class="paragraph">
<p>At the core of every LDAP implementation is a database organized using a
schema.</p>
</div>
<div class="paragraph">
<p>The Zimbra LDAP schema extends the generic schema included with OpenLDAP
software.  It is designed to coexist with existing directory installations.</p>
</div>
<div class="paragraph">
<p>All attributes and object classes specifically created for Zimbra Collaboration
are prefaced by &#8220;zimbra&#8221;, such as <code>zimbraAccount</code> object class or
<code>zimbraAttachmentsBlocked</code> attribute.</p>
</div>
<div class="paragraph">
<p>The following schema files are included in the OpenLDAP implementation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>core.schema</p>
</li>
<li>
<p>cosine.schema</p>
</li>
<li>
<p>inetorgperson.schema</p>
</li>
<li>
<p>zimbra.schema</p>
</li>
<li>
<p>amavisd.schema</p>
</li>
<li>
<p>dyngroup.schema</p>
</li>
<li>
<p>nis.schema</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot modify the Zimbra schema.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_zimbra_collaboration_objects">Zimbra Collaboration Objects</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Object</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Object class</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents an account on the Zimbra mailbox server that can be logged into.
Account entries are either administrators or user accounts.
The object class name is <strong>zimbraAccount</strong>.
This object class extends the <strong>zimbraMailRecipient</strong> object class.<br>
All accounts have the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A name in the format of user@example.domain A unique ID that never changes and is never reused.</p>
</li>
<li>
<p>A set of attributes, some of which are user-modifiable (preferences) and others that are only configurable by administrators.</p>
</li>
<li>
<p>All user accounts are associated with a domain, so a domain must be created before creating any accounts.</p>
</li>
</ul>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraAccount</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class of Service (COS)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines the default attributes an account has and what features are allowed
or denied.  The COS controls features, default preference settings, mailbox
quotas, message lifetime, password restrictions, attachment blocking, and
server pools for creation of new accounts.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraCOS</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents an email domain such as <strong>example.com</strong> or <strong>example.org</strong>.  A
domain must exist before email addressed to users in that domain can be
delivered.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraDomain</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution Lists</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Also known as mailing lists, are used to send mail to all members of a list
by sending a single email to the list address.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraDistributionList</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Groups</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Are like distribution lists.  The difference is members of a dynamic group
are dynamically computed by a LDAP search.  The LDAP search filter is
defined in an attribute on the dynamic group entry.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both distribution lists and dynamic groups can be used as grantee or target
in the delegated administrator framework.
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraGroup</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servers</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents a particular server in the Zimbra system that has one or more of
the Zimbra software packages installed.  Attributes describe server
configuration information, such as which services are running on the
server.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraServer</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global Configuration</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies default values for the following objects: server and domain.  If
the attributes are not set for other objects, the values are inherited from
the global settings.  Global configuration values are required and are set
during installation as part of the Zimbra core package.  These become the
default values for the system.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraGlobalConfig</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alias</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents an alias of an account, distribution list or a dynamic group.
The <strong>zimbraAliasTarget</strong> attribute points to target entry of this alias
entry.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraAlias</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines Zimlets that are installed and configured in Zimbra.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraZimletEntry</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar Resource</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Defines a calendar resource such as conference rooms or equipment that can
be selected for a meeting.  A calendar resource is an account with
additional attributes on the <strong>zimbraCalendarResource</strong> object class.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraCalendarResource</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents a persona of a user.  A persona contains the user&#8217;s identity
such as display name and a link to the signature entry used for outgoing
emails.  A user can create multiple personas.  Identity entries are created
under the user&#8217;s LDAP entry in the DIT.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraIdentity</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Source</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents an external mail source of a user.  Two examples of data source
are POP3 and IMAP.  A data source contains the POP3/IMAP server name, port,
and password for the user&#8217;s external email account.  The data source also
contains persona information, including the display name and a link to the
signature entry for outgoing email messages sent on behalf of the external
account.  Data Source entries are created under the user&#8217;s LDAP entry in
the DIT.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraDataSource</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Signature</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Represents a user&#8217;s signature.  A user can create multiple signatures.
Signature entries are created under the user&#8217;s LDAP entry in the DIT.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>zimbraSignature</strong></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_account_authentication">Account Authentication</h3>
<div class="paragraph">
<p>Supported authentication mechanisms are Internal, External LDAP, and
External Active Directory.  The authentication method type is set on a
per-domain basis.  If <code>zimbraAuthMech</code> attribute is not set, the default is
to use internal authentication.</p>
</div>
<div class="paragraph">
<p>The internal authentication method uses the Zimbra schema running on the
OpenLDAP server.</p>
</div>
<div class="paragraph">
<p>The <code>zimbraAuthFallbackToLocal</code> attribute can be enabled so that the system
falls back to the local authentication if external authentication fails.
The default is FALSE.</p>
</div>
<div class="sect3">
<h4 id="_internal_authentication_mechanism">Internal Authentication Mechanism</h4>
<div class="paragraph">
<p>The internal authentication method uses the Zimbra schema running on the
OpenLDAP directory server.  For accounts stored in the OpenLDAP server, the
<code>userPassword</code> attribute stores a salted-SHA512 (SSHA512) digest of the user&#8217;s
password.  The user&#8217;s provided password is computed into the SSHA digest
and then compared to the stored value.</p>
</div>
</div>
<div class="sect3">
<h4 id="_external_ldap_and_external_ad_authentication_mechanism">External LDAP and External AD Authentication Mechanism</h4>
<div class="paragraph">
<p>External LDAP and external Active Directory authentication can be used if
the email environment uses another LDAP server or Microsoft Active
Directory for authentication and Zimbra LDAP for all other
Zimbra Collaboration related transactions.  This requires that users exist in
both OpenLDAP and in the external LDAP server.</p>
</div>
<div class="paragraph">
<p>The external authentication methods attempt to bind to the specified LDAP
server using the supplied user name and password.  If this bind succeeds,
the connection is closed and the password is considered valid.</p>
</div>
<div class="paragraph">
<p>The <code>zimbraAuthLdapURL</code> and <code>zimbraAuthLdapBindDn</code> attributes are required
for external authentication.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraAuthLdapURL</code> attribute <code>ldap://ldapserver:port/</code> identifies the IP
address or host name of the external directory server, and port is the
port number.  You can also use the fully qualified host name instead of
the port number.</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>ldap://server1:3268
ldap://exch1.acme.com</pre>
</div>
</div>
<div class="paragraph">
<p>If it is an SSL connection, use <code>ldaps:</code> instead of <code>ldap:</code>.  The SSL
certificate used by the server must be configured as a trusted certificate.</p>
</div>
</li>
<li>
<p><code>zimbraAuthLdapBindDn</code> attribute is a format string used to determine
which DN to use when binding to the external directory server.</p>
<div class="paragraph">
<p>During the authentication process, the user name starts out in the
format: <strong>user@example.com</strong></p>
</div>
<div class="paragraph">
<p>The user name might need to be transformed into a valid LDAP bind <code>DN</code>
(distinguished name) in the external directory.  In the case of Active
Directory, that bind <code>dn</code> might be in a different domain.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_custom_authentication">Custom Authentication</h4>
<div class="paragraph">
<p>You can implement a custom authentication to integrate external
authentication to your proprietary identity database.  When an
authentication request comes in, Zimbra checks the designated auth
mechanism for the domain.  If the auth mechanism is set to custom
authentication, Zimbra invokes the registered custom auth handler to
authenticate the user.</p>
</div>
<div class="paragraph">
<p>To set up custom authentication, prepare the domain for the custom auth and
register the custom authentication handler.</p>
</div>
<div class="sect4">
<h5 id="_preparing_a_domain_for_custom_auth">Preparing a domain for custom auth</h5>
<div class="paragraph">
<p>To enable a domain for custom auth, set the domain attribute,
<strong>zimbraAuthMech to custom:{registered-custom-auth-handler-name}</strong>.</p>
</div>
<div class="paragraph">
<p>In the following example, "sample" is the name under which custom
authentication is registered.</p>
</div>
<div class="exampleblock">
<div class="title">Example 1. Enable a domain for custom authentication</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifydomain {domain|id} zimbraAuthMech custom:sample</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_register_a_custom_authentication_handler">Register a custom authentication handler</h5>
<div class="paragraph">
<p>To register a custom authentication handler, invoke:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">ZimbraCustomAuth.register( handlerName, handler )</code></pre>
</div>
</div>
<div class="paragraph">
<p>in the init method of the extension.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Class: <strong>com.zimbra.cs.account.ldap.ZimbraCustomAuth</strong></p>
</li>
<li>
<p>Method: <code>public synchronized static void register (String handlerName, ZimbraCustomAuth handler)</code></p>
<div class="paragraph">
<p>Definitions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>handlerName</strong> is the name under which this custom auth handler
isregistered to Zimbra&#8217;s authentication infrastructure.  This name is
set in the domain&#8217;s zimbraAuthMech attribute of the domain.</p>
</li>
<li>
<p><strong>handler</strong> is the object on which the authenticate method is invoked
forthis custom auth handler.  The object has to be an instance of
<code>ZimbraCustomAuth</code> (or subclasses of it).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 2. Registering a custom authentication handler</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SampleExtensionCustomAuth</span> <span class="directive">implements</span> ZimbraExtension {

  <span class="directive">public</span> <span class="type">void</span> init() <span class="directive">throws</span> ServiceException {
  <span class="comment">/*
   * Register to Zimbra's authentication infrastructure
   * custom:sample should be set for domain attribute zimbraAuthMech
   */</span>
   ZimbraCustomAuth.register(<span class="string"><span class="delimiter">&quot;</span><span class="content">sample</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> SampleCustomAuth());
  }
...
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_how_custom_authentication_works">How Custom Authentication Works</h5>
<div class="paragraph">
<p>When an authentication request comes in and the domain is specified to use custom authentication, the authenticating framework invokes the authenticate method on the <code>ZimbraCustomAuth</code> instance passed as the handler parameter to <code>ZimbraCustomAuth.register()</code>.</p>
</div>
<div class="paragraph">
<p>The account object for the principal to be authenticated and the clear-text password entered by the user are passed to <code>ZimbraCustomAuth.authenticate()</code>.</p>
</div>
<div class="paragraph">
<p>All attributes of the account can be retrieved from the account object.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_kerberos5_authentication_mechanism">Kerberos5 Authentication Mechanism</h4>
<div class="paragraph">
<p>Kerberos5 Authentication Mechanism authenticates users against an external
Kerberos server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the domain attribute <code>zimbraAuthMech</code> to <code>kerberos5</code>.</p>
</li>
<li>
<p>Set the domain attribute <code>zimbraAuthKerberos5Realm</code> to the Kerberos5
realm in which users in this domain are created in the Kerberos
database.
When users log in with an email password and the domain,
<code>zimbraAuthMech</code> is set to <code>kerberos5</code>, the server constructs the
Kerberos5 principal by
<code>{localpart-of-the-email}@{value-of-zimbraAuthKerberos5Realm}</code> and
uses that to authenticate to the kerberos5 server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To specify Kerberos5 for an individual account set the account&#8217;s
<code>zimbraForeignPrincipal</code> as <code>kerberos5:{kerberos5-principal}</code>.  For
example: kerberos5:user1@MYREALM.COM.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_global_address_list">Global Address List</h3>
<div class="paragraph">
<p>The Global Address List (GAL) is a company directory of users, usually
within the organization itself, that is available to all users of the email
system.  Zimbra Collaboration uses the company directory to look up user
addresses from within the company.</p>
</div>
<div class="paragraph">
<p>For each Zimbra Collaboration domain you can configure GAL to use:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>External LDAP server</p>
</li>
<li>
<p>Zimbra Collaboration internal LDAP server</p>
</li>
<li>
<p>Both external LDAP server and Zimbra Collaboration LDAP in GAL searches</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Zimbra Collaboration Web Client can search the GAL.  When the user searches
for a name, that name is turned into an LDAP search filter similar to the
following example, where the string <code>%s</code> is the name the user is searching
for.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. Searching the GAL</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>(|(cn = %s*)(sn=%s*)(gn=%s*)(mail=%s*))
  (zimbraMailDeliveryAddress = %s*)
  (zimbraMailAlias=%s*)
  (zimbraMailAddress = %s*)</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_gal_attributes_in_zimbra_collaboration">GAL Attributes in Zimbra Collaboration</h4>
<div class="paragraph">
<p>The
<a href="#attributes_mapped_to_zimbra_collaboration_contact">Attributes Mapped to Zimbra Collaboration Contact</a>
table maps generic GAL search attributes to their Zimbra Collaboration
contact fields.</p>
</div>
<div class="paragraph">
<p>LDAP attributes are mapped to GAL entry fields.  For example, the LDAP
attribute <code>displayName</code> and <code>cn</code> can be mapped to GAL entry field <code>fullName</code>.
The mapping is configured in the <code>zimbraGalLdapAttrMap</code> attribute.</p>
</div>
<table id="attributes_mapped_to_zimbra_collaboration_contact" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Attributes Mapped to Zimbra Collaboration Contact</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Standard LDAP Attribute</th>
<th class="tableblock halign-left valign-top">Zimbra Collaboration Contact Field</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>co</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workCountry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>company</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Company</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>givenName/gn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">firstName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fullName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>initials</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initials</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workCity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>street, streetaddress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workStreet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postalCode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workPostalCode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>telephoneNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workPhone</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mobile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mobile</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pager</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pager</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>facisimileTelephoneNumber</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">faxNumber</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>st</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workState</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>title</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jobTitle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">email</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>thumbnailPhoto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">thumbnailPhoto</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>objectClass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not currently mapped</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zimbra_collaboration_gal_search_parameters">Zimbra Collaboration GAL Search Parameters</h4>
<div class="paragraph">
<p>GAL is configured on a per-domain basis.  To configure the attributes, you
can run the GAL Configuration Wizard from the Administration Console.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modifying_attributes">Modifying Attributes</h4>
<div class="paragraph">
<p>Additions, changes and deletions to the GAL attributes are made through the
Zimbra Administration Console or from the <code>zmprov</code> commands.</p>
</div>
<div class="paragraph">
<p>Users can modify attributes for their account in the directory. When users
change their options from the Zimbra Web Client, they also modify the
attributes when they change their preferences.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_flushing_ldap_cache">Flushing LDAP Cache</h3>
<div class="paragraph">
<p>When you modify the following type of entries in the Zimbra LDAP server,
you might need to flush the LDAP cache to make the change available on the
server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Themes</p>
</li>
<li>
<p>Locales</p>
</li>
<li>
<p>Account</p>
</li>
<li>
<p>Groups</p>
</li>
<li>
<p>COS</p>
</li>
<li>
<p>Domains</p>
</li>
<li>
<p>Global configuration</p>
</li>
<li>
<p>Server</p>
</li>
<li>
<p>Zimlet configuration</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_flush_the_cache_for_themes_and_locales">Flush the Cache for Themes and Locales</h4>
<div class="paragraph">
<p>When you add or change theme (skin) property files and locale resource
files for ZCS on a server, you must flush the cache to make
the new content available.</p>
</div>
<div class="listingblock">
<div class="title">To flush skins:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov flushCache skin</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">To flush locales</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov flushCache locale</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_flush_accounts_groups_cos_domains_and_servers">Flush Accounts, Groups, COS, Domains, and Servers</h4>
<div class="paragraph">
<p>When you modify the account, COS, groups, domain, and server attributes,
the change is effective immediately on the server to which the modification
is done.  On the other servers, the LDAP entries are automatically updated
after a period of time if the attributes are cached.</p>
</div>
<div class="paragraph">
<p>The default ZCS setting to update the server is 15 minutes.
The caching period is configured on local config key.</p>
</div>
<div class="listingblock">
<div class="title">To change the setting:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig ldap_cache_&lt;object&gt;_maxage</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">To enable changes immediately:</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov flushCache {account|cos|domain|group|server|...} [name|id]...</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you do not specify a name or ID along with the type, all entries in
cache for that type are flushed and the cache is reloaded.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some server attributes require a server restart even after the cache is
flushed.  For example, settings like bind port or number of processing
threads.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_flush_global_attributes">Flush Global Attributes</h4>
<div class="paragraph">
<p>When you modify global config attributes, the changes are effective
immediately on the server to which the modification is done.  On other
mailbox servers, you must flush the cache to make the changes available or
restart the server.  LDAP entries for global config attributes do not
expire.</p>
</div>
<div class="paragraph">
<p>Some global config attributes are computed into internal representations
only once per server restart.  For efficiency reasons, changes to those
attributes are not effective until after a server restart, even after the
cache is flushed.  Also, some global configuration settings and server
settings that are inherited from global config are only read once at server
startup, for example port or number of processing threads.  Modifying these
types of attributes requires a server restart.</p>
</div>
<div class="paragraph">
<p>To flush the cache for global config changes on all servers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the setting on the local server</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraImapClearTextLoginEnabled TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>The change is performed via the server identified by the localconfig keys
<code>zimbra_zmprov_default_soap_server</code> and <code>zimbra_admin_service_port</code>.</p>
</div>
</li>
<li>
<p>To flush the global config cache on all other servers, <code>zmprov flushCache</code>
must be issued on all servers, one at a time (or use <code>zmprov flushCache -a</code>).</p>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov –s server2 flushCache config
zmprov –s server3 flushCache config</code></pre>
</div>
</div>
</li>
<li>
<p>To determine if the action requires a restart</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov desc -a &lt;attributename&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>requiresRestart</code> value is added to the output if a restart is required.</p>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_mail_transfer_agent">Zimbra Mail Transfer Agent</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Zimbra MTA (Mail Transfer Agent) receives mail via SMTP and routes
each message using Local Mail Transfer Protocol (LMTP) to the
appropriate Zimbra mailbox server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can set MTA parameters with the Admin Console and the
CLI. However, it is highly recommended that you use the CLI for MTA
configuration to ensure the best results.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Zimbra MTA server includes the following programs:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>MTA Server Programs</strong></th>
<th class="tableblock halign-left valign-top"><strong>Purpose/Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfix MTA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail routing, mail relay, and attachment blocking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clam Anti-Virus</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scanning email messages and attachments in email messages for viruses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spam Assassin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identify unsolicited commercial email (spam)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amavisd-New</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface between Postfix and ClamAV / SpamAssassin</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Milter Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enforce restrictions on which addresses can send to
distribution lists and adds <strong>Reply-To</strong> and <strong>X-Zimbra-DL</strong> headers to
messages sent from distribution lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra policy server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aid in protecting Alias Domains from Backscatter Spam</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cluebringer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy daemon/cbpolicyd used to enforce actions, such as rate limiting.
For more information, see <a href="https://wiki.zimbra.com/wiki/Postfix_Policyd" class="bare">https://wiki.zimbra.com/wiki/Postfix_Policyd</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opendkim</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sign outgoing email if it has been configured to do so.  For more
information, see <a href="https://wiki.zimbra.com/wiki/Configuring_for_DKIM_Signing" class="bare">https://wiki.zimbra.com/wiki/Configuring_for_DKIM_Signing</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the Zimbra Collaboration configuration, mail transfer and delivery
are distinct functions: Postfix acts as a MTA, and the Zimbra mail
server acts as a Mail Delivery Agent (MDA).</p>
</div>
<div class="paragraph">
<p>The MTA configuration is stored in LDAP. The <code>zmconfigd</code> process polls the
LDAP directory every two minutes for modifications and updates the
Postfix configuration files with the changes.</p>
</div>
<div class="sect2">
<h3 id="_incoming_mail_routing_overview">Incoming Mail Routing Overview</h3>
<div class="paragraph">
<p>The Zimbra mailbox server receives the messages from the Zimbra MTA
server and passes them through any filters that have been created.</p>
</div>
<div class="paragraph">
<p>The MTA server receives mail via SMTP and routes each mail message to
the appropriate mailbox server using LMTP. As each mail message arrives,
its contents are indexed so that all elements can be searched.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_mta_deployment">Zimbra MTA Deployment</h3>
<div class="paragraph">
<p>ZCS includes a precompiled version of Postfix to route and relay mail
and manage attachments. Postfix receives inbound messages via SMTP,
performs anti-virus and anti-spam filtering and hands off the mail
messages to the Zimbra Collaboration server via LMTP.</p>
</div>
<div class="paragraph">
<p>Postfix also plays a role in transferring outbound messages. Messages
composed from the Zimbra Web Client are sent by the Zimbra server
through Postfix, including messages sent to other users on the same
server.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_deployment.png" alt="Zimbra MTA Deployment">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Edge MTA can be any edge security solution for mail. You might
already deploy such solutions for functions such as filtering. Some
filtering might be duplicated between an edge MTA and the Zimbra MTA.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_postfix_configuration_files">Postfix Configuration Files</h4>
<div class="paragraph">
<p>Zimbra modified Postfix files&#8201;&#8212;&#8201;main.cf and master.cf&#8201;&#8212;&#8201;specifically to work
with ZCS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>main.cf</strong>&#8201;&#8212;&#8201;Modified to include the LDAP tables. The <code>zmconfigd</code> in
the Zimbra MTA pulls data from the Zimbra LDAP and modifies the Postfix
configuration files.</p>
</li>
<li>
<p><strong>master.cf</strong>&#8201;&#8212;&#8201;Modified to use Amavisd-New.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Changes made to postfix configuration files will be overwritten with every
upgrade and should be well documented. If possible, try to implement any
necessary configuration changes using Zimbra defined parameters.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_smtp_authentication">SMTP Authentication</h3>
<div class="paragraph">
<p>SMTP authentication allows authorized mail clients from external
networks to relay messages through the Zimbra MTA. The user ID and
password is sent to the MTA when the SMTP client sends mail so that the
MTA can verify if the user is allowed to relay mail.</p>
</div>
<div class="paragraph">
<p>The user ID and password is sent to the MTA when the SMTP client sends
mail. This ensures that the MTA can verify if the user is allowed to
relay mail, by checking the associated credentials with the LDAP
account.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
User authentication is provided through the Zimbra LDAP
directory server, or if implemented, through the Microsoft Active
Directory Sever.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_smtp_restrictions">SMTP Restrictions</h4>
<div class="paragraph">
<p>You can enable restrictions so that messages are not accepted by Postfix
when non-standard or other disapproved behavior is exhibited by an
incoming SMTP client. These restrictions provide some protection against
spam senders. By default, clients that do not greet with a fully
qualified domain name are restricted. DNS based restrictions are also
available.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Understand the implications of these restrictions before
you implement them. You might have to compromise on these checks to
accommodate people outside of your system who have poorly implemented
mail systems.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_sending_non_local_mail_to_a_different_server">Sending Non Local Mail to a Different Server</h4>
<div class="paragraph">
<p>You can configure Postfix to send nonlocal mail to a different SMTP
server, commonly referred to as a relay or smart host.</p>
</div>
<div class="paragraph">
<p>A common use case for a relay host is when an ISP requires that all your
email be relayed through a designated host, or if you have filtering
SMTP proxy servers.</p>
</div>
<div class="paragraph">
<p>The relay host setting must not be confused with Web mail MTA setting.
Relay host is the MTA to which Postfix relays non-local email. Webmail
MTA is used by the Zimbra server for composed messages and must be the
location of the Postfix server in the Zimbra MTA package.</p>
</div>
<div class="paragraph">
<p>To use the Administration Console to configure Relay MTA for external
delivery:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA &#8594; Network</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To prevent mail loops, use caution when setting the relay host.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/sending_non_local_mail_to_different_server.png" alt="MTA Settings">
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_anti_virus_and_anti_spam_protection">Anti-Virus and Anti-Spam Protection</h3>
<div class="paragraph">
<p>The Amavisd-New utility is the interface between the Zimbra MTA and Clam
Anti-Virus (ClamAV) and SpamAssassin scanners.</p>
</div>
<div class="sect3">
<h4 id="_anti_virus_protection">Anti-Virus Protection</h4>
<div class="paragraph">
<p>ClamAV software is the virus protection engine enabled for each ZCS
server.</p>
</div>
<div class="paragraph">
<p>The anti-virus software is configured to put messages that have been
identified as having a virus to the virus quarantine mailbox. By
default, the Zimbra MTA checks every two hours for any new anti-virus
updates from ClamAV.</p>
</div>
<div class="paragraph">
<p>You can change anti-virus settings at the Administration Console.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; AS/AV &#8594; Anti-virus Settings</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/anti_virus_protection.png" alt="Anti-Virus Protection">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Updates are obtained via HTTP from the ClamAV website.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_scanning_attachments_in_outgoing_mail">Scanning Attachments in Outgoing Mail</h5>
<div class="paragraph">
<p>You can enable real-time scanning of attachments in outgoing emails sent
using the Zimbra Web Client. If enabled, when an attachment is added to
an email, it is scanned using ClamAV prior to sending the message. If
ClamAV detects a virus, it will block attaching the file to the message.
By default, scanning is configured for a single node installation.</p>
</div>
<div class="paragraph">
<p>To enable scanning, using a single node:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraAttachmentsScanURL clam://localhost:3310/
zmprov mcf zimbraAttachmentsScanEnabled TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>To enable scanning in a multi-node environment:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Designate the MTA nodes to handle ClamAV scanning.</p>
</li>
<li>
<p>Enable, as follows:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms &lt;mta_server&gt; zimbraClamAVBindAddress &lt;mta_server&gt;
zmprov mcf zimbraAttachmentsScanURL clam://&lt;mta_server&gt;:3310/
zmprov ms &lt;mailbox_server&gt; zimbraAttachmentsScanEnabled TRUE</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_anti_spam_protection">Anti-Spam Protection</h4>
<div class="paragraph">
<p>Zimbra uses SpamAssassin to identify unsolicited commercial email (spam)
with learned data stored in either the Berkeley DB database or a MariaDB
database. You can also use the Postscreen function to provide additional
protection against mail server overload. Both strategies are described
in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spam_assassin_methods">Spam Assassin Methods for Avoiding Spam</a></p>
</li>
<li>
<p><a href="#postscreen_methods">Postscreen Methods for Avoiding Spam</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="spam_assassin_methods">Spam Assassin Methods for Avoiding Spam</h5>
<div class="paragraph">
<p>Usage guidelines are provided in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#spam_assassin_score">Managing the Spam Assassin Score</a></p>
</li>
<li>
<p><a href="#training_spam_filter">Training the Spam Filter</a></p>
</li>
<li>
<p><a href="#config_final_destination_spam">Configuring Final Destination for Spam</a></p>
</li>
<li>
<p><a href="#setting_up_trusted_netorks">Setting Up Trusted Networks</a></p>
</li>
<li>
<p><a href="#enabling_milter_server">Enabling a Milter Server</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For information about how to customize SpamAssassin, see
https:// wiki.zimbra.com/wiki/Anti-spam_strategies.
</td>
</tr>
</table>
</div>
<div id="spam_assassin_score" class="paragraph">
<p><strong>Managing the Spam Assassin Score:</strong> SpamAssassin uses predefined rules
as well as a Bayes database to score messages with a numerical range.
Zimbra uses a percentage value to determine &#8220;spaminess&#8221; based on a
SpamAssassin score of 20 as 100%. Any message tagged between 33%-75% is
considered spam and delivered to the user&#8217;s junk folder. Messages tagged
above 75% are always considered spam and discarded.</p>
</div>
<div class="paragraph">
<p>You can change the spam percentage settings, and the subject prefix at
the Administration Console.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; AS/AV &#8594; Spam checking Settings</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/spam_assassin.png" alt="Spam Assassin Settings">
</div>
</div>
<div class="paragraph">
<p>By default, Zimbra uses the Berkeley DB database for spam training. You
can also use a MariaDB database.</p>
</div>
<div class="paragraph">
<p>To use the MariaDB method on the MTA servers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e antispam_mariadb_enabled=TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>When this is enabled, Berkeley DB database is not enabled.</p>
</div>
<div id="training_spam_filter" class="paragraph">
<p><strong>Training the Spam Filter</strong>&#8201;&#8212;&#8201;The effectiveness of the anti-spam filter is
dependent on user input to differentiate spam or ham. The SpamAssassin
filter learns from messages that users specifically mark as spam by
sending them to their junk folder or not spam by removing them from
their junk folder. A copy of these marked messages is sent to the
appropriate spam training mailbox.</p>
</div>
<div class="paragraph">
<p>At installation, a spam/ham cleanup filter is configured on only the
first MTA. The ZCS spam training tool, <code>zmtrainsa</code>, is configured to
automatically retrieve these messages and train the spam filter. The
<code>zmtrainsa</code> script empties these mailboxes each day.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>New installations of ZCS limit spam/ham training to the first
MTA installed. If you uninstall or move this MTA, you will need to
enable spam/ham training on another MTA, as one host should have this
enabled to run <code>zmtrainsa --cleanup</code>.</p>
</div>
<div class="paragraph">
<p>To set this on a new MTA server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zmtrainsa_cleanup_host=TRUE</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Initially, you might want to train the spam filter manually to quickly
build a database of spam and non-spam tokens, words, or short character
sequences that are commonly found in spam or ham. To do this, you can
manually forward messages as message/rfc822 attachments to the spam and
non-spam mailboxes. When <code>zmtrainsa</code> runs, these messages are used to teach
the spam filter. Make sure you add a large enough sampling of messages to
get accurate scores. To determine whether to mark messages as spam at least
200 known spams and 200 known hams must be identified.</p>
</div>
<div id="spamassassin_sa_update_tool" class="paragraph">
<p>SpamAssassin&#8217;s <code>sa-update</code> tool is included with SpamAssassin. This tool
updates SpamAssassin rules from the SA organization. The tool is
installed into <code>/opt/zimbra/common/bin</code>.</p>
</div>
<div id="config_final_destination_spam" class="paragraph">
<p><strong>Configuring Final Destination for Spam</strong>&#8201;&#8212;&#8201;You can configure Amavis
behavior to handle a spam item&#8217;s final destination by using the following
attribute:</p>
</div>
<div class="paragraph">
<p><code>zimbraAmavisFinalSpamDestiny</code></p>
</div>
<div class="paragraph">
<p>The default is <code>D_DISCARD</code> (which will not deliver the email to the
addressee).</p>
</div>
<div class="paragraph">
<p>Setting final spam destiny attributes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf &quot;zimbraAmavisFinalSpamDestiny&quot; D_PASS
zmprov ms serverhostname.com D_PASS</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Configurable attribute values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D_PASS</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Deliver the email to the recipient. The email is likely to be placed in
the recipient&#8217;s junk folder (although some sites disable junk).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D_BOUNCE</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The email is bounced back to the sender. Because this setting can create
backscatter&#8201;&#8212;&#8201;as the "sender" is not the person who actually sent the
email&#8201;&#8212;&#8201;it is not advised.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D_REJECT</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Reject the email. This setting reduces the chance of backscatter:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the sender is valid, the MTA will notify this person about the rejection.</p>
</li>
<li>
<p>If the sender is not valid, the associated MTA will discard the email (i.e. email that was sent by a spammer spoofing someone else).</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>D_DISCARD</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The email is silently discarded (not delivered).</p>
</div></div></td>
</tr>
</tbody>
</table>
<div id="setting_up_trusted_netorks" class="paragraph">
<p><strong>Setting Up Trusted Networks:</strong> The ZCS configuration allows
relaying only for the local network, but you can configure trusted networks
that are allowed to relay mail. You set the MTA trusted networks as a
global setting, but you can configure trusted networks as a server
setting. The server setting overrides the global setting.</p>
</div>
<div class="paragraph">
<p>To use the Administration Console to set up MTA trusted networks as a
global setting:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA &#8594; Network</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_network.png" alt="MTA Trusted Networks">
</div>
</div>
<div class="paragraph">
<p>When using the Administration Console to set up MTA trusted networks on
a per server basis, first ensure that MTA trusted networks have been set
up as global settings.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Servers &#8594; <em>server</em> &#8594; MTA &#8594; Network</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_network_2.png" alt="MTA Trusted Networks">
</div>
</div>
<div class="paragraph">
<p>Enter the network addresses separated by <em>commas</em> and/or a <em>space</em>. Continue
long lines by starting the next line with space, similar to the
following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>127.0.0.0/8, 168.100.189.0/24
127.0.0.0/8 168.100.189.0/24 10.0.0.0/8 [::1]/128 [fe80::%eth0]/64</pre>
</div>
</div>
<div id="enabling_milter_server" class="paragraph">
<p><strong>Enabling a Milter Server:</strong> Milter server can be enabled to enforce
restrictions on which addresses can send to distribution lists and add
<strong>Reply-To</strong> and <strong>X-Zimbra-DL</strong> headers to messages sent from distribution
lists. This can be enabled globally or for specific servers from the
Administration Console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only enable a Milter Server on a server where an MTA is running.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For global configuration, enable the milter server from the
Administration Console:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA &#8594; Milter Server</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_milter.png" alt="MTA Milter Server">
</div>
</div>
<div class="paragraph">
<p>Use the Administration Console to enable a specific milter server, and
to set bind addressing for individual servers.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Servers &#8594; <em>server</em> &#8594; MTA &#8594; Milter Server</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mta_milter_2.png" alt="MTA Milter Server">
</div>
</div>
</div>
<div class="sect4">
<h5 id="postscreen_methods">Postscreen Methods for Avoiding Spam</h5>
<div class="paragraph">
<p>Zimbra Postscreen is the 8.7 enhancement to the Zimbra Collaboration
anti-spam strategy, to provide additional protection against mail server
overload. By design, Postscreen is not an SMTP proxy. Its purpose is to
keep spambots away from Postfix SMTP server processes, while minimizing
overhead for legitimate traffic. A single Postscreen process handles
multiple inbound SMTP connections and decides which clients may communicate
to a Post-fix SMTP server process. By keeping spambots away, Postscreen
frees up SMTP server processes for legitimate clients, and delays the onset
of server overload conditions.</p>
</div>
<div class="paragraph">
<p>In a typical deployment, Postscreen handles the MX service on TCP port 25,
while MUA clients submit mail via the submission service on TCP port 587,
which requires client authentication. Alternatively, a site could set up a
dedicated, non-Postscreen, &#8220;port 25&#8221; server that provides submission
service and client authentication without MX service.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Postscreen should not be used on SMTP ports that receive mail from end-user
clients (MUAs).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zimbra Collaboration Postscreen maintains a temporary white-list for
clients that have passed a number of tests. When an SMTP client IP address
is whitelisted, Postscreen immediately passes the connection to a Postfix
SMTP server process. This minimizes the overhead for legitimate mail.</p>
</div>
<div class="paragraph">
<p>In a typical scenario that uses Postscreen service, it is reasonable
to expect potentially malicious email entities&#8201;&#8212;&#8201;such as bots and
zombies&#8201;&#8212;&#8201;to be mixed in with friendly candidates in email
loads. This concept is illustrated in the following diagram, in which
undesirable entities are depicted in red; good email candidates are
green.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/postscreen.png" alt="Postscreen">
</div>
</div>
<div class="paragraph">
<p>Postscreen performs basic checks and denies connection(s) that are clearly
from a bot or zombie. If the connection is not in the temporary whitelist,
Postscreen passes the email to the local Anti-SPAM and Anti-Virus engines,
which can either accept it or deny it. Good connections are accepted via
Postscreen security, then allowed to talk directly with the SMTP daemon,
which scans the Email (as usual) with the AS/AV. By default, all bots or
zombies are rejected.</p>
</div>
<div class="paragraph">
<p>Use Zimbra CLI attributes to set parameters for Postscreen operations. For
any <a href="#postscreen_attributes">Postscreen Attributes</a> that provide the
ignore, enforce, or drop instruction, use guidelines as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>ignore</em>&#8201;&#8212;&#8201;Ignore this result. Allow other tests to complete. Repeat this
test with subsequent client connections. This is the default setting, which
is useful for testing and collecting statistics without blocking mail.</p>
</li>
<li>
<p><em>enforce</em>&#8201;&#8212;&#8201;Allow other tests to complete. Reject attempts to deliver
mail with a 550 SMTP reply, and log the hello/sender/recipient
information. Repeat this test with subsequent client connections.</p>
</li>
<li>
<p><em>drop</em>&#8201;&#8212;&#8201;Drop the connection immediately with a 521 SMTP reply.
Repeat this test with subsequent client connections.</p>
</li>
</ul>
</div>
<div id="postscreen_attribtutes" class="paragraph">
<p><strong>Postscreen Attributes:</strong></p>
</div>
<div class="paragraph">
<p>Go to the <code>zmprov mcf</code> prompt (release 8.7+) to use Postscreen commands.
You can see example usages of these attributes in
<a href="#enabling_postscreen">Enabling Postscreen</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraMtaPostscreenAccessList</code>&#8201;&#8212;&#8201;Default = permit_mynetworks</p>
<div class="paragraph">
<p>Postconf <code>postscreen_access_list</code> setting, which is the permanent white/
blacklist for remote SMTP client IP addresses. Postscreen(8) searches this
list immediately after a remote SMTP client connects. Specify a comma- or
whitespace -separated list of commands (in upper or lower case) or lookup
tables. The search stops upon the first command that fires for the client
IP address.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenBareNewlineAction</code>&#8201;&#8212;&#8201;Default = ignore</p>
<div class="paragraph">
<p>The action that postscreen(8) is to take when a remote SMTP client sends a
bare newline character, that is, a newline not preceded by carriage return&#8201;&#8212;&#8201;as either ignore, enforce, or drop.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenBareNewlineEnable</code>&#8201;&#8212;&#8201;Default = no</p>
<div class="paragraph">
<p>Enable (yes) or disable (no) &#8220;bare newline&#8221; SMTP protocol tests in the
postscreen(8) server. These tests are expensive: a remote SMTP client must
disconnect after it passes the test, before it can talk to a real Postfix
SMTP server.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenBareNewlineTTL</code>&#8201;&#8212;&#8201;Default = 30d</p>
<div class="paragraph">
<p>The amount of time allowable for postscreen(8) to use the result of a
successful &#8220;bare newline&#8221; SMTP protocol test. During this time, the client
IP address is excluded from this test. The default setting is lengthy
because a remote SMTP client must disconnect after it passes the test,
before it can talk to a real Postfix SMTP server.</p>
</div>
<div class="paragraph">
<p>Specify a non-zero time value (an integral value plus an optional
one-letter suffix that specifies the time unit). Time units: s (seconds), m
(minutes), h (hours), d (days), w (weeks).</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenBlacklistAction</code>&#8201;&#8212;&#8201;Default = ignore</p>
<div class="paragraph">
<p>The action that postscreen(8) is to take when a remote SMTP client is
permanently blacklisted with the <code>postscreen_access_list</code> parameter, as
either ignore, enforce, or drop.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenCacheCleanupInterval</code>&#8201;&#8212;&#8201;Default = 12h</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The amount of time allowable between postscreen(8) cache cleanup runs.
Cache cleanup increases the load on the cache database and should therefore
not be run frequently. This feature requires that the cache database
supports the &#8220;delete&#8221; and &#8220;sequence&#8221; operators. Specify a zero interval to
disable cache cleanup.</p>
</div>
<div class="paragraph">
<p>After each cache cleanup run, the postscreen(8) daemon logs the number of
entries that were retained and dropped. A cleanup run is logged as
&#8220;partial&#8221; when the daemon terminates early after <code>postfix reload</code>, <code>postfix
stop</code>, or no requests for <code>$max_idle</code> seconds.</p>
</div>
<div class="paragraph">
<p>Time units: s (seconds), m (minutes), h (hours), d (days), w (weeks).</p>
</div>
</div>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenCacheRetentionTime</code>&#8201;&#8212;&#8201;Default = 7d</p>
<div class="paragraph">
<p>The amount of time that postscreen(8) is allowed to cache an expired
temporary whitelist entry before it is removed. This prevents clients from
being logged as &#8220;NEW&#8221; just because their cache entry expired an hour
ago. It also prevents the cache from filling up with clients that passed
some deep protocol test once and never came back.</p>
</div>
<div class="paragraph">
<p>Time units: s (seconds), m (minutes), h (hours), d (days), w (weeks).</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenCommandCountLimit</code>&#8201;&#8212;&#8201;Default = 20</p>
<div class="paragraph">
<p>Value to set the limit on the total number of commands per SMTP session for
postscreen(8)'s built-in SMTP protocol engine. This SMTP engine defers or
rejects all attempts to deliver mail, therefore there is no need to enforce
separate limits on the number of junk commands and error commands.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblAction</code>&#8201;&#8212;&#8201;Default = ignore</p>
<div class="paragraph">
<p>The action that postscreen(8) is to take when a remote SMTP client&#8217;s
combined DNSBL score is equal to or greater than a threshold (as defined
with the <code>postscreen_dnsbl_sites</code> and <code>postscreen_dnsbl_threshold</code>
parameters), as either ignore, enforce, or drop.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblSites</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Optional list of DNS white/blacklist domains, filters and weight
factors. When the list is non-empty, the dnsblog(8) daemon will query
these domains with the IP addresses of remote SMTP clients, and
postscreen(8) will update an SMTP client&#8217;s DNSBL score with each non-error
reply.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When postscreen rejects mail, it replies with the DNSBL domain name. Use the
<code>postscreen_dnsbl_reply_map</code> feature to hide &#8220;password&#8221; information in
DNSBL domain names.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a client&#8217;s score is equal to or greater than the threshold specified
with <code>postscreen_dnsbl_threshold</code>, postscreen(8) can drop the connection
with the remote SMTP client.</p>
</div>
<div class="paragraph">
<p>Specify a list of <code>domain=filter*weight</code> entries, separated by comma or
whitespace.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When no <code>=filter</code> is specified, postscreen(8) will use any non-error
DNSBL reply. Otherwise, postscreen(8) uses only DNSBL replies that match
the filter. The filter has the form <code>d.d.d.d</code>, where each d is a number, or a
pattern inside <code>[]</code> that contains one or more &#8220;;&#8221;-separated
numbers or number..number ranges.</p>
</li>
<li>
<p>When no <code>*weight</code> is specified, postscreen(8) increments the remote SMTP
client&#8217;s DNSBL score by 1. Otherwise, the weight must be an integral
number, and postscreen(8) adds the specified weight to the remote SMTP
client&#8217;s DNSBL score. Specify a negative number for whitelisting.</p>
</li>
<li>
<p>When one <code>postscreen_dnsbl_sites</code> entry produces multiple DNSBL
responses, postscreen(8) applies the weight at most once.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="paragraph">
<p>To use example.com as a high-confidence blocklist, and to block mail
with example.net and example.org only when both agree:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>postscreen_dnsbl_threshold = 2
postscreen_dnsbl_sites = example.com*2, example.net, example.org</pre>
</div>
</div>
<div class="paragraph">
<p>To filter only DNSBL replies containing 127.0.0.4:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>postscreen_dnsbl_sites = example.com=127.0.0.4</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblThreshold</code>&#8201;&#8212;&#8201;Default = 1</p>
<div class="paragraph">
<p>Value to define the inclusive lower bound for blocking a remote SMTP
client, based on its combined DNSBL score as defined with the
<code>postscreen_dnsbl_sites</code> parameter.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblTTL</code>&#8201;&#8212;&#8201;Default = 1h</p>
<div class="paragraph">
<p>The amount of time allowable for postscreen(8) to use the result from a
successful DNS-based reputation test before a client IP address is required
to pass that test again.</p>
</div>
<div class="paragraph">
<p>Specify a non-zero time value (an integral value plus an optional
one-letter suffix that specifies the time unit). Time units: s (seconds), m
(minutes), h (hours), d (days), w (weeks).</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblWhitelistThreshold</code>&#8201;&#8212;&#8201;Default = 0</p>
<div class="paragraph">
<p>Allow a remote SMTP client to skip &#8220;before&#8221; and &#8220;after 220 greeting&#8221;
protocol tests, based on its combined DNSBL score as defined with the
<code>postscreen_dnsbl_sites</code> parameter.</p>
</div>
<div class="paragraph">
<p>Specify a negative value to enable this feature. When a client passes the
<code>postscreen_dnsbl_whitelist_threshold</code> without having failed other tests, all
pending or disabled tests are flagged as completed with a time-to-live
value equal to <code>postscreen_dnsbl_ttl</code>. When a test was already completed, its
time-to-live value is updated if it was less than <code>postscreen_dnsbl_ttl</code>.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenGreetAction</code>&#8201;&#8212;&#8201;Default = ignore</p>
<div class="paragraph">
<p>The action that postscreen(8) is to take when a remote SMTP client speaks
before its turn within the time specified with the <code>postscreen_greet_wait</code>
parameter, as either ignore, enforce, or drop.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenGreetTTL</code>&#8201;&#8212;&#8201;Default = 1d</p>
<div class="paragraph">
<p>The amount of time allowed for postscreen(8) to use the result from a
successful PREGREET test. During this time, the client IP address is
excluded from this test. The default is relatively short, because a good
client can immediately talk to a real Postfix SMTP server.</p>
</div>
<div class="paragraph">
<p>Specify a non-zero time value (an integral value plus an optional
one-letter suffix that specifies the time unit). Time units: s (seconds), m
(minutes), h (hours), d (days), w (weeks).</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenNonSmtpCommandAction</code>&#8201;&#8212;&#8201;Default = drop</p>
<div class="paragraph">
<p>The action that postscreen(8) takes when a remote SMTP client sends
non-SMTP commands as specified with the <code>postscreen_forbidden_</code> commands
parameter, as either ignore, enforce, or drop.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenNonSmtpCommandEnable</code>&#8201;&#8212;&#8201;Default = no</p>
<div class="paragraph">
<p>Enable (yes) or disable (no) "non- SMTP command" tests in the postscreen(8)
server. These tests are expensive: a client must disconnect after it passes
the test, before it can talk to a real Postfix SMTP server.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenNonSmtpCommandTTL</code>&#8201;&#8212;&#8201;Default = 30d</p>
<div class="paragraph">
<p>The amount of time allowable for postscreen(8) to use the result from a
successful &#8220;non_smtp_command&#8221; SMTP protocol test. During this time, the
client IP address is excluded from this test. The default is long because a
client must disconnect after it passes the test, before it can talk to a
real Postfix SMTP server.</p>
</div>
<div class="paragraph">
<p>Specify a non-zero time value (an integral value plus an optional
one-letter suffix that specifies the time unit). Time units: s (seconds), m
(minutes), h (hours), d (days), w (weeks).</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenPipeliningAction</code>&#8201;&#8212;&#8201;Default = enforce</p>
<div class="paragraph">
<p>The action that postscreen(8) is to take when a remote SMTP client sends
multiple commands instead of sending one command and waiting for the server
to respond, as either ignore, enforce, or drop.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenPipeliningEnable</code>&#8201;&#8212;&#8201;Default = no</p>
<div class="paragraph">
<p>Enable (yes) or disable (no) &#8220;pipelining&#8221; SMTP protocol tests in the
postscreen(8) server. These tests are expensive: a good client must
disconnect after it passes the test, before it can talk to a real Postfix
SMTP server.</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenPipeliningTTL</code>&#8201;&#8212;&#8201;Default = 30d</p>
<div class="paragraph">
<p>Time allowable for postscreen(8) to use the result from a successful
&#8220;pipelining&#8221; SMTP protocol test. During this time, the client IP address is
excluded from this test. The default is lengthy because a good client must
disconnect after it passes the test, before it can talk to a real Postfix
SMTP server.</p>
</div>
<div class="paragraph">
<p>Specify a non-zero time value (an integral value plus an optional
one-letter suffix that specifies the time unit). Time units: s (seconds), m
(minutes), h (hours), d (days), w (weeks).</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenWatchdogTimeout</code>&#8201;&#8212;&#8201;Default = 10s</p>
<div class="paragraph">
<p>Time allowable for a postscreen(8) process to respond to a remote SMTP
client command, or to perform a cache operation, before it is terminated by
a built-in watchdog timer. This is a safety mechanism that prevents
postscreen(8) from becoming non-responsive due to a bug in Postfix itself
or in system software. To avoid false alarms and unnecessary cache
corruption this limit cannot be set under 10s.</p>
</div>
<div class="paragraph">
<p>Specify a non-zero time value (an integral value plus an optional
one-letter suffix that specifies the time unit). Time units: s (seconds), m
(minutes), h (hours), d (days), w (weeks).</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenWhitelistInterfaces</code></p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>A list of local postscreen(8) server IP addresses where a non-whitelisted
remote SMTP client can obtain postscreen(8)'s temporary whitelist
status. This status is required before the client can talk to a Postfix
SMTP server process. By default, a client can obtain postscreen(8)'s
whitelist status on any local postscreen(8) server IP address.</p>
</div>
<div class="paragraph">
<p>When postscreen(8) listens on both primary and backup MX addresses, the
<code>postscreen_whitelist_interfaces</code> parameter can be configured to give the
temporary whitelist status only when a client connects to a primary MX
address. Once a client is whitelisted it can talk to a Postfix SMTP server
on any address. Thus, clients that connect only to backup MX addresses will
never become whitelisted, and will never be allowed to talk to a Postfix
SMTP server process.</p>
</div>
<div class="paragraph">
<p>Specify a list of network addresses or network/netmask patterns, separated
by commas and/or whitespace. The netmask specifies the number of bits in
the network part of a host address. Continue long lines by starting the
next line with whitespace.</p>
</div>
<div class="paragraph">
<p>You can also specify <code>/file/name</code> or <code>type:table</code> patterns. A <code>/file/name</code>
pattern is replaced by its contents; a <code>type:table</code> lookup table is matched
when a table entry matches a lookup string (the lookup result is ignored).</p>
</div>
<div class="paragraph">
<p>The list is matched left to right, and the search stops on the first
match. Specify <code>!pattern</code> to exclude an address or network block from the
list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
IPv6 address information must be specified inside <code>[]</code> in
the <code>postscreen_whitelist_interfaces</code> value, and in files specified with
<code>/file/name</code>. IP version 6 addresses contain the &#8220;:&#8221; character, and would
otherwise be confused with a <code>type:table</code> pattern.
</td>
</tr>
</table>
</div>
<div id="dont-whitelist-connections-to-the-backup-ip-address" class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/etc/postfix/main.cf:

# Don't whitelist connections to the backup IP address.
postscreen_whitelist_interfaces = !168.100.189.8, static:all</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblMinTTL</code>&#8201;&#8212;&#8201;Default = 60s</p>
<div class="paragraph">
<p>The minimum amount of time that postscreen(8) is allowed&#8201;&#8212;&#8201;resulting from a
successful DNS -based reputation test&#8201;&#8212;&#8201;before a client IP address is
required to pass that test again. If the DNS reply specifies a larger TTL
value, that value will be used unless it would be larger than
<code>postscreen_dnsbl_max_ttl</code>.</p>
</div>
<div class="paragraph">
<p>Specify a non-zero time value (an integral value plus an optional
one-letter suffix that specifies the time unit). Time units: s (seconds), m
(minutes), h (hours), d (days), w (weeks).</p>
</div>
</li>
<li>
<p><code>zimbraMtaPostscreenDnsblMaxTTL</code>&#8201;&#8212;&#8201;Default = postscreen dnsbl ttl</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The maximum amount of time allowable for postscreen(8) to use the result
from a successful DNS-based reputation test before a client IP address is
required to pass that test again. If the DNS reply specifies a shorter TTL
value, that value will be used unless it would be smaller than
<code>postscreen_dnsbl_min_ttl</code>.</p>
</div>
<div class="paragraph">
<p>Specify a non-zero time value (an integral value plus an optional
one-letter suffix that specifies the time unit). Time units: s (seconds), m
(minutes), h (hours), d (days), w (weeks).</p>
</div>
<div class="paragraph">
<p>Note that the default setting is backwards-compatible with Postscreen
versions earlier than 3.1.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
<div id="enabling_postscreen" class="paragraph">
<p><strong>Enabling Postscreen:</strong></p>
</div>
<div class="paragraph">
<p>The example in this section demonstrates settings appropriate for a global
configuration with medium-to-high level Postscreen protection.</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. Global Configuration for Postscreen</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>zmprov mcf zimbraMtaPostscreenAccessList permit_mynetworks
zmprov mcf zimbraMtaPostscreenBareNewlineAction ignore
zmprov mcf zimbraMtaPostscreenBareNewlineEnable no
zmprov mcf zimbraMtaPostscreenBareNewlineTTL 30d
zmprov mcf zimbraMtaPostscreenBlacklistAction ignore
zmprov mcf zimbraMtaPostscreenCacheCleanupInterval 12h
zmprov mcf zimbraMtaPostscreenCacheRetentionTime 7d
zmprov mcf zimbraMtaPostscreenCommandCountLimit 20
zmprov mcf zimbraMtaPostscreenDnsblAction enforce
zmprov mcf \
  zimbraMtaPostscreenDnsblSites 'b.barracudacentral.org=127.0.0.2_7' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.inps.de=127.0.0.2*7' \
  zimbraMtaPostscreenDnsblSites 'zen.spamhaus.org=127.0.0.[10;11]*8' \
  zimbraMtaPostscreenDnsblSites 'zen.spamhaus.org=127.0.0.[4..7]*6' \
  zimbraMtaPostscreenDnsblSites 'zen.spamhaus.org=127.0.0.3*4' \
  zimbraMtaPostscreenDnsblSites 'zen.spamhaus.org=127.0.0.2*3' \
  zimbraMtaPostscreenDnsblSites 'list.dnswl.org=127.0.[0..255].0*-2' \
  zimbraMtaPostscreenDnsblSites 'list.dnswl.org=127.0.[0..255].1*-3' \
  zimbraMtaPostscreenDnsblSites 'list.dnswl.org=127.0.[0..255].2*-4' \
  zimbraMtaPostscreenDnsblSites 'list.dnswl.org=127.0.[0..255].3*-5' \
  zimbraMtaPostscreenDnsblSites 'bl.mailspike.net=127.0.0.2*5' \
  zimbraMtaPostscreenDnsblSites 'bl.mailspike.net=127.0.0.[10;11;12]*4' \
  zimbraMtaPostscreenDnsblSites 'wl.mailspike.net=127.0.0.[18;19;20]*-2' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.10*8' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.5*6' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.7*3' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.8*2' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.6*2' \
  zimbraMtaPostscreenDnsblSites 'dnsbl.sorbs.net=127.0.0.9*2'
zmprov mcf zimbraMtaPostscreenDnsblTTL 5m
zmprov mcf zimbraMtaPostscreenDnsblThreshold 8
zmprov mcf zimbraMtaPostscreenDnsblTimeout 10s
zmprov mcf zimbraMtaPostscreenDnsblWhitelistThreshold 0
zmprov mcf zimbraMtaPostscreenGreetAction enforce
zmprov mcf zimbraMtaPostscreenGreetTTL 1d
zmprov mcf zimbraMtaPostscreenNonSmtpCommandAction drop
zmprov mcf zimbraMtaPostscreenNonSmtpCommandEnable no
zmprov mcf zimbraMtaPostscreenNonSmtpCommandTTL 30d
zmprov mcf zimbraMtaPostscreenPipeliningAction enforce
zmprov mcf zimbraMtaPostscreenPipeliningEnable no
zmprov mcf zimbraMtaPostscreenPipeliningTTL 30d
zmprov mcf zimbraMtaPostscreenWatchdogTimeout 10s
zmprov mcf zimbraMtaPostscreenWhitelistInterfaces static:all</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p><strong>Testing Postscreen:</strong></p>
</div>
<div class="paragraph">
<p>Testing uses Postscreen to view results without taking any action. In a
testing scenario, you instruct Postscreen to log email connections without
taking action on them. Once you are satisfied with the results, you can set
Postscreen values to enforce or drop emails, as required.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up the DNS-based Blackhole List (DNSBL).</p>
</li>
<li>
<p>Set Postscreen to ignore.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following real-world example demonstrates return of a 550 error from
Postscreen during a test session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Mar 1 02:03:26 edge01 postfix/postscreen[23154]: DNSBL rank 28 for [112.90.37.251]:20438

Mar 1 02:03:26 edge01 postfix/postscreen[23154]: CONNECT from [10.210.0.161]:58010 to [10.210.0.174]:25

Mar 1 02:03:26 edge01 postfix/postscreen[23154]: WHITELISTED [10.210.0.161]:58010

Mar 1 02:03:27 edge01 postfix/postscreen[23154]: NOQUEUE: reject: RCPT from [112.90.37.251]:20438: 550 5.7.1 Service unavailable; client [112.90.37.251] blocked using zen.spamhaus.org; from=&lt;hfxdgdsggfvfg@gmail.com&gt;, to=&lt;support@zimbra.com&gt;, proto=ESMTP, helo=&lt;gmail.com&gt;

Mar 1 02:03:27 edge01 postfix/postscreen[23154]: DISCONNECT [112.90.37.251]:20438</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_receiving_and_sending_mail">Receiving and Sending Mail</h3>
<div class="paragraph">
<p>The Zimbra MTA delivers the incoming and the outgoing mail messages. For
outgoing mail, the Zimbra MTA determines the destination of the recipient
address. If the destination host is local, the message is passed to the
Zimbra server for delivery. If the destination host is a remote mail
server, the Zimbra MTA must establish a communication method to transfer
the message to the remote host. For incoming messages, the MTA must be able
to accept connection requests from remote mail servers and receive messages
for the local users.</p>
</div>
<div class="paragraph">
<p>To send and receive email, the MTA must be configured in DNS with both an A
record and an MX Record. For sending mail, the MTA uses DNS to resolve
hostnames and email-routing information. To receive mail, the MX record
must be configured correctly to route messages to the mail server.</p>
</div>
<div class="paragraph">
<p>You must configure a relay host if you do not enable DNS.</p>
</div>
<div class="sect3">
<h4 id="_message_queues">Message Queues</h4>
<div class="paragraph">
<p>When the Zimbra MTA receives mail, it routes the mail through a series of
queues to manage delivery; incoming, active, deferred, hold, and corrupt.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/message_queues.png" alt="Message Queues">
</div>
</div>
<div class="paragraph">
<p>The <strong>incoming</strong> message queue holds the new mail that has been received.
Each message is identified with a unique file name. Messages are moved to
the active queue when there is room. If there are no problems, message move
through this queue very quickly.</p>
</div>
<div class="paragraph">
<p>The <strong>active</strong> message queue holds messages that are ready to be sent. The
MTA sets a limit to the number of messages that can be in the active queue
at any one time. From here, messages are moved to and from the anti-virus
and anti-spam filters before being delivered to another queue.</p>
</div>
<div class="paragraph">
<p>Messages that cannot be delivered are placed in the <strong>deferred</strong> queue.  The
reasons for the delivery failures are documented in a file in the deferred
queue. This queue is scanned frequently to resend the message.  If the
message cannot be sent after the set number of delivery attempts, the
message fails and is bounced back to the original sender. You can choose to
send a notification to the sender that the message has been deferred.</p>
</div>
<div class="paragraph">
<p>The <strong>hold</strong> message queue keeps mail that could not be processed.  Messages
stay in this queue until the administrator moves them. No periodic delivery
attempts are made for messages in the hold queue.</p>
</div>
<div class="paragraph">
<p>The <strong>corrupt</strong> queue stores damaged unreadable messages.</p>
</div>
<div class="paragraph">
<p>You can monitor the mail queues for delivery problems from the
Administration Console. See
<a href="#monitoring_zcs_servers">Monitoring ZCS Servers</a>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_message_banner_for_mails_from_external_domains">Message banner for mails from external domains</h3>
<div class="paragraph">
<p><strong>Joule-Patch-32</strong> onwards, a message banner in the mails can be added for the mails coming from external domains. This will help users to identify the mails originating outside their organization. The feature is controlled by a localconfig attribute and by default it is disabled.</p>
</div>
<div class="paragraph">
<p>Following are the details of the attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbra_external_email_warning_enabled</code> - Attribute to enable/disable the feature.</p>
</li>
<li>
<p><code>zimbra_external_email_warning_message</code> - Attribute to customize the message to be displayed in the mails.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Following are the instructions to be executed as zimbra user:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enabling the feature:</p>
<div class="literalblock">
<div class="content">
<pre>su - zimbra
zmlocalconfig -e zimbra_external_email_warning_enabled=true</pre>
</div>
</div>
</li>
<li>
<p>Restart mailbox service:</p>
<div class="literalblock">
<div class="content">
<pre>zmmailboxdctl restart</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a user receives mail from an external domain, the message banner will get displayed at the top of the message body.</p>
</div>
<div class="sect3">
<h4 id="_modifying_the_message">Modifying the message</h4>
<div class="paragraph">
<p>The message for external domains can also be modified.</p>
</div>
<div class="paragraph">
<p>Following are the instructions:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the localconfig attribute <code>zimbra_external_email_warning_message</code> with the new message:</p>
<div class="literalblock">
<div class="content">
<pre>zmlocalconfig -e zimbra_external_email_warning_message="The external domain warning has been edited"</pre>
</div>
</div>
</li>
<li>
<p>Restart mailbox service:</p>
<div class="literalblock">
<div class="content">
<pre>zmmailboxdctl restart</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a user receives mail from an external domain, the edited message banner will get displayed at the top of the message body.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zimbra_proxy_server">Zimbra Proxy Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra Proxy is a high-performance proxy server that can be configured as a
POP3/IMAP/HTTP proxy used to reverse proxy IMAP/POP3 and HTTP client
requests to a set of backend servers.</p>
</div>
<div class="paragraph">
<p>The Zimbra Proxy package is installed and configured during the
Zimbra Collaboration installation. You can install this package on a mailbox
server, MTA server, or on its own independent server. When the Zimbra Proxy
package is installed, the proxy feature is enabled. In most cases, no
modification is necessary.</p>
</div>
<div class="sect2">
<h3 id="_benefits_of_using_zimbra_proxy">Benefits of Using Zimbra Proxy</h3>
<div class="paragraph">
<p>Benefits for using Zimbra Proxy include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra proxy centralizes access to Mailbox servers</p>
</li>
<li>
<p>Load Balancing</p>
</li>
<li>
<p>Security</p>
</li>
<li>
<p>Authentication</p>
</li>
<li>
<p>SSL Termination</p>
</li>
<li>
<p>Caching</p>
</li>
<li>
<p>Centralized Logging and Auditing</p>
</li>
<li>
<p>URL Rewriting</p>
</li>
<li>
<p>Strict Server Name Enforcement (optional)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information, see the wiki page
<a href="https://wiki.zimbra.com/wiki/Zimbra_Proxy_Guide">Zimbra_Proxy_Guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="zimbra_proxy_components">Zimbra Proxy Components</h3>
<div class="paragraph">
<p>Zimbra Proxy is designed to provide a HTTP/POP/IMAP proxy that is quick,
reliable, and scalable. Zimbra Proxy includes the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nginx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High performance HTTP/IMAP/POP3 proxy server that handles all incoming
HTTP/POP/IMAP requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memcached</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">High performance distributed memory object caching system in which routing
information is cached to enable increased performance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimbra Proxy Route Lookup Handler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servelet—located on the ZCS mailbox server—that handles queries for the
user account route information. This routing information consists of the
server and port number where the user account resides.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_proxy_architecture_and_flow">Proxy Architecture and Flow</h3>
<div class="paragraph">
<p>This section describes the architecture and flow sequence of Zimbra proxy.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>End clients connect to Zimbra Proxy using HTTP/HTTPS/POP/IMAP ports.</p>
</li>
<li>
<p>When Zimbra Collaboration Proxy receives an incoming connection, the
Nginx component sends an HTTP request to Zimbra Collaboration Proxy Route
Lookup Handler component.</p>
<div class="paragraph">
<p><span class="image"><img src="images/proxy_architecture_and_flow.png" alt="Proxy Architecture"></span></p>
</div>
</li>
<li>
<p>Zimbra Collaboration Proxy Route Lookup Handler locates the route
information for the account being accessed and returns this to Nginx.</p>
</li>
<li>
<p>The Memcached component stores the route information for the configured
period of time (the default is one hour). Nginx uses this route information
instead of querying the Zimbra Collaboration Proxy Route Lookup Handler
until the default period of time has expired.</p>
</li>
<li>
<p>Nginx uses the route information to connect to Zimbra Collaboration
Mailbox.</p>
</li>
<li>
<p>Zimbra Collaboration Proxy connects to Zimbra Collaboration Mailbox and
initiates the web/mail proxy session. The end client behaves as if it is
connecting directly to Zimbra Collaboration Mailbox.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_changing_the_zimbra_proxy_configuration">Changing the Zimbra Proxy Configuration</h3>
<div class="paragraph">
<p>When Zimbra proxy is configured, the Zimbra proxy config performs keyword
substitution as necessary with values from the LDAP configuration and
localconfig.</p>
</div>
<div class="paragraph">
<p>If changes are required after the Zimbra Proxy is set up, modify the Zimbra
LDAP attributes or localconfig values and run zmconfigd to generate the
updated Zimbra Proxy configuration. The Zimbra proxy configuration file is
in <code>/opt/zimbra/conf/nginx.conf</code>. The nginx.conf includes the main config,
memcache config, mail config, and web config files.</p>
</div>
<div class="paragraph">
<p>Common changes to Zimbra Proxy configuration are IMAP/POP configuration
changes from the original default setup</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP reverse proxy configuration changes from the original default setup</p>
</li>
<li>
<p>GSSAPI authentication for Kerberos. In this case you manually identify
the location of the Kerberos Keytab file, including Zimbra Proxy password</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_proxy">Zimbra Proxy</h3>
<div class="paragraph">
<p>Zimbra Proxy allows end users to access their Zimbra Collaboration account
using clients such as Microsoft Outlook, Mozilla Thunderbird, or other
POP/IMAP end-client software. End users can connect using POP3, IMAP, POP3S
(Secure POP3), or IMAPS (Secure IMAP).</p>
</div>
<div class="paragraph">
<p>For example, proxying allows users to enter imap.example.com as their IMAP
server. The proxy running on imap.example.com inspects their IMAP traffic,
does a lookup to determine which backend mailbox server a user’s mailbox
lives on and transparently proxies the connection from user’s IMAP client
to the correct mailbox server.</p>
</div>
<div class="sect3">
<h4 id="_zimbra_proxy_ports">Zimbra Proxy Ports</h4>
<div class="paragraph">
<p>The following ports are used either by Zimbra Proxy or by Zimbra Mailbox
(if Proxy is not configured). If you have any other services running on
these ports, turn them off.</p>
</div>
<div class="paragraph">
<p>End clients connect directly to Zimbra Proxy, using the Zimbra Proxy
Ports. Zimbra Proxy connects to the Route Lookup Handler or Zimbra Mailbox
using the Zimbra Mailbox Ports.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Proxy Ports</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Zimbra Proxy Ports (External to ZCS)</strong></th>
<th class="tableblock halign-left valign-top"><strong>Port</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3S (Secure POP3)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPS (Secure IMAP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zimbra Mailbox Ports (Internal to ZCS)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Port</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Route Lookup Handler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7072</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP Backend (if Proxy configured)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS Backend (if Proxy configured)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3 Backend (if Proxy configured)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3S Backend (if Proxy configured)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP Backend (if Proxy configured)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAPS Backend (if Proxy configured)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_strict_server_name_enforcement">Strict Server Name Enforcement</h4>
<div class="paragraph">
<p>Zimbra Proxy has the ability to strictly enforce which values are allowed in the <code>Host</code> header
passed in by the client.</p>
</div>
<div class="paragraph">
<p>This is <em>enabled by default</em> on <strong>new installations</strong> but left <em>disabled</em> for <strong>upgrades</strong> from previous
versions unless toggled during the installation.</p>
</div>
<div class="paragraph">
<p>The functionality may be altered by setting the <code>zimbraReverseProxyStrictServerNameEnabled</code> boolean configuration
option followed by restarting the proxy server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>TRUE - strict server name enforcement enabled</p>
</li>
<li>
<p>FALSE - strict server name enforcement disabled</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraReverseProxyStrictServerNameEnabled TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the strict server name functionality is enabled, additional valid server names may be specified
using the <code>zimbraVirtualHostName</code> and <code>zimbraVirtualIPAddress</code> configuration items at the domain level.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md example.com zimbraVirtualHostName mail.example.com zimbraVirtualIPAddress 1.2.3.4</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only one virtual ip address is needed per domain although more than one is acceptable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_imap_and_pop_proxy_after_http_proxy_installation">Setting Up IMAP and POP Proxy After HTTP Proxy Installation</h4>
<div class="paragraph">
<p>IMAP proxy is installed with Zimbra Collaboration and set up during
installation from the configuration menus. To set up the HTTP proxy, the
proxy must be installed on the identified proxy nodes in order to set up
HTTP proxy. No other configuration is usually required.</p>
</div>
<div class="paragraph">
<p>If you need to, set up IMAP/POP proxy after you have already installed HTTP proxy, and set up the mailbox server and the proxy node.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can run the command as <code>zmproxyconfig -r</code>, to run against a remote
host. This requires the server to be properly configured in the LDAP
master.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_set_up_imappop_proxy_with_separate_proxy_node">Set Up IMAP/POP Proxy with Separate Proxy Node</h5>
<div class="paragraph">
<p>Use steps in this section if your configuration includes a
separate proxy server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On each Zimbra mailbox server that you want to proxy with, enable the
proxy for IMAP/POP proxy.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -m -H mailbox.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configures the following:</p>
</div>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port Attributes</th>
<th class="tableblock halign-left valign-top">Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3BindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3ProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbralmapCleartextLoginEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3CleartextLoginEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>Restart services on the proxy and mailbox servers.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Set Up the Proxy Node</strong></p>
</div>
<div class="paragraph">
<p>On each proxy node that has the proxy service installed, enable the proxy
for the web.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -m -H proxy.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configures the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Port Attribute</strong></th>
<th class="tableblock halign-left valign-top"><strong>Setting</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3BindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3ProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyMailEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_set_up_a_single_node">Set Up a Single Node</h5>
<div class="paragraph">
<p>Use steps in this section if Zimbra proxy is installed with Zimbra Collaboration
on the same server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable the proxy for the web.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -m -H mailbox.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configures the following:</p>
</div>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port Attribute</th>
<th class="tableblock halign-left valign-top">Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">143</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapSSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3BindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3ProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3SSLProxyBindPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraImapCleartextLoginEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraPop3CleartextLoginEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyMailEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>Restart services on the proxy and mailbox servers.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_zimbra_http_proxy">Configuring Zimbra HTTP Proxy</h3>
<div class="paragraph">
<p>Zimbra Proxy can also reverse proxy HTTP requests to the right back-end
server.</p>
</div>
<div class="paragraph">
<p>For example, users can use a web browser to connect to the proxy server at <code>https://mail.example.com</code>. The connection from users whose mailboxes live on mbs1.example.com is proxied to mbs1.example.com by the proxy running on the mail.example.com server. The proxy also supports REST and CalDAV clients, Zimbra Connector for Outlook, and Zimbra Mobile Sync NG devices.</p>
</div>
<div class="paragraph">
<p>HTTP reverse proxy routes requests as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the requesting URL can be examined to determine the user name, then
the request is routed to the backend mailbox server of the user in the
URL. REST, CalDAV, and Zimbra Mobile Sync are supported through this
mechanism.</p>
</li>
<li>
<p>If the request has an auth token cookie (<strong>ZM_AUTH_TOKEN</strong>), the request is
routed to the backend mailbox server of the authenticated user.</p>
</li>
<li>
<p>If the above methods do not work, the IP hash method is used to load
balance the requests across the backend mailbox servers which are able to
handle the request or do any necessary internal proxying.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_setting_up_http_proxy">Setting Up HTTP Proxy</h4>
<div class="paragraph">
<p>To set up HTTP proxy, Zimbra Proxy must be installed on the identified
nodes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can run the command as <code>/opt/zimbra/libexec/zmproxyconfig -r</code>, to run
against a remote host. Note that this requires the server to be properly
configured in the LDAP master.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_setting_up_http_proxy_as_a_separate_proxy_node">Setting Up HTTP Proxy as a Separate Proxy Node</h5>
<div class="paragraph">
<p>Use steps in this section if your configuration includes a separate proxy
server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On each Zimbra mailbox server that you want to proxy with, enable the
proxy for the web.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -w -H mailbox.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configures the following:</p>
</div>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailReferMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reverse-proxied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080 (to avoid port conflicts)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailSSLPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443 (to avoid port conflicts)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
<li>
<p>Restart services on the proxy and mailbox servers.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</li>
<li>
<p>Configure each domain with the public service host name to be used for
REST URLs, email, and Briefcase folders.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyDomain &lt;domain.com&gt; zimbraPublicServiceHostname &lt;hostname.domain.com&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Setting Up Proxy Node</strong></p>
</div>
<div class="paragraph">
<p>On each proxy node that has the proxy service installed, enable the proxy
for the web.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -w -H proxy.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configures the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailReferMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reverse-proxied.
To set the proxy server mail mode, add the -x option to the command, with
the specific mode as either http, https, both, redirect, or mixed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailProxyPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 (to avoid port conflicts).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailSSLProxyPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443 (to avoid port conflicts).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyHttpEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE (to indicate that Web proxy is enabled).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyMailMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP (default)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To set the proxy server mail mode, add the <code>-x</code> option to the command
with the specific mode: <strong>http</strong>, <strong>https</strong>, <strong>both</strong>, <strong>redirect</strong>, <strong>mixed</strong>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_setting_up_a_single_node_for_http_proxy">Setting Up a Single Node for HTTP Proxy</h5>
<div class="paragraph">
<p>Use steps in this section if Zimbra proxy is installed along with ZCS on
the same server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On each zimbra mailbox server that you want to proxy with, enable
the proxy for the web.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig -e -w -H mailbox.node.service.hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>This configures the following:</p>
</div>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Attribute</strong></th>
<th class="tableblock halign-left valign-top"><strong>Setting</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailReferMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reverse-proxied.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8080 (to avoid port conflicts)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailSSLPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443 (to avoid port conflicts)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyLookupTarget</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP (the only supported mode)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailProxyPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80 (to avoid port conflicts)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailSSLProxyPort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">443 (to avoid port conflicts)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyHttpEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRUE (to indicate that Web proxy
is enabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraReverseProxyMailMode</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP (default)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="paragraph">
<p>To set the proxy server mail mode, add the <code>-x</code> option to the command
with the specific mode: <strong>http</strong>, <strong>https</strong>, <strong>both</strong>, <strong>redirect</strong>, <strong>mixed</strong>.</p>
</div>
</li>
<li>
<p>Restart services on the proxy and mailbox servers.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure each domain with the public service host name to be used for REST
URLs, email and Briefcase folders.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyDomain &lt;domain.com&gt; zimbraPublicServiceHostname &lt;hostname.domain.com&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Set Up Proxy to use Clear Text for Upstream Connections</strong></p>
</div>
<div class="paragraph">
<p>When setting up the proxy to use clear text for upstream connections, set
<code>zimbraReverseProxySSLToUpstreamEnabled</code> to FALSE.</p>
</div>
<div class="paragraph">
<p>This attribute defaults to TRUE. In an "out of the box" proxy set up,
the upstream communication defaults to SSL.</p>
</div>
<div class="paragraph">
<p><strong>REST URL Generation</strong></p>
</div>
<div class="paragraph">
<p>For REST URL, you set the host name, service protocol, and services port
globally or for a specific domain from the following attributes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraPublicServiceHostname</code></p>
</li>
<li>
<p><code>zimbraPublicServiceProtocol</code></p>
</li>
<li>
<p><code>zimbraPublicServicePort</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When generating REST URL’s:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <code>domain.zimbraPublicServiceHostname</code> is set, use
<code>zimbraPublicServiceProtocol</code> + <code>zimbraPublicServiceHostname</code> + <code>zimbraPublicServicePort</code></p>
</li>
<li>
<p>Otherwise it falls back to the server (account&#8217;s home server) attributes:</p>
<div class="ulist">
<ul>
<li>
<p>protocol is computed from <code>server.zimbraMailMode</code></p>
</li>
<li>
<p>hostname is <code>server.zimbraServiceHostname</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>port is computed from the protocol.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
About using <code>zimbraMailReferMode</code> - In earlier versions, a local config
variable — <code>zimbra_auth_always_send_refer</code> — determined which action the
back-end server took when a user’s mailbox did not reside on the server
that the user logged in to. The default value of FALSE redirected the user
if the user was logging in on the incorrect backend host.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On a multiserver ZCS, if a load balanced name was needed to create a
friendly landing page, a user would always have to be redirected. In that
case, <code>zimbra_auth_always_send_refer</code> was set to TRUE.</p>
</div>
<div class="paragraph">
<p>Now with a full-fledged reverse proxy, users do not need to be
redirected. The localconfig variable <code>zimbraMailReferMode</code> is used with
nginx reverse proxy.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_proxy_trusted_ip_addresses">Setting Proxy Trusted IP Addresses</h4>
<div class="paragraph">
<p>When a proxy is configured with ZCS, each proxy server’s IP
address must be configured in LDAP attribute <code>zimbraMailTrustedIP</code> to
identify the proxy addresses as trusted when users log in through the
proxy. The proxy IP address is added to the <code>X-Forwarded-For</code> header
information. The <code>X-Forwarded-For</code> header is automatically added to the
localconfig <code>zimbra_http_originating_ip</code> header attribute. When a user logs
in, this IP address and the user’s address are verified in the Zimbra
mailbox log.</p>
</div>
<div class="paragraph">
<p>Set each proxy IP address in the attribute. For example, if you have two
proxy servers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf +zimbraMailTrustedIP {IP of nginx-1} +zimbraMailTrustedIP {IP of nginx-2}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To verify that X-Forwarded-For was correctly added to the localconfig, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig | grep -i http</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zimbra_http originating_ip_header = X-Forwarded-For</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_zimbra_proxy_for_kerberos_authentication">Configuring Zimbra Proxy for Kerberos Authentication</h3>
<div class="paragraph">
<p>Use steps in this section if you use the Kerberos5 authenticating
mechanism, and want to configure it for the IMAP and POP proxy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Make sure that your Kerberos5 authentication mechanism is correctly
configured. See <a href="#zimbra_ldap_service">Zimbra LDAP Service</a>
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On each proxy node, set the zimbraReverseProxyDefaultRealm server
attribute to the realm name corresponding to the proxy server. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms [DNS name.isp.net] zimbraReverseProxyDefaultRealm [ISP.NET]</code></pre>
</div>
</div>
</li>
<li>
<p>Each proxy IP address where email clients connect must be configured for
GSSAPI authentication by the mail server. On each proxy node for each of
the proxy IP addresses:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf +zimbraReverseProxyAdminIPAddress [IP address]</code></pre>
</div>
</div>
</li>
<li>
<p>On each proxy server:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms [proxyexample.net] zimbraReverseProxyImapSaslGssapiEnabled TRUE

zmprov ms proxyl.isp.net zimbraReverseProxyPop3SaslGssapiEnabled TRUE</code></pre>
</div>
</div>
</li>
<li>
<p>Restart the proxy server</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmproxyctl restart</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_administration_console">Zimbra Administration Console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Zimbra Administration Console is a browser-based user interface for the central management of Zimbra servers and user accounts.</p>
</div>
<div class="sect2">
<h3 id="_administrator_accounts">Administrator Accounts</h3>
<div class="paragraph">
<p>When you log in to the Administration Console, the tasks you are authorized to perform show up on the Navigation pane.
These tasks depend on the rights assigned to your administrator role.</p>
</div>
<div class="paragraph">
<p>You can create two types of administrator accounts to manage Zimbra Collaboration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Global Administrators</strong> have full privileges to manage servers,
global settings, domains, and accounts as well as create other administrators.
One global administrator account gets created automatically during software installation.
Create additional global administrator accounts anytime later.
You can perform administration tasks from the Administration Console or the command line.</p>
</li>
<li>
<p><strong>Delegated Administrators</strong> are granted customized administrator roles by the global administrator to manage different tasks from the Administration Console.
See <a href="#delegated_administration">Delegated Administration</a> for more details.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_logging_into_the_administration_console">Logging into the Administration Console</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>To launch the Administration Console in a typical installation, use the following URL pattern.</p>
<div class="paragraph">
<p><code>https://server.domain.com:7071/</code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">server.domain.com</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Zimbra server name or IP address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7071</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default HTTP listen port.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>At the login screen, enter the complete administrator address - e.g., <strong>admin@domain.com</strong> - and the password configured for it during server installation of Zimbra Collaboration.</p>
<div class="imageblock">
<div class="content">
<img src="images/administration_console.png" alt="Administration Console">
</div>
</div>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_modifying_administrator_passwords">Modifying Administrator Passwords</h4>
<div class="paragraph">
<p>You can change the password - from either the Administration Console or the CLI - at any time.</p>
</div>
<div class="paragraph">
<p>From the Administration Console, use the <strong>Change Password</strong> screen to set the new password string, and to define the policy for user password modifications.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Manage &#8594; Accounts</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Double click select <em>user account</em> <strong>or</strong> from the <strong>Gear</strong> icon, select <strong>Change Password</strong> from the popup menu.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_password.png" alt="Change Password">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov sp adminname@domain.com password</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_the_login_and_logout_pages">Customizing the Login and Logout Pages</h4>
<div class="paragraph">
<p>A different login and logout page can be configured either as a global setting or as a domain setting.</p>
</div>
<div class="paragraph">
<p>To specify a URL to redirect administrators to if their login fails authentication, or if their authentication has expired:</p>
</div>
<div class="paragraph">
<p>Global:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraAdminConsoleLoginURL &lt;https://example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraAdminConsoleLoginURL &lt;https://example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To specify a URL to redirect administrators to, for logging out:</p>
</div>
<div class="paragraph">
<p>Global:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraAdminConsoleLogoutURL &lt;https://example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraAdminConsoleLogoutURL &lt;https://example.com&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_tasks">Managing Tasks</h3>
<div class="paragraph">
<p>Most ZCS tasks - such as creating accounts and Classes of Service, Server Status Monitoring, Domain management, Backup Scheduling, and Session management - can be managed from the Administration Console.</p>
</div>
<div class="paragraph">
<p>Other configuration and maintenance tasks require the use of the Zimbra CLI because you cannot perform them in the Administration Console.
For example: starting and stopping services and managing the local server configuration.</p>
</div>
<div class="paragraph">
<p>At the Administration Console, if you need to view the attribute associated with a particular function, you can click on the text labels of the currently visible configuration page to open the information in a popup.
Guide text is also provided from these popups, as demonstrated in the following illustration.</p>
</div>
<div class="openblock">
<div class="title">Viewing Attributes at the Administration Console</div>
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Click the field label to view the Attribute popup.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="images/administration_console_viewing_attributes.png" alt="Viewing Attributes">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">With the attribute popup in view, click <strong>More</strong> to view guidetext about the field.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="images/administration_console_viewing_attributes_2.png" alt="Viewing Attributes">
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_navigating_the_user_interface">Navigating the User Interface</h3>
<div class="paragraph">
<p>The organization of the Zimbra Collaboration Administration Console provides quick navigation to the configuration and monitoring tools and views associated with your login privileges.
It also provides easy access to various types of <strong>Help</strong> and the on-screen guide text.</p>
</div>
<div class="paragraph">
<p>After logging in to the Administration Console, the <strong>Home</strong> page provides status information and options you can select to navigate to the configuration and viewing options described in this user guide.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_ui.png" alt="Administration Console">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;1&gt; Go to Previous or Next page
&lt;2&gt; Current Location/Path
&lt;3&gt; Search
&lt;4&gt; Screen Refresh
&lt;5&gt; Current User and Logout Option
&lt;6&gt; Help
&lt;7&gt; Gear Icon
&lt;8&gt; Status Pane
&lt;9&gt; Viewing Pane
&lt;10&gt; Navigation Pane</pre>
</div>
</div>
<div class="paragraph">
<p>The displays and options in the navigation pane and viewing pane change according to your selections.
Other portions of the UI&#8201;&#8212;&#8201;arrow buttons, search field, screen refresh, current location/path, current login, and Help&#8201;&#8212;&#8201;always remain in view.</p>
</div>
<div class="paragraph">
<p>The Gear Icon <span class="image"><img src="images/gear_icon.png" alt="Gear Icon"></span> is displayed with some screens, to enable quick access to functions associated with the functions provided in the screens.
For more information about the Gear icon, see <a href="#using_the_gear_icon">Using the Gear icon</a></p>
</div>
<div class="sect3">
<h4 id="_home_navigation_pane">Home Navigation Pane</h4>
<div class="paragraph">
<p>The options provided in the <strong>Home</strong> navigation pane get categorized under the <strong>Home</strong> directory.
Some of the options lead to configuration pages; others lead to pages containing reports, as associated with your selections.</p>
</div>
<div class="paragraph">
<p>The illustration at right is an expanded view of the options currently supported in the Navigation Pane.</p>
</div>
<div class="paragraph">
<p>The upper bar of the in-view page always displays your current position in the hierarchy, and you can use multiple options for dismissing the current view:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To return to a previous page or go to the next page, click the left or right arrows.</p>
</li>
<li>
<p>To return to a specific portion of the UI, select an option from the Home dropdown.</p>
</li>
<li>
<p>To go directly to a specific option, click through the hierarchy in the Navigation Pane.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Navigation pane options are described in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#home_ui">Home UI</a>.</p>
</li>
<li>
<p><a href="#monitor_ui">Monitor UI</a>.</p>
</li>
<li>
<p><a href="#manage_ui">Manage UI</a>.</p>
</li>
<li>
<p><a href="#configure_ui">Configure UI</a>.</p>
</li>
<li>
<p><a href="#global_settings_ui">Global Settings UI</a>.</p>
</li>
<li>
<p><a href="#tools_and_migration_ui">Tools and Migration UI</a>.</p>
</li>
<li>
<p><a href="#search_ui">Search UI</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="home_ui">Home UI</h4>
<div class="paragraph">
<p>The <strong>Home</strong> screen is the default, login view, which provides the <strong>Home</strong>
navigation pane and the Home page.
This page provides a snapshot view of system status and a series of quick-access links for essential tasks.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_home_ui.png" alt="Home UI">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;1&gt; Go to Previous or Next page
&lt;2&gt; Search
&lt;3&gt; Screen Refresh
&lt;4&gt; Current User and Logout Option
&lt;5&gt; Help
&lt;6&gt; System Status
&lt;7&gt; Status Pane
&lt;8&gt; Quick Start
&lt;9&gt; Navigation Pane</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Home UI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Topic</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Summary</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the version of Zimbra Collaboration currently running and in view,
and the detected number of servers, account, domains, and classes of service associated with this session.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maintenance</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the most recent software backup performed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runtime</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the runtime statistics for Service, Active Session, and Queue Length.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 Get Started</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the steps essential to getting started with your Zimbra Collaboration
operations, and provides quick links to the functions in this UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install Licenses</p>
</li>
<li>
<p>Configure Back-ups</p>
</li>
<li>
<p>Install Certificates</p>
</li>
<li>
<p>Configure Default COS</p>
</li>
</ol>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 Set up Domain</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the steps you use to establish the domain(s) to be managed by the Collaborator.
Each step is a link to the function in this UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a Domain</p>
</li>
<li>
<p>Configure GAL&#8230;&#8203;</p>
</li>
<li>
<p>Configure Authentication</p>
</li>
</ol>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 Add Accounts</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the steps for adding accounts for management by the Collaborator.
Each step is a link to the function in this UI:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add Account</p>
</li>
<li>
<p>Manage Accounts</p>
</li>
<li>
<p>Migration and Co-existence</p>
</li>
</ol>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="monitor_ui">Monitor UI</h4>
<div class="paragraph">
<p>The <strong>Monitor</strong> screen provides the Monitor navigation pane and the Monitor pages, which display various itemizations about servers monitored by the Collaborator.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_monitor_ui.png" alt="Monitor UI">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;1&gt; Go to Previous or Next page
&lt;2&gt; Search
&lt;3&gt; Screen Refresh
&lt;4&gt; Current User and Logout Option
&lt;5&gt; Help
&lt;6&gt; Status Pane
&lt;7&gt; Navigation Pane</pre>
</div>
</div>
<div class="sect4">
<h5 id="_monitor_navigation_pane_and_pages">Monitor Navigation Pane and Pages</h5>
<div class="paragraph">
<p>The options provided in the <strong>Monitor</strong> pages provide various methods-
dynamic charts, or tables-for viewing the individual or system-wide monitored servers and services listed in the following table.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Adobe Flash Player must be activated to enable views of the dynamic charts.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Monitor UI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Status</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Server, Service, and Time details for each server monitored by the Collaborator.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced Statistics</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>System-wide Information page for Advanced Statistics, which allows you to set up a new monitoring chart using parameters from the selection fields available from this page: Server, Group, Start, end, and Counters.</p>
</div>
<div class="paragraph">
<p>From this Advanced Statistics page, you can also elect to perform the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hide Chart Settings</p>
</li>
<li>
<p>Update Chart</p>
</li>
<li>
<p>Remove Chart</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Count</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>System-wide Information page, for Message Counts, to examine charts depicting counts over the last 48, 30, 60, and 365 days.
The information summarizes the number of recipients of messages using either SMTP or LMTP.
The polling intervals for the counts are posted directly beneath each chart.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message Volume</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>System-wide Information page, for Message Volume, to view charts depicting the number of recipients of messages using either SMTP or LMTP, and associated message sizes.
These counts get summarized in periods over the last 48, 30, 60, and 365 days.
The polling intervals for the counts are posted directly beneath each chart.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Anti-Spam/Anti-Virus</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>System-wide Information page, for Anti-Spam/Anti-Virus</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activity</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Activity, depicting the number of unique messages processed by the AS/AC system over the last 48, 30, 60, and 365 days.
The polling intervals for the counts are posted directly beneath each chart.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Statistics</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Access to statistics for a selected Service Host.
You can view information for a selected host, as follows:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Place and hold the cursor on the Service Hostname to view popup license information.</p>
<div class="paragraph">
<p><span class="image"><img src="images/admin_console_monitor_ui_license.png" alt="License"></span></p>
</div>
</li>
<li>
<p>Right-click on the Service Hostname and select <strong>View</strong> from the popup to go to the statistics page for it.
You can also double-click on the Service Hostname to access the statistics page.</p>
<div class="paragraph">
<p><span class="image"><img src="images/admin_console_monitor_ui_view.png" alt="View"></span></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>For the selected Server, the Server Statistics navigation pane provides options to view Disk, Session, Mailbox Quota, Message Count, Message Volume, and Anti- Spam/Anti-Virus Activity.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail Queues</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Tab pages from which to view counts of Deferred, Incoming, Active, Held,
and Corrupt statistics for detected mail queues.
Each tab page provides summary filtering information and Message details.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="manage_ui">Manage UI</h4>
<div class="paragraph">
<p>The <strong>Manage</strong> screen provides the <strong>Manage</strong> navigation pane, and the <strong>Manage</strong>
pages, which display the tables categorically provided as Accounts,
Aliases, Distribution Lists, and Resources that are currently managed by Collaborator.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_manage_ui.png" alt="Manage UI">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;1&gt; Go to Previous or Next page
&lt;2&gt; Search
&lt;3&gt; Screen Refresh
&lt;4&gt; Current User and Logout Option
&lt;5&gt; Help
&lt;6&gt; Gear Icon
&lt;7&gt; Status Pane
&lt;8&gt; Navigation Pane</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Manage UI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Option</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts (count)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Table of accounts managed by the Collaborator.
Actions you can perform:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>View ID information from a popup display: Hold the cursor over an Accounts row.</p>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions: <strong>Delete</strong>, <strong>Edit</strong>, <strong>Change Password</strong>, <strong>New Administrator</strong>, <strong>View Mail</strong>, <strong>New</strong>, <strong>Invalidate Session</strong>, <strong>View Rights</strong>, <strong>Configure Grants</strong>,
<strong>Move Mailbox</strong>, <strong>Search Mail</strong>.</p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aliases (count)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Table of Aliases managed by the Collaborator.
Each alias is an email address that forwards all email to a specified account.</p>
</div>
<div class="paragraph">
<p>Actions you can perform:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>View ID information in a popup display: Hold the cursor over an Alias row.</p>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions:
<strong>Delete</strong>, <strong>Edit</strong>, <strong>New Administrator</strong>, <strong>View Mail</strong>, <strong>Move Alias</strong>, <strong>New</strong>, <strong>Invalidate Session</strong>, <strong>View Rights</strong>, <strong>Configure Grants</strong>, <strong>Move Mailbox</strong>, <strong>Search Mail</strong>.</p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution Lists (count)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Table of Distribution Lists managed by the Collaborator.
A Distribution List is a group of mail addresses contained in a list, with a mail address for the list.
When you send a message to a distribution list, you are sending it <em>implicitly</em> to everyone whose address appears in the list.
The <strong>To:</strong> address line displays the distribution list address.</p>
</div>
<div class="paragraph">
<p>Actions you can perform:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>View ID information: Hold the cursor over a Distribution List row.</p>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions: <strong>Delete</strong>, <strong>Edit</strong>, <strong>New Administrator</strong>, <strong>View Mail</strong>, <strong>New</strong>, <strong>View Rights</strong>, <strong>Configure Grants</strong>, <strong>Search Mail</strong>.</p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resources (count)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Table of Resources managed by the Collaborator.
A Resource is a location or a piece of equipment that supports scheduling for meetings.</p>
</div>
<div class="paragraph">
<p>Actions you can perform:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>View ID information: Hold the cursor over a Resources row.</p>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions: <strong>Delete</strong>, <strong>Edit</strong>, <strong>New Administrator</strong>, <strong>View Mail, New</strong>, <strong>View Rights</strong>, <strong>Configure Grants</strong>, <strong>Search Mail</strong>.</p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="configure_ui">Configure UI</h4>
<div class="paragraph">
<p>The <strong>Configure</strong> screen provides the <strong>Configure</strong> navigation pane, and the <strong>Configure</strong> pages, which enable configurations for individual or global components.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_configure_ui.png" alt="Configure UI">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;1&gt; Go to Previous or Next page
&lt;2&gt; Search
&lt;3&gt; Screen Refresh
&lt;4&gt; Help
&lt;5&gt; Gear Icon
&lt;6&gt; Status Pane
&lt;7&gt; Configure Navigation Pane</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Configure UI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Option</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class of Service</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the COSs managed from this AdministrationConsole.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Double-click on a table row to access the configuration screens for the selected COS,</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions: <strong>New</strong>, <strong>Delete</strong>, <strong>Edit</strong>, <strong>Duplicate</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the domains managed from this Administration Console.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Double-click on a table row to access the configuration screens for the selected domain,</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions:
<strong>New</strong>, <strong>Delete</strong>, <strong>Edit</strong>, <strong>Configure GAL</strong>, <strong>Configure Authentication</strong>, <strong>View Accounts</strong>, <strong>Add a Domain Alias</strong>, <strong>Configure Grants</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servers</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the servers managed from this Administration Console.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Double-click on a table row to access the configuration screens for the selected server,</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions:
<strong>Edit</strong>, <strong>Flush Cache</strong>, <strong>Enable Proxy</strong>, <strong>Disable Proxy</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global Settings</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Provides access to tools you use to set various global parameters for your
Zimbra Collaboration.</p>
</div>
<div class="paragraph">
<p>Gear Icon: <strong>Save</strong>, <strong>Download</strong>, <strong>Update License</strong>, <strong>Activate License</strong>,
<strong>Manually Activate License</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlets</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the Zimlets managed from this Administration Console.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Double-click on a table row to access the configuration screens for the selected Zimlet,</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions:
<strong>Deploy</strong>, <strong>Undeploy</strong>, <strong>Toggle Status</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin Extensions</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the Admin Extensions managed from this Administration Console.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Double-click on a table row to access the configuration screens for the selected Admin Extension,</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions: <strong>Deploy</strong>, <strong>Undeploy</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificates</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the Certificates managed from this Administration Console.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Double-click on a table row to access the General Information screen for the selected certificate,</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions:
<strong>Install Certificate</strong>, <strong>View Certificate</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rights</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the various Rights applicable to this Administration Console.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Double-click on a table row to access the General Information screen for the selected Right,</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following function: <strong>View</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global ACL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the Global Access Control Lists managed from this Administration Console.</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Double-click on a table row to access the Edit ACE screen for the selected Global ACL,</p>
<div class="paragraph">
<p>or</p>
</div>
</li>
<li>
<p>Right-click on a table row, or use the Gear icon to access the following functions: <strong>Add</strong>, <strong>Delete</strong>, <strong>Edit</strong></p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="global_settings_ui">Global Settings UI</h4>
<div class="paragraph">
<p>Global Settings define the default global values for servers, accounts, COS, and domains.
These default values and parameters apply when no specific values and parameters for particular items are in their settings.</p>
</div>
<div class="paragraph">
<p>You configure the defaults for Global Settings during installation.
You can change the settings at any time from Global Settings at the Administration Console.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Global Settings UI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Option</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">General Information</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Set global ceiling for the number of results from a GAL search.</p>
</li>
<li>
<p>Define default domain.</p>
</li>
<li>
<p>Configure the number of threads that can be used to get the content from the remote data sources.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information,
see <a href="#general_information_configuration">General Information Configuration</a></p>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attachments</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Enable rules to reject messages that include attachments of a specific
extension.</p>
</li>
<li>
<p>Disable attachments from being read.</p>
</li>
<li>
<p>Convert attachments to HTML for viewing.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information,
see <a href="#attachments_configuration">Attachments Configuration</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTA</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Enable authentication.</p>
</li>
<li>
<p>Set maximum message size.</p>
</li>
<li>
<p>Enable or disable protocol and DNS check.</p>
</li>
<li>
<p>Add X-Originating-IP message headers.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>For more information,
see <a href="#mta_configuration">MTA Configuration</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enable IMAP service.
Changes to these settings do not take effect until the server restarts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enable POPS3 Service.
Changes to these settings do not take effect until the server restarts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AS/AV</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set anti-spam and anti-virus rules.
Changes to the Spam-check settings do not take effect until the server restarts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Themes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Customize the color scheme of existing themes</p>
</li>
<li>
<p>Add logo to a theme.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Changes to the theme settings require flushing of the server theme cache by using <b class="button">Flush Cache</b> on the toolbar in Server settings.</p>
</div>
<div class="paragraph">
<p>For more information,
see <a href="#color_and_logo_management">Color and Logo Management</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Configure the company name to be displayed in the prompt on the Authentication Required dialog used to log in to Briefcase folders shared with external guests</p>
</li>
<li>
<p>Add regular expression rules for Account Email Validation.</p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retention Policy</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set up a retention and deletion time threshold for items in user folders.
You can configure retention and deletion policies as a global setting, or configure COS-level policies instead of inheriting from the global settings.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set parameters for Web Proxy and Mail Proxy.
There are also tools provided for setting Advanced Proxy parameters.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S/MIME</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>(Secure Multipurpose Internet Mail Extensions): Configure the LDAP settings on the S/MIME tab (if S/MIME feature is enabled).
Users retrieve private keys from LDAP servers.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>(Access Control List): Go to ACE (Access Control Entry) configuration for delegated administration rights granted on selected target(s), to add,
edit, or delete an ACE.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backup/Restore</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Set parameters for backup-for standard or auto- grouped mode.
For more information see <a href="#backup_and_restore">Backup and Restore</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HSM</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>(hierarchical storage management): Configure the aging of messages before they move to the secondary volume.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">License</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Update and install your Zimbra license.</p>
</li>
<li>
<p>View current license information.</p>
</li>
</ul>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="tools_and_migration_ui">Tools and Migration UI</h4>
<div class="paragraph">
<p>The <strong>Tools and Migration</strong> screen provides the <strong>Tools and Migration</strong> navigation pane, for access to system software management and system backup/restore.
Administrators can access and download specific wizards and tools from this page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_tools_and_migration_ui.png" alt="Tools and Migration UI">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;1&gt; Go to Previous or Next page
&lt;2&gt; Search
&lt;3&gt; Screen Refresh
&lt;4&gt; Current User and Logout Option
&lt;5&gt; Help
&lt;6&gt; Status Pane
&lt;7&gt; _Tools and Migration_ Navigation Pane</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Tools and Migration</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Downloads</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access Zimbra utilities, which provides downloadable <code>zip</code> packages
- for general administration use, and to synchronize an individual end-user -
containing migration wizards for various platforms, and Outlook connectors.
Additional information is provided in <a href="#downloadable_wizards_and_connectors">Downloadable Wizards and Connectors</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software Updates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find out if your system needs a Zimbra Server update or not, and use this page to view polling and email contact information pertinent to software updates for your system.</p>
<p class="tableblock">See also <a href="#checking_for_updates">Checking for Zimbra Collaboration Software Updates</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account Migration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View tabular details about account migrations, as detected by your system.
This page lists total imports and the status of each.
This page also provides the name(s) of the owners for each account migration listed.
See also <a href="#migrating_accounts">Migrating Accounts from a Zimbra Server</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Upload</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this page to browse for the latest version of software to be uploaded to your system.
After selecting the image, you can use <b class="button">Upload</b> on this page to complete the software upload.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access a summary view of current free and total space (MB) based on the most recent system backup.
You can also choose an administrator from this navigation pane to view their backup history.
The history lists labels, start and end times, and success or failure for each backup occurrence.
Each of these listings is associated with an identical displayed directory path to the backup target.
The section <a href="#backup_and_restore">Backup and Restore</a> provides additional information.</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="downloadable_wizards_and_connectors">Downloadable Wizards and Connectors</h5>
<div class="paragraph">
<p>Use the <strong>Tools and Migration</strong> screen <strong>Downloads</strong> option to get the tools described in this section.
Check <a href="#zimbra-pst-migration">Zimbra PST Migration</a> to migrate Outlook PSTs to Zimbra Collaboration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Administrator Tools and Migration Options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ZCS Migration Wizard for Exchange/PST (32 bit)</strong><br>
<strong>ZCS Migration Wizard for Exchange/PST (64 bit)</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get <code>zip</code> files to perform a server-to-server migration of mail, calendar, and contacts from Microsoft Exchange or PST file to the Zimbra Collaboration Server.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This package is supported only for PST file import, with End of Technical Guidance set for 31 December 2020.
We recommend <a href="https://zimbra.audriga.com/"><em>audriga</em>'s self-service migration solution</a>
as a preferred alternative for all account migrations.
</td>
</tr>
</table>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ZCS Migration Wizard for Domino</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This package is deprecated!
We recommend <a href="https://zimbra.audriga.com/">Audriga&#8217;s self-service migration solution</a>
as a preferred alternative for all account migrations.
</td>
</tr>
</table>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Legacy ZCS Migration Wizard for Exchange</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This package is deprecated!
We recommend <a href="https://zimbra.audriga.com/">Audriga&#8217;s self-service migration solution</a>
as a preferred alternative for all account migrations.
</td>
</tr>
</table>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zimbra Connector for Outlook MSI Customizer</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Present text file containing functions you can use to customize the standard ZCO MSI.
The server name, port, and other variables particular to an organization can be customized.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zimbra Connector for Outlook Branding MSI</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get the Windows Visual Basic Script Edition (VBScript Script File) to customize the standard ZCO MSI.
Customization replaces all instances of the Zimbra product name and logo.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. End User Desktop Applications and Utilities / Migration and Import Tools</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Zimbra Connector for Outlook (32 bits)</strong><br>
<strong>Zimbra Connector for Outlook (64 bit) (User Instructions)</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This application enables the user&#8217;s Outlook to synchronize calendar, contacts, and mail with the ZCS server.
The Zimbra Connector for Microsoft Outlook (ZCO) allows users of Microsoft Outlook to connect to the ZCS server to access ZCS business features.
Address books, Contacts, Calendars, Tasks, and mail are synced directly with the ZCS server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>(Legacy) Microsoft Outlook PST Import Tool</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This package is deprecated!
Users should use the General Migration Wizard for PST import.
</td>
</tr>
</table>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>(Legacy) Migration Wizard for Microsoft Exchange</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This package is deprecated!
We recommend <a href="https://zimbra.audriga.com/">Audriga&#8217;s self-service migration solution</a>
as a preferred alternative for all account migrations.
</td>
</tr>
</table>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>General Migration Wizard</strong></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This tool imports data within Microsoft Exchange servers and Outlook PST files to the Zimbra Server.</p>
</div>
<div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This package is supported only for PST file import.
We recommend <a href="https://zimbra.audriga.com/">Audriga&#8217;s self-service migration solution</a>
as a preferred alternative for all account migrations.
</td>
</tr>
</table>
</div>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="search_ui">Search UI</h4>
<div class="paragraph">
<p>The <strong>Search</strong> screen displays the <strong>Search</strong> results from queries made in the Search field in the Administration Console header.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When you open this page without entering a search query, <em>All Results</em> is the default search, which displays accounts, domains, and distribution lists in the Content pane.</p>
</li>
<li>
<p>The auto-completion function allows you to enter a partial name, then select a searchable name from the displayed list of matched strings.</p>
</li>
<li>
<p>You can also use the Zimbra mailbox ID number to search for an account.
However, to return a search from a mailbox ID, the complete ID string must be entered in the search.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_search_ui.png" alt="Search UI">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;1&gt; Go to Previous or Next page
&lt;2&gt; Search Options
&lt;3&gt; Search
&lt;4&gt; Screen Refresh
&lt;5&gt; Current User and Logout Option
&lt;6&gt; Help
&lt;7&gt; Gear Icon
&lt;8&gt; Status Pane
&lt;9&gt; Search Navigation Pane</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Search UI</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Option</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the count and table of all search results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the count and table resulting from a query for Accounts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the count and table resulting from a query for Domains.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution Lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the count and table resulting from a query for Distribution Lists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Attributes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for a user by first name, last name, display name, or account ID number.
You can search for administrators or delegated administrators only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for an account by status: Active, Closed, Locked, Logout, Pending, or Maintenance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last Login Time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for accounts by the last login time.
You can specify a date range to search.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External Email Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for an account with an external email address.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for objects by COS or for objects that are not assigned a COS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for accounts on selected servers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for accounts on selected domains.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Saved Searches</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, this section includes predefined common search queries.
You can also create and save your queries.
After you enter the query syntax, click <strong>Save Search</strong> and provide a name for the search.
The search is then added to this Saved Searches section.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_setting_up_a_simple_search">Setting Up a Simple Search</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>At the <strong>Search</strong> field, use search options from the drop-down selector to define the type of search, as either <em>accounts</em>, <em>distribution lists</em>,
<em>aliases</em>, <em>resources</em>, <em>domains</em>, <em>class of service</em>, or <em>all objects</em>.</p>
<div class="paragraph">
<p>For accounts, you can search by display name, first/last name, the first part of an email address, alias, delivery address, or mailbox ID.</p>
</div>
</li>
<li>
<p>Type the search string into the <strong>Search</strong> field.</p>
<div class="paragraph">
<p>Partial entries are allowed as search criteria, but a search based on mailbox ID must include the complete ID string.</p>
</div>
</li>
<li>
<p>Click <strong>Search</strong>.</p>
<div class="paragraph">
<p>The Search page appears, containing results of the search based on your criteria.</p>
</div>
</li>
<li>
<p>View the total number of results at the Navigation pane, in <strong>Search&gt; All Results</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_help_center_ui">Help Center UI</h4>
<div class="paragraph">
<p>The <strong>Help Center</strong> is a reference of resources available from the online help and documentation, which you can access with the links provided in the <strong>Help</strong> <strong>Center</strong> screen.
Use this page, also, to access community forums and to view expert responses to the top migration questions.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_help_center_ui.png" alt="Help Center UI">
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;1&gt; Go to Previous or Next page
&lt;2&gt; Search
&lt;3&gt; Screen Refresh
&lt;4&gt; Current User and Logout Option
&lt;5&gt; Help
&lt;6&gt; Status Pane
&lt;7&gt; Help Center Navigation Pane</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tools_in_collaborator_tables">Tools in Collaborator Tables</h4>
<div class="paragraph">
<p>The selection of a category from the Navigation pane typically results in a tabular display of all managed objects for the selected category.
All tables display labeled columns in which to view information such as email addresses, display names, status, last logins, and descriptions (if configured).</p>
</div>
<div class="paragraph">
<p>Each row in a table enables actions you can perform if you require additional information or access to the configuration for the selected table entry.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Action at Table Row</th>
<th class="tableblock halign-left valign-top">Result</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hold cursor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display ID details for the selection, similar to the example at right (invoked from an Accounts row).</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="images/administration_console_tools_in_collaborator_tables.png" alt="Tools">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Right-click</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access the popup menu for a selected table row.
The popup menus from a typical table may differ from row to row, as demonstrated in the following examples.</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Accounts and Aliases: Dist Lists and Resources:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_tools_in_collaborator_tables_2.png" alt="Tools">
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_message_of_the_day">Message of the Day</h3>
<div class="paragraph">
<p>Global administrators can create the message- or messages-of-the-day (MOTD) that administrators view when logging into the Administration Console.</p>
</div>
<div class="paragraph">
<p>The MOTD displays during administrative login at the top-left of the Administration Console, similar to the example below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/motd.png" alt="Message of the Day">
</div>
</div>
<div class="paragraph">
<p>The message can be closed, replaced, or removed.</p>
</div>
<div class="sect3">
<h4 id="_closing_a_message_of_the_day">Closing a Message of the Day</h4>
<div class="paragraph">
<p>To remove a message from view, click <b class="button">Close</b> located alongside the message content.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_messages_of_the_day">Creating Message(s) of the Day</h4>
<div class="paragraph">
<p>Use the <code>zimbraAdminConsoleLoginMessage</code> attribute, with guidelines in this section, to create a single message of the day, or to create multiple messages to be displayed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When creating a message with your command entry, always place double-quote marks at the beginning and end of the message to be displayed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Creating a global message or domain-specific message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraAdminConsoleLoginMessage &quot;message to display&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating a multiple-message display:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; +zimbraAdminConsoleLoginMessage &quot;second message to display&quot;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_removing_messages_of_the_day">Removing Message(s) of the Day</h4>
<div class="paragraph">
<p>Use the <code>zimbraAdminConsoleLoginMessage</code> attribute, with guidelines in this section, to delete a single message of the day, or to delete multiple messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When removing a message with your command entry, use the following guidelines for individual and multiple deletions:
</td>
</tr>
</table>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Place a minus sign (-) before the attribute, and double quote marks at the beginning and end of an individual message-id for deletion.</p>
</li>
<li>
<p>Use single quote marks with the attribute to remove all messages.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Removing a specific message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; -zimbraAdminConsoleLoginMessage &quot;message to display&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Removing all messages:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraAdminConsoleLoginMessage ''</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_functional_reference">Functional Reference</h3>
<div class="paragraph">
<p>This section provides birds-eye views of the functions you can use when navigating the Administration Console, in the following topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#gui_roadmap">GUI Roadmap</a></p>
</li>
<li>
<p><a href="#popup_menu_options">Popup Menu Options</a></p>
</li>
<li>
<p><a href="#containers">Containers</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="gui_roadmap">GUI Roadmap</h4>
<div class="paragraph">
<p>The following illustration provides a high-level view of the Administration Console UI.</p>
</div>
<div id="high_level_view_of_administration_console_ui" class="openblock">
<div class="title">High-level View of Administration Console UI</div>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/high_level_view_of_admin_console_ui.png" alt="High-level View of Administration Console UI">
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="popup_menu_options">Popup Menu Options</h4>
<div class="paragraph">
<p>You can select options to perform on a selected entity from the navigation pane from the Gear icon or a topical popup menu.</p>
</div>
<div class="sect4">
<h5 id="using_the_gear_icon">Using the Gear icon</h5>
<div class="paragraph">
<p>The <strong>Gear</strong> icon is always located at the upper-right edge of the page view if pertinent to selectable items in the displayed page.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_gear_icon.png" alt="The Gear Icon">
</div>
</div>
<div class="paragraph">
<p>To view the available options, highlight a topic at the navigation pane or in the page view:
In the popup, the options that do not apply to your selection are disabled&#8201;&#8212;&#8201;the remaining enabled options are valid with your selection.
The following example demonstrates Gear options based on the selection of a navigation bar topic, versus a table row entry from within the same page view.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_gear_icon_2.png" alt="The Gear Icon">
</div>
</div>
<div class="paragraph">
<p>The following table provides a high-level view of the operations derived from the Gear icon, which varies for particular functions.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 20. Gear Icon Operations</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Navigation Pane Topic</th>
<th class="tableblock halign-left valign-top">Selections</th>
<th class="tableblock halign-left valign-top">Options <span class="image"><img src="images/gear_icon.png" alt="Gear Icon"></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>Home Monitor</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server Statistics</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>View</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail Queues</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flush</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><strong>Manage</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>New, New Administrator, Edit, Delete, Change Password, Invalidate Sessions,
View Mail, Move Mailbox, View Rights, Configure Grants</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aliases</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New, New Administrator, Edit, Delete, Move Alias, Invalidate Sessions, View Mail, Move Mailbox, View Rights, Configure Grants</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution Lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New, New Administrator, Edit, Delete, View Mail, View Rights, Configure Grants</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New, New Administrator, Edit, Delete, View Mail, View Rights, Configure Rights</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><strong>Configure</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class of Service</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>New, Delete, Edit, Duplicate</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New, Delete, Edit, Configure GAL, Configure Authentication, View Accounts,
Add a Domain Alias, Configure Grants</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit, Flush Cache, Enable Proxy, Disable Proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global Settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save, Download, Update License, Activate License, Manually Activate License</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy, Undeploy, Toggle Status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin Extensions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy, Undeploy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install Certificate, View Certificate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Voice/Chat Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">New, Delete, Edit, Generate Session ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rights</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global ACL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add, Delete, Edit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock"><strong>Tools and Migration</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account Migration</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Delete Task, Refresh, Migration Wizard</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software Updates</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Save, Check Now</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backups</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View, Backup, Restore, Configure, Refresh</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><strong>Search</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All Result</p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><div class="content"><div class="paragraph">
<p>Delete, Edit, Change Password, View Mail, Move Alias, Invalidate Sessions, Move Mailbox, Download</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aliases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domains</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution Lists</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_using_the_topical_popup_menus">Using the Topical Popup Menus</h5>
<div class="paragraph">
<p>You can elect to access options to perform on a selection by using popup menus:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are no popup menus in the Navigation Pane.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following example demonstrates the popup options provided by a specific selection in the page view.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. Popup Options</div>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="images/administration_console_popup_menus.png" alt="Popup Options">
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_containers">Containers</h4>
<div class="paragraph">
<p>The Administration Console logically groups a wide range of Configuration options into <em>containers</em>.
Applicable configuration options inside these containers are listed in the
<a href="#high_level_view_of_administration_console_ui">High-level View of Administration Console UI</a></p>
</div>
<div class="paragraph">
<p>By default, all containers on a page are opened (expanded).
You can opt to close (collapse) containers - which can free up additional space in a page view - by clicking on <b class="button">collapse/expand</b> located at the upper-left edge of the container.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/administration_console_containers.png" alt="Containers">
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="zimbra-pst-migration">Zimbra PST Migration Wizard</h3>
<div class="paragraph">
<p>The Zimbra PST Migration Wizard helps migrate Microsoft Outlook personal folders (<code>PST</code>) files to Zimbra Collaboration (ZCS).</p>
</div>
<div class="paragraph">
<p>The tool runs in two modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migration wizard with a graphical interface</p>
</li>
<li>
<p>Migration utility which uses a command line interface</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_migration_wizard_gui">Migration Wizard GUI</h3>
<div class="paragraph">
<p>Zimbra PST Migration Wizard is an application that helps users migrate their <code>PST</code> files to Zimbra Collaboration Server using a very intuitive interface.</p>
</div>
<div class="paragraph">
<p>The tool has 4 phases:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Source</dt>
<dd>
<p>Locate and select the <code>PST</code> file to migrate to Zimbra Collaboration Server.</p>
</dd>
<dt class="hdlist1">Destination</dt>
<dd>
<p>Enter login credentials associated with Zimbra Collaboration Server.</p>
</dd>
<dt class="hdlist1">Options</dt>
<dd>
<p>Specify folders, items, and other available options for migration.</p>
</dd>
<dt class="hdlist1">Results</dt>
<dd>
<p>View migration status, including progress, errors, and warnings.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="source-info">Source Information</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click <strong>Source</strong>.</p>
</li>
<li>
<p>Click <code>&#8230;&#8203;</code> beside <strong>PST File</strong> field to open a file browser window.</p>
</li>
<li>
<p>Navigate to and choose the <code>PST</code> file to migrate to Zimbra Collaboration Server.</p>
</li>
<li>
<p>Choose a log detail level. Logs are written to folder <code>%temp%/ZimbraMigration</code> and are useful for diagnosing migration issues. Support may request logs when you require assistance. We recommend that you set the log level to <strong>Verbose</strong> while becoming familiar with the tool.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Logs are automatically deleted after seven days to conserve disk space, so take backup copies if you require assistance after seven days of performing a migration. During migration, you can open a log file by clicking <strong>Open Log File</strong> on the <strong>Results</strong> page.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="destination-info">Destination Information</h4>
<div class="paragraph">
<p>An administrator creates the account for you on the Zimbra Collaboration Server and gives you the migration tool application and the following information which you need to migrate your <code>PST</code> files.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Destination</strong> dialog, box, enter below details.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Hostname</dt>
<dd>
<p>This is the domain name of the Zimbra server.</p>
</dd>
<dt class="hdlist1">Port</dt>
<dd>
<p>The port number used by the server is usually <code>80</code> for non-secure connections and <code>443</code> for secure connections.</p>
</dd>
<dt class="hdlist1">Use Secure Connection</dt>
<dd>
<p>Select the option for SSL secure communication with ZCS.</p>
</dd>
<dt class="hdlist1">Username</dt>
<dd>
<p>Enter your ZCS account email address as <strong>name@domain.com</strong>.</p>
</dd>
<dt class="hdlist1">Password</dt>
<dd>
<p>Enter your ZCS account password.</p>
</dd>
</dl>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="select-options">Selecting Options to Migrate</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Under <strong>Item Types</strong>, choose items to import.</p>
</li>
<li>
<p>Choose <strong>Additional Folders</strong> to migrate <strong>Sent</strong>, <strong>Deleted Items</strong> (Trash), and <strong>Junk</strong> (Spam) folders.</p>
</li>
<li>
<p><strong>Filters</strong>: Choose below filter options to skip unwanted <code>PST</code> items during migration.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Migrate On or After</strong>: This option filters out messages from before the provided date. The tool skips the migration of messages before this date.</p>
</li>
<li>
<p><strong>Maximum message size</strong>: The message size includes the message and attachments. Leave the field blank to use the Zimbra Collaboration server setting for maximum message size.</p>
<div class="ulist">
<ul>
<li>
<p>If you set a value here, this value cannot be larger than the global MTA setting for the maximum size of a message. The default maximum message size is 0 (indicating no size limit).</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Setting <strong>0</strong> as maximum size does not override the limits specified in the Zimbra Collaboration server.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><strong>Skip these folders, and their children (separate with a comma)</strong></dt>
<dd>
<p>Enter names of folders, and all its subfolders, separated by a comma, to skip their migration.</p>
</dd>
<dt class="hdlist1"><strong>Skip previously migrated items</strong></dt>
<dd>
<p>Select this box to skip migration of Previously migrated items.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can view and change the Maximum size of a message value from the Administration Console <strong>Configure</strong> &#8594; <strong>Global Settings</strong> &#8594; <strong>MTA</strong> tab.
</td>
</tr>
</table>
</div>
</dd>
</dl>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Click <strong>Save</strong> to save configuration information in a file which can be loaded later using the Load button on the <a href="#source-info">Source Information</a> page when you next run the migration tool.</p>
</li>
<li>
<p>Click <strong>Back</strong> to go back and change specifics in <a href="#source-info">Source Information</a> or <a href="#destination-info">Destination Information</a>.</p>
</li>
<li>
<p>Click <strong>Migrate</strong> to begin the migration process.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_migration_results">Viewing Migration Results</h4>
<div class="paragraph">
<p>In the Results dialog, view the migration status of the <code>PST</code> file, including progress, errors, and warnings.</p>
</div>
<div class="paragraph">
<p>To view the results log, double click your account. A new tab opens and displays the account log information.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Account</dt>
<dd>
<p>This shows the migration status. The progress bar shows the state of the migration, accompanied by status messages. <strong>Min/Avg/Max</strong> are the minimum, average and maximum times (in milliseconds) to migrate items in that account. Read/Write indicate proportionally how much time is spent reading data from the source vs. writing data to the Zimbra Collaboration server. These figures are useful for detecting network/server bottlenecks. For example, 90%:10% would indicate the source is the bottleneck.</p>
<div class="ulist">
<ul>
<li>
<p>Double-click your account name in Accounts, and an individual tab shows folder-by-folder migration status, along with folder-by-folder bottleneck statistics mentioned above. Click <strong>X</strong> on the appropriate tab to close view.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Open Log File</dt>
<dd>
<p>Opens the log file associated with your <code>PST</code> file&#8217;s migration. The Log files are at <code>%temp%\ZimbraMigration\Logs\*.log</code>. Each migration generates several log files. <code>*migrate.log</code> contains overall migration session data. <code>*migrate-SUMMARY.log</code> contains a summary of key events from the migration session. In addition there will be one log for each account migrated&#8201;&#8212;&#8201;<code>*migrate [src-account-name]</code> to <code>[dest-account-name].log</code>.</p>
</dd>
<dt class="hdlist1">Stop</dt>
<dd>
<p>Click Stop to stop the migration. To restart, go back to the previous view, and click the Migrate button.</p>
</dd>
<dt class="hdlist1">Exit</dt>
<dd>
<p>Click Exit to close the migration tool.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_migration_wizard_cli">Migration Wizard CLI</h3>
<div class="paragraph">
<p>Zimbra PST Migration Wizard also has a command line interface to help users migrate their <code>PST</code> files to Zimbra Collaboration Server using one command with multiple, intuitively named, arguments.</p>
</div>
<div class="paragraph">
<p>The command requires a configuration file (<code>XML</code>) and a <code>PST</code> file.</p>
</div>
<div class="sect3">
<h4 id="create-config-file">Creating Configurations file</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Launch Zimbra Collaboration.</p>
</li>
<li>
<p>Specify <a href="#source-info">Source Information</a>.</p>
</li>
<li>
<p>Specify <a href="#destination-info">Destination Information</a>.</p>
</li>
<li>
<p><a href="#select-options">Select options</a> applicable to current migration.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Options chosen here can be overridden by specifying the arguments available in the command line utility.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Once done, click <strong>Save</strong> to save the above configurations as an <code>XML</code> file.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_running_the_utility">Running the Utility</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Format</dt>
<dd>
<p><code>ZimbraMigrationConsole ConfigxmlFile=&lt;path to XML file&gt; [arg1] [arg2] &#8230;&#8203;</code></p>
</dd>
<dt class="hdlist1">Example</dt>
<dd>
<p><code>ZimbraMigrationConsole ConfigxmlFile=../Config.xml Calendar=true Contacts=true</code></p>
</dd>
<dt class="hdlist1">Explanation</dt>
<dd>
<p>The tool migrates Calendar and Contacts from the PST mentioned in the <code>XML</code> file</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The tool accepts multiple other arguments which are precisely like when <a href="#select-options">selecting options</a> to migrate. Run the utility with <code>-Help</code> as a switch to see all supported arguments.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Arguments, when specified in the command line utility, override options selected while creating the configurations file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the command runs successfully, the console displays the status of the migration.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="managing_configuration">Managing Configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ZCS components are configured during the initial installation of the
software. After the installation, you can manage the following components
from either the Administration Console or using the CLI utility.</p>
</div>
<div class="paragraph">
<p><strong>Help</strong> is available from the Administration Console about how to perform
tasks from the Administration Console. If the task is only available from
the CLI, see <a href="#cli_commands">Zimbra CLI Commands</a> for a description of how
to use the CLI utility.</p>
</div>
<div class="sect2">
<h3 id="_global_configuration">Global Configuration</h3>
<div class="paragraph">
<p>Global Settings apply to all accounts in the Zimbra servers. They are
initially set during installation. You can modify the settings from the
Administration Console.</p>
</div>
<div class="paragraph">
<p>Configurations set in Global Settings define inherited default values
for the following objects: server, account, COS, and domain. If these
attributes are set in the server, the server settings override the
global settings.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p>To configure global settings, navigate to:<br>
<strong>Home &#8594; Configure &#8594; Global Settings</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Configured global settings are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Default domain</p>
</li>
<li>
<p>Maximum number of results returned for GAL searches. Default = 100.</p>
</li>
<li>
<p>User views of email attachments and attachment types not permitted.</p>
</li>
<li>
<p>Configuration for authentication process, Relay MTA for external
delivery, DNS lookup, and protocol checks.</p>
</li>
<li>
<p>Spam check controls and anti-virus options to check messages received.</p>
</li>
<li>
<p>Free/busy scheduling across a mix of Zimbra Collaboration servers and
third party email servers.</p>
</li>
<li>
<p>Customization of themes: modify colors and add your logo.</p>
</li>
<li>
<p>Configuration of company name display for external guest log on, when
viewing a shared Briefcase folder.</p>
</li>
<li>
<p>Backup default directory and backup notification information.</p>
</li>
<li>
<p>Global HSM schedule that defines when messages should be moved to a
secondary storage space.</p>
</li>
<li>
<p>View of current Zimbra license information, license updating, and view
the number of accounts created.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="general_information_configuration">General Information Configuration</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Use the <strong>General Information</strong> screen to view and set global parameters
for servers that have been installed and enabled.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Settings defined at the server(s) override those configured in the General
Information screen.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administration_console_general_information_configuration.png" alt="General Information"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify parameters, as appropriate for your requirements.</p>
</li>
<li>
<p>From the <strong>Gear</strong> icon, select <strong>Save</strong> to use your settings.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 21. General Information Parameters</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most results returned by GAL search</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of GAL results returned from a user search. This value
can be set by domain: the domain setting overrides the global setting.<br>
Default = 100.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default domain</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Domain that users' logins are authenticated against.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of scheduled tasks that can run simultaneously</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Number of threads used to fetch content from remote data
sources.
* If set too low, users do not get their mail from external sources pulled down often enough.
* If set too high, the server may be consumed with downloading this mail and not servicing "main" user requests.<br>
Default = 20</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sleep time between subsequent mailbox purges</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The duration of time that the server should "rest" between purging
mailboxes.  If the message purge schedule is set to 0, messages are not
purged, even if the mail, trash and spam message life time is set.<br>
Default = message purge is scheduled to run every 1 minute.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum size of an uploaded file for Briefcase files (KB)</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum size of a file that can be uploaded into Briefcase.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The maximum message size for an email message and attachments that can be
sent is configured in the <strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA</strong> page, <strong>Messages</strong> section.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin Help URL<br>
Delegated Admin Help URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>To use the Zimbra Collaboration Help, you can designate the URL that is
linked from the Administration Console Help</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="attachments_confirguration">Attachments Configuration</h3>
<div class="sect3">
<h4 id="_setting_up_email_attachment_rules">Setting Up Email Attachment Rules</h4>
<div class="paragraph">
<p>Global email attachment settings allow you to specify global rules for
handling attachments to an email message. You can also set rules by COS and
for individual accounts. When attachment settings are configured in Global
Settings, the global rule takes precedence over COS and Account settings.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; Attachments</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administration_console_email_attachment_rules.png" alt="Attachment Rules"></span><br>
See
<a href="#_blocking_email_attachments_by_file_type">Blocking Email Attachments by File type</a>
for information about this section of the screen.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. Global Settings Advanced</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attachments cannot be viewed regardless of COS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users cannot view any attachments. This global setting can be set to
prevent a virus outbreak from attachments, as no mail attachments can be
opened.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attachments are viewed in HTML regardless of COS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email attachments can only be viewed in HTML.  The COS may have another
setting but this global setting overrides the COS setting.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attachments are viewed according to COS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This global setting states the COS sets the rules for how email attachments
are viewed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send blocked extension notification to recipient</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_blocking_email_attachments_by_file_type">Blocking Email Attachments by File Type</h4>
<div class="paragraph">
<p>You can also reject messages with certain types of files attached. You
select which file types are unauthorized from the <strong>Common extensions</strong>
list. You can also add other extension types to the list. Messages with
those type of files attached are rejected. By default the recipient and the
sender are notified that the message was blocked.</p>
</div>
<div class="paragraph">
<p>If you do not want to send a notification to the recipient when messages
are blocked, you can disable this option.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; Attachments</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mta_configuration">MTA Configuration</h3>
<div class="paragraph">
<p>Use options from the MTA page to enable or disable authentication and
configure a relay hostname, the maximum message size, enable DNS lookup,
protocol checks, and DNS checks.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administation_console_mta_configuration.png" alt="MTA Configuration"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 23. MTA Page Options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>Authentication</strong> should be enabled, to support mobile SMTP authentication
users so that their email client can talk to the Zimbra MTA.</p>
</li>
<li>
<p><strong>TLS authentication only</strong> forces all SMTP auth to use Transaction Level
Security to avoid passing passwords in the clear.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>Web mail MTA Host name and Web mail MTA Port</strong>. The MTA that the web
server connects to for sending mail. The default port number is 25.</p>
</li>
<li>
<p>The <strong>Relay MTA for external delivery</strong> is the relay host name. This is the
Zimbra MTA to which Postfix relays non- local email.</p>
</li>
<li>
<p>If your MX records point to a spam-relay or any other external non-Zimbra
server, enter the name of that server in the <strong>Inbound SMTP host name</strong>
field. This check compares the domain MX setting against the
zimbraInboundSmtpHostname setting, if set. If this attribute is not set,
the domain MX setting is checked against zimbraSmtpHostname.</p>
</li>
<li>
<p>MTA Trusted Networks. Configure trusted networks that are allowed to
relay mail. Specify a list of network addresses, separated by commas and/or
a space.</p>
</li>
<li>
<p>If <strong>Enable DNS lookups</strong> is checked, the Zimbra MTA makes an explicit DNS
query for the MX record of the recipient domain. If this option is
disabled, set a relay host in the Relay MTA for external delivery.</p>
</li>
<li>
<p>If <strong>Allow domain administrators to check MX records
from Administration Console</strong> is checked, domain
administrators can check the MX records for their domain.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Milter Server</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>If <strong>Enable Milter Server</strong> is checked, the milter enforces the rules that
are set up for who can send email to a distribution list.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Archiving</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>If you installed the Archiving feature, you can configure it here.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Messages</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Set the <strong>Maximum messages size</strong> for a message and its attachments that can be sent.</p>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
To set the maximum size of an uploaded file to Briefcase, go to the General
Information page.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>You can enable the <strong>X-Originating-IP header to messages</strong> checkbox. The
X-Originating-IP header information specifies the original sending IP of
the email message the server is forwarding.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy Service</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>Customize <strong>zimbraMtaRestriction</strong> (restrictions to reject Checks some
suspect SMTP clients).</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Protocol checks</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>To reject unsolicited commercial email (UCE), for spam control.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS checks</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>To reject mail if the client&#8217;s IP address is unknown, the hostname in the
greeting is unknown, or if the sender&#8217;s domain is unknown.</p>
</li>
<li>
<p>Add other email recipient restrictions to the <strong>List of RBLs</strong> field.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
RBL (Real time black-hole lists) can be turned on or off from the Zimbra
CLI.
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_global_imap_and_pop_configuration">Global IMAP and POP Configuration</h4>
<div class="paragraph">
<p>Use the IMAP and POP pages to enable global access.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; IMAP</strong><br>
<strong>Home &#8594; Configure &#8594; Global Settings &#8594; POP</strong></p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you make changes to the IMAP or POP settings, you must restart
Zimbra Collaboration before the changes take effect.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>IMAP and POP3 polling intervals can be set from the Administration Console
COS Advanced page.<br>
Default = No polling interval.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If IMAP/POP proxy is set up, ensure that the port numbers are configured
correctly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>With POP3, users can retrieve their mail stored on the Zimbra server and
download new mail to their computer. The user&#8217;s POP configuration in their
<strong>Preference &#8594; Mail</strong> page determines how their messages are downloaded and
saved.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_domains">Working With Domains</h3>
<div class="paragraph">
<p>One domain is identified during the installation process. You can add
domains after installation. From the Administration Console you can manage
the following domain features.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Global Address List</p>
</li>
<li>
<p>Authentication</p>
</li>
<li>
<p>Virtual hosts for the domain to establish a default domain for a user
login</p>
</li>
<li>
<p>Public service host name that is used for REST URLs, commonly used in
sharing.</p>
</li>
<li>
<p>Maximum number of accounts that can be created on the domain</p>
</li>
<li>
<p>Free/Busy Interop settings for use with Microsoft Exchange.</p>
</li>
<li>
<p>Domain SSL certificates</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A domain can be renamed and all account, distribution list, alias and
resource addresses are changed to the new domain name. The CLI utility is
used to changing the domain name.
See <a href="#_renaming_a_domain">Renaming a Domain</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Domain settings override global settings.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_domain_general_information_configuration">Domain General Information Configuration</h4>
<div class="paragraph">
<p>Use the <strong>New Domain</strong> Wizard to set options described in this section.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 2 Set up Domain &#8594; 1. Create Domain&#8230;&#8203;</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administration_console_create_domain.png" alt="Create Domain"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. New Domain&#8201;&#8212;&#8201;General Information</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain name *<br>
Public service host name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enter the host name of the REST URL. This is commonly used for sharing. See
<a href="#_setting_up_a_public_service_host_name">Setting up a Public Service Host</a></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public service protocol</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select HTTP or HTTPS from the drop-down field.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public service port</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inbound SMTP host name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If your MX records point to a spam-relay or any other external non-Zimbra
server, enter the name of the server here.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default Class of Service</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This COS (for the domain) is automatically assigned to accounts created on
the domain if another COS is not set.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The domain status is active in the normal state. Users can log in and mail
is delivered. Changing the status can affect the status for accounts on the
domain also. The domain status is displayed on the <strong>Domain &#8594; General</strong>
page. Domain status can be set as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Active</dt>
<dd>
<p>Active is the normal status for domains. Accounts can be created
and mail can be delivered.</p>
<div class="openblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If an account has a different status setting than the domain setting, the
account status overrides the domain status.
</td>
</tr>
</table>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">Closed</dt>
<dd>
<p>When a domain status is marked as <strong>Closed</strong>, login for accounts on
the domain is disabled and messages are bounced. The closed status
overrides an individual account&#8217;s status setting.</p>
</dd>
<dt class="hdlist1">Locked</dt>
<dd>
<p>When a domain status is marked as <strong>Locked</strong>, users cannot log in to
check their email, but email is still delivered to the accounts.  If an
account&#8217;s status setting is marked as maintenance or closed, the account&#8217;s
status overrides the domain status setting.</p>
</dd>
<dt class="hdlist1">Maintenance</dt>
<dd>
<p>When the domain status is marked for maintenance, users
cannot log in and their email is queued at the MTA. If an account&#8217;s status
setting is marked as closed, the account&#8217;s status overrides the domain
status setting.</p>
</dd>
<dt class="hdlist1">Suspended</dt>
<dd>
<p>When the domain status is marked as <strong>Suspended</strong>, users cannot
log in, their email is queued at the MTA, and accounts and distribution
lists cannot be created, deleted, or modified. If an account&#8217;s status
setting is marked as closed, the account&#8217;s status overrides the domain
status setting.</p>
</dd>
</dl>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_setting_up_a_public_service_host_name">Setting up a Public Service Host Name</h5>
<div class="paragraph">
<p>You can configure each domain with the public service host name to be used
for REST URLs. This is the URL that is used when sharing email folders and
Briefcase folders, as well as sharing task lists, address books, and
calendars.</p>
</div>
<div class="paragraph">
<p>When users share a Zimbra Collaboration folder, the default is to create
the URL with the Zimbra server hostname and the Zimbra service host
name. This is displayed as <code>https://server.domain.com/service/home/username/sharedfolder</code>. The
attributes are generated as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hostname is server.zimbraServiceHostname</p>
</li>
<li>
<p>Protocol is determined from server.zimbraMailMode</p>
</li>
<li>
<p>Port is computed from the protocol</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you configure a public service host name, this name is used instead of
the server/service name, as <code>https://publicservicename.domain.com/home/username/sharedfolder</code>. The
attributes to be used are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraPublicServiceHostname</code></p>
</li>
<li>
<p><code>zimbraPublicServiceProtocol</code></p>
</li>
<li>
<p><code>zimbraPublicServicePort</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use another FQDN as long as the name has a proper DNS entry to
point at 'server' both internally and externally.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_global_address_list_gal_mode_configuration">Global Address List (GAL) Mode Configuration</h4>
<div class="paragraph">
<p>The Global Address List (GAL) is your company-wide listing of users that is
available to all users of the email system. GAL is a commonly used feature
in mail systems that enables users to look up another user&#8217;s information by
first or last name, without having to know the complete email address.</p>
</div>
<div class="paragraph">
<p>GAL is configured on a per-domain basis. The GAL mode setting for each
domain determines where the GAL lookup is performed.</p>
</div>
<div class="paragraph">
<p>Use the <strong>GAL Mode Settings</strong> tool with your domain configuration to define
the Global Address List.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 2 Set up Domain &#8594; 1 Create Domain&#8230;&#8203; &#8594; GAL Mode Settings</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/administration_console_gal.png" alt="GAL Mode Settings"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. New Domain&#8201;&#8212;&#8201;GAL Mode Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAL Mode</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>Internal</strong>. The Zimbra LDAP server is used for directory lookups.</p>
</li>
<li>
<p><strong>External</strong>. External directory servers are used for GAL lookups. You can
configure multiple external LDAP hosts for GAL. All other directory
services use the Zimbra LDAP service (configuration, mail routing, etc.).
When you configure an external GAL, you can configure different search
settings and sync settings. You might want to configure different search
settings if your LDAP environment is set up to optimize LDAP searching by
setting up an LDAP cache server, but users also will need to be able to
sync to the GAL.</p>
</li>
<li>
<p><strong>Both</strong>. Internal and external directory
servers are used
for GAL lookups.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most results returned by GAL search</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Maximum number of search results that can be returned in one GAL search.
If this value is undefined here, the system will use the value defined in
Global Settings.<br>
Default = 100 results.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAL sync account name*</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Read-only field that displays the galsync name and associated domain.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Datasource name for internal GAL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Read-only field that displays the name of the internal GAL.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Internal GAL polling interval</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Define how often&#8201;&#8212;&#8201;as days, hours, minutes, or seconds&#8201;&#8212;&#8201;the GAL sync
account is to sync with the LDAP server.  With the first sync to the LDAP
server, all GAL contacts from the LDAP are added to the galsync account&#8217;s
address book. On subsequent syncs, the account is updated with information
about new contacts, modified contacts, and deleted contacts.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_using_gal_sync_accounts_for_faster_access_to_gal">Using GAL sync accounts for faster access to GAL</h4>
<div class="paragraph">
<p>A GAL sync account is created for the domain when an internal or external
GAL is created, and if you have more than one mailbox server, you can
create a GAL sync account for each mailbox server in the domain.  Using the
GAL sync account gives users faster access to auto complete names from the
GAL.</p>
</div>
<div class="paragraph">
<p>When a GAL sync account is created on a server, GAL requests are directed
to the server&#8217;s GAL sync account instead of the domain&#8217;s GAL sync
account. The GalSyncResponse includes a token which encodes the GAL sync
account ID and current change number. The client stores this and then uses
it in the next GalSyncRequest. Users perform GAL sync with the GAL sync
account they initially sync with. If a GALsync account is not available for
some reason, the traditional LDAP-based search is run.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The GAL sync accounts are system accounts and do not use a Zimbra license.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When you configure the GAL sync account, you define the GAL datasource and
the contact data is synced from the datasource to the GAL sync accounts'
address books. If the mode <strong>Both</strong> is selected, an address book is created
in the account for each LDAP data source.</p>
</div>
<div class="paragraph">
<p>The GAL polling interval for the GAL sync determines how often the GALsync
account syncs with the LDAP server. The sync intervals can be in x days,
hours, minutes, or seconds. The polling interval is set for each data
source.</p>
</div>
<div class="paragraph">
<p>When the GAL sync account syncs to the LDAP directory, all GAL contacts
from the LDAP are added to the address book for that GAL. During the sync,
the address book is updated with new contact, modified contact and deleted
contact information. You should not modify the address book directly. When
the LDAP syncs the GAL to the address book, changes you made directly to
the address book are deleted.</p>
</div>
<div class="paragraph">
<p>You create GALsync accounts from the Administration Console. The CLI
associated with this feature is <strong>zmgsautil.</strong></p>
</div>
<div class="sect4">
<h5 id="_creating_additional_galsync_accounts">Creating Additional GALsync Accounts</h5>
<div class="paragraph">
<p>When ZCS is configured with more than one server, you can add an additional
GAL sync account for each server.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Domains</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the domain to add another GAL sync account.</p>
</li>
<li>
<p>In the <strong>Gear</strong> icon, select <strong>Configure GAL</strong>.</p>
</li>
<li>
<p>Click <strong>Add a GAL account</strong>.</p>
</li>
<li>
<p>In the GAL sync account name field, enter the name for this account.  Do
not use the default name.</p>
</li>
<li>
<p>Select the mailbox server that this account will apply to.</p>
</li>
<li>
<p>Enter the <strong>GAL datasource name</strong>. If the GAL mode is BOTH, enter the data
source name for both the internal GAL and the external GAL.</p>
</li>
<li>
<p>Set the <strong>GAL polling interval</strong> to how often the GAL sync account should
sync with the LDAP server to update.</p>
</li>
<li>
<p>Click <strong>Finish</strong>.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_changing_gal_sync_account_name">Changing GAL sync account name</h5>
<div class="paragraph">
<p>The default name for the GAL sync account is <strong>galsync</strong>. When you configure
the GAL mode, you can specify another name. After the GAL sync account is
created, you cannot rename the account because syncing the data fails.</p>
</div>
<div class="paragraph">
<p>To change the account name, delete the existing GAL sync account and
configure a new GAL for the domain.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Domains</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the domain where you want to change the GAL sync account name.</p>
</li>
<li>
<p>In the <strong>Gear</strong> icon, select <strong>Configure GAL</strong> to open the configuration wizard
and change the GAL mode to internal. Do not configure any other
fields. Click <strong>Finish</strong>.</p>
</li>
<li>
<p>In the domain&#8217;s account Content pane, delete the domain&#8217;s galsync
account.</p>
</li>
<li>
<p>Select the domain again and select Configure GAL to reconfigure the
GAL. In the GAL sync account name field, enter the name for the account.
Complete the GAL configuration and click <strong>Finish</strong>. The new account is
displayed in the Accounts Content pane.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_authentication_modes">Authentication Modes</h4>
<div class="paragraph">
<p>Authentication is the process of identifying a user or a server to the
directory server and granting access to legitimate users based on user name
and password information provided when users log in.</p>
</div>
<div class="paragraph">
<p>Set the authentication method on a per-domain basis.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 2 Set up Domain &#8594; 1 Create Domain&#8230;&#8203; &#8594; Authentication Mode</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. New Domain&#8201;&#8212;&#8201;Authentication Mode</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication mechanism</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>Internal</strong>. The Internal authentication uses the Zimbra directory server
for authentication on the domain.  When you select Internal, no other
configuration is required.</p>
</li>
<li>
<p><strong>External LDAP</strong>. The user name and password is the authentication
information supplied in the bind operation to the directory server. You
must configure the LDAP URL, LDAP filter, and to use DN password to bind to
the external server.</p>
</li>
<li>
<p><strong>External Active Directory</strong>. The user name and password is the
authentication information supplied to the Active Directory server. You
identify the Active Directory domain name and URL.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_virtual_hosts">Virtual Hosts</h4>
<div class="paragraph">
<p>Virtual hosting allows you to host more than one domain name on a
server. The general domain configuration does not change.</p>
</div>
<div class="paragraph">
<p>When you create a virtual host, this becomes the default domain for user login; users can log in without having to specify the domain name as part of their user name.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 2 Set up Domain &#8594; 1 Create Domain&#8230;&#8203; &#8594; Virtual Hosts</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. New Domain&#8201;&#8212;&#8201;Virtual Hosts</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Option</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add virtual host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alphanumeric string to identify the virtual host(s) for this domain. The
virtual host requires a valid DNS configuration with an A record.  To
delete a virtual host from the domain, click <strong>Remove</strong> alongside the host name
displayed in this wizard screen.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To open the Zimbra Web Client log in page, users enter the virtual host
name as the URL address. For example, <code>https://mail.company.com</code>.</p>
</div>
<div class="paragraph">
<p>When the Zimbra login screen displays, users enter only their user name
and password. The authentication request searches for a domain with that
virtual host name. When the virtual host is found, the authentication is
completed against that domain.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_account_limits">Setting Account Limits</h4>
<div class="paragraph">
<p>You can limit the number of accounts that can be provisioned on a
domain. The maximum number of accounts that can be provisioned for the
domain can be set when the domain is created. You can also edit the domain
configuration to add or change the number.</p>
</div>
<div class="paragraph">
<p>In the Administration Console this is set for a domain in the Account
Limits page. If this page is not configured, no limits on the domain are
set.</p>
</div>
<div class="paragraph">
<p>Resources, spam, and ham accounts are not counted against this limit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot exceed the account limit set by the Zimbra Collaboration
license.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When multiple Classes of Service (COS) are available, you can select which
classes of service can be configured and how many accounts on the domain
can be assigned to the COS. This is configured in the domain&#8217;s Account
Limits page. The number of COS account types used is tracked.  The limits
for all COSs cannot exceed the number set for the maximum accounts for the
domain.</p>
</div>
<div class="paragraph">
<p>The number of COS assigned to accounts is tracked. You can see the number
assigned/number remaining from any account&#8217;s General Information page.</p>
</div>
</div>
<div class="sect3">
<h4 id="_renaming_a_domain">Renaming a Domain</h4>
<div class="paragraph">
<p>When you rename a domain you are actually creating a new domain, moving all
accounts to the new domain and deleting the old domain. All account, alias,
distribution list, and resource addresses are changed to the new domain
name. The LDAP is updated to reflect the changes.</p>
</div>
<div class="paragraph">
<p>Before you rename a domain</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Make sure MX records in DNS are created for the new domain name</p>
</li>
<li>
<p>Make sure you have a functioning and current full backup of the domain</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the domain has been renamed</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Update external references that you have set up for the old domain name
to the new domain name. This may include automatically generated emails
that were sent to the administrator&#8217;s mailbox such as backup session
notifications. Immediately run a full backup of the new domain:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov -l rd [olddomain.com] [newdomain.com]</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_domain_rename_process">Domain Rename Process</h5>
<div class="paragraph">
<p>When you run this <code>zmprov</code> command, the domain renaming process goes
through the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The status of the old domain is changed to an internal status of
shutdown, and mail status of the domain is changed to suspended. Users
cannot login, their email is bounced by the MTA, and accounts, calendar
resources and distribution lists cannot be created, deleted or modified.</p>
</li>
<li>
<p>The new domain is created with the status of shutdown and the mail status
suspended.</p>
</li>
<li>
<p>Accounts, calendar resources, distribution lists, aliases, and resources
are all copied to the new domain.</p>
</li>
<li>
<p>The LDAP is updated to reflect the new domain address.</p>
</li>
<li>
<p>The old domain is deleted.</p>
</li>
<li>
<p>The status for the new domain is changed to active. The new domain can
start accepting email messages.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_adding_a_domain_alias">Adding a Domain Alias</h4>
<div class="paragraph">
<p>A domain alias allows different domain names to direct to a single domain
address. For example, your domain is <code>domain.com</code>, but you want users to have
an address of <code>example.com</code>, you can create <code>example.com</code> as the alias for the
<code>domain.com</code> address. Sending mail to <code>user@example.com</code> is the same as sending
mail to <code>user@domain.com</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A domain alias is a domain name just like your primary domain name. You
must own the domain name and verify your ownership before you can add it as
an alias.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Domains</strong>, from the <strong>Gear</strong> icon select, <strong>Add a Domain Alias</strong>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_support_for_domain_disclaimers">Enabling Support for Domain Disclaimers</h4>
<div class="paragraph">
<p>Disclaimers are set per-domain. When upgrading, an existing global
disclaimer is converted to domain specific disclaimers on every domain to
preserve behavior with previous releases.</p>
</div>
<div class="paragraph">
<p>Per domain disclaimer support can be enabled using the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new domain (e.g. <code>example.com</code>) and account (e.g.
<code>user2@example.com</code>).</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmprov cd example.com cb9a4846-6df1-4c18-8044-4c1d4c21ccc5
$ zmprov ca user2@example.com test123 95d4caf4-c474-4397-83da-aa21de792b6a
$ zmprov -l gaa user1@example.com user2@example.com</code></pre>
</div>
</div>
</li>
<li>
<p>Enable the use of disclaimers</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmprov mcf zimbraDomainMandatoryMailSignatureEnabled TRUE
$ zmprov gcf zimbraDomainMandatoryMailSignatureEnabled
zimbraDomainMandatoryMailSignatureEnabled: TRUE</code></pre>
</div>
</div>
</li>
<li>
<p>Add disclaimers to the new domain</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmprov md example.com
zimbraAmavisDomainDisclaimerText &quot;text disclamer&quot;
zimbraAmavisDomainDisclaimerHTML &quot;HTML disclaimer&quot;

$ zmprov gd example.com zimbraAmavisDomainDisclaimerText zimbraAmavisDomainDisclaimerHTML
# name example.com
zimbraAmavisDomainDisclaimerHTML: HTML disclaimer
zimbraAmavisDomainDisclaimerText: text disclamer

$ zmprov gd eng.example.com
# name eng.example.com
zimbraAmavisDomainDisclaimerText
zimbraAmavisDomainDisclaimerHTML</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>On the first MTA:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmaltermimeconfig -e example.com

Enabled disclaimers for domain: example.comm
Generating disclaimers for domain example.com.</code></pre>
</div>
</div>
</li>
<li>
<p>On all additional MTAs:</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmaltermimeconfig</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To test, send an email from the account (e.g. <code>user2@example.com</code>) in
html and plain text format</p>
</li>
<li>
<p>To verify, check emails received with correct HTML disclaimer and
plain text disclaimer.</p>
</li>
<li>
<p>To disable for the domain example.com</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On the first MTA, as the Zimbra user:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmaltermimeconfig -d example.com</code></pre>
</div>
</div>
</li>
<li>
<p>On all additional MTAs:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmaltermimeconfig</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_disclaimers_for_intra_domain_emails">Disabling Disclaimers for Intra-domain Emails</h4>
<div class="paragraph">
<p>You can enable the option for emails between individuals in the same domain
to not have a disclaimer attached.</p>
</div>
<div class="paragraph">
<p>Set the attribute <code>attachedzimbraAmavisOutboundDisclaimersOnly</code> to <code>TRUE</code>.</p>
</div>
<div class="paragraph">
<p>To preserve backward-compatibility, this attribute defaults to <code>FALSE</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_the_disclaimer_feature">Disabling the Disclaimer Feature</h4>
<div class="paragraph">
<p>It is possible to completely remove support for disclaimers by setting the
related attribute to <code>FALSE</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraDomainMandatoryMailSignatureEnabled FALSE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zimlets_on_the_domain">Zimlets on the Domain</h4>
<div class="paragraph">
<p>All Zimlets that are deployed are displayed in the domain&#8217;s <strong>Zimlets</strong>
page. If you do not want all the deployed Zimlets made available for users
on the domain, select from the list the Zimlets that are available for the
domain. This overrides the Zimlet settings in the COS or for an account.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_server_settings">Managing Server Settings</h3>
<div class="paragraph">
<p>A server is a machine that has one or more of the Zimbra service packages
installed. During the installation, the Zimbra server is automatically
registered on the LDAP server.</p>
</div>
<div class="paragraph">
<p>In the Administration Console, you can view the current status of all the
servers that are configured with Zimbra software, and you can edit or
delete existing server records. You cannot add servers directly to
LDAP. The Zimbra Collaboration installation program must be used to add new
servers because the installer packages are designed to register the new
host at the time of installation.</p>
</div>
<div class="paragraph">
<p>The server settings that can be viewed from the Administration Console,
Configure Servers link for a specific server include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>General information about the service host name, and LMTP advertised name
and bind address, and the number of threads that can simultaneously
process data source imports.</p>
</li>
<li>
<p>A list of enabled services. You can disable and enable the services.</p>
</li>
<li>
<p>Authentication types enabled for the server, setting a Web mail MTA
host-name different from global. Setting relay MTA for external delivery,
and enabling DNS lookup if required. Enable the Milter Server and set the
bind address.</p>
</li>
<li>
<p>Enabling POP and IMAP and setting the port numbers for a server. If
IMAP/POP proxy is set up, making sure that the port numbers are configured
correctly.</p>
</li>
<li>
<p>Index and message volumes configuration. Setting HSM policies.</p>
</li>
<li>
<p>IP Address Bindings. If the server has multiple IP addresses, IP Address
binding allows you to specify which interface to bind to.</p>
</li>
<li>
<p>Proxy settings if proxy is configured.</p>
</li>
<li>
<p>Backup and Restore configuration for the server. When backup and restore
is configured for the server, this overrides the global backup and restore
setting.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Servers inherit global settings if those values are not set in the server
configuration. Settings that can be inherited from the Global configuration
include MTA, SMTP, IMAP, POP, anti-virus, and anti-spam configurations.</p>
</div>
<div class="sect3">
<h4 id="_general_server_settings">General Server Settings</h4>
<div class="paragraph">
<p>The General Information page includes the following configuration
information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Server display name and a description field</p>
</li>
<li>
<p>Server hostname</p>
</li>
<li>
<p>LMTP information including advertised name, bind address, and number of
threads that can simultaneously process data source imports.<br>
Default = 20 threads.</p>
</li>
<li>
<p><strong>Purge setting</strong>: The server manages the message purge schedule. You
configure the duration of time that the server should "rest" between
purg-ing mailboxes from the Administration Console, Global settings or
Server settings, or General Information page.<br>
Default = message purge is scheduled to run each minute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When installing a reverse proxy the communication between the proxy server
and the backend mailbox server must be in plain text. Checking <strong>This server
is a reverse proxy lookup target</strong> automatically sets the following
parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zimbraImapCleartextLoginEnabled TRUE
zimbraReverseProxyLookupTarget TRUE
zimbraPop3CleartextLoginEnabled TRUE</pre>
</div>
</div>
<div class="paragraph">
<p>The Notes text box can be used to record details you want to save.</p>
</div>
</div>
<div class="sect3">
<h4 id="_change_mta_server_settings">Change MTA Server Settings</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Servers &#8594; <em>server</em> &#8594; MTA</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <strong>MTA</strong> page show the following settings:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authentication enabled.</p>
<div class="paragraph">
<p>Enables SMTP client authentication, so users can authenticate. Only
authenticated users or users from trusted networks are allowed to relay
mail. TLS authentication when enabled, forces all SMTP auth to use
Transport Layer Security (successor to SSL) to avoid passing passwords in
the clear.</p>
</div>
</li>
<li>
<p>Network settings, including Web mail MTA hostname, Web mail MTA time-out,
the relay MTA for external delivery, MTA trusted networks ID, and the
ability to enable DNS lookup for the server.</p>
</li>
<li>
<p>Milter Server.</p>
<div class="paragraph">
<p>If <strong>Enable Milter Server</strong> is checked, the milter enforces the rules that
are set up for who can send email to a distribution list on the server.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_ip_address_binding">Setting Up IP Address Binding</h4>
<div class="paragraph">
<p>If the server has multiple IP addresses, you can use IP address binding
to specify which specific IP addresses you want a particular server to
bind to.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Servers &#8594; <em>server</em> &#8594; IP Address Bindings</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 28. IP Address Bindings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Client Server IP Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface address on which the HTTP server listens</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Client Server SSL IP Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface address on which the HTTPS server listens</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Client Server SSL Client Cert IP Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interface address on which HTTPS server accepting the client certificates
listen</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administration Console Server IP Address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administrator console Interface address on which HTTPS server listens</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_managing_ssl_certificates_for_zcs">Managing SSL Certificates for ZCS</h4>
<div class="paragraph">
<p>A certificate is the digital identity used for secure communication between
different hosts or clients and servers. Certificates are used to certify
that a site is owned by you.</p>
</div>
<div class="paragraph">
<p>Two types of certificates can be used - self-signed and commercial
certificates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A <strong>self-signed certificate</strong> is an identity certificate that is signed by
its own creator.</p>
<div class="paragraph">
<p>You can use the Certificate Installation Wizard to generate a new
self-signed certificate. This is useful when you use a self-signed
certificate and want to change the expiration date. Self-signed
certificates are normally used for testing.<br>
Default = 1825 days (5 years)</p>
</div>
</li>
<li>
<p>A <strong>commercial certificate</strong> is issued by a certificate authority (CA) that
attests that the public key contained in the certificate belongs to the
organization (servers) noted in the certificate.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When Zimbra Collaboration is installed, the self-signed certificate is automatically installed and can be used for testing Zimbra Collaboration.
You should install the commercial certificate when Zimbra Collaboration is used in your production environment.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
ZCO users in a self-signed environment will encounter warnings about
connection security unless the root CA certificate is added to the client&#8217;s
Window Certificate Store. See the
<a href="https://wiki.zimbra.com/wiki/Main_Page">Zimbra Wiki</a> article
<a href="https://wiki.zimbra.com/wiki/ZCO_Connection_Security">ZCO Connection
Security</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_installing_certificates">Installing Certificates</h4>
<div class="paragraph">
<p>To generate the Certificate Signing Request (CSR) you complete a form
with details about the domain, company, and country, and then generate
a CSR with the RSA private key.  You save this file to your computer
and submit it to your commercial certificate authorizer.</p>
</div>
<div class="paragraph">
<p>To obtain a commercially signed certificate, use the Zimbra Certificates
Wizard in the Administration Console to generate the RSA Private Key and
CSR.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 1 Get Started &#8594; 2. Install Certificates</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Use guidelines from the Install Certificates table to set parameters for
your certificates.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. Install Certificates</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Name (CN)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exact domain name that should be used to access your Web site securely.
Are you going to use a wildcard common name?  If you want to manage
multiple sub domains on a single domain on the server with a single
certificate, check this box. An asterisk (*) is added to the Common Name
field.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Country Name (C)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Country name you want the certificate to display as our company location</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">State/Province (ST)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">State/province you want the certificate to display as your company
location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">City (L)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">City you want the certificate to display as your company location.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization Name (O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your company name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Organization Unit (OU)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unit name (if applicable)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject Alternative Name (SAN)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you are going to use a SAN, the input must be a valid domain name. When
SAN is used, the domain name is compared with the common name and then to
the SAN to find a match. You can create multiple SANs.  When the alternate
name is entered here, the client ignores the common name and tries to match
the server name to one of the SAN names.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Download the CSR from the Zimbra server and submit it to a Certificate
Authority, such as VeriSign or GoDaddy. They issue a digitally signed
certificate.</p>
</div>
<div class="paragraph">
<p>When you receive the certificate, use the Certificates Wizard a second time to install the certificate on Zimbra Collaboration. When the certificate is installed, you must restart the server to apply the certificate.</p>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_installed_certificates">Viewing Installed Certificates</h4>
<div class="paragraph">
<p>You can view the details of certificates currently deployed. Details
include the certificate subject, issuer, validation days and subject
alternative name.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Certificates &#8594; <em>zmhostname</em></strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Certificates display for different Zimbra services such as LDAP, mailboxd, MTA and proxy.</p>
</div>
</div>
<div class="sect3">
<h4 id="_maintaining_valid_certificates">Maintaining Valid Certificates</h4>
<div class="paragraph">
<p>It is important to keep your SSL certificates valid to ensure clients and
environments work properly, as the ZCS system can become non-functional if
certificates are allowed to expire. You can view deployed SSL certificates
from the ZCS administrator console, including their validation days. It is
suggested that certificates are checked periodically, so you know when they
expire and to maintain their validity.</p>
</div>
</div>
<div class="sect3">
<h4 id="_install_a_ssl_certificate_for_a_domain">Install a SSL Certificate for a Domain</h4>
<div class="paragraph">
<p>You can install an SSL certificate for each domain on a Zimbra Collaboration
server. Zimbra Proxy must be installed on Zimbra Collaboration and correctly
configured to support multiple domains. For each domain, a virtual host
name and Virtual IP address are configured with the virtual domain name and
IP address.</p>
</div>
<div class="paragraph">
<p>Each domain must be issued a signed commercial certificate that attests
that the public key contained in the certificate belongs to that domain.</p>
</div>
<div class="paragraph">
<p>Configure the Zimbra Proxy Virtual Host Name and IP Address.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; +zimbraVirtualHostName {domain.example.com} +zimbraVirtualIPAddress {1.2.3.4}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The virtual domain name requires a valid DNS configuration with an A
record.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Edit the certificate for the domain:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 1 Get Started &#8594; 2. Install Certificates</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Copy the domain&#8217;s issued signed commercial certificates and private key files to the <strong>Domain Certificate</strong> section for the selected domain.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/certificate_domain_load.jpg" alt="Certificate Domain Load"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the root certificate and the intermediate certificates in descending
order, starting with your domain certificate. This allows the full
certificate chain to be validated.</p>
</li>
<li>
<p>Remove any password (passphrase) from the private key before the
certificate is saved.</p>
<div class="paragraph">
<p>See your commercial certificate provider for details about how to remove
the password.</p>
</div>
</li>
<li>
<p>Click <strong>Upload</strong>.</p>
<div class="paragraph">
<p>The domain certificate is deployed to <code>/opt/zimbra/conf/domaincerts</code></p>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_dkim_to_authenticate_email_message">Using DKIM to Authenticate Email Message</h3>
<div class="paragraph">
<p>Domain Keys Identified Mail (DKIM) defines a domain-level authentication
mechanism that lets your organization take responsibility for transmitting
an email message in a way that can be verified by a recipient. Your
organization can be the originating sending site or an intermediary. Your
organization&#8217;s reputation is the basis for evaluating whether to trust the
message delivery.</p>
</div>
<div class="paragraph">
<p>You can add a DKIM digital signature to outgoing email messages,
associating the message with a domain name of your organization. You can
enable DKIM signing for any number of domains that are being hosted by
ZCS. It is not required for all domains to have DKIM signing enabled for
the feature to work.</p>
</div>
<div class="paragraph">
<p>DKIM defines an authentication mechanism for email using</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A domain name identifier</p>
</li>
<li>
<p>Public-key cryptography</p>
</li>
<li>
<p>DNS-based public key publishing service.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DKIM signature is added to the email message header field. The header
information is similar to the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>DKIM-Signature a=rsa-sha1; q=dns;
     d=example.com;
     i=user@eng.example.com;
     s=jun2021.eng; c=relaxed/simple;
     t=1117574938; x=1118006938;
     h=from:to:subject:date;
     b=dzdVyOfAKCdLXdJOc9G2q8LoXSlEniSbav+yuU4zGeeruD00lszZVoG4ZHRNiYzR</pre>
</div>
</div>
<div class="paragraph">
<p>Receivers who successfully validate a DKIM signature can use information
about the signer as part of a program to limit spam, spoofing, phishing, or
other undesirable behavior.</p>
</div>
<div class="sect3">
<h4 id="_configure_zimbra_collaboration_for_dkim_signing">Configure Zimbra Collaboration for DKIM Signing</h4>
<div class="paragraph">
<p>DKIM signing to outgoing mail is done at the domain level.</p>
</div>
<div class="paragraph">
<p>To set up DKIM you must run the CLI zmdkimkeyutil to generate the DKIM keys
and selector. You then update the DNS server with the selector which is the
public key.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the ZCS server and as zimbra:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmdkimkeyutil -a -d &lt;example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The public DNS record data that must be added for the domain to your DNS
server is displayed. The public key DNS record appears as a DNS TXT-record
that must be added for the domain to your DNS server.</p>
</div>
<div class="paragraph">
<p>Optional. To specify the number of bits for the new key, include <code><strong>-b</strong></code> in
the command line, <code>-b &lt;####&gt;</code>. If you do not add the <code>-b</code>, the default
setting is 2048 bits.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>DKIM Data added to LDAP for domain example.com with selector B534F5FC-EAF5-11E1-A25D-54A9B1B23156

Public signature to enter into DNS:
B534F5FC-EAF5-11E1-A25D-54A9B1B23156._domainkey IN TXT
"v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC+ycHjGL/mJXEVlRZnxZL/VqaN/Jk9VllvIOTkKgwLSFtVsKC69kVaUDDjb3zkpJ6qpswjjOCO+0eGJZFA4aB4BQjFBHbl97vgNnpJq1sV3QzRfHrN8X/gdhvfKSIwSDFFl3DHewKDWNcCzBkNf5wHt5ujeavz2XogL8HfeL0bTwIDAQA B" ; ----- DKIM B534F5FC-EAF5-11E1-A25D-54A9B1B23156 for example.com</pre>
</div>
</div>
<div class="paragraph">
<p>The generated DKIM data is stored in the LDAP server as part of the
domain LDAP entry.</p>
</div>
</li>
<li>
<p>Work with your service provider to update your DNS for the domain with
the DKIM DNS text record.</p>
</li>
<li>
<p>Reload the DNS and verify that the DNS server is returning the DNS
record.</p>
</li>
<li>
<p>Verify that the public key matches the private key. See the <a href="#dkim_identifiers">Identifiers</a> table for <code>-d</code>, <code>-s</code>, and <code>-x</code> descriptions.</p>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/common/sbin/opendkim-testkey -d &lt;example.com&gt; -s &lt;0E9F184A-9577-11E1-AD0E-2A2FBBAC6BCB&gt; -x /opt/zimbra/conf/opendkim.conf</code></pre>
</div>
</div>
<table id="dkim_identifiers" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. Identifiers</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Selector name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration file name.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_update_dkim_data_for_a_domain">Update DKIM Data for a Domain</h4>
<div class="paragraph">
<p>When the DKIM keys are updated, the DNS server must be reloaded with the
new TXT record.</p>
</div>
<div class="paragraph">
<p>Good practice is to leave the previous TXT record in DNS for a period of
time so that email messages that were signed with the previous key can
still be verified.</p>
</div>
<div class="paragraph">
<p>Log in to the ZCS server and as zimbra:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmdkimkeyutil -u -d &lt;example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Optional. To specify the number of bits for the new key, include <strong>-b</strong> in
the command line, <code>-b &lt;####&gt;</code>. If you do not add the <code>-b</code>, the default
setting is 2048 bits.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Work with your service provider to update your DNS for the domain with
the DKIM DNS text record.</p>
</li>
<li>
<p>Reload the DNS and verify that the DNS server is returning the DNS
record.</p>
</li>
<li>
<p>Verify that the public key matches the private key: See the Identifiers
table for <code>-d</code>, <code>-s</code>, and <code>-x</code> descriptions.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/common/sbin/opendkim-testkey -d &lt;example.com&gt; -s &lt;0E9F184A-9577-11E1-AD0E-2A2FBBAC6BCB&gt; -x /opt/zimbra/conf/opendkim.conf</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_remove_dkim_signing_from_zcs">Remove DKIM Signing from ZCS</h4>
<div class="paragraph">
<p>Removing DKIM signing deletes the DKIM data from LDAP, and new email messages are no longer signed for the domain. When you remove DKIM from the domain, it is a good practice to leave the previous TXT record in DNS for some time so that email messages that were signed with the previous key can still be verified.</p>
</div>
<div class="paragraph">
<p>Use the following command syntax to remove the file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmdkimkeyutil -r -d example.com</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_retrieve_dkim_data_for_a_domain">Retrieve DKIM Data for a Domain</h4>
<div class="paragraph">
<p>Use the following command syntax to view the stored DKIM information for
the domain, selector, private key, public signature and identity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmdkimkeyutil -q -d example.com</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_anti_spam_settings">Anti-spam Settings</h3>
<div class="paragraph">
<p>ZCS uses SpamAssassin to control spam. SpamAssassin uses predefined rules
as well as a Bayes database to score messages. Zimbra evaluates spam as a percentage value. Messages tagged between 33%-75% spam are delivered to the user&#8217;s junk folder. Messages tagged above 75% are not sent to the user and are discarded.</p>
</div>
<div class="paragraph">
<p>You can change the anti-spam settings.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console</dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; AS/AV</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/as_av.jpg" alt="Anti-Spam Settings"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>At the Anti-Spam fields, enter parameters, as appropriate for your
requirements.</p>
</li>
<li>
<p>From the <strong>Gear</strong> icon, select <strong>Save</strong> to use your settings.</p>
<div class="openblock">
<div class="content">
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 31. Anti-Spam</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kill percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Percent that scored mail to be considered as spam, and therefore not to be
delivered.<br>
Default = 75%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tag percent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Percent that scores mail to be considered as spam, which should be
delivered to the Junk folder.<br>
Default = 33%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text string to be added to the subject line for messages tagged as spam.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When a message is tagged as spam, the message is delivered to the
recipient&#8217;s junk folder. Users can view the number of unread messages that
are in their junk folder and can open the junk folder to review the
messages marked as spam. If you have the anti-spam training filters
enabled, when users add or remove messages in the junk folder, their action
helps train the spam filter.</p>
</div>
<div class="paragraph">
<p>RBL (Real time black-hole lists) can be turned on or off in SpamAssassin
from the Zimbra CLI.</p>
</div>
<div class="sect3">
<h4 id="_anti_spam_training_filters">Anti-Spam Training Filters</h4>
<div class="paragraph">
<p>The automated spam training filter is enabled by default and two
feedback system mailboxes are created to receive mail notification.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Spam Training User</strong> for mail that was not marked as spam but should be.</p>
</li>
<li>
<p><strong>Non-spam (referred to as ham) training user</strong> for mail that was marked
as spam but should not have been.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The mailbox quota and attachment indexing is disabled for these training
accounts. Disabling quotas prevents bouncing messages when the mailbox is
full.</p>
</div>
<div class="paragraph">
<p>How well the anti-spam filter works depends on recognizing what is
considered spam. The SpamAssassin filter learns from messages that users
specifically mark as spam by sending them to their junk folder or not spam
by removing them from their junk folder. A copy of these marked messages is
sent to the appropriate spam training mailbox.</p>
</div>
<div class="paragraph">
<p>When ZCS is installed, the spam/ham cleanup filter is configured on only
the first MTA. The ZCS spam training tool, <strong>zmtrainsa</strong>, is configured to
automatically retrieve these messages and train the spam filter. The
<strong>zmtrainsa script</strong> is enabled through a crontab job to feed mail to the
SpamAssassin application, allowing SpamAssassin to 'learn' what signs are
likely to mean spam or ham. The zmtrainsa script empties these mailboxes
each day.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>New installs of ZCS limit spam/ham training to the first MTA installed. If
you uninstall or move this MTA, you will need to enable spam/ham training
on another MTA, as one host should have this enabled to run <code>zmtrainsa
--cleanup</code>.</p>
</div>
<div class="paragraph">
<p>To set this on a new MTA server</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zmtrainsa_cleanup_host=TRUE</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_the_spam_training_mailboxes">Disabling the Spam Training Mailboxes</h4>
<div class="paragraph">
<p>The ZCS default is that all users can give feedback when they add or remove
items from their junk folder.</p>
</div>
<div class="paragraph">
<p>If you do not want users to train the spam filter you can disable this
function.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the global configuration attributes, <code>ZimbraSpamIsSpamAccount</code> and
<code>ZimbraSpamIsNotSpamAccount</code></p>
</li>
<li>
<p>Remove the account addresses from the attributes.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf ZimbraSpamIsSpamAccount ''
zmprov mcf ZimbraSpamIsNotSpamAccount ''</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>When these attributes are modified, messages marked as spam or not spam are
not copied to the spam training mailboxes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manually_training_spam_filters">Manually Training Spam Filters</h4>
<div class="paragraph">
<p>Initially, you might want to train the spam filter manually to quickly
build a database of spam and non-spam tokens, words, or short character
sequences that are commonly found in spam or ham. To do this, you can
manually forward messages as message/rfc822 attachments to the spam and
non-spam mailboxes.</p>
</div>
<div class="paragraph">
<p>When <code>zmtrainsa</code> runs, these messages are used to teach the spam filter.
Make sure you add a large enough sampling of messages to get accurate
scores. To determine whether to mark messages as spam at least 200 known
spams and 200 known hams must be identified.</p>
</div>
</div>
<div class="sect3">
<h4 id="_protect_alias_domains_from_backscatter_spam">Protect Alias Domains from Backscatter Spam</h4>
<div class="paragraph">
<p>To reduce the risk of backscatter spam, you can run a service that runs a
Zimbra Access Policy Daemon that validates <strong>RCPT To:</strong> content specifically
for alias domains.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For information about creating domain aliases, see the
<a href="https://wiki.zimbra.com">Zimbra wiki</a> article
<a href="https://wiki.zimbra.com/wiki/Managing_Domains">Managing Domains</a>.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the Postfix LC key.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e postfix_enable_smtpd_policyd=yes</code></pre>
</div>
</div>
</li>
<li>
<p>Define the MTA restriction.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf +zimbraMtaRestriction &quot;check_policy_service unix:private/policy&quot;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>postfix_policy_time_limit</code> key is set because by default the Postfix
spawn(8) daemon kills its child process after 1000 seconds. This is too
short for a policy daemon that might run as long as an SMTP client is
connected to an SMTP process.</p>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_postfix_policy_daemon">Disabling Postfix Policy Daemon</h4>
<div class="paragraph">
<p>Disable the SMTPD policy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e postfix_enable_smtpd_policyd=no</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Define the policy restriction.Setting Email Recipient
RestrictionsRealtimeBlackhole Lists and Realtime Right-Hand Side
Blocking/Black Lists can be turned on or off in the MTA.</p>
</div>
<div class="paragraph">
<p>For protocol checks, the following three RBLs can be enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tname</p>
</li>
<li>
<p>Client must greet with a fully qualified hostname -
<code>reject_non_fqdn_hostname</code></p>
</li>
<li>
<p>Sender address must be fully qualified - reject_non_fqdn_sender</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hostname in greeting violates RFC - <code>reject_invalid_host</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf -zimbraMtaRestriction &quot;check_policy_service unix:private/policy&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following RBLs can also be set.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>reject_rbl_client cbl.abuseat.org</code></p>
</li>
<li>
<p><code>reject_rbl_client bl.spamcop.net</code></p>
</li>
<li>
<p><code>reject_rbl_client dnsbl.sorbs.net</code></p>
</li>
<li>
<p><code>reject_rbl_client sbl.spamhaus.org</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As part of recipient restrictions, you can also use the
<code>reject_rbl_client &lt;rbl hostname&gt;</code> option.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA &#8594; DNS Checks</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Use the DNS tools in MTA configuration to define the restriction lists.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/dns_checks.jpg" alt="DNS Checks"></span></p>
</div>
<div class="paragraph">
<p>For a list of current RBL&#8217;s, see the
<a href="https://en.wikipedia.org/wiki/Comparison_of_DNS_blacklists">Comparison of DNS
blacklists</a> article.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_rbls_with_the_cli">Adding RBLs with the CLI</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>View the current RBLs.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gacf zimbraMtaRestriction</code></pre>
</div>
</div>
</li>
<li>
<p>Add new RBLs: list the existing RBLs and the new Add, in the same command
entry. For 2-word RBL names, surround the name with quotes in your entry.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraMtaRestriction [RBL type]</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="title">Example 6. adding all possible restrictions</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf \
 zimbraMtaRestriction reject_invalid_hostname \
 zimbraMtaRestriction reject_non-fqdn_hostname \
 zimbraMtaRestriction reject_non_fqdn_sender \
 zimbraMtaRestriction &quot;reject_rbl_client cbl.abuseat.org&quot; \
 zimbraMtaRestriction &quot;reject_rbl_client bl.spamcop.net&quot; \
 zimbraMtaRestriction &quot;reject_rbl_client dnsbl.sorbs.net&quot; \
 zimbraMtaRestriction &quot;reject_rbl_client sbl.spamhaus.org&quot;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_global_rule_for_messages_marked_as_both_spam_and_whitelist">Setting Global Rule for Messages Marked as Both Spam and Whitelist</h4>
<div class="paragraph">
<p>When you use a third-party application to filter messages for spam before
messages are received by ZCS, the ZCS global rule is to send all messages
that are marked by the third-party as spam to the junk folder. This
includes messages that are identified as spam and also identified as
whitelisted.</p>
</div>
<div class="paragraph">
<p>If you do not want messages that are identified as whitelisted to be sent
to the junk folder, you can configure <code>zimbraSpamWhitelistHeader</code> and
<code>zimbraSpamWhitelistHeaderValue</code> to pass these messages to the user&#8217;s
mailbox. This global rule is not related to the Zimbra MTA spam filtering
rules. Messages are still passed through a user&#8217;s filter rules.</p>
</div>
<div class="paragraph">
<p>To search the message for a whitelist header:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraSpamWhitelistHeader &lt;X-Whitelist-Flag&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>To set the value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraSpamWhitelistHeaderValue &lt;value_of_third-party_white-lists_messages&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_anti_virus_settings">Anti-virus Settings</h3>
<div class="paragraph">
<p>Anti-virus protection is enabled for each server when the Zimbra software
is installed. The anti-virus software is configured to send messages that
have been identified as having a virus to the virus quarantine mailbox. An
email notification is sent to recipients letting them know that a message
has been quarantined. The quarantine mailbox message lifetime is set to 7
days.</p>
</div>
<div class="paragraph">
<p>From the Admin Console, you can specify ho aggressively spam is to be
filtered in your Zimbra Collaboration.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; AS/AV</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/as_av.jpg" alt="AS/AV"></span></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>At the Anti-Virus fields, enter parameters, as appropriate for your
requirements.</p>
</li>
<li>
<p>From the <strong>Gear</strong> icon, select <strong>Save</strong> to use your settings.</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. Anti Virus</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Definition update frequency</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">By default, the Zimbra MTA checks every two hours for any new anti-virus
updates from ClamAV. The frequency can be set between 1 and 24 hours.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Block encrypted archives</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restrict encrypted files, such as password protected zipped files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send notification to recipient</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To alert that a mail message had a virus and was not delivered.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>During Zimbra Collaboration installation, the administrator notification
address for anti- virus alerts is configured. The default is to set up
the admin account to receive the notification. When a virus has been
found, a notification is automatically sent to that address.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Updates are obtained via HTTP from the ClamAV website.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_freebusy_calendar_scheduling">Zimbra Free/Busy Calendar Scheduling</h3>
<div class="paragraph">
<p>The Free/Busy feature allows users to view each other&#8217;s calendars for
efficiently scheduling meetings. You can set up free/busy scheduling across
ZCS and Microsoft Exchange servers.</p>
</div>
<div class="paragraph">
<p>ZCS can query the free/busy schedules of users on supported Microsoft Exchange servers and also can propagate the free/busy schedules of ZCS users to the Exchange servers.</p>
</div>
<div class="paragraph">
<p>To set free/busy interoperability, the Exchange systems must be set up as
described in the Exchange Setup Requirements section, and the
Zimbra Collaboration Global Config, Domain, COS and Account settings must be
configured. The easiest way to configure Zimbra Collaboration is from the
Administration Console.</p>
</div>
<div class="sect3">
<h4 id="_exchange_setup_requirements">Exchange Setup Requirements</h4>
<div class="paragraph">
<p>The following is required to set up the free/busy feature:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Either a single Active Directory (AD) must be in the system or the global
catalog must be available.</p>
</li>
<li>
<p>The Zimbra Collaboration server must be able to access the HTTP(S) port
of IIS on at least one of the Exchange servers.</p>
</li>
<li>
<p>Web interface to Exchange public folders needs to be available via
IIS. (<code>http://server/public/</code>)</p>
</li>
<li>
<p>Zimbra Collaboration users must be provisioned as a contact on the AD
using the same administrative group for each mail domain. This is required
only for ZCS to Exchange free/busy replication.</p>
</li>
<li>
<p>For Zimbra Collaboration to Exchange free/busy replication, the Exchange
user email address must be provisioned in the account attribute
<strong>zimbra-ForeignPrincipal</strong> for all Zimbra Collaboration users.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_freebusy_on_zimbra_collaboration">Configuring Free/Busy on Zimbra Collaboration</h4>
<div class="paragraph">
<p>To set Free/Busy Interoperability up from the Administration Console, the
global config, Domain, COS and Account settings must be configured as
described here.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the Exchange server settings, either globally or per-domain.</p>
<div class="ulist">
<ul>
<li>
<p>Microsoft Exchange Server URL. This is the Web interface to the
Exchange.</p>
</li>
<li>
<p>Microsoft Exchange Authentication Scheme, either <strong>Basic</strong> or <strong>Form</strong>.</p>
<div class="ulist">
<ul>
<li>
<p>Basic is authentication to Exchange via HTTP basic authentication.</p>
</li>
<li>
<p>Form is authentication to Exchange as HTML form based authentication.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Microsoft Exchange Server Type, either <strong>WebDav</strong> or <strong>ews</strong></p>
<div class="ulist">
<ul>
<li>
<p>Select WebDAV to support free/busy with Exchange 2003 or Exchange 2007.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is for information only, as these versions of Exchange are no longer supported.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Select ews (Exchange Web Service) to support free/busy with Exchange
2010 SP1 and newer.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Include the Microsoft Exchange user name and password. This is the name
of the account in Active Directory and password that has access to the
public folders. These are used to authenticate against the Exchange server
on REST and WebDAV interfaces.</p>
</li>
<li>
<p>Add the <strong>o</strong> and <strong>ou</strong> values that are configured in the <strong>legacyExchangeDN</strong>
attribute for Exchange on the Global Config Free/Busy Interop page, the
Domain Free/Busy Interop page or on the Class of Service (COS) Advanced
page. Set at the global level this applies to all accounts talking to
Exchange.</p>
</li>
<li>
<p>In the Account&#8217;s Free/Busy Interop page, configure the foreign principal
email address for the account. This sets up a mapping from the
Zimbra Collaboration account to the corresponding object in the AD.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To find these settings on the Exchange server, you can run the Exchange
ADSI Edit tool and search the <strong>legacyExchangeDN</strong> attribute for the <code>o=</code> ,
<code>ou=</code> , and <code>cn=</code> settings.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_collaboration_to_zimbra_collaboration_freebusy_interoperability">Zimbra Collaboration to Zimbra Collaboration Free/Busy Interoperability</h4>
<div class="paragraph">
<p>You can set up free/busy interoperability between ZCS servers.  Free/Busy
interoperability is configured on each server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Each server must be running ZCS 8.0.x or later.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the server host names and ports.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraFreebusyExternalZimbraURL http[s]://[user:pass@]host:port</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <strong>user:pass</strong> is not included, the server runs an anonymous free/busy
lookup.</p>
</div>
</li>
<li>
<p>Restart the server.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</li>
<li>
<p>Repeat these steps at all other servers.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_setting_up_smime">Setting Up S/MIME</h3>
<div class="paragraph">
<p>S/MIME is a standard to send secure email messages. S/MIME messages use
digital signature to authenticate and encrypt messages.</p>
</div>
<div class="paragraph">
<p>Currently, there are two different methods for providing the S/MIME feature</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The old client based solution which requires Java 1.6 SE deployed on the client machine</p>
</li>
<li>
<p>The new server based solution which does not require Java on the client machine. The server performs all the cryptographic operations. (Recommended)</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_setting_up_for_using_the_smime_feature_using_the_client_based_solution">Setting up for using the S/MIME feature using the client based solution</h4>
<div class="sect4">
<h5 id="_prerequisites">Prerequisites</h5>
<div class="ulist">
<ul>
<li>
<p>To use S/MIME, users must have a PKI certificate and a private key.  The
private key must be installed in the user&#8217;s local certificate store on
Windows and Apple Mac and in the browser certificate store if they use the
Firefox browser. See the appropriate computer or browser documentation for
how to install certificates.</p>
</li>
<li>
<p>Users can use any of the following browsers:</p>
<div class="ulist">
<ul>
<li>
<p>Mozilla Firefox 4 or later</p>
</li>
<li>
<p>Internet Explorer 8, 9</p>
</li>
<li>
<p>Chrome 12 or later</p>
</li>
</ul>
</div>
</li>
<li>
<p>Users computers must have Java 1.6 SE deployed to use S/MIME. If they do
not, they see an error asking them to install it.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_smime_license">S/MIME License</h5>
<div class="paragraph">
<p>You must have a ZCS license that is enabled for S/MIME.</p>
</div>
</div>
<div class="sect4">
<h5 id="_enable_smime_feature">Enable S/MIME Feature</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Features</strong><br>
<strong>Home &#8594; Manage &#8594; Accounts &#8594; <em>account</em> &#8594; Features</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The S/MIME feature can be enabled from either the COS or Account
FeaturesTab.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the COS or account to edit.</p>
</li>
<li>
<p>In the Features tab S/MIME features section, check <strong>Enable S/MIME</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_importing_smime_certificates">Importing S/MIME Certificates</h5>
<div class="paragraph">
<p>Users can send encrypted messages to recipients if they have the
recipients' public-key certificate stored in one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Recipient&#8217;s contact page in their Address Book.</p>
</li>
<li>
<p>Local OS or browser keystore.</p>
</li>
<li>
<p>External LDAP directory.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The certificates should be published into the LDAP directory so that they
can be retrieved from the GAL. The format of the S/MIME certificates must
be X.509 Base64 encoded DER.</p>
</div>
<div class="sect5">
<h6 id="_configure_external_ldap_lookup_for_certificates">Configure External LDAP Lookup for Certificates</h6>
<div class="paragraph">
<p>If you use an external LDAP to store certificates, you can configure the
Zimbra server to lookup and retrieve certificates from the external LDAP,
on behalf of the client.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; S/MIME</strong><br>
<strong>Home &#8594; Configure &#8594; Domains &#8594; <em>domain</em> &#8594; S/MIME</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can configure the external LDAP server settings from either the <strong>Global
Settings &#8594; S/MIME</strong> tab or the <strong>Domains &#8594; S/MIME</strong> tab.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Global Settings override Domain settings
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit the global settings page or select a domain to edit. Open the
<strong>S/MIME</strong> tab.</p>
</li>
<li>
<p>In the <strong>Configuration Name</strong> field, enter a name to identify the external
LDAP server. Example, <code>companyLDAP_1</code></p>
</li>
<li>
<p>In the <strong>LDAP URL</strong> field, enter the LDAP server&#8217;s URL. Example,
<code>ldap://host.domain:3268</code></p>
</li>
<li>
<p>To use DN to bind to the external server, in the <strong>S/MIME LDAP Bind DN</strong>
field, enter the bind DN. Example, <code>administrator@domain</code></p>
<div class="paragraph">
<p>If you want to use anonymous bind, leave the Bind ND and Bind password
fields empty.</p>
</div>
</li>
<li>
<p>In the <strong>S/MIME Ldap Search Base</strong> field, enter the specific branch of the
LDAP server that should be searched to find the certificates.</p>
<div class="paragraph">
<p>Example, <code>ou=Common Users, DC=host, DC=domain</code></p>
</div>
<div class="paragraph">
<p>Or, check <strong>Automatically discover search base</strong> to automatically discover
the search base DNs. For this to work, the S/MIME Search Base field must be
empty.</p>
</div>
</li>
<li>
<p>In the <strong>S/MIME Ldap filter</strong> field, enter the filter template for the
search. The filter template can contain the following conversion variables
for expansion:</p>
<div class="ulist">
<ul>
<li>
<p><code>%n</code> - search key with <code>@</code> (or without, if no <code>@</code> was specified)</p>
</li>
<li>
<p><code>%u</code> - with <code>@</code> removed (For example, <code>mail=%n</code>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>S/MIME Ldap Attribute</strong> field, enter attributes in the external
LDAP server that contain users' S/MIME certificates. Multiple attributes
can be separated by a comma (<code>,</code>).</p>
<div class="paragraph">
<p>Example, "userSMIMECertificate, UserCertificate"</p>
</div>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To set up another external LDAP server, click <strong>Add Configuration</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_for_using_the_smime_feature_using_the_server_based_solution">Setting up for using the S/MIME feature using the server based solution</h4>
<div class="sect4">
<h5 id="_prerequisites_2">Prerequisites</h5>
<div class="paragraph">
<p>Same as for the client based S/MIME solution except that Java is not required on the client machine. The private key is also not required to be on the client machine&#8217;s local/browser certificate store.</p>
</div>
</div>
<div class="sect4">
<h5 id="_smime_license_2">S/MIME License</h5>
<div class="paragraph">
<p>Same as for the client based S/MIME solution</p>
</div>
</div>
<div class="sect4">
<h5 id="_enable_smime_feature_2">Enable S/MIME Feature</h5>
<div class="paragraph">
<p>Same as for the client based S/MIME solution</p>
</div>
</div>
<div class="sect4">
<h5 id="_importing_smime_certificates_2">Importing S/MIME Certificates</h5>
<div class="paragraph">
<p>Same as for the client based S/MIME solution except that the recipients' public-key certificate no longer needs to be stored in the Local OS or browser keystore.
The certificate can be published to all other places mentioned in previous S/MIME version.</p>
</div>
</div>
<div class="sect4">
<h5 id="_list_of_ldap_attributes_introduced_to_support_the_server_based_smime_solution">List of LDAP attributes introduced to support the server based S/MIME solution</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>zimbraSmimeOCSPEnabled</code></p>
<div class="ulist">
<ul>
<li>
<p>Used by server at the time of validating the user as well as public certificates</p>
</li>
<li>
<p>If <code>TRUE</code>, the revocation check will be performed during certificate validation</p>
</li>
<li>
<p>If <code>FALSE</code>, the revocation check will not be performed during certificate validation</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>zimbraSmimePublicCertificateExtensions</code></p>
<div class="ulist">
<ul>
<li>
<p>The supported public certificate file extensions separated by commas</p>
</li>
<li>
<p>Contains the list of supported formats for the <code>userCertificate</code> LDAP attribute</p>
</li>
<li>
<p>Default values: <code>cer</code>, <code>crt</code>, <code>der</code>, <code>spc</code>, <code>p7b</code>, <code>p7r</code>, <code>sst</code>, <code>sto</code>, <code>pem</code></p>
</li>
<li>
<p>Zimbra Web Client retrieves the supported file formats or extensions for uploading public certificate from the server</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>zimbraSmimeUserCertificateExtensions</code></p>
<div class="ulist">
<ul>
<li>
<p>The supported public certificate file extensions separated by commas</p>
</li>
<li>
<p>Contains the list of supported formats for the userSmimeCertificate LDAP attribute</p>
</li>
<li>
<p>Default values: <code>p12</code>, <code>pfx</code></p>
</li>
<li>
<p>Zimbra Web Client retrieves the supported file formats or extensions for uploading public certificate from the server</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_process_for_adding_the_ca_certificate_to_the_mailbox_truststore_for_smime">Process for Adding the CA certificate to the mailbox truststore for S/MIME</h5>
<div class="paragraph">
<p>S/MIME uses the mailbox trust store path and its password which are defined in localconfig.xml</p>
</div>
<div class="paragraph">
<p>The key names are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mailboxd_truststore</p>
</li>
<li>
<p>mailboxd_truststore_password</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If the mailboxd_truststore key is not defined in localconfig.xml, by default the value of mailboxd_truststore is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&lt;zimbra_java_home&gt;/jre/lib/security/cacerts</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A CA certificate can be imported to the mailbox trust store by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">keytool -import -alias -keystore &lt;mailboxd_truststore path&gt; -trustcacerts -file &lt;CA_Cert&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_storage_management">Storage Management</h3>
<div class="sect3">
<h4 id="_managing_storage_volumes">Managing Storage Volumes</h4>
<div class="paragraph">
<p>In the Volume page you manage storage volumes on the Zimbra Mailbox
server. When Zimbra Collaboration is installed, one index volume and one
message volume are configured on each mailbox server. You can add new
volumes, set the volume type, and set the compression threshold.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If Compress Blobs is enabled (YES), the disk space used is decreased, but
memory requirements for the server increases.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_index_volumes">Index Volumes</h5>
<div class="paragraph">
<p>Each Zimbra mailbox server is configured with one current index volume.
Each mailbox is assigned to a permanent directory on the current index
volume. You cannot change the volume to which an account is assigned.</p>
</div>
<div class="paragraph">
<p>As volumes become full, you can create a new current index volume for new
accounts. You can add new volumes, set the volume type, and set the
compression threshold.</p>
</div>
<div class="paragraph">
<p>Index volumes not marked current are still actively in use for the accounts
assigned to them. Any index volume that is referenced by a mailbox as its
index volume cannot be deleted.</p>
</div>
</div>
<div class="sect4">
<h5 id="_message_volumes">Message Volumes</h5>
<div class="paragraph">
<p>When a new message is delivered or created, the message is saved in the
current message volume. Message volumes can be created, but only one is
configured as the current volume where new messages are stored. When the
volume is full, you can configure a new current message volume. The current
message volume receives all new messages. New messages are never stored in
the previous volume.</p>
</div>
<div class="paragraph">
<p>A current volume cannot be deleted, and message volumes that have messages
referencing the volume cannot be deleted.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_hierarchical_storage_management">Implementing Hierarchical Storage Management (*)</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Starting with Zimbra 8.8</strong>, there are two versions of this feature, Standard and New Generation (NG) versions.
Zimbra 8.7 and earlier included only the Standard version, which is explained below.
To use and enable the NG version of this feature with Zimbra 8.8 and later, refer to the specific NG chapter later in this Guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Hierarchical Storage Management (HSM) allows you to configure storage
volumes for older messages. HSM is a process of moving older data from the
primary volume to the current secondary volume based on the age of the
data.</p>
</div>
<div class="paragraph">
<p>To manage your disk utilization, implement a global HSM policy or a HSM
policy for each mailbox server. The policy configured on individual servers
overrides the policy configured as the global policy.</p>
</div>
<div class="paragraph">
<p>Email messages and the other items in the account are moved from the
primary volume to the current secondary volume based on the HSM policy.
Users are not aware of any change and do not see any noticeable differences
when opening older items that have been moved.</p>
</div>
<div class="paragraph">
<p>The default global HSM policy moves messages and document files more than
30 days old to the secondary volume. You can also select to move tasks,
appointments, and contacts. The schedule for moving can be set for items
older than a specified number of days, months, weeks, hours, minutes.</p>
</div>
<div class="paragraph">
<p>In addition to selecting different items to move, you can use the search
query language to set up other HSM policies.</p>
</div>
<div class="paragraph">
<p>For example: to include all messages marked as spam in messages moved to
the current secondary volume, you would add the following to the policy:
<strong>message:in:junk before:-[x] days</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The search string can be added to the default policy or you can write a new
policy.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_scheduling_hsm_sessions">Scheduling HSM Sessions</h5>
<div class="paragraph">
<p>Sessions to move messages to the secondary volume are scheduled in your
cron table. From the Administration Console, when you select a server, you
can manually start a HSM session, monitor HSM sessions, and abort HSM
sessions that are in progress from the Volumes page.</p>
</div>
<div class="paragraph">
<p>You can manually start an HSM session from the server&#8217;s <strong>Gear</strong> icon.</p>
</div>
<div class="paragraph">
<p>When you abort a session and then restart the process, the HSM session
looks for entries in the primary store that meet the HSM age criteria.  Any
entries that were moved in the previous run would be excluded, as they
would no longer exist in the primary store.</p>
</div>
<div class="paragraph">
<p>HSM jobs can be configured to be a specific batch size. The
<code>zimbraHsmBatchSize</code> attribute can be configured either as a global setting
or per server to specify the maximum number of items to move during a
single HSM operation. The default value is 10000. If the limit is exceeded
the HSM operation is repeated until all qualifying items are moved.</p>
</div>
<div class="paragraph">
<p>Global batch size modification:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraHsmBatchSize &lt;num&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modifying batch size on a server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms `zmhostname` zimbraHsmBatchSize &lt;num&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_email_retention_management">Email Retention Management</h3>
<div class="paragraph">
<p>You can configure retention policies for user account&#8217;s email, trash, and
junk folders. The basic email retention policy is to set the email, trash
and spam message lifetime in the COS or for individual accounts.</p>
</div>
<div class="paragraph">
<p>You can set up specific retention policies that users can enable for the
Inbox and other email folders in their account. Users can also create their
own retention policies.</p>
</div>
<div class="paragraph">
<p>You can enable the dumpster feature to save messages that are deleted from Trash. When a message reaches the end of its retention lifetime, based on email lifetime rules or deletion policies, the message is moved to the dumpster if enabled. Users can recover deleted items from the dumpster until the
threshold set in the <strong>Visibility lifetime in dumpster for end user</strong> setting.</p>
</div>
<div class="paragraph">
<p>If dumpster is not enabled, messages are purged from the server when the email retention lifetime is reached.</p>
</div>
<div class="paragraph">
<p>You can also set up a legal hold on an account to prevent messages from being deleted.</p>
</div>
<div class="sect3">
<h4 id="_configuring_email_lifetime_rules">Configuring Email Lifetime Rules</h4>
<div class="paragraph">
<p>You can configure when email messages should be deleted from an accounts
folders, and the trash and junk folders by COS or for individual accounts.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 33. Email Lifetime Options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Email Lifetime Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Email message lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of days a message can remain in a folder before it is purged. This
includes data in RSS folders.<br>
Default = 0<br>
Minimum = 30 days</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trashed message lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of days a message remains in the Trash folder before it is purged.<br>
Default = 30 days.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spam message lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of days a message can remain in the Junk folder before it is purged.<br>
Default = 30 days.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_purging_email_messages">Purging Email Messages</h4>
<div class="paragraph">
<p>By default, the server purges email messages that have exceeded their
lifetime every minute. You can change the duration of time that the server
should "rest" between purging mailboxes.</p>
</div>
<div class="paragraph">
<p>Use the global Sleep Time setting to define duration, in minutes, between
mailbox purges.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; General Information</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/GeneralInformation.jpg" alt="Purge Interval"></span></p>
</div>
<div class="paragraph">
<p>For example, if the purge interval is set to 1 minute, the server purges <code>mailbox1</code>, waits for 1 minute, and then begins to purge mailbox2.</p>
</div>
<div class="paragraph">
<p>If the message purge schedule is set to 0, messages are not purged even if
the mail, trash and spam message lifetime is set.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Because users cannot view message lifetime settings, you will
need to apprise them of your purge policies.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_message_retention_and_deletion_policies">Configuring Message Retention and Deletion Policies</h4>
<div class="paragraph">
<p>Retention and deletion policies can be configured as a global setting or
as a COS setting. Users can select these policies to apply to their
message folders in their account. They can also set up their own
retention and deletion policies. Users enable a policy you set up or
create their own policies from their folders' Edit Properties dialog
box.</p>
</div>
</div>
<div class="sect3">
<h4 id="_global_retention_policy">Global Retention Policy</h4>
<div class="paragraph">
<p>System wide retention and deletion policies can be managed from the
Administration Console.</p>
</div>
<div class="paragraph">
<p>Use the global Retention Policy page to set global retention or deletion
policies.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; Retention Policy</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/GlobalRetentionPolicy.jpg" alt="Global Retention Policy"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_cos_retention_policy">COS Retention Policy</h4>
<div class="paragraph">
<p>Use the COS Retention Policy page to set retention or deletion for the
selected COS.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Retention Policy</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/COSRetentionPolicy.jpg" alt="COS Retention Policy"></span></p>
</div>
<div class="paragraph">
<p>Ensure that the <strong>Enable COS-level policies instead of inheriting from the
policy defined in Global Settings</strong> is enabled.</p>
</div>
<div class="paragraph">
<p>The retention policy is not automatically enforced on a folder. If users
option an item in a folder that has not met the threshold of the retention
policy, the following message is displayed, <strong>You are deleting a message
that is within its folder&#8217;s retention period. Do you wish to delete the
message?</strong></p>
</div>
<div class="paragraph">
<p>When the threshold for the deletion policy is reached, items are deleted
from the account. They are not sent to the Trash folder. If the dumpster
feature is enabled, they are sent to the dumpster, if it is not enabled,
they are purged from the server.</p>
</div>
<div class="sect4">
<h5 id="_how_lifetime_and_retentiondeletion_policies_work_together">How Lifetime and Retention/Deletion Policies Work Together</h5>
<div class="paragraph">
<p>If the Email Message Lifetime is set to a value other than zero (0), this
setting applies in addition to the disposal or retention policy values
applied to a folder. For example:</p>
</div>
<div class="paragraph">
<p>Email Message Lifetime is set to 120 days</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Folder A has a policy with a disposal threshold of 360 days. Messages in
Folder a are disposed of in 120 days.</p>
</li>
<li>
<p>Folder B has a policy with disposal threshold of 90 days. Messages in
Folder B are disposed of in 90 days.</p>
</li>
<li>
<p>Folder C has a policy with retention range of 150 days. Messages in
Folder C are disposed of in 120 days.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_managing_the_dumpster">Managing the Dumpster</h4>
<div class="paragraph">
<p>When a message, trash or spam lifetime has been reached, the message is moved to the dumpster if the feature is enabled.
When users right-click on Trash, they can click <strong>Recover deleted items</strong> to retrieve items from their trash that have been deleted in the last x days.
This threshold is based on the <strong>Visibility lifetime in dumpster for end user</strong> setting.</p>
</div>
<div class="paragraph">
<p>The <strong>Retention lifetime in dumpster before purging setting</strong> sets retention
lifetime for items in dumpster. Items in dumpster older than the threshold
are purged and cannot be retrieved.</p>
</div>
<div class="paragraph">
<p>Administrators can access the individual dumpster&#8217;s content, including
spam, and they can delete data at any time before the message lifetime is
reached.</p>
</div>
<div class="sect4">
<h5 id="_searching_for_an_item_in_the_dumpster_folder">Searching for an item in the dumpster folder</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m &lt;user@example.com&gt; search --dumpster -l &lt;#&gt; --types &lt;message,contact,document&gt; &lt;search-field&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The search field can be a date range: 'before:mm/dd/yyyy and
after:mm/dd/yyyy' or emails from or to a particular person:
'from:Joe', etc.</p>
</div>
</div>
<div class="sect4">
<h5 id="_deleting_items_in_the_dumpster_folder">Deleting items in the dumpster folder</h5>
<div class="paragraph">
<p>Items in the dumpster folder can be deleted with the CLI or from the
Administration Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m &lt;user@example.com&gt; -A dumpsterDeleteItem &lt;item-ids&gt;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Features &#8594; General Features</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enable (check) the <strong>Dumpster folder</strong> checkbox.</p>
</li>
<li>
<p>To set <strong>Visibility lifetime in dumpster for end user</strong>, go to the <strong>Timeout Policy</strong> section on COS' <strong>Advanced</strong> page</p>
</li>
<li>
<p>To set <strong>Retention lifetime in dumpster before purging</strong>, go to the COS&#8217;s
<strong>Advanced</strong> page, <strong>Email Retention Policy</strong> section.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configure_legal_hold_on_an_account">Configure Legal Hold on an Account</h4>
<div class="paragraph">
<p>If the dumpster folder feature is enabled, you can set up a legal hold to
preserve all items in user accounts.</p>
</div>
<div class="paragraph">
<p>When dumpster is enabled, <strong>Can purge dumpster folder</strong> is also enabled.
Disabling this feature turns off purging of items in the user&#8217;s
dumpster. This can be set on a COS or for individual accounts. When <strong>Can
purge dumpster folder</strong> is enabled, any deletion policies set up on the
accounts' folders are ignored.</p>
</div>
<div class="paragraph">
<p>Configure legal hold:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Features</strong><br>
<strong>Home &#8594; Manage &#8594; Accounts &#8594; <em>account</em> &#8594; Features</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Deselect <strong>Can purge dumpster folder</strong> on the <strong>Features</strong> page.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_customized_admin_extensions">Customized Admin Extensions</h3>
<div class="paragraph">
<p>Developers can create and add custom modules to the Zimbra Administration
Console user interface, to provide new views, manage new data objects,
extend existing objects with new properties, and customize existing views.</p>
</div>
<div class="paragraph">
<p>For the most up-to-date and comprehensive information about how to create
an extended Administration Console UI module, go to the Zimbra wiki
Extending Admin UI article located at
<a href="https://wiki.zimbra.com/wiki/Extending_Admin_UI">Extending_Admin_UI</a>.</p>
</div>
<div class="paragraph">
<p>All Zimbra extensions currently incorporated at the Administration Console
UI are listed in the content pane as view only.</p>
</div>
<div class="paragraph">
<p>Only those created by you can be removed (see also Removing Admin Extension
Modules).</p>
</div>
<div class="sect3">
<h4 id="_deploying_new_administration_console_ui_modules">Deploying New Administration Console UI Modules</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Admin Extensions</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Save the module <code>zip</code> file to the computer you use to access the
Administration Console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>Gear</strong> icon, select <strong>Deploy</strong> to present the <strong>Deploying a Zimlet
or an extension</strong> dialog.</p>
</li>
<li>
<p>Browse to the custom module <code>zip</code> file you need to upload.</p>
</li>
<li>
<p>Click <strong>Deploy</strong>.</p>
<div class="paragraph">
<p>The file is uploaded and the extension is immediately deployed on the
server.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_removing_an_admin_extension_module">Removing An Admin Extension Module</h4>
<div class="paragraph">
<p>Deleting an Admin Extension results in removal of the selected extension
and all associated files. This action does not delete the originating <code>zip</code>
file.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Admin Extensions</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Use steps in this section to remove custom Admin Extensions.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the module to remove, and select <strong>Undeploy</strong> from the <strong>Gear</strong>
icon. A confirmation query is presented.</p>
</li>
<li>
<p>At the confirmation query, click <strong>Yes</strong> to proceed.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ephemeral_data">Ephemeral Data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are 3 main types of ephemeral data stored in LDAP during normal operation of Zimbra Collaboration.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Last Logon Time Stamps (<code>zimbraLastLogonTimestamp</code>)</p>
</li>
<li>
<p>Auth Tokens (<code>zimbraAuthTokens</code>)</p>
</li>
<li>
<p>CSRF Tokens (<code>zimbraCsrfTokenData</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>On small systems, storage of these types of ephemeral data may be done in the LDAP Server.
However, mail systems with large numbers of active users have been found to overload LDAP for short-lived data storage.
Therefore, the preferred option is to store this ephemeral data using an external server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This document does not cover how to install and maintain the ephemeral storage server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Configuring the storage location of ephemeral data is done through the following LDAP attribute:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">zimbraEphemeralBackendURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[backend name]:[params]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ephemeral Backend URL Configuration</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The two currently supported Ephemeral Data backends are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backend</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ldap://default</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSDB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssdb:127.0.0.1:8888</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSDB server and port</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Frequent authentication requests place a high load on Ephemeral Data storage backend. See the following Zimbra wiki pages for results of authentication-based load tests:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/Zimbra/zm-ssdb-ephemeral-store/wiki/Zimbra-and-LDAP-Authentication-Load-Tests">LDAP Authentication load tests</a></p>
</li>
<li>
<p><a href="https://github.com/Zimbra/zm-ssdb-ephemeral-store/wiki/Zimbra-and-SSDB-Authentication-Load-Tests">SSDB Authentication load tests</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_configuring_a_running_zimbra_collaboration_to_use_ssdb">Configuring a Running Zimbra Collaboration to Use SSDB</h3>
<div class="paragraph">
<p>Configuring an already running Zimbra Collaboration installation
to utilize <code>SSDB</code> instead of <code>LDAP</code> for short-lived data storage is done through the following process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <code>SSDB</code> and note the IP address and port configured since you will
need this data for the next steps. Refer to
<a href="#ssdb_configuration_options">Overview of Configuration Options</a> for more information.</p>
</li>
<li>
<p>Migrate any existing short-lived data to <code>SSDB</code> using the <code>/opt/zimbra/bin/zmmigrateattrs</code> command.</p>
</li>
<li>
<p>Configure Zimbra Collaboration to utilize <code>SSDB</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_migration_procedure">Migration Procedure</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access the command prompt on one of the machines in the installation.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Migrate existing ephemeral data to the <code>SSDB</code> backend using the <code>zmmigrateattrs</code> utility</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo su - zimbra
/opt/zimbra/bin/zmmigrateattrs ssdb:&lt;ip address|hostname&gt;:port # substituting your server values</pre>
</div>
</div>
<div class="paragraph">
<p>You may use either an IP address or a hostname for the host portion of the destination URL.
Either way, you will need to ensure it resolves to the proper IP address on all machines in the cluster.
If the provided SSDB address does not resolve to a functioning backend, the migration process will terminate.</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Configure Zimbra Collaboration to use <code>SSDB</code>:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>sudo su - zimbra
zmprov mcf zimbraEphemeralBackendURL ssdb:&lt;ip address|hostname&gt;:port # substituting your server values</pre>
</div>
</div>
<div class="paragraph">
<p>As with migration, the host and port must resolve to a functioning SSDB backend. Otherwise,
the value of <code>zimbraEphemeralBackendURL</code> will not be changed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_migration_details">Migration Details</h3>
<div class="sect3">
<h4 id="_migration_info">Migration Info</h4>
<div class="paragraph">
<p>Information about the latest migration process can be viewed by running the command <code>zmmigrateattrs --status</code>.
If the migration is currently in progress, this command may have to be run from a new terminal window.
This command will output three pieces of information:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The status of the migration: one of IN_PROGRESS, COMPLETED or FAILED</p>
</li>
<li>
<p>The URL of the SSDB backend acting as the destination</p>
</li>
<li>
<p>A timestamp of when the migration process was initiated</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The migration info can be reset with the command <code>zmmigrateattrs --clear</code>. This should only be done if
the status does not reflect the true state of the system.</p>
</div>
</div>
<div class="sect3">
<h4 id="_changing_the_ephemeral_backend_url">Changing the Ephemeral Backend URL</h4>
<div class="paragraph">
<p>When the value of <code>zimbraEphemeralBackendURL</code> is modified, Zimbra Collaboration checks the status of the last known migration.
This can result in one of several scenarios:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If the migration is completed and the URL of this migration matches the newly provided value, <code>zimbraEphemeralBackendURL</code>
is changed to the new value and the migration info is reset. This is the expected use case.</p>
</li>
<li>
<p>If a migration is currently in progress, <code>zimbraEphemeralBackendURL</code> will not be changed.</p>
</li>
<li>
<p>If no migration info is available, the migration has failed, or the new URL does not match the migration URL,
<code>zimbraEphemeralBackendURL</code> will be changed; however, a warning will be logged stating that data is not guaranteed to have
been migrated.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_forwarding_ephemeral_data">Forwarding Ephemeral Data</h4>
<div class="paragraph">
<p>During the migration process, and until the backend URL is changed, Zimbra Collaboration will store new ephemeral data
both in LDAP and <code>SSDB</code>; this keeps the two backends from getting out of sync. If the new value of <code>zimbraEphemeralBackendURL</code>
is changed to match the migration URL, migration info is reset and the forwarding mechanism is turned off.
If the values do not match, migration info is not reset, and forwarding remains in place.
Note that this means that migration only needs to be run once, even if there is a gap between the initial migration
and URL change. As long as the target backend is never taken offline, it will stay up-to-date. However, if <code>SSDB</code> is
taken offline between the end of the migration and the backend URL change, migration will need to be re-run.</p>
</div>
<div class="paragraph">
<p>These scenarios are demonstrated below:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ephemeral-data-migration.png" alt="ephemeral data migration"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_advanced_migration_options">Advanced Migration Options</h4>
<div class="paragraph">
<p>The <code>zmmigrateattrs</code> tool provides several migration options, to be used with careful consideration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>-r</code> or <code>--dry-run</code> option outputs the changes to be made for each account to the console, without actually performing the migration.</p>
</li>
<li>
<p>The <code>-n</code> or <code>--num-threads</code> option specifies how many threads will be used for migration. Omitting this will result in migration happening synchronously.</p>
</li>
<li>
<p>The <code>-a</code> or <code>--account</code> option allows for migration of a comma-separated list of specific accounts. This should be used only for testing or debugging.</p>
</li>
<li>
<p>The <code>-d</code> or <code>--debug</code> option enables debug logging.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If no attribute names are explicitly passed in as arguments, migration will occur for all known ephemeral attributes, as in the example above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_migration_limitations">Migration Limitations</h4>
<div class="paragraph">
<p>Ephemeral data migration is a one-way process. The <code>zmmigrateattrs</code> script does not support migrating data from <code>SSDB</code>
back into LDAP, nor does it support migrating data between different instances of <code>SSDB</code>. This means that if the value of
<code>zimbraEphemeralBackendURL</code> is reverted back to LDAP after migration, prior authentication data will become inaccessible,
and all user sessions will be invalidated. If migration to a new <code>SSDB</code> backend becomes necessary, the data should be
replicated to the new location prior to changing the value of <code>zimbraEphemeralBackendURL</code>.</p>
</div>
<div class="paragraph">
<p>There is one exception to this is: the backend can be safely reverted back to LDAP immediately after the switch to
<code>SSDB</code> with minimal loss of data. This is because the original values are retained in LDAP during migration; switching
the backend to <code>SSDB</code> leaves a "snapshot" of ephemeral data in LDAP at the time of the switch. The migration utility
does not currently provide a way to delete this data to free up space; however, it allows for the backend to be reverted.
The more time passes between the initial change and the reversion, the less the LDAP snapshot will reflect the true state
of ephemeral data.</p>
</div>
</div>
<div class="sect3">
<h4 id="_changes_to_zmprov">Changes to zmprov</h4>
<div class="paragraph">
<p>Due to changes in the way multi-valued ephemeral data is stored, the attributes <code>zimbraAuthTokens</code> and <code>zimbraCsrfTokenData</code>
are no longer returned as part of the <code>zmprov ga &lt;account&gt;</code> response. The value of <code>zimbraLastLogonTimestamp</code> is returned
as before, although only if the -l flag is not used, as adding the -l flag will restrict the server to accessing attributes
in LDAP only. It is still possible to modify these attributes using the <code>zmprov ma &lt;account&gt;</code> command, regardless of the
ephemeral backend. In order to do this, the provided attribute value must match its LDAP format: <code>tokenId|expiration|serverVersion</code>
for auth tokens; <code>data:crumb:expiration</code> for CSRF tokens.</p>
</div>
</div>
<div class="sect3">
<h4 id="_migration_csv_output">Migration CSV Output</h4>
<div class="paragraph">
<p>Each run of <code>zmmigrateattrs</code> generates a CSV file in the <code>/opt/zimbra/data/tmp/</code> folder. The file contains migration info
for every migrated account, such as the number of attributes migrated. Note that it is possible for this to be zero,
which can happen if all ephemeral data for an account is already present in the destination store.</p>
</div>
<div class="paragraph">
<p>If any migrations fail, a cutdown CSV file report detailing only the errors is also created
in the same directory. The name(s) of the file(s) are logged at the end of the run.</p>
</div>
</div>
<div class="sect3">
<h4 id="_account_deletion_behavior">Account Deletion Behavior</h4>
<div class="paragraph">
<p>Ephemeral data deletion behavior differs slightly between SSDB and LDAP backends. With SSDB as the backend, account deletion
results in the <code>zimbraLastLogonTimestamp</code> attribute being explicitly deleted from SSDB. <code>zimbraAuthTokens</code> and <code>zimbraCsrfTokenData</code>,
however, are left to be expired by SSDB when the token lifetimes are reached (default of 2 days). Conversely, ephemeral data
in LDAP is wiped immediately as part of the account deletion process.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ssdb_installation_and_configuration">SSDB Installation and Configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_installation">Installation</h3>
<div class="paragraph">
<p>Zimbra Collaboration packages do not include SSDB server and Zimbra Collaboration installation and configuration utilities do not alter SSDB configuration. To install the latest version of SSDB, follow instructions provided by SSDB developer community in <a href="http://ssdb.io/docs/install.html">SSDB Installation Documentation</a>. Please note, that Zimbra Collaboration has been tested with SSDB version 1.9.5. In order to install SSDB 1.9.5, download  <a href="https://github.com/ideawu/ssdb/tree/stable-1.9.5">stable-1.9.5.zip</a> instead of <a href="https://github.com/ideawu/ssdb/archive/master.zip">master.zip</a> when following <a href="http://ssdb.io/docs/install.html">SSDB installation instructions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="ssdb_configuration_options">Overview of Configuration Options</h3>
<div class="paragraph">
<p>The purpose of this guide is to discuss some of the options available
with <code>SSDB</code>, specifically with regards to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>High-availability via master-slave replication</p>
</li>
<li>
<p>High-availability via master-master replication</p>
</li>
<li>
<p>Horizontal scaling, with high-availability, via multi-master
configuration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This guide is not meant to be an exhaustive treatment of the subject.
Also, as of the time of this writing, <code>SSDB</code> and any related packages
must be installed and configured by the system administrator prior to
updating <code>zimbraEphemeralBackendURL</code> and migrating attributes.</p>
</div>
<div class="paragraph">
<p><code>SSDB</code> is compatible with <a href="https://redis.io/">Redis</a> clients and
Zimbra Collaboration currently uses a <code>Redis</code>-compatible client for
communication with <code>SSDB</code>, so many of the concepts described herein
are applicable with a <code>Redis</code> backend.</p>
</div>
<div class="sect3">
<h4 id="_high_availability_with_master_slave_replication">High-availability with Master-Slave replication</h4>
<div class="sect4">
<h5 id="_normal_operation">Normal Operation</h5>
<div class="paragraph">
<p>The method described in this document to implement master-slave
replication makes use of <a href="http://www.keepalived.org/">Keepalived</a> to
maintain a configured virtual IP address that is bound to the master
<code>SSDB</code> instance under normal conditions.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssdb-master-slave-normal.png" alt="ssdb master slave normal"></span></p>
</div>
</div>
<div class="sect4">
<h5 id="_fail_over">Fail-over</h5>
<div class="paragraph">
<p>If <code>Keepalived</code> detects a failure of the master instance, then the
backup instance is promoted to master by re-binding the virtual IP
address to the backup.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssdb-master-slave-failover.png" alt="ssdb master slave failover"></span></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_high_availability_with_master_master_replication">High-availability with Master-Master replication</h4>
<div class="paragraph">
<p>This differs from master-slave replication in that both <code>SSDB</code>
instances are online and accessible.  Each replicates changes from the
other.  In the example set-up described later, we use
<a href="http://www.haproxy.org/">HAProxy</a> as a front-end.  Keep in mind that,
for production, you must use a proxy service that is, itself, highly-available.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssdb-master-master.png" alt="ssdb master master"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_horizontal_scaling_via_multi_master_configuration">Horizontal Scaling via Multi-Master Configuration</h4>
<div class="paragraph">
<p>Normally, both <code>SSDB</code> and <code>Redis</code> contain the entire key-space in a
single instance.  It is possible to front-end multiple instances using
a service such as <a href="https://github.com/twitter/twemproxy">twemproxy</a>.  It
supports various hashing modes such that the data associated with a
particular key is always stored on the same server.  This allows for
horizontal scaling with very large installations.</p>
</div>
<div class="paragraph">
<p>By configuring each <code>SSDB</code> instance in master-slave configuration, you
get both horizontal scaling and high-availability.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/ssdb-multi-master.png" alt="ssdb multi master"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_master_slave_replication">Master-Slave Replication</h3>
<div class="paragraph">
<p>One way to ensure that <code>SSDB</code> remains highly-available is to set-up
master-slave replication and configure a system that will allow the
backup <code>SSDB</code> instance to automatically take-over in the event that
the primary instance goes down.  This document will describe one
technique for accomplishing that goal.</p>
</div>
<div class="sect3">
<h4 id="_overview">Overview</h4>
<div class="paragraph">
<p><code>SSDB</code> will be installed on two servers.  It will be configured such
that one server is the designated master and the other server is the
designated slave, or backup, that will constantly replicate changes
from the master server.</p>
</div>
<div class="paragraph">
<p><code>Keepalived</code> will also be installed on these two servers.  Each
<code>Keepalived</code> instance will monitor the other.  In the event that the
master server goes down, <code>Keepalived</code> will detect that failure and
promote the slave, or backup, server to master.  <code>Keepalived</code> will
maintain a <a href="https://en.wikipedia.org/wiki/Virtual_IP_address">Virtual
IP address</a> bound to whichever server is the current master.</p>
</div>
<div class="paragraph">
<p>Zimbra Collaboration will be configured such that the
<code>zimbraEphemeralBackendURL</code> will bind to the <em>Virtual IP address</em> that is
being maintained by <code>Keepalived</code>.</p>
</div>
<div class="paragraph">
<p>Once the installation and configuration of <em>both</em> the <code>SSDB</code>
master-slave setup and Zimbra Collaboration have been completed, follow the
instructions in <a href="#ephemeral_data">Ephemeral Data</a> to update the
<code>zimbraEphemeralBackendURL</code> accordingly.</p>
</div>
<div class="paragraph">
<p>The example documented here was done on servers running
<a href="http://releases.ubuntu.com/16.04/">Ubuntu 16.04</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_required_packages">Required Packages</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://ssdb.io/">SSDB</a></p>
</li>
<li>
<p><a href="http://www.keepalived.org/">Keepalived</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites_3">Prerequisites</h4>
<div class="paragraph">
<p>Install <code>SSDB</code> and <code>Keepalived</code> on two servers in accordance with the
procedure that is applicable to the Linux distribution that you are
using.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">Configuration</h4>
<div class="paragraph">
<p>The following configuration steps assume that you have installed
<code>SSDB</code> to <code>/var/lib/ssdb</code> and that all <code>SSDB</code> configuration files are
located in that same directory.  It further assumes that the internal
host addresses are on the <code>192.168.56/24</code> network.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>192.168.56.111</code> - This is IP address of the initial master <code>SSDB</code>
server</p>
</li>
<li>
<p><code>192.168.56.112</code> - This is the IP address of the initial slave <code>SSDB</code> server</p>
</li>
<li>
<p><code>192.168.56.120</code> - This is the virtual IP address that will be maintained by
<code>Keepalived</code>.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_ssdb_configuration_designated_initial_master">SSDB Configuration, Designated (Initial) Master</h5>
<div class="paragraph">
<p>The IP address of this machine is <code>192.168.56.111</code>.</p>
</div>
<div class="paragraph">
<p><code>/var/lib/ssdb/ssdb_master.conf</code></p>
</div>
<div class="paragraph">
<p>The key configuration items in the following block are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>server/ip</code> - Binding to all available IP addresses</p>
</li>
<li>
<p><code>server/port</code> - Binding to standard <code>SSDB</code> port</p>
</li>
<li>
<p><code>server/deny</code>, <code>server/allow</code> - Restrict <code>SSDB</code> access to <code>localhost</code> and the internal (host) addresses.`</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only the configuration items related to master-slave replication are
shown here.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ssdb-server config
# MUST indent by TAB!

# relative to path of this file, directory must exists
work_dir = ./var
pidfile = ./var/ssdb.pid

server:
        ip: 0.0.0.0
        port: 8888
        deny: all
        allow: 127.0.0.1
        allow: 192.168.56

replication:
        binlog: yes
        # Limit sync speed to *MB/s, -1: no limit
        sync_speed: -1
        slaveof:
                # sync|mirror, default is sync
                #type: sync</pre>
</div>
</div>
<div class="paragraph">
<p><code>/var/lib/ssdb/ssdb_slave.conf</code></p>
</div>
<div class="paragraph">
<p>The key configuration items in the following block are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>server/ip</code> - Binding to <code>localhost</code></p>
</li>
<li>
<p><code>server/port</code> - Binding to standard <code>SSDB</code> port</p>
</li>
<li>
<p><code>slaveof/type</code> - <code>sync</code></p>
</li>
<li>
<p><code>slaveof/host</code> - <code>192.168.56.112</code> is the other <code>SSDB</code> server</p>
</li>
<li>
<p><code>slaveof/port</code> - <code>8888</code> - The standard <code>SSDB</code> port</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Again, only the configuration items related to master-slave
replication are show.</p>
</div>
<div class="listingblock">
<div class="content">
<pre># ssdb-server config

# relative to path of this file, must exist
work_dir = ./var_slave
pidfile = ./var_slave/ssdb.pid

server:
        ip: 127.0.0.1
        port: 8888

replication:
        binlog: yes
        # Limit sync speed to *MB/s, -1: no limit
        sync_speed: -1
        slaveof:
                # sync|mirror, default is sync
                type: sync
                # Can use host: &lt;hostname&gt; with SSDB 1.9.2 or newer
                ip: 192.168.56.112
                port: 8888</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ssdb_configuration_designated_initial_slave">SSDB Configuration, Designated (Initial) Slave</h5>
<div class="paragraph">
<p>The IP address of this machine is <code>192.168.56.112</code>.</p>
</div>
<div class="paragraph">
<p>The <code>ssdb_master.conf</code> file is identical to that of the designated
master server.</p>
</div>
<div class="paragraph">
<p>The <code>ssdb_slave.conf</code> file is almost identical to that of the
designated master server.  Only the following items differ;</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>slaveof/ip (or host)</code> - <code>192.168.56.111</code> is the other <code>SSDB</code> server</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_keepalived_configuration_designated_initial_master">Keepalived configuration, Designated (Initial) Master</h5>
<div class="paragraph">
<p><code>/etc/keepalived/keepalived.conf</code></p>
</div>
<div class="paragraph">
<p>The key configuration items to note are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>state</code> -  State is set to <code>BACKUP</code> for <em>both</em> the designated
(initial) master and backup servers.  In this scenario, the
<code>priority</code> is used to negotiate which server will assume <code>MASTER</code>
status initially.</p>
</li>
<li>
<p><code>nopreempt</code> - In the event that the master server fails and the
backup server is promoted to master, this configuration directive
will keep the original master from reclaiming that role should it
come back online automatically.  This is required because it will
likely be stale.  In this case, when it comes back up, it will
remain in backup mode and will begin replicating information from
the new master. <em>Note</em>: Human intervention may be required to bring
a failed master back into service.</p>
</li>
<li>
<p><code>interface</code> - In this example, <code>enp0s8</code> is the interface identifier
for which the <code>virtual_ipaddress</code> will be defined.  You will choose
a value that is appropriate to your installation.</p>
</li>
<li>
<p><code>priority</code> - The designated initial master must have a higher
priority than the designated initial backup.</p>
</li>
<li>
<p><code>advert_int</code> - For the purposes of this documentation, the default value of
 1 second was use.  If you install <code>Keepalived</code> <code>1.2.21</code> or newer, you
 can specify a floating-point value here; e.g., <code>0.1</code> (seconds).
This will allow <code>Keepalived</code> to detect a master failure more rapidly.</p>
</li>
<li>
<p><code>notify</code> - This is the path to a script that will be called for
state transitions.  The full contents of the script is shown below</p>
</li>
<li>
<p><code>virtual_ipaddress</code> - This is the virtual IP address that is
maintained by <code>Keepalived</code>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>vrrp_instance VRRP1 {
        state BACKUP
        nopreempt
        interface enp0s8
        virtual_router_id 41
        priority 200
		advert_int 1
        notify /var/lib/ssdb/notify.sh

        authentication {
                auth_type PASS
                auth_pass 1234
        }
        virtual_ipaddress {
                192.168.56.120 dev enp0s8 label enp0s8:vip
        }
}</pre>
</div>
</div>
<div class="paragraph">
<p><code>/var/lib/ssdb/notify.sh</code></p>
</div>
<div class="paragraph">
<p>This is the script that is called by <code>Keepalived</code> during state
transitions.  Note that the value assigned to <code>USER</code> should be the
username that owns the <code>SSDB</code> process.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">#!/bin/bash
# This must be run as root.

ENDSTATE=$3
NAME=$2
TYPE=$1

LOG=/var/log/keepalived-state-transition.log
LOG_ERROR=0
LOG_WARNING=1
LOG_INFO=2
LOG_DEBUG=3
LOG_LEVEL=$LOG_INFO

KPCFG=/etc/keepalived/keepalived.conf
USER=&lt;SSDB-user-name&gt;
PREFIX=/var/lib/ssdb


function log {
    lvl=$1
    msg=&quot;$2&quot;
    if [ $lvl -le $LOG_LEVEL ]
    then
        now=$(date)
        echo &quot;$now [$lvl] $msg&quot; &gt;&gt; $LOG
    fi
}

function log_error {
    log $LOG_ERROR &quot;$1&quot;
}
function log_warning {
    log $LOG_WARNING &quot;$1&quot;
}
function log_info {
    log $LOG_INFO &quot;$1&quot;
}
function log_debug {
    log $LOG_DEBUG &quot;$1&quot;
}

function backup {
    log_info &quot;Transitioning to BACKUP state&quot;
    runuser -l $USER -c &quot;${PREFIX}/ssdb-server ${PREFIX}/ssdb.conf -s stop&quot;
    runuser -l $USER -c &quot;cp ${PREFIX}/ssdb_slave.conf ${PREFIX}/ssdb.conf&quot;
    runuser -l $USER -c &quot;${PREFIX}/ssdb-server -d ${PREFIX}/ssdb.conf&quot;

}

function fault {
    log_error &quot;keepalived is in FAULT state&quot;
}

function master {
    log_info &quot;Transitioning to MASTER state&quot;
    runuser -l $USER -c &quot;${PREFIX}/ssdb-server ${PREFIX}/ssdb.conf -s stop&quot;
    runuser -l $USER -c &quot;cp ${PREFIX}/ssdb_master.conf ${PREFIX}/ssdb.conf&quot;
    runuser -l $USER -c &quot;${PREFIX}/ssdb-server -d ${PREFIX}/ssdb.conf&quot;
}


case $ENDSTATE in
    &quot;BACKUP&quot;) # Perform action for transition to BACKUP state
        backup
        exit 0
        ;;
    &quot;FAULT&quot;)  # Perform action for transition to FAULT state
        fault
        exit 0
        ;;
    &quot;MASTER&quot;) # Perform action for transition to MASTER state
        master
        exit 0
        ;;
    *)    echo &quot;Unknown state ${ENDSTATE} for VRRP ${TYPE} ${NAME}&quot;
        exit 1
        ;;
esac</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_keepalived_configuration_designated_initial_backup">Keepalived configuration, Designated (Initial) Backup</h5>
<div class="paragraph">
<p><code>/etc/keepalived/keepalived.conf</code></p>
</div>
<div class="paragraph">
<p>This file is almost identical to the same file on the master node.
Exceptions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>priority</code> - It is given a lower initial priority.</p>
</li>
<li>
<p>It does not contain the <code>nopreempt</code> option.  Once the backup server
has become master due to a failure of the original master, the
system should allow for some human intervention before restoring
the original server to master status.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>vrrp_instance VRRP1 {
        state BACKUP
        interface enp0s8
        virtual_router_id 41
        priority 100
        advert_int 1
        notify /var/lib/ssdb/notify.sh

        authentication {
                auth_type PASS
                auth_pass 1234
        }
        virtual_ipaddress {
                192.168.56.120 dev enp0s8 label enp0s8:vip
        }
}</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>/var/lib/ssdb/notify.sh</code> for the backup server is identical to
the master.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_master_master_replication">Master-Master Replication</h3>
<div class="sect3">
<h4 id="_overview_2">Overview</h4>
<div class="paragraph">
<p>Another way to ensure that <code>SSDB</code> remains highly-available is to set-up
master-master replication and configure a proxy that understands
<code>Redis</code> protocol in front of the two <code>SSDB</code> servers.  The proxy is
responsible for monitoring the health of the two servers and removing
a failed server from the poop.</p>
</div>
<div class="paragraph">
<p>The following simplified example uses a single <code>HAProxy</code> instance in
front of two <code>SSDB</code> servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_required_packages_2">Required Packages</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://ssdb.io/">SSDB</a>.  In the examples shown below it is assumed
that version <code>1.9.2</code> or newer is installed.</p>
</li>
<li>
<p><a href="http://www.haproxy.org/">HAProxy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_prerequisites_4">Prerequisites</h4>
<div class="paragraph">
<p>Install <code>SSDB</code> on two servers in accordance with the
procedure that is applicable to the Linux distribution that you are
using. Install <code>HAProxy</code> on an additional server.  Note that
<a href="http://www.keepalived.org/">Keepalived</a> can be used to configure a
highly-available pool of <code>HAProxy</code> servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configuration_2">Configuration</h4>
<div class="sect4">
<h5 id="_ssdb_configuration_first_master">SSDB Configuration, First Master</h5>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only the configuration related to master-master replication is
shown.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># ssdb-server config
## ssdb-server config MUST indent by TAB!

# relative to path of this file, directory must exists
work_dir = ./var
pidfile = ./var/ssdb.pid

server:
        ip: 0.0.0.0
        port: 8888
        deny: all
        allow: 127.0.0.1
        # e.g., 192.168.56
        allow: &lt;ip-address-prefix&gt;


replication:
        binlog: yes
        # Limit sync speed to *MB/s, -1: no limit
        sync_speed: -1
        slaveof:
                id: svc_2
                type: mirror
                host: &lt;hostname-of-other-master&gt;
                port: 8888</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_ssdb_configuration_second_master">SSDB Configuration, Second Master</h5>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only the configuration related to master-master replication is
shown.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre># ssdb-server config
# MUST indent by TAB!

# relative to path of this file, directory must exists
work_dir = ./var
pidfile = ./var/ssdb.pid

server:
        ip: 0.0.0.0
        port: 8888
        deny: all
        allow: 127.0.0.1
        # e.g., 192.168.56
        allow: &lt;ip-address-prefix&gt;


replication:
        binlog: yes
        # Limit sync speed to *MB/s, -1: no limit
        sync_speed: -1
        slaveof:
                id: svc_1
                type: mirror
                host: &lt;hostname-of-other-master&gt;
                port: 8888</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_haproxy_configuration">HAProxy Configuration</h5>
<div class="paragraph">
<p>Notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only the configuration related to <code>SSDB</code> is shown.</p>
</li>
<li>
<p><code>SSDB</code> supports <code>Redis</code> network protocol. You can use <code>Redis</code> clients to
connect to an <code>SSDB</code> server and operate on it. This is what
Zimbra Collaboration does.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>defaults REDIS
        mode tcp
        timeout connect  4s
        timeout server  30s
        timeout client  30s

frontend ft_redis
        bind &lt;published-ip-address&gt;:8888 name redis
        default_backend bk_redis

backend bk_redis
        option tcp-check
        server R1 &lt;first-master-ip-address&gt;:8888 check inter 1s
        server R2 &lt;second-master-ip-address&gt;:8888 check inter 1s</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_multi_master_scaling_replication">Multi-Master Scaling / Replication</h3>
<div class="sect3">
<h4 id="_overview_3">Overview</h4>
<div class="paragraph">
<p>The details of multi-master configuration will not be covered in this
document.  In essence, you will install and configure multiple
independent <code>SSDB</code> master-slave pairs using the instructions included
above. Each pair will be responsible for storing a subset of the total
key-space.</p>
</div>
<div class="paragraph">
<p>As in the master-master configuration, all of the pairs in the pool of <code>SSDB</code>
servers will be front-ended by a proxy service that understands
<code>Redis</code> protocol.  It must also be capable of consistently hashing the
data keys that are presented such that all requests relating to a
particular key always get routed to the same master-slave pair.</p>
</div>
<div class="paragraph">
<p>One such product is <a href="https://github.com/twitter/twemproxy">twemproxy</a>
from <a href="https://github.com/twitter">Twitter</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ldap_attributes">LDAP Attributes</h3>
<div class="paragraph">
<p>The the SSDB backend makes use of a resource pool to manage access to the
<code>SSDB</code> server; threads attempting ephemeral data operations must first
acquire a resource from this pool. To that end, two LDAP attributes have
been introduced to control the pool configuration.</p>
</div>
<div class="paragraph">
<p><code>zimbraSSDBResourcePoolSize</code> controls the size of the pool. This determines
how many client threads can simultaneously perform ephemeral API operations.
By default this is set to 0, which results an unlimited pool size.</p>
</div>
<div class="paragraph">
<p><code>zimbraSSDBResourcePoolTimeout</code> controls the amount of time a thread will
wait for a resource before throwing an exception. The default is 0,
which results in no timeout. This attribute has no effect when the pool size
is 0, as threads will never have to wait for resources to be freed in order
to perform ephemeral data operations.</p>
</div>
<div class="paragraph">
<p>A non-zero timeout value is recommended when the pool size is finite.
Otherwise, a lost <code>SSDB</code> connection may cause mailboxd threads to remain
blocked indefinitely, even after the connection is re-established.
In general, the resource pool should be sized such that the mailbox server
is not starved for resources.</p>
</div>
</div>
<div class="sect2">
<h3 id="_scaling_ssdb_for_production_load_with_zimbra_collaboration">Scaling SSDB for Production Load with Zimbra Collaboration</h3>
<div class="paragraph">
<p>The main characteristics of Zimbra Collaboration production load that affects load on SSDB server are the frequency of authentication requests and frequency of SOAP requests sent by Zimbra Collaboration Web Client and 3rd party SOAP clients. Each authentication request results in a 2 or 3 write operations for SSDB. The write operations update zimbraLastLogonTimestamp, zimbraAuthTokens and zimbraCsrfTokenData values. Note, that zimbraCsrfTokenData is updated only when using a CSRF-enabled SOAP client such as Zimbra Collaboration Web Client. Each authenticated SOAP request results in 2 read operations for SSDB.</p>
</div>
<div class="sect3">
<h4 id="_minimum_recommended_ssdb_configuration">Minimum Recommended SSDB Configuration</h4>
<div class="paragraph">
<p>We recommend that your SSDB server has at least 2GB RAM and 1 CPU. If you plan on running additional tools, such as monitoring and configuration management on your SSDB server, consider increasing memory and adding one more CPU core to accommodate additional software. Check out <a href="https://github.com/Zimbra/zm-ssdb-ephemeral-store/wiki/Zimbra-and-SSDB-Authentication-Load-Tests">Zimbra and SSDB Authentication Load Tests</a> for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">Conclusion</h3>
<div class="paragraph">
<p>For installations whose ephemeral data storage requirements will fit
in a single instance, simple master-slave replication is the easiest
to implement and requires the fewest resources.  Master-master
replication does allow requests to be load-balanced across both
masters; however, each master is also constantly replicating from the
other, so <code>SSDB</code> must do additional work to maintain
consistency.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="class_of_service_and_accounts">Class of Service and Accounts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Class of Service (COS) assigned to an account determines the default attributes for user accounts, and the features to be enabled or denied.
Each account is assigned a COS.
The COS controls mailbox quotas, message lifetime, password restrictions, attachment blocking, and server pool usage.</p>
</div>
<div class="paragraph">
<p>A COS is a global object and is not restricted to a particular domain or set of domains.</p>
</div>
<div class="paragraph">
<p>You can create and edit the classes of services from the Administration Console:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em></strong></p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_managing_features_and_settings_with_a_cos">Managing Features and Settings with a COS</h3>
<div class="paragraph">
<p>A default COS is created when Zimbra Collaboration is installed.
You can modify the default COS and create new ones.</p>
</div>
<div class="paragraph">
<p>From a COS, you can manage the following functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Features and preferences that users can access.</p>
</li>
<li>
<p>Themes and Zimlets that users can access.</p>
</li>
<li>
<p>Advanced settings including attachment settings, quotas, and password login policies.</p>
</li>
<li>
<p>Web Client Versions (Advanced and Standard).</p>
</li>
<li>
<p>Web Services and Desktop Clients (EWS, MAPI and more).</p>
</li>
<li>
<p>Offline Mode.</p>
</li>
<li>
<p>Retention policies.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As an example, you could create an Executive COS that is configured to enable all features, provide unlimited mailbox quotas, and never purges messages.
Another General-Employee COS may also be created, which enables only the mail feature, sets the mailbox quota, and purges messages every 60 days.
Grouping accounts to a specific COS allows you update or change account features in bulk.
As such, when the COS is changed, all accounts assigned to the COS are changed.</p>
</div>
<div class="paragraph">
<p>If a COS is not explicitly set for a new account, or if the COS assigned to a user no longer exists, the <strong>default</strong> COS is automatically assigned.</p>
</div>
<div class="paragraph">
<p>You can create a COS and assign that as a default COS for all accounts that are created on that domain.
You can create different COSs and specify which ones are available for the domain.
If a domain does not have a COS defined, and you do not specify a COS, the original default COS is automatically assigned when an account is created.</p>
</div>
<div class="paragraph">
<p>Some COS settings can be overridden either by global settings or by user settings.
For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Whether outgoing messages are saved to <strong>Sent</strong> can be changed from the Zimbra Web Client in the user&#8217;s preferences.</p>
</li>
<li>
<p>Attachment blocking set as a global setting can override the COS setting.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some COS settings assigned to an account are not enforced for IMAP clients.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_selecting_features_and_preferences">Selecting Features and Preferences</h3>
<div class="paragraph">
<p>All the features available for a COS are displayed in its <strong>Features</strong> page.
From there, you can select or deselect the features you do not want included in the COS.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Changes made at the account level override the rules in the COS assigned to the account.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can define the initial preferences for saving and viewing messages, in the <strong>Preferences</strong> page.
You can also select a specific locale for the Web Client.
If a locale is not specified, the browser locale is the default.</p>
</div>
<div class="paragraph">
<p>For a description of the features and preferences, see <a href="#customizing_accounts">Customizing Accounts</a>.</p>
</div>
<div class="sect3">
<h4 id="_disabling_preferences">Disabling Preferences</h4>
<div class="paragraph">
<p>By default, Preferences are enabled, and your users can modify the default preferences that are configured for their accounts.</p>
</div>
<div class="paragraph">
<p>As the Administrator, you can disable Preferences.
As a result, the Preferences page will not display in users mailboxes: they therefore cannot modify the default configuration for features that are set up for their accounts.</p>
</div>
</div>
<div class="sect3">
<h4 id="setting_default_time_zone">Setting Default Time Zone</h4>
<div class="paragraph">
<p>The default time zone setting displayed in an account&#8217;s Preferences tab is used to localize the time for received messages and calendar activities in the Standard web client.</p>
</div>
<div class="paragraph">
<p>When the Standard web client is used, the time zone on the computer is not used to set the time a message is received or for calendar activities.
Rather, the time zone setting in the <strong>Preferences &#8594; Calendar Options</strong> is used.</p>
</div>
<div class="paragraph">
<p>When using the Advanced web client, the time zone setting on the computer is used as the time stamp for received messages and for calendar activities, not the time zone setting on the <strong>General Information</strong> page.</p>
</div>
<div class="paragraph">
<p>Because the advanced web client and the Standard web client do not use the same time zone source to render messages, you might notice that a message displayed on multiple clients will be stamped with different times.
You can avoid this by setting the computer time zone and the web client time zone set to the same time.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_server_pools">Using Server Pools</h3>
<div class="paragraph">
<p>In an environment with multiple mailbox servers, the COS is used to assign a new account to a mailbox server.
When you configure the COS, you select which servers to add to the server pool.
Within each pool of servers, a random algorithm assigns new mailboxes to any available server.</p>
</div>
<div class="paragraph">
<p>You can assign an account to a particular mailbox server when you create an account in the New Account Wizard, Server field.
Uncheck <strong>auto</strong> and enter the mailbox server in the Server field.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_account_quota">Setting Account Quota</h3>
<div class="paragraph">
<p>An account quota is the storage limit allowed for an account.
Email messages, address books, calendars, tasks, and Briefcase files contribute to the volume of the quota.
Account quotas can be set for a COS or for individual accounts from the Administration Console.</p>
</div>
<div class="paragraph">
<p>If you set the quota to 0, accounts do not have a quota.</p>
</div>
<div class="sect3">
<h4 id="_viewing_account_quotas">Viewing Account Quotas</h4>
<div class="paragraph">
<p>To view account quotas for all accounts on a domain:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Domains &#8594; <em>domain</em> &#8594; Mailbox Quota</strong></p>
</dd>
</dl>
</div>
<div class="sect4">
<h5 id="_notifying_users_when_maximum_quota_is_near">Notifying Users When Maximum Quota is Near</h5>
<div class="paragraph">
<p>Users can be notified that their mailboxes are nearing their quota.
The quota percentage can be set and the warning message text can be modified: Go to the <strong>Quotas</strong> container for a specified Class of Service:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Advanced &#8594; Quotas</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When the displayed/configured threshold is reached, a quota warning message is sent to the user.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_quotas_in_domains">Setting Quotas in Domains</h4>
<div class="paragraph">
<p>You can set a maximum mailbox quota for a domain.
The default for the domain mailbox quota is unlimited.
The domain quota is the maximum amount of storage that can be used by all mailboxes within the domain.</p>
</div>
<div class="paragraph">
<p>You can set an aggregate quota as well.
The sum of the quotas for all accounts in the domain can exceed the size of the aggregate.</p>
</div>
<div class="paragraph">
<p>An aggregate quota policy for how to handle messages that are sent or received once the aggregate quota has been reached can be set up.
The policy options include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Continue to allow messages to be sent and received as usual.</p>
</li>
<li>
<p>Do not allow messages to be sent.</p>
</li>
<li>
<p>Do not allow messages to be sent or received.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notifications can be automatically sent when the quota is within a configured percentage of the aggregate quota.
A cron tab job runs daily to check the aggregate quota percentage and if the percentage has been reached, the quota warning email is sent.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When a domain quota is set, the effective quota for an account is the minimum quota setting of either the domain or account.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure domain quotas, go to the <strong>Domain Quota Setting</strong> container for a specified domain:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Domains &#8594; <em>domain</em> &#8594; Advanced &#8594; Domain Quota Setting</strong></p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_managing_excess_quota">Managing Excess Quota</h4>
<div class="paragraph">
<p>You can set how message delivery is handled when a user&#8217;s mailbox exceeds the configured quota.
The default behavior is for the MTA to temporarily send the message to the deferred queue.
When the mailbox has sufficient space, the message is delivered.
You can change this behavior to either have messages bounce back to the sender instead of being sent to the deferred queue first or you can configure to send the message to the mailbox even if the quota has been exceeded.</p>
</div>
<div class="paragraph">
<p>To bounce messages instead of sending them to the deferred queue:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraLmtpPermanentFailureWhenOverQuota TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>To send the message to the mailbox even if the quota has been exceeded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc {cos-name} zimbraMailAllowReceiveButNotSendWhenOverQuota TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>When this attribute is set to TRUE, a mailbox that exceeds its quota is still allowed to receive new mail and calendar invites.
This quote bypass is only implemented for messages.
All other mail items are still affected by the quota.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_passwords">Managing Passwords</h3>
<div class="paragraph">
<p>If you use internal authentication, you can quickly change an account&#8217;s password from the Account&#8217;s toolbar.
The user must be told the new password to log on.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If Microsoft Active Directory (AD) is used for user authentication, you must disable the Change Password feature in the COS.
The AD password policy is not managed by Zimbra.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you want to make sure users change a password that you create, you can enable <strong>Must Change Password</strong> for the account.
The user must change the password the next time he logs on.</p>
</div>
<div class="paragraph">
<p>Password restrictions can be set either at the COS level or at the account level.
You can configure settings to require users to create strong passwords and change their passwords regularly, and you can set the parameters to lock out accounts when incorrect passwords are entered.</p>
</div>
<div class="sect3">
<h4 id="_directing_users_to_your_change_password_page">Directing Users to Your Change Password Page</h4>
<div class="paragraph">
<p>If authentication is configured as external auth, you can configure Zimbra Collaboration to direct users to <strong>your password change page</strong> when users change their passwords.
You can either set this URL as a global setting or a per domain setting.</p>
</div>
<div class="paragraph">
<p>Set the <code>zimbraChangePasswordURL</code> attribute to the URL of your password change page.</p>
</div>
<div class="paragraph">
<p><strong>Change Password</strong> in the Web Client under <strong>Preferences &#8594; General</strong> links to this URL, and when passwords expire, users are sent to this page.</p>
</div>
<div class="paragraph">
<p>Modifying the password for the domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md example.com zimbraChangePasswordURL https://auth.example.com</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_a_password_policy">Configuring a Password Policy</h4>
<div id="passwordpolicy" class="paragraph">
<p>If internal authentication is configured for the domain, you can require users to create strong passwords to guard against simple password harvest attacks.
Users can be locked out of their accounts if they fail to sign in after the maximum number of attempts configured.</p>
</div>
<div class="paragraph">
<p>To set password policy, use the <strong>Password</strong> container for a specified Class of Service:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Advanced &#8594; Password</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The password settings that can be configured are listed below.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. Password Options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Password Options</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum/Maximum password length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the required length of a password.
The default minimum and maximum are 6 and 64 characters, respectively.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum/Maximum password age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures the password expiration date.
Users can change their passwords at any time between the minimum and maximum.
They must change it when the maximum password age is reached.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock">The following settings require users to add complexity to their passwords.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum upper case characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Uppercase A - Z</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum lower case characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lowercase a - z</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum punctuation symbols</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Non-alphanumeric, for example !, $, #, &amp;, %</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum numeric characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base 10 digits 0 - 9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum numeric characters or punctuation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Combined Non-alphanumeric and digits</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum number of unique passwords history</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of unique new passwords that a user must create before an old password can be reused.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum password age (Days)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum days between password changes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum password age (Days)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum days between password changes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password locked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users cannot change their passwords.
This should be set if authentication is external.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must change password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User is required to change password at first sign in.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When enabled, users can change their password at any time within the password age settings from their account Preferences tab.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_managing_login_policies">Managing Login Policies</h3>
<div class="paragraph">
<p>You can set the maximum number of failed login attempts before the account is locked out for the specified lockout time.
This type of policy is used to prevent password attacks.</p>
</div>
<div class="paragraph">
<p>To set user login policy, use the <strong>Filed Login Policy</strong> container for a specified Class of Service:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Advanced &#8594; Failed Login Policy</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. Login Policy Options</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Login Policy Options</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable failed login lockout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This enables "failed login lockout" feature.
You can configure the following settings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of consecutive failed logins allowed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of failed login attempts before the account is locked out.
The default is 10.
If set to 0, the account is never locked out.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time to lockout the account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of time the account is locked out.
If this is set to 0, the account is locked out until the correct password is entered, or the administrator manually changes the account status and creates a new password.
The default is 1 hour.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time window in which the failed logins must occur to lock the account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration of time after which the number of consecutive failed login attempts is cleared from the log.
If this is set to 0, the user can continue attempts to authenticate, no matter how many consecutive failed login attempts have occurred.
The default is 1 hour.</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="about_two_factor_auth">About 2 Factor Authentication</h4>
<div class="paragraph">
<p>With the 2 Factor Authentication (FA) feature you can apply additional security policies to COS and/or user accounts to provide another layer of authentication during attempts to access the system.
This feature must be enabled or disabled in the Admin Console, to manage 2FA functions applicable to user mailboxes.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/2FADiagram.png" alt="2 Factor Authentication"></span></p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://wiki.zimbra.com/wiki/Zimbra_Two-factor_authentication">2 Factor Authentication</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_session_timeout_policies">Managing Session Timeout Policies</h3>
<div class="paragraph">
<p>You can set the period of time to allot for user sessions based on various conditions.</p>
</div>
<div class="paragraph">
<p>To set the session timeout policy use the <strong>Timeout Policy</strong> container for a specified Class of Service:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Advanced &#8594; Timeout Policy</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. Session Timeout Policy Options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Session Timeout Policy Options</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin console auth token lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets a browser cookie that contains the admin auth token.
Administrators can open the Administration Console without having to log on again until the auth token expires.
The default is 12 hours.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auth token lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets a browser cookie that contains the Web Client auth token.
User can open the Web Client without having to log on again until the auth token expires.
The default is 2 days.
When it expires, the login page is displayed and the user must log on to continue.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Session idle lifetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How long a user session remains active, if no activity occurs.
Activity includes any clickable mouse action, such as viewing folder contents or clicking a button.
The default is unlimited.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>You can manually expire a user&#8217;s web client session from the Administration Console <b class="button">Expire Sessions</b> link.
This forces the current session of the account to expire immediately.</p>
</div>
</div>
<div class="sect2">
<h3 id="_managing_default_external_cos">Managing Default External COS</h3>
<div class="paragraph">
<p>The <code>defaultExternal</code> COS is assigned to external virtual accounts that are created when external users accepts a ZCS provisioned users'
invitation to share their calendar or briefcase items.</p>
</div>
<div class="paragraph">
<p>This account is not provisioned on the server, but the external user can sign in to the Web Client, create a display name and set a password to view the shared items.
The only folders available are for the content they have access to.</p>
</div>
<div class="paragraph">
<p>The <code>defaultExternal</code> COS is configured with the following general features:
Change password, Change UI themes, HTML compose, Export and Search.
None of the major features are configured.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="customizing_accounts">Customizing Accounts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter describes the features and user preferences that can be configured for an account, either from the assigned COS or in an individual account.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Mailbox features are enabled for Zimbra Web Client users.
When IMAP or POP clients are used, users might not have these features available.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Offline mode is no more supported for Chrome versions 85 and above (affects <strong>Joule8815-Patch16</strong> onwards). Users can still continue to use Offline mode in previous browser versions.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_messaging_and_collaboration_applications">Messaging and Collaboration Applications</h3>
<div class="paragraph">
<p>Your COS configuration and assignment of a COS to accounts determines the default settings for account features and the restrictions to be applied to groups of accounts.
Individual accounts can be configured differently, and any changes you make override the COS setting.
When you update the COS, the changes are not reflected in accounts that have COS overrides.</p>
</div>
<div class="sect3">
<h4 id="_email_messaging_features">Email Messaging Features</h4>
<div class="paragraph">
<p>You configure which email messaging features are enabled.
Users can then manage many of the enabled features as preferences.</p>
</div>
<div class="paragraph">
<p>By default, users manage their own preferences, but you can administratively elect not to allow user modifications to their account preferences.
Currently supported Web Client Email Messaging Features are listed and described in <a href="#table_email_features">Email Features</a>.</p>
</div>
<table id="table_email_features" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. Email Features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Email Messaging Feature</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enables the email application.
Enabled by default.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Major Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversations</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Messages can be grouped into conversations by a common thread.
The default is to thread messages in a conversation by the References header.
If there is no References header, the Subject is used to determine the conversation thread.</p>
</div>
<div class="paragraph">
<p>To change the default, update attribute <code>zimbraMailThreadingAlgorithm</code> from the COS or for individual accounts.
See <a href="#conversation_threading">changing conversations thread default</a>.</p>
</div>
<div class="paragraph">
<p>If this feature is enabled, conversation view is the default.
You can change the default on the COS Preferences page.
Users can also change the default.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML compose</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can compose email messages with an HTML editor.
They can specify default font settings as a preference.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Preferences &#8594; Composing Mail</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Draft auto save interval</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Frequency of saving draft messages.
The default is every 30 seconds.
Users cannot change the frequency, but they can turn off the save draft feature.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Preferences &#8594; Composing Mail</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail send later</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, users can choose <strong>Send Later</strong> to send a message at a later time.
The user configures the data and time for sending.
Messages are saved in the Draft folder.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Message priority</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, users can set the priority of the message.
The recipient viewing from the Web Client sees the priority flag if it is high or low.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable Attachment indexing</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Attachments are indexed.
Indexed attachments can be searched.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Advanced &#8594; Attachment Settings</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow the user to specify a forwarding address</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>You can specify a default forwarding address that the user can use.
Users can change the forwarding address from their account Preferences tab.</p>
</div>
<div class="paragraph">
<p>You can also specify forwarding addresses that are hidden from the user.
A copy of a message sent to the account is immediately forwarded to the designated forwarding address.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Out of office reply</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can create an email message that automatically replies to incoming messages.
By default a message is sent to each recipient only once every seven days, regardless of how many messages that person sends to the address.
This setting can be changed in the COS Preferences page, <strong>Out of office cache lifetime</strong> field.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">New mail notification</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows users the option to specify an address to be notified of new mail.
They can turn this feature on or off and designate an address from their account Preferences tab.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See <a href="#custom_new_mail_notification">Customize the notification email</a> for an example of changing the email template.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Persona</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, users can create additional account names to manage different roles.
Account aliases can be selected for the <strong>From</strong> name of messages sent from that persona account and a specific signature can be set for the persona account.
The number of personas that can be created is configurable depending on your requirements.
The minimum is 0, and the default is 20 (<code>zimbraIdentityMaxNumEntries</code>).</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum length of mail signature</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of characters that can be in a signature.
The default is 1024 characters.</p>
</div>
<div class="paragraph">
<p>The number of signatures users can create is configured in <code>zimbraSignatureMaxNumEntries</code>.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Preferences &#8594; Composing Mail</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced search</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Allows users to build a complex search by date, domain, status, tags, size, attachment, Zimlets, and folders.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Search Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Saved searches</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can save a search that they have previously executed or built.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Search Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial search preference</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, the default search mailbox can be changed.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; General Options</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External POP access</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, users can retrieve their POP accounts' email messages directly from their Zimbra account.
They add the external account address to their account settings.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External IMAP Access</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, users can retrieve their IMAP accounts' email messages directly from their Zimbra account.
They can add the external account address to their account settings.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aliases for this account</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>You can create aliases for the account.
Users cannot change this.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail filters</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can define a set of rules and corresponding actions to apply to incoming and outgoing mail and calendar appointments.
When an incoming email message matches the conditions of a filter rule, the corresponding actions associated with that rule are applied.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Spam check on a received message is completed before users' mail filters are run.
Message identified as spam are moved to the junk folder.
To avoid having mail incorrectly marked as spam, users can create a spam whitelist from the Preferences Mail folder to identify email addresses that should not be marked as spam.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flagging</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can create flags and assign them to messages, contacts, and files in Briefcase folders.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable keyboard shortcuts</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can use keyboard shortcuts within their mailbox.
The shortcut list can be viewed in the Web Client from the Username drop-down menu.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Preferences &#8594; General Options</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global Address List (GAL) access</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can access the company directory to find names for their email messages.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; General Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Autocomplete from GAL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, users enter a few letters in their compose header and names listed in the GAL are displayed ranked by usage.
See also <a href="#autocomplete_ranks_names">Autocomplete Ranks Names</a>.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; General Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Offline support for Web Client</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, users can use the offline mode to access their data without network connectivity when using the Zimbra Web Client.
See also <a href="#offline_mode">Offline Mode</a>.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; General Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP access</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can use third party mail applications to access their mailbox using the IMAP protocol.</p>
</div>
<div class="paragraph">
<p>You can set the polling interval from the COS or Account <strong>Advanced</strong> page, <strong>Data Source &#8594; IMAP</strong> polling interval section.
The polling interval is not set by default.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP3 access</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can use third party mail applications to access their mailbox using the POP protocol.
When they retrieve their POP email messages, the messages and attachments are saved on the Zimbra server.</p>
</div>
<div class="paragraph">
<p>Users can configure from their <strong>Preferences &#8594; Mail</strong> page</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How messages are downloaded.</p>
</li>
<li>
<p>Whether to include their junk messages.
Junk messages are downloaded to their Inbox.</p>
</li>
<li>
<p>How to delete messages from their POP account.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can set the polling interval from the COS or Account <strong>Advanced</strong> page, <strong>Data Source &#8594; POP3</strong> polling interval section.
The polling interval is not set by default.</p>
</div>
<div class="paragraph">
<p>See <strong><em>COS</em> &#8594; Features &#8594; Mail Features</strong> container in the Admin Console.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="autocomplete_ranks_names">Autocomplete Ranks Names</h5>
<div class="paragraph">
<p>The autocomplete feature displays names ranked with the most frequently recalled contact listed at the top.
If the contact name that appears first should not be listed at the top, the user can click <strong>Forget</strong> and the contact names are re-ranked.</p>
</div>
</div>
<div class="sect4">
<h5 id="_email_preferences_that_users_manage">Email Preferences that Users Manage</h5>
<div class="paragraph">
<p>The default behavior for many of the preferences listed in this section can be set from either the COS or the Accounts Preferences page.
Users can modify the following mail preferences from their account Preferences
in the Web Client.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How often, in minutes, that the Web Client checks for new messages:</p>
<div class="paragraph">
<p><strong>Check for new mail every&#8230;&#8203;</strong></p>
</div>
</li>
<li>
<p>Set or change email message alerts.
Alerts can be set up to play a sound, highlight the Mail tab when a message arrives, and flash the browser.</p>
</li>
<li>
<p>Set the display language for the Web Client.
If more than one language locale is installed on Zimbra Collaboration, users can select a locale that is different from the browser language settings.</p>
</li>
<li>
<p>Whether to save copies of outbound messages to the Sent folder.</p>
</li>
<li>
<p>Whether to save a local copy of a message that is forwarded or to have it deleted from their mailbox.</p>
</li>
<li>
<p>Whether to compose messages in a separate window.</p>
</li>
<li>
<p>Whether to view mail as HTML for messages that include HTML or to view messages as plain text.</p>
</li>
<li>
<p>Whether to send a read receipt when it is requested.</p>
</li>
<li>
<p>Adjust the default font size for printed messages.
The default is 12 points.</p>
</li>
<li>
<p>Users can set up their own Spam mail options of whitelist and blacklist email addresses that are used to filter incoming message from their Preferences Mail folder.
The default maximum number of whitelist and blacklist addresses is 100 on each list.
This value can be changed using CLI <code>zmprov</code> for accounts and COS.
The attributes are <code>zimbraMailWhitelistMaxNumEntries</code> and <code>zimbraMailBlacklistMaxNumEntries</code>.</p>
</li>
<li>
<p>Users can modify the following mail preferences under <strong>Signatures</strong>:</p>
<div class="ulist">
<ul>
<li>
<p>Whether to automatically append a signature to outgoing messages.</p>
</li>
<li>
<p>Preferences for how signatures are applied to messages that are replied to or forwarded.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_using_import_and_export_to_save_users_data">Using Import and Export to Save User&#8217;s Data</h5>
<div class="paragraph">
<p>From the <strong>Preferences Import/Export</strong> page in the Web Client users may export all of their account data, including mail, contacts, calendar, and tasks.
By selecting export options, they can export specific items in their account and save the data to their computer.</p>
</div>
<div class="paragraph">
<p>The account data is saved as a tar-gzipped (<code>.tgz</code>) archive file so that it can be imported to restore their account.
Individual contacts are saved as <code>.csv</code> files, and individual calendar files are saved as <code>.ics</code> files.
The data are copied, not removed from the user&#8217;s account.</p>
</div>
<div class="paragraph">
<p>The exported account data file can be viewed with an archive program such as <em>WinZip</em>.
Any of these files can be imported into their account from the same page.</p>
</div>
<div class="paragraph">
<p>You can turn the Import/Export feature off from the <strong>COS</strong> or <strong>Account Features</strong> page, <strong>General Features</strong> section.</p>
</div>
</div>
<div class="sect4">
<h5 id="_setting_up_rss_polling_intervals">Setting Up RSS Polling Intervals</h5>
<div class="paragraph">
<p>Users can subscribe to Websites that provide RSS and podcast feeds and receive updated information directly to their mailboxes.
The maximum number of feeds that can be returned is 50.
RSS feeds count against users' account quota.</p>
</div>
<div class="paragraph">
<p>The default is to update the RSS data every 12 hours.
Users can right-click on an RSS feed folder to manually load new feed.</p>
</div>
<div class="paragraph">
<p>You can change the polling interval from the Administration Console the COS or Account <strong>Advanced</strong> page, <strong>Data Source &#8594; RSS polling interval</strong> section.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_contacts_features">Contacts Features</h3>
<div class="paragraph">
<p>Zimbra Contacts allows users to create multiple contact lists and add contact names automatically when mail is received or sent.
Users can import contacts into their Address Book.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To allow users to share their mail folders, address books, and calendars, enable Sharing on the <strong>General Features</strong> container:</p>
</div>
<div class="paragraph">
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Features &#8594; General Features</strong></p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 38. Address Book Features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">COS/Account Tabs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address Book</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users can create personal contacts lists.
By default, a "Contacts" list and "Emailed Contacts" list are created.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address book size limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of contacts a user can have in all address books.
<code>0</code> means unlimited.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Users can modify the following Address Book preferences from their account <strong>Preferences Address Book</strong> page.</p>
</div>
<div class="paragraph">
<p>To set default behavior:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Preferences</strong><br>
<strong>Home &#8594; Manage &#8594; Accounts &#8594; <em>account</em> &#8594; Preferences</strong></p>
<div class="ulist">
<ul>
<li>
<p>Enable auto adding of contacts to automatically add contacts to their Emailed Contact list when they send an email to a new address.</p>
</li>
<li>
<p>Enable the ability to use the Global Access List when using the contact picker to look up names.</p>
</li>
<li>
<p>Enable the options to include the GAL addresses and names in shared address books when using autocomplete to address a message.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_calendar_features">Calendar Features</h3>
<div class="paragraph">
<p>Zimbra Calendar lets users schedule appointments and meetings, establish recurring activities, create multiple calendars, share calendars with others, and delegate manager access to their calendars.
They can subscribe to external calendars and view their calendar information from the Zimbra Web Client.
They can also use search for appointments in their calendars.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To allow users to share their calendars, address books, and Briefcase files, enable Sharing in the <strong>General Features</strong> container.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Features &#8594; General Features</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 39. Calendar Features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Calendar Feature</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">COS/Account Tabs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Lets users maintain their calendar, schedule meetings, delegate access to their calendar, create multiple personal calendars, and more.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Group Calendar</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When Group Calendar is not checked, users can create personal appointments and accept invitations to meetings only.
The Find Attendees, Schedule and Find Resources tabs are not displayed.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nested Calendars</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Calendars can be nested within Zimbra folders like Mail, Contact, and Calendar folders.
The administrator creates a nested list of calendars using CLI.
A nested calendar grouping can be imported through migration as well.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time zone</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sets the time zone to use for Calendar scheduling.
Domain admins set this in the Accounts, General Information page.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Preferences</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forward calendar invitation to specific addresses</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>You can specify email addresses to forward a user&#8217;s calendar invitations.
Users can also specify forwarding address from the Preferences Calendar folder.</p>
</div>
<div class="paragraph">
<p>The account the invitation is forwarded to must have admin privileges on the shared calendar to reply to the invitation.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts Forwarding</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">Example</dt>
<dd>
<p>To create a calendar nested under the "Calendar Name" folder:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m user1 cf -V appointment &quot;/Calendar Name/Sub Calendar&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_troubleshooting_calendar_appointment_problems">Troubleshooting Calendar Appointment Problems</h4>
<div class="paragraph">
<p>Use the <code>zmcalchk</code> command to check for discrepancy between different users' calendars for the same meeting, and send an email notification regarding the discrepancies.</p>
</div>
<div class="paragraph">
<p>You can also use this command to notify the organizer and/or all attendees when an appointment is out of sync.</p>
</div>
</div>
<div class="sect3">
<h4 id="_changing_remote_calendar_update_interval">Changing Remote Calendar Update Interval</h4>
<div class="paragraph">
<p>Remote calendars are updated every 12 hours, by default.
The frequency can be modified at the Admin Console.</p>
</div>
<div class="paragraph">
<p>To modify the frequency of calendar updates in the Admin Console go to the desired COS or Account <strong>Advanced</strong> page, <strong>Data Source &#8594; Calendar polling interval</strong> field.</p>
</div>
</div>
<div class="sect3">
<h4 id="_disabling_attendee_edits_to_appointments">Disabling Attendee Edits to Appointments</h4>
<div class="paragraph">
<p>Attendees can edit appointments in their calendars, but their changes do not affect anyone else.
If the appointment organizer makes changes, these changes overwrite the attendees edits.
You can modify the COS attribute <code>zimbraPrefCalendarApptAllowAtendeeEdit</code> to prevent attendees from editing appointments in their calendar.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;cosname&gt; zimbraPrefCalendarApptAllowAtendeeEdit FALSE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_other_user_calendar_preferences">Setting Other User Calendar Preferences</h4>
<div class="paragraph">
<p>Users can modify the Calendar preferences listed in the Calendar Preference table.
You can set the default behavior in the COS or Accounts Preferences page.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Calendar Preference</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time zone</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Time zone displayed in the user&#8217;s Preferences.
See <a href="#setting_default_time_zone">Setting Default Time Zone</a>.
If the time zone is configured in the COS, the time zone configured in the domain is ignored.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of minutes before an appointment to show reminder</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sets the minutes before the meeting to send a reminder notice.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial calendar view</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sets the default view.
Options are Day, Work Week, 7-Day Week, Month, List, or Schedule.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">First day of the week</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Sets the default first day of a user&#8217;s work week.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default appointment visibility</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Options are Public or Private.
Sets the default visibility options on the new appointment page.</p>
</div>
<div class="paragraph">
<p>The default is Public, appointments details can be viewed by others.</p>
</div>
<div class="paragraph">
<p>When the default is Private, all incoming calendar invites are marked as private on the user&#8217;s calendar and details are hidden when the calendar is shared.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use iCal delegation model for shared calendars for CalDAV</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Apple iCal can be configured to access users' calendars using the CalDAV protocol.
When enabled, shared calendars are displayed in users' iCal account&#8217;s Delegation tab and they can delegate access to their calendars.</p>
</div>
<div class="paragraph">
<p>For automatic polling, the polling interval can be set up in the COS or Account <strong>Advanced</strong> page, <strong>Data Source &#8594; CalDAV polling interval</strong> field.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable past due reminders</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users log into the Web Client, the reminder notifications for the last two weeks pop up for meeting reminders that were not dismissed.
When this is disabled, Zimbra Collaboration silently dismisses the old reminders.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable toaster notification for new calendar events</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A popup displays in the Web Client when new calendar events are received.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow sending cancellation email to organizer</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When users receive an invitation they cannot attend at the scheduled time, they have the option to click <strong>Propose New Time</strong> and select another time.
The meeting organizer receives an email with the proposed time.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically add invites with PUBLISH method</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>A calendar invitation email should have <code>method=REQUEST</code> in the calendar object but some third-party email clients incorrectly set <code>method=PUBLISH</code>.
These emails are not processed as invitations by default.
You can relax the rules by enabling this option.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically add forwarded invites to calendar</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Invites that have been forwarded to users are automatically added to the forwarded recipient&#8217;s calendar.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flash browser title on appointment reminder</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When appointment reminders pop up, the browser flashes until the user closes the pop-up.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable audible appointment notification</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When an appointment reminder pops up, users can be notified by a beep on their computer.
Users must have either QuickTime or Windows Media installed.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto-decline invites from users who are denied from inviting this user</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can configure who can send them calendar invites.
When enabled, an auto-reply message is sent to those users to let them know they do not have permission to invite the user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically add appointments when invited</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, appointments are automatically added to user&#8217;s Primary calendar.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show declined meetings</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, declined appointments display on the Web Client calendar in a faded view.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notify of changes made via delegated access</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users that delegated their calendar are notified of changes made to an appointment by a delegated access grantee.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always show the mini-calendar</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The mini-calendar automatically displays in the Calendar view.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the QuickAdd dialog when creating new appointments</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When is enabled, the QuickAdd dialog displays when users double-click or drag on the calendar in the Zimbra Web Client.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show time zone list in appointment view</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When enabled, a time zones list displays in the event editor along with event time, giving them the opportunity to change time zones while making appointments.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_setting_up_zimbra_tasks">Setting Up Zimbra Tasks</h4>
<div class="paragraph">
<p>Zimbra Tasks lets users create to-do lists and manage tasks through to completion.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
To allow users to share their Task lists, enable Sharing in the Features page.
Task lists can be shared with individuals, groups, and the public.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable or disable the Tasks feature:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Features</strong><br>
<strong>Home &#8594; Manage &#8594; Accounts &#8594; <em>account</em> &#8594; Features</strong></p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_web_client_user_interface_themes">Zimbra Web Client User Interface Themes</h3>
<div class="paragraph">
<p>The appearance of the Zimbra Web Client user interface can be changed.
A number of Zimbra themes are included with ZCS, and you can create others.
You can select a theme to be the default and the themes that users can select to customize their user experience.
To develop themes, see <a href="#color_and_logo_management">Color and Logo Management</a>.</p>
</div>
<div class="paragraph">
<p>The following theme usage options can be configured either from COS or by individual accounts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Limit users to one theme</strong></p>
<div class="paragraph">
<p>On the Features page, remove the check mark from <strong>Change UI Themes</strong>.  The Web Client theme is the theme listed in Current UI theme field on the Themes page.</p>
</div>
</li>
<li>
<p><strong>Let users access any of the installed Zimbra themes</strong></p>
<div class="paragraph">
<p>If the <strong>Change UI Themes</strong> is checked, users can access any of the themes that are listed in the Available UI themes list.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="two_factor_auth">Two Factor Authentication</h3>
<div class="paragraph">
<p>The Two Factor Authentication (2FA) function allows you to configure a secondary set of security requirements that may be applicable to any or all critical mailboxes or users in the environment.
You can set 2FA for user accounts and/or class of service.</p>
</div>
<div class="sect3">
<h4 id="_2fa_for_new_user_account">2FA for New User Account</h4>
<div class="paragraph">
<p>In the Wizard setup for a new user account, you will find settings for 2FA with other <strong>Advanced</strong> options.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 3 Add Accounts &#8594; 1. Add Account</strong><br>
&#8201;&#8212;&#8201;<em>Next</em> until <strong>Advanced</strong>, scroll down to <strong>Two Factor Authentication</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/User_NewAcct_2FASettings.png" alt="New Account Two Factor Authentication">
</div>
</div>
<div class="paragraph">
<p>See <a href="#two_factor_authentication_parameters">Two Factor Authentication Parameters</a>
for parameter descriptions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2fa_for_existing_user_account">2FA for Existing User Account</h4>
<div class="paragraph">
<p>For an existing user account, you can apply 2FA settings from the <strong>Advanced</strong> options.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Manage &#8594; Accounts</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Locate the <strong>Two Factor Authentication</strong> container within the editable configurations for an account:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select an <em>account</em> from the list of accounts.</p>
</li>
<li>
<p>Select <strong>Edit</strong> from the <strong>Gear</strong> icon.</p>
<div class="paragraph">
<p>&#8201;&#8212;&#8201; The <strong>General Information</strong> for the <em>account</em> is now displayed.</p>
</div>
</li>
<li>
<p>Select <strong>Advanced</strong> from the left panel.</p>
</li>
<li>
<p>Scroll down to the <strong>Two Factor Authentication</strong> container in the main panel.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="images/User_EditAcct_2FASettings.png" alt="Edit Account Two Factor Authentication">
</div>
</div>
<div class="paragraph">
<p>See <a href="#two_factor_authentication_parameters">Two Factor Authentication Parameters</a>
for parameter descriptions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_2fa_for_class_of_service">2FA for Class of Service</h4>
<div class="paragraph">
<p>Parameters you can use to set up 2FA for a Class of Service are included with other Advanced features.</p>
</div>
<div class="paragraph">
<p>To apply 2FA to a class of service, use the <strong>Two Factor Authentication</strong>
container to set parameters.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Advanced &#8594; Two Factor Authentication</strong></p>
</dd>
</dl>
</div>
<div class="imageblock">
<div class="content">
<img src="images/COS_2FAContainer.png" alt="Class of Service Two Factor Authentication">
</div>
</div>
<div class="paragraph">
<p>See <a href="#two_factor_authentication_parameters">Two Factor Authentication Parameters</a>
for parameter descriptions.</p>
</div>
<table id="two_factor_authentication_parameters" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. Two Factor Authentication Parameters</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameters</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable two factor authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable (check) or disable (un-check) this function for the selected COS account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require two-step authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable (check) or disable (un-check) mandatory use of this function for the selected COS account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of one-time codes to generate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value to assign maximum number of 6-digit passcodes that may be viewed/used by the account when attempting to access the system.
The passcode is presented to the account once the initial login credentials are accepted.</p>
<p class="tableblock">Each passcode has a 15-second life cycle.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable application passcodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Users can generate exception codes for legacy applications that do not support two-factor authentication.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_other_configuration_settings_for_accounts">Other Configuration Settings for Accounts</h3>
<div class="sect3">
<h4 id="_enable_sharing">Enable Sharing</h4>
<div class="paragraph">
<p>When the Sharing feature is enabled, users can share any of their folders, including their mail folders, calendars, address books, task lists, and Briefcase folders.</p>
</div>
<div class="paragraph">
<p>A users specifies the type of access permissions to give the grantee.
They can share with internal users who can be given complete manager access, external guests who must use a password to view the folder content, as well as public access so that anyone who has the URL can view the folder&#8217;s content.</p>
</div>
<div class="paragraph">
<p>When internal users share a mail folder, a copy of the shared folder is put in the grantee&#8217;s folder list on the Overview pane.
Users can manage their shared folders from their Web Client Preferences Sharing page.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configure_sms_notification">Configure SMS Notification</h4>
<div class="paragraph">
<p>The Web Client <strong>Preferences &#8594; Notification</strong> page lets users configure an email address or SMS alert to their mobile device to receive a reminder message for a task or a meeting on their calendar.
Notification by SMS is disabled by default.</p>
</div>
<div class="paragraph">
<p>SMS notification can be configured by domain, COS or for individual accounts.
SMS notification set in a COS overrides SMS notifications set on a domain.
In the Administration Console, this is set on the domain, COS or account&#8217;s Feature page.</p>
</div>
<div class="paragraph">
<p>Users select a region and a carrier when setting up their SMS alert.
The list of SMS/email gateways is in <strong>ZmSMS.properties</strong>.
You can customize this list to add SMS/email gateways that are not listed.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configure_attachment_viewing">Configure Attachment Viewing</h4>
<div class="paragraph">
<p>You can set attachment viewing rules as a global setting, by COS, or for a specific account.
The global setting takes precedence over COS and account Settings.
You can select from four options.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 41. Attachment Viewing Features</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Feature Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">COS/Account Tabs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable attachment viewing from web mail UI</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Attachments cannot be viewed.
This can also be set as a global setting.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attachments can be viewed in HTML only</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Attachments received in another format are opened in HTML view.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attachments can be viewed in their original format only</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Users might not be able to open attachments that require a specific application that is not on their computer.
</td>
</tr>
</table>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attachments can be viewed in HTML and their original format</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Users can select to open either in the original format or as HTML.</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Advanced</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_display_a_warning_when_users_try_to_navigate_away">Display a Warning When Users Try to Navigate Away</h4>
<div class="paragraph">
<p>Users can click the Back and Forward arrows in the browser, or close their browser without logging out of their account.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If this preference is checked, users are asked to confirm that they want to navigate away from their account.</p>
</li>
<li>
<p>If this preference is not checked, the question is not asked.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_the_check_box_for_the_web_client">Enabling the Check Box for the Web Client</h4>
<div class="paragraph">
<p>If <strong>Show selection checkbox for selecting email, contact, voicemail items in a list view for batch operations</strong> is enabled, when users view email messages,contacts, and tasks lists in the Content pane, a check box displays for each item.
Users can select items and then perform an action such as mark as read/unread, move to a specific folder, drag and drop to a folder, delete, and tag for all those selected items.</p>
</div>
</div>
<div class="sect3">
<h4 id="_preferences_importexport">Preferences Import/Export</h4>
<div class="paragraph">
<p>From the <strong>Preferences Import/Export</strong> page in the Web Client users may export all of their account data, including mail, contacts, calendar, and tasks.
By selecting export options, they can export specific items in their account and save the data to their computer.</p>
</div>
<div class="paragraph">
<p>The account data is saved as a tar-gzipped (<code>.tgz</code>) archive file so that it can be imported to restore their account.
Individual contacts are saved as <code>.csv</code> files, and individual calendar files are saved as <code>.ics</code> files.
The data are copied, not removed from the user&#8217;s account.</p>
</div>
<div class="paragraph">
<p>The exported account data file can be viewed with an archive program such as <em>WinZip</em>.
Any of these files can be imported into their account from the same page.</p>
</div>
<div class="paragraph">
<p>You can turn the Import/Export feature off from the <strong>COS</strong> or <strong>Account Features</strong> page, <strong>General Features</strong> section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_words_to_spell_dictionary">Adding Words to Spell Dictionary</h4>
<div class="paragraph">
<p>If Web Client users frequently use words, abbreviations or acronyms that are marked as spelling errors during a Web Client spell check, you can update the COS or domain attribute <code>zimbraPrefSpellIgnoreWord</code> with the words that should be ignored when spell check is run.</p>
</div>
<div class="paragraph">
<p>To configure words to ignore for a domain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md example.com +zimbraPrefSpellIgnoreWord &lt;word&gt; +zimbraPrefSpellIgnoreWord &lt;word2&gt;</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hierarchical_address_book">Hierarchical Address Book (HAB) in Zimbra</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_a_hab">What is a HAB?</h3>
<div class="paragraph">
<p>The hierarchical address book (HAB) allows users to look for recipients in their address book using organizational hierarchy. Typically, users only see the default global address list (GAL) whose structure doesn&#8217;t help understand who reports to whom or to identify one John Doe from another. Being able to customize a HAB, which maps to your organization&#8217;s unique business structure, provides your users with an efficient method for locating internal recipients.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_hierarchical_address_book">Using Hierarchical Address Book</h3>
<div class="paragraph">
<p>In a Hierarchical Address Book (HAB), your root organization (e.g., Zimbra) is the top-level tier. Under this top-level tier, you can add several child tiers to create a customized HAB that is segmented by division, department, or any other organizational level you want to specify. The following figure illustrates a HAB for Zimbra with the following structure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The top-level tier represents the root organization&#8201;&#8212;&#8201;Zimbra.</p>
</li>
<li>
<p>The second-level child tiers represent the business divisions within Zimbra — Corporate Office, Engineering, Product Support, and Sales &amp; Marketing.</p>
</li>
<li>
<p>The third-level child tiers represent departments within the Corporate Office division — Human Resources, Accounts, and Administration.</p>
</li>
</ul>
</div>
<div id="ExampleHierarchy" class="imageblock">
<div class="content">
<img src="images/HABHierarchy.png" alt="HABHierarchy">
</div>
<div class="title">Figure 1. Example Hierarchy</div>
</div>
</div>
<div class="sect2">
<h3 id="SeniorityIndex">Seniority Index</h3>
<div class="paragraph">
<p><strong>Seniority Index</strong> provides an additional level in the hierarchy. When creating a HAB, use this parameter to rank individuals or organizational groups by seniority within these organizational tiers. This ranking specifies the order in which HAB displays recipients or groups. A higher seniority index ensures that a user or group appears above another with a lower seniority index.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>100</code> for Vice President</p>
</li>
<li>
<p><code>50</code> for Administration Operations Manager</p>
</li>
<li>
<p><code>25</code> for Business Administrator</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the <strong>Seniority Index</strong> parameter isn&#8217;t set or is equal for two or more users, the HAB sorting order lists the users and groups in ascending alphabetical order.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_hierarchical_address_books">Configuring hierarchical address books</h3>
<div class="sect3">
<h4 id="CreateOU">Create an organizational unit (OU)</h4>
<div class="sect4">
<h5 id="_format">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABOrgUnit &lt;domain name of OU&gt; &lt;OU Name&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example">Example</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABOrgUnit example.com ZimbraOU</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_explanation">Explanation</h5>
<div class="paragraph">
<p><em>ZimbraOU</em> as an organizational unit created.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="createHABGroup">Create groups within this OU</h4>
<div class="paragraph">
<p>You have to create a group and assign an email address for each department.</p>
</div>
<div class="sect4">
<h5 id="_format_2">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup &lt;name of the group&gt; &lt;name of OU&gt; &lt;group email address&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_2">Example</h5>
<div class="paragraph">
<p>In this series of commands, we create <strong>8</strong> HAB groups&#8201;&#8212;&#8201;as per the <a href="#ExampleHierarchy">Example Hierarchy</a>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup Zimbra ZimbraOU zimbra@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup CorporateOffice ZimbraOU CorpOffice@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup Engineering ZimbraOU eng@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup ProdSupport ZimbraOU prodsupport@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup SalesAndMarketing ZimbraOU sales-mark@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup HumanResources ZimbraOU hr@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup Accounts ZimbraOU accounts@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov createHABGroup Administration ZimbraOU administration@example.com</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CreateHierarchy">Create Hierarchy</h4>
<div class="paragraph">
<p>Each of these groups (except Zimbra) needs to be assigned a parent group to create a hierarchy.</p>
</div>
<div class="sect4">
<h5 id="_format_3">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember ParentGroupEmailAddress ChildGroupEmailAddress</pre>
</div>
</div>
<div class="paragraph">
<p>In this series of commands, we designate <strong>7</strong> HAB groups&#8201;&#8212;&#8201;except Zimbra because it is root&#8201;&#8212;&#8201;as per the hierarchy in the figure <a href="#ExampleHierarchy">Example Hierarchy</a>.</p>
</div>
<div class="paragraph">
<p>For this, we add <strong>Human Resources</strong>, <strong>Accounts</strong>, and <strong>Administration</strong> to <strong>Corporate Office</strong>; and add <strong>Corporate Office</strong>, <strong>Engineering</strong>, <strong>Product Support</strong>, and <strong>Sales &amp; Marketing</strong> to <strong>Zimbra</strong>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember CorpOffice@example.com hr@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember CorpOffice@example.com accounts@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember CorpOffice@example.com administration@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember zimbra@example.com CorpOffice@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember zimbra@example.com eng@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember zimbra@example.com prodsupport@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember zimbra@example.com sales-mark@example.com</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="GetZimbraId">Get Zimbra ID</h4>
<div class="paragraph">
<p><code>zimbraId</code> is a unique identifier associated with an email address. It is used to <a href="#AddUsers">assign users to groups</a> and to <a href="#SpecifyRoot">specify a group as root</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
For this example, and everywhere else we have used a placeholder (xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx) for <code>zimbraId</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_format_4">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov gdl &lt;group email address&gt; zimbraId</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_3">Example</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov gdl zimbra@example.com zimbraId</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_output">Example Output</h5>
<div class="literalblock">
<div class="content">
<pre># distributionList zimbra@example.com memberCount=4
zimbraId: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_explanation_2">Explanation</h5>
<div class="paragraph">
<p><em>zimbra@example.com</em> is the email address of the group which is to become root.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="AddUsers">Add users to Groups</h4>
<div class="paragraph">
<p>This example adds the users <em>Jane Doe</em> and <em>John Smith</em> to the group named <em>CorporateOffice</em> without affecting other existing members.</p>
</div>
<div class="sect4">
<h5 id="_format_5">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember &lt;group email address&gt; &lt;user's email address&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_4">Example</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember hr@example.com jane.doe@example.com</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov addHABGroupMember accounts@example.com john.smith@example.com</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="CreateSortOrder">Set Sort Order</h4>
<div class="paragraph">
<p>Configure the sort order for groups in the HAB. Groups with higher seniority index appear above groups with lower seniority index.</p>
</div>
<div class="sect4">
<h5 id="_format_6">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyHABGroupSeniority &lt;zimbra ID&gt; &lt;seniority index&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_5">Example</h5>
<div class="paragraph">
<p>To have <em>Engineering</em> appear above <em>CorporateOffice</em>&#8201;&#8212;&#8201;irrespective of their names and alphabetical order, get <a href="#GetZimbraId">Zimbra ID</a>, decide on a number in place of <code>SeniorityIndexNumber</code>, and run the below command.</p>
</div>
<div class="paragraph">
<p>Assign <em>CorporateOffice</em> a seniority index of 90</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyHABGroupSeniority xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx 90</pre>
</div>
</div>
<div class="paragraph">
<p>Assign <em>Engineering</em> a seniority index of 100</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyHABGroupSeniority xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx 100</pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Commands used to set seniority index for groups also set <a href="#SeniorityIndex">Seniority Index</a> for users.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="SpecifyRoot">Specify the root organization for the HAB</h4>
<div class="paragraph">
<p>A group needs to be specified as root so that other groups can be added as child groups to comply with the organizational hierarchy. Run below command to make <em>zimbra@example.com</em> as root.</p>
</div>
<div class="sect4">
<h5 id="_format_7">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov md &lt;domain name&gt; zimbraHierarchicalAddressBookRoot &lt;ZimbraID of the group to be made root&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_6">Example</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov md 'example.com' zimbraHierarchicalAddressBookRoot xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_output_2">Example Output</h5>
<div class="literalblock">
<div class="content">
<pre># distributionList zimbra@example.com memberCount=4
zimbraId: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_did_it_work">Did it work?</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to Zimbra client.</p>
</li>
<li>
<p>Click <strong>New Message</strong>.</p>
</li>
<li>
<p>In the <strong>Compose</strong> window, click the <strong>To</strong> field.</p>
</li>
<li>
<p>On <strong>Select Addresses</strong> window, locate the <strong>Show Names from:</strong> drop-down on the top right corner.</p>
</li>
<li>
<p>Choose <strong>Organizational Address Book</strong>.</p>
</li>
<li>
<p>The address book in a hierarchical format appears in the left pane.</p>
<div class="imageblock">
<div class="content">
<img src="images/HABStructure-zimbra.png" alt="HABStructure zimbra">
</div>
</div>
</li>
<li>
<p>Click any group to view and select users of that group.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manage_organisational_units_ous">Manage Organisational Units (OUs)</h3>
<div class="sect3">
<h4 id="list-OU">List Organisational Units (OUs)</h4>
<div class="paragraph">
<p>There can be multiple organizational units in a domain. This command lists all the OUs in a specified domain.</p>
</div>
<div class="sect4">
<h5 id="_format_8">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov listHABOrgUnit &lt;domain name of OU&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_7">Example</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov listHABOrgUnit example.com ZimbraOU</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_explanation_3">Explanation</h5>
<div class="paragraph">
<p>All OUs in <em>example.com</em> listed.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="rename-OU">Rename Organisational Units (OUs)</h4>
<div class="paragraph">
<p>This command renames the specified OU in a domain.</p>
</div>
<div class="sect4">
<h5 id="_format_9">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov renameHABOrgUnit &lt;domain name of OU&gt; &lt;OU Name&gt; &lt;New name for OU&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_8">Example</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov renameHABOrgUnit example.com ZimbraOU ZMXOU</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_explanation_4">Explanation</h5>
<div class="paragraph">
<p><em>ZimbraOU</em> renamed to <em>ZMXOU</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="delete-OU">Rename Organisational Units (OUs)</h4>
<div class="paragraph">
<p>This command deletes the specified OU in a domain.</p>
</div>
<div class="sect4">
<h5 id="_format_10">Format</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov renameHABOrgUnit &lt;domain name of OU&gt; &lt;OU Name&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_example_9">Example</h5>
<div class="literalblock">
<div class="content">
<pre>zmprov renameHABOrgUnit example.com ZimbraOU</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_explanation_5">Explanation</h5>
<div class="paragraph">
<p><em>ZimbraOU</em> deleted.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioning_user_accounts">Provisioning User Accounts</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When an account is provisioned, you create the mailbox, assign the primary
account email address, and assign a class of service (COS) to enable
Zimbra Collaboration applications and features.</p>
</div>
<div class="paragraph">
<p>You can configure one account at a time or migrate multiple existing
accounts from a server.</p>
</div>
<div class="sect2">
<h3 id="_creating_a_single_user_accounts">Creating a Single User Accounts</h3>
<div class="paragraph">
<p>Before adding a user account, determine which features and access
privileges should be assigned.  You can either assign a class of service
(COS) with the features enabled when you create the account or you can
configure the features for the individual accounts.  For a description of
the features, see
<a href="#class_of_service_and_accounts">Class of Service and Accounts</a>.</p>
</div>
<div class="paragraph">
<p>If the COS you assign has the correct functionality for the account, you do
not need to perform any additional configuration.</p>
</div>
<div class="paragraph">
<p>Creating an account sets up the appropriate entries on the Zimbra LDAP
directory server.  When the user logs in for the first time or when an
email is delivered to the user&#8217;s account, the mailbox is created on the
mailbox server.</p>
</div>
<div class="paragraph">
<p>Basic user account setup:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 3 Add Accounts &#8594; 1. Add Account</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Account Name</strong> section, enter the account name and the last
name as a minimum to configure the account.</p>
<div class="paragraph">
<p>The default COS is assigned to the account.</p>
</div>
</li>
<li>
<p>Click <strong>Finish</strong> to create the account.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can continue to configure features and functionality for the
individual account.  Changes you make to the account override the COS
that is assigned to the account.</p>
</div>
</div>
<div class="sect2">
<h3 id="_migrating_accounts_and_importing_account_email">Migrating Accounts and Importing Account Email</h3>
<div class="openblock">
<div class="content">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
ZCS Account Migration within the Zimbra Admin UI is no longer supported,
with End of Technical Guidance set for 17 December 2019.
We recommend <a href="https://zimbra.audriga.com/">Audriga&#8217;s self-service migration solution</a>
as a preferred alternative for all account migrations.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>You can provision multiple accounts at one time using the Account Migration
Wizard from the Administration Console.  You can import accounts from
either a generic IMAP server or from another ZCS server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only accounts on ZCS 7.2 or later can be migrated to ZCS 8.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also import account names to provision from an XML file that you
create.</p>
</div>
<div class="paragraph">
<p>You can run the migration wizard one time to provision accounts and import
data or you can run the migration wizard the first time to provision the
accounts and then run the wizard again to import the provisioned accounts'
data.</p>
</div>
<div class="paragraph">
<p>Whether you get the account records from an LDAP directory or use an XML
file, you need to set the password requirements for the newly provisioned
accounts.  The options are to have ZCS randomly create passwords for each
account or to set the same password on each account.  You have the option
to force users to change the password when they sign in the first time.</p>
</div>
<div class="paragraph">
<p>When the provisioning is complete, the wizard generates a <code>.csv</code> file with a
list of new accounts.  This includes the passwords that are generated.  You
should download this file for future reference.  Choose a secure location
to store the file as it can contain password information for the user
accounts you provisioned.</p>
</div>
<div class="paragraph">
<p>If you&#8217;re running a split-domain configuration, you can set the SMTP host and
port in the wizard.  For more information about split domains, see the wiki
article about split domains at <a href="https://wiki.zimbra.com/wiki/Split_Domain" class="bare">https://wiki.zimbra.com/wiki/Split_Domain</a>.</p>
</div>
<div class="sect3">
<h4 id="_migrating_accounts_from_a_zimbra_server">Migrating Accounts from a Zimbra Server</h4>
<div class="paragraph">
<p>To migrate accounts from a server running ZCS 7.2 or later to ZCS 8.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 3 Add Accounts &#8594; 3. Migration and Co-existence</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Type of mail server</strong> field, select <strong>Zimbra Collaboration.</strong></p>
</li>
<li>
<p>If you are provisioning accounts, select <strong>Yes</strong> to import the account&#8217;s
records.  If you are not going to import the data at this time, in the
<strong>Would you like to import mail</strong>, select <strong>No</strong>.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Overview</strong> dialog, Import from another Zimbra LDAP directory is
selected.  Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Bulk provisioning options</strong> page, select whether to generate
random passwords or to assign the same password for each account.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 42. Bulk Provisioning Features</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bulk Provisioning Feature</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate random password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you select Generate a random password for each account, set the length
for the password.  The password can be from 6 to 64 characters.</p>
<p class="tableblock">Default = 8 characters</p>
<p class="tableblock">If you select to generate a random password, you must download the <code>.csv</code>
file that is created so that you can give the password information to each
user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use same password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you select Use same password for all new accounts, enter the password to
use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require users to change password after first login</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is recommended that this is checked to force users to change their
passwords when they log on the first time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP Host / SMTP Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For split domain configurations, set the SMTP Host name and port.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Directory connection</strong> dialog enter the information to connect to
the server.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 43. Directory Connection Options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory Connection Options</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically create missing domains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enable this option to create a domain when an account is imported and the
domain they were on is not created.</p>
</div>
<div class="paragraph">
<p>If you do not enable this, accounts from domains that do not exist on the
server are not created.  Disabling this option makes it easy to import
accounts from specific domains that have been pre-created.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum records to fetch</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enter the maximum number of accounts to import at one time.  The default is
0, which means that no limits are set.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server name, LDAP URL, Port, and Use of SSL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>The LDAP URL is entered as: <code>ldap://&lt;ldapdirectory.example.com&gt;</code></p>
</li>
<li>
<p>The default port is 389, but you can change this.</p>
</li>
<li>
<p>Check SSL if this is used.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind DN</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Zimbra setting is in the field by default as
<code>uid=zimbra,cn=admins,cn=zimbra</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind password</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enter the password for the server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP filter</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In this field enter the LDAP search filter to run.  Here you can define
search criteria to collect the type of account information you want to
import.  The default filter in the field is (<strong>objectclass=zimbraAccount</strong>).
This filter includes the email address, the account ID, and attributes for
the account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP search base</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure the subsections of the LDAP forest to search.</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
<div class="paragraph">
<p>The <strong>Account Migration Wizard</strong> connects to the directory server and
generates a report showing the number of domains found; number of accounts
found on the server and how many of those accounts are already created on
ZCS.  This dialog also shows the password options you configured.</p>
</div>
</li>
<li>
<p>Review the report generated and then click <strong>Next</strong>.  The accounts are
provisioned on the Zimbra Collaboration server.</p>
</li>
<li>
<p>Download the <code>.csv</code> file that lists the provisioned accounts and their
passwords.  The <code>.csv</code> file is deleted when you close the wizard.  If you do
not download the file, you cannot access the report later.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_accounts_from_generic_imap_servers">Migrating Accounts from Generic IMAP Servers</h4>
<div class="paragraph">
<p>Use steps in this section to provision accounts on the Zimbra server.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 3 Add Accounts &#8594; 3. Migration and Co-existence</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Type of mail server</strong> field, select <strong>Generic IMAP Server</strong>.</p>
</li>
<li>
<p>If you are provisioning accounts, select <strong>Yes</strong> to import the account&#8217;s
records.  If you are not going to import the data at this time, in the
Would you like to import mail, select <strong>No</strong>.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Overview</strong> dialog, Import from another LDAP directory is
selected.  Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Bulk provisioning options</strong> page, select whether to generate
random passwords or to assign the same password for each account.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 44. Bulk Provisioning Features</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Bulk Provisioning Feature</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate random password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you select Generate a random password for each account, set the length
for the password.  The password can be from 6 to 64 characters.</p>
<p class="tableblock">Default = 8 characters</p>
<p class="tableblock">If you select to generate a random password, you must download the <code>.csv</code>
file that is created so that you can give the password information to each
user.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use same password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you select Use same password for all new accounts, enter the password to
use.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Require users to change password after first login</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is recommended that this is checked to force users to change their
passwords when they log on the first time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP Host / SMTP Port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For split domain configurations, set the SMTPHost name and port.</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Directory connection</strong> dialog enter the information to connect to
the server.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 45. Directory Connection Options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Directory Connection Options</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Automatically create missing domains</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enable this option to create a domain when an account is imported and the
domain they were on is not created.</p>
</div>
<div class="paragraph">
<p>If you do not enable this, accounts from domains that do not exist on the
server are not created.  Disabling this option makes it easy to import
accounts from specific domains that have been pre-created.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum records to fetch</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enter the maximum number of accounts to import at one time.  The default is
0, which means that no limits are set.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server name, LDAP URL, Port, and Use of SSL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>The LDAP URL is entered as: <code>ldap://&lt;ldapdirectory.example.com&gt;</code></p>
</li>
<li>
<p>The default port is 389, but you can change this.</p>
</li>
<li>
<p>Check SSL if this is used.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind DN</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Zimbra setting is in the field by default as
<code>uid=zimbra,cn=admins,cn=zimbra</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bind password</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enter the password for the server.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP filter</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>In this field enter the LDAP search filter to run.  Here you can define
search criteria to collect the type of account information you want to
import.  The default filter in the field is (<strong>objectclass=zimbraAccount</strong>).
This filter includes the email address, the account ID, and attributes for
the account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP search base</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Configure the subsections of the LDAP forest to search.</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
<div class="paragraph">
<p>The Migration Wizard connects to the directory server and generates a
report showing the number of domains found; number of accounts found on the
server and how many of those accounts are already created on ZCS.  This
dialog also shows the password options you configured.</p>
</div>
</li>
<li>
<p>Review the report generated and then click <strong>Next</strong>.  The accounts are
provisioned on the Zimbra Collaboration server.</p>
</li>
<li>
<p>Download the <code>.csv</code> file that lists the provisioned accounts and their
passwords.  The <code>.csv</code> file is deleted when you close the wizard.  If you do
not download the file, you cannot access the report later.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_accounts_using_an_xml_file">Migrating Accounts using an XML File</h4>
<div class="paragraph">
<p>Use steps in this section to create an XML file with the account
information and save it to a computer you can access.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 3 Add Accounts &#8594; 3. Migration and Co-existence</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Type of mail server</strong> field, select the type of server your are
migrating from.</p>
</li>
<li>
<p>If you are provisioning accounts, select <strong>Yes</strong> to import the account&#8217;s
records.  If you are not going to import the data at this time, in the
Would you like to import mail, select <strong>No</strong>.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Overview</strong> dialog, select <strong>Import from an XML</strong> file.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>The <strong>Review</strong> options dialog displays the number of domains; number of
accounts and the password options configured in the XML file.</p>
</li>
<li>
<p>If this information is correct, click <strong>Next</strong>.  If this information is not
correct, fix your XML file before proceeding.</p>
<div class="paragraph">
<p>If you clicked <strong>Next</strong>, the accounts are provisioned on the Zimbra Collaboration
server.</p>
</div>
</li>
<li>
<p>Download the <code>.csv</code> file that lists the provisioned accounts and their
passwords.  The <code>.csv</code> file is deleted when you close the wizard.  If you do
not download the file, you cannot access the report later.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_importing_email_for_selected_accounts">Importing Email for Selected Accounts</h4>
<div class="paragraph">
<p>Use steps in this section to specify the list of accounts whose mail you
want to import by either selecting the accounts to import data or by using
an XML file to select the accounts.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ensure that accounts are provisioned on the ZCS server before attempting
this procedure.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; 3 Add Accounts &#8594; 3. Migration and Co-existence</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Type of mail server</strong> field, select the type of server your are
importing the data from.</p>
</li>
<li>
<p>In the <strong>Would you like to import account records</strong> menu, select <strong>No</strong>.</p>
</li>
<li>
<p>In the <strong>Would you like to import mail menu</strong>, select <strong>Yes</strong>.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>On the <strong>Import options</strong> dialog box, select which way you are going to
specify the accounts whose mail is being imported.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
<div class="paragraph">
<p>If you are selecting accounts, go to step 7.  If you are using an XML
file go to step 9.</p>
</div>
</li>
<li>
<p>If you are selecting the accounts to import, on the Selected Accounts
dialog box, search for the accounts to add.  You can search by domain or
user name.  If you click Search without entering text, all accounts are
returned.</p>
<div class="paragraph">
<p>Add the accounts to the <strong>Accounts for data import</strong> column.</p>
</div>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>If you are using an XML file with the accounts listed, browse to the
XML file to use.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>In the IMAP Connection details dialog box, enter the information
necessary to connect to the exporting server&#8217;s IMAP, this includes the
IMAP host name, port and administrator login information.</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>Review the data import options.  If the information is correct, click
<strong>Next</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_xml_file_examples">XML File Examples</h4>
<div class="paragraph">
<p>This section contains three examples of the XML file structure to
provision accounts and import data.</p>
</div>
<div class="exampleblock">
<div class="title">Example 7. Using an XML file to provision accounts</div>
<div class="content">
<div class="paragraph">
<p>The following example shows an XML file that is used to provision multiple
email accounts without importing mail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;ZCSImport&gt;</span>
<span class="tag">&lt;ImportUsers&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Sample<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Sam<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Sam Sample<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>ssample@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;password&gt;</span>test123<span class="tag">&lt;/password&gt;</span>
<span class="tag">&lt;zimbraPasswordMustChange&gt;</span>TRUE<span class="tag">&lt;/zimbraPasswordMustChange&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Zackry<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Zak<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Zak Zackry<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>zzackry@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;password&gt;</span>test123<span class="tag">&lt;/password&gt;</span>
<span class="tag">&lt;zimbraPasswordMustChange&gt;</span>TRUE<span class="tag">&lt;/zimbraPasswordMustChange&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;/ImportUsers&gt;</span>
<span class="tag">&lt;/ZCSImport&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 8. Using an XML file to provision accounts from externally hosted domains</div>
<div class="content">
<div class="paragraph">
<p>The following example shows an XML file that is used to provision multiple
email accounts for externally hosted domain without importing mail.</p>
</div>
<div class="paragraph">
<p>In this example, the <code>zimbraMailTransport</code> attribute of newly provisioned
accounts will be set to point to external SMTP server instead of the ZCS
server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;ZCSImport&gt;</span>
<span class="tag">&lt;SMTPHost&gt;</span>smtp.example.com<span class="tag">&lt;/SMTPHost&gt;</span>
<span class="tag">&lt;SMTPPort&gt;</span>25<span class="tag">&lt;/SMTPPort&gt;</span>
<span class="tag">&lt;ImportUsers&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Sample<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Sam<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Sam Sample<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>sam@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Zackry<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Zak<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Zak Zackry<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>zzackry@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;/ImportUsers&gt;</span>
<span class="tag">&lt;/ZCSImport&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 9. Using an XML file to import email</div>
<div class="content">
<div class="paragraph">
<p>The following example shows an XML file that is used to import email for
one account via IMAP from a gmail account without provisioning the email
account in ZCS.  The account must be provisioned on ZCS before running this
type of XML file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;ZCSImport&gt;</span>
<span class="tag">&lt;IMAPHost&gt;</span>imap.gmail.com<span class="tag">&lt;/IMAPHost&gt;</span>
<span class="tag">&lt;IMAPPort&gt;</span>993<span class="tag">&lt;/IMAPPort&gt;</span>
<span class="tag">&lt;ConnectionType&gt;</span>ssl<span class="tag">&lt;/ConnectionType&gt;</span>
<span class="tag">&lt;UseAdminLogin&gt;</span>0<span class="tag">&lt;/UseAdminLogin&gt;</span>
<span class="tag">&lt;ImportUsers&gt;</span>
<span class="tag">&lt;User&gt;</span>
<span class="tag">&lt;sn&gt;</span>Sample<span class="tag">&lt;/sn&gt;</span>
<span class="tag">&lt;givenName&gt;</span>Sam<span class="tag">&lt;/givenName&gt;</span>
<span class="tag">&lt;displayName&gt;</span>Sam Sample<span class="tag">&lt;/displayName&gt;</span>
<span class="tag">&lt;RemoteEmailAddress&gt;</span>sam@example.com<span class="tag">&lt;/RemoteEmailAddress&gt;</span>
<span class="tag">&lt;RemoteIMAPLogin&gt;</span>sam@example.com<span class="tag">&lt;/RemoteIMAPLogin&gt;</span>
<span class="tag">&lt;remoteIMAPPassword&gt;</span>test123<span class="tag">&lt;/remoteIMAPPassword&gt;</span>
<span class="tag">&lt;/User&gt;</span>
<span class="tag">&lt;/ImportUsers&gt;</span>
<span class="tag">&lt;/ZCSImport&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_auto_provisioning_new_accounts_from_external_ldap">Auto Provisioning New Accounts from External LDAP</h3>
<div class="paragraph">
<p>Auto provisioning of new accounts from external LDAP is supported via the
CLI.  This section describes the supported CLI attributes and auto
provisioning methods.</p>
</div>
<div class="sect3">
<h4 id="_overview_4">Overview</h4>
<div class="paragraph">
<p>When an external LDAP authentication mechanism - such as external LDAP
authentication, preauth, or SPNEGO - is configured for a ZCS domain, you
can set up ZCS to automatically create user accounts on ZCS.  Primary email
address and account attributes are mapped from an external directory. You
can configure how and when new accounts should be created from the external
directory data.</p>
</div>
<div class="paragraph">
<p>Three modes are supported for auto-provisioning configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Mode</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Eager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ZCS polls the external directory for accounts to auto provision.  For this
mode, you configure how often the external directory is polled for new
users, the maximum number of users to process at each interval, and which
domains are scheduled for account auto provision on specified servers.</p>
<p class="tableblock">Guidelines are provided in
<a href="#eager_mode_configuration">Eager Mode Configuration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lazy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If a user logs into the Web Client the first time through one of the authentication
mechanisms supported for auto provisioning, and if the user does not exist
in the ZCS directory, a new account is automatically created in ZCS for
this user.</p>
<p class="tableblock">Guidelines are provided in
<a href="#lazy_mode_configuration">Lazy Mode Configuration</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manual</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auto provisioning does not occurs: instead, the administrator manually
searches from the configured external auto-provisioning LDAP source and
selects an entry from the search result to create the corresponding Zimbra
account for the external entry.</p>
<p class="tableblock">Guidelines are provided in
<a href="#manual_mode_configuration">Manual Mode Configuration</a>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When an account is created, the account name (consisting of the characters
alongside the @ symbol) is mapped from a user attribute on the external
directory that you define in <code>zimbraAutoProvAccountNameMap</code>.  Other account
information, such as first and last name, phone numbers, and address, is
populated from the attributes mapped from the external directory based on
<code>zimbraAutoProvAttrMap</code>.  You can review the external directory&#8217;s
attributes to determine those that should be mapped to a Zimbra attribute.</p>
</div>
<div class="paragraph">
<p>The COS assignment for auto-provisioned accounts is identical to the way
that COS is determined for manually provisioned accounts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If a COS is defined for the domain, this COS is assigned to the accounts
that are created.</p>
</li>
<li>
<p>If a domain COS is not defined, the ZCS default COS is assigned.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can configure a <strong>Welcome</strong> email message to be sent to newly created
accounts.  The subject and body of this email can be configured with
<code>AutoProvNotification</code> attributes on the domain.</p>
</div>
</div>
<div class="sect3">
<h4 id="_auto_provisioning_attributes">Auto-Provisioning Attributes</h4>
<div class="paragraph">
<p>The attributes listed in this section can be used with the <code>zmprov</code> command
to configure auto provisioning of new accounts with an external LDAP
directory.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>zimbraAutoProvMode</code></dt>
<dd>
<p>Set auto provision mode as either EAGER, LAZY, and/or MANUAL.
Multiple auto-provisioning modes can be enabled on a domain.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvAuthMech</code></dt>
<dd>
<p>Set type of authentication mechanism - as either LDAP, PREAUTH, KRB5,
or SPNEGO - to enable for LAZY mode.  Once a user authenticates via
the specified authentication mechanism, and if the user account does
not yet exist in the Zimbra directory, an account will be
automatically created in the Zimbra directory.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapURL</code></dt>
<dd>
<p>Set the LDAP URL of the external LDAP source for auto provisioning</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapStartTlsEnabled</code></dt>
<dd>
<p>Enable (TRUE) or disable (FALSE) the StartTLS protocol when accessing
the external LDAP server for auto provisioning.<br>
Default = FALSE.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapAdminBindDn</code></dt>
<dd>
<p>Defines the LDAP search bind DN for auto provisioning.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapAdminBindPassword</code></dt>
<dd>
<p>Set the LDAP search admin bind password for auto provisioning.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapSearchBase</code></dt>
<dd>
<p>Set the LDAP search base for auto provisioning, used in conjunction
with zimbra <code>zimbraAutoProvLdapSearchFilter</code>.<br>
If not set, LDAP root DSE will be used.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapSearchFilter</code></dt>
<dd>
<p>Defines the LDAP search filter template for account auto provisioning.
For LAZY mode, either <code>zimbraAutoProvLdapSearchFilter</code> or
<code>zimbraAutoProvLdapBindDn</code> must be set.</p>
<div class="paragraph">
<p>If both are set, <code>zimbraAutoProvLdapSearchFilter</code> will take precedence.
See <a href="#auto_provisioning_placeholders">Placeholders</a> for supported
placeholders.</p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvLdapBindDn</code></dt>
<dd>
<p>Defines the LDAP external DN template for account auto provisioning.
For LAZY mode, either <code>zimbraAutoProvLdapSearchFilter</code> or
<code>zimbraAutoProvLdapBindDn</code> must be set.</p>
<div class="paragraph">
<p>If both are set, <code>zimbraAutoProvLdapSearchFilter</code> will take
precedence.  See <a href="#auto_provisioning_placeholders">Placeholders</a> for
supported placeholders.</p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvAccountNameMap</code></dt>
<dd>
<p>Defines the attribute name in the external directory that contains
local part of the account name.  This is the name used to create the
Zimbra account.  If this is not specified, the local part of the
account name is the principal user used to authenticated to Zimbra.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvAttrMap</code></dt>
<dd>
<p>Defines the attribute map for mapping attribute values from the
external entry to Zimbra account attributes.  Values are in the format
of <code>{external attribute}={zimbra attribute}</code>.  If this is not set, no
attributes from the external directory are populated in Zimbra
account.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Invalid mapping configuration will cause the account creation to fail.
Bad mapping may be due to conditions such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invalid external attribute name.</p>
</li>
<li>
<p>Invalid Zimbra attribute name.</p>
</li>
<li>
<p>External attribute contains multiple values; the Zimbra attribute
contains only a single value.</p>
</li>
<li>
<p>Syntax violation (such as external attribute=string, but Zimbra
attribute=integer).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvNotificationFromAddress</code></dt>
<dd>
<p>Defines the email address to put in the <strong>From</strong> header for the Welcome
email sent to the newly created account.  If not set, no notification
email is sent to the newly created account.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvNotificationSubject</code></dt>
<dd>
<p>Template used to construct the subject of the notification message
sent to the user when the user&#8217;s account is auto provisioned.</p>
<div class="paragraph">
<p>Supported variables: <code>${ACCOUNT_ADDRESS}</code>, <code>${ACCOUNT_DISPLAY_NAME}</code></p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvNotificationBody</code></dt>
<dd>
<p>Template used to construct the body of the notification message
sent to the user when the user&#8217;s account is auto provisioned.</p>
<div class="paragraph">
<p>Supported variables: <code>${ACCOUNT_ADDRESS}</code>, <code>${ACCOUNT_DISPLAY_NAME}</code></p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvListenerClass</code></dt>
<dd>
<p>Domain setting to define the class name of auto provision listener.
The class must implement the
<code>com.zimbra.cs.account.Account.AutoProvisionListener</code> interface.  The
singleton listener instance is invoked after each account is auto
created in Zimbra.  Listener can be plugged in as a server
extension to handle tasks like updating the account auto provision
status in the external LDAP directory.</p>
<div class="paragraph">
<p>At each eager provision interval, ZCS does an LDAP search
based on the value configured in <code>zimbraAutoProvLdapSearchFilter</code>.
Returned entries from this search are candidates to be auto
provisioned in this batch.  The <code>zimbraAutoProvLdapSearchFilter</code>
should include an assertion that will only hit entries in the external
directory that have not yet been provisioned in ZCS,
otherwise it&#8217;s likely the same entries will be repeated pulled in to
ZCS.  After an account is auto provisioned in
ZCS,
<code>com.zimbra.cs.account.Account.AutoProvisionListener.postCreate
(Domain domain, Account acct, String external DN)</code> will be called by
the auto provisioning framework.  Customer can implement the
AutoProvisionListener interface in a ZCS server extension
and get their <code>AutoProvisionListener.postCreate()</code> get called.  The
implementation of customer&#8217;s post Create method can be, for example,
setting an attribute in the external directory on the account just
provisioned in ZCS.  The attribute can be included as a
condition in the <code>zimbraAutoProvLdapSearchFilter</code>, so the entry won&#8217;t
be returned again by the LDAP search in the next interval.</p>
</div>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvBatchSize</code></dt>
<dd>
<p>Domain | Global setting to define the maximum number of accounts to
process in each interval for EAGER auto provision.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvScheduledDomains</code></dt>
<dd>
<p>Server attribute that lists the domains scheduled for EAGER auto
provision on this server.  Scheduled domains must have EAGER mode
enabled in <code>zimbraAutoProvMode</code>.  Multiple domains can be scheduled on
a server for EAGER auto provision.  Also, a domain can be scheduled on
multiple servers for EAGER auto provision.</p>
</dd>
<dt class="hdlist1"><code>zimbraAutoProvPollingInterval</code></dt>
<dd>
<p>Domain | Global setting to define the interval between successive
polling and provisioning accounts in EAGER mode.  The actual interval
might take longer since it can be affected by two other factors:
<code>zimbraAutoProvBatchSize</code> and number of domains configured in
<code>zimbraAutoProvScheduledDomains</code>.</p>
<div class="paragraph">
<p>At each interval, the auto provision thread iterates through all
domains in <code>zimbraAutoProvScheduledDomains</code> and auto creates accounts
up to <code>domain.zimbraAutoProvBatchSize</code>.  If that process takes longer
than <code>zimbraAutoProvPollingInterval</code> than the next iteration starts
immediately instead of waiting for <code>zimbraAutoProvPollingInterval</code>
amount of time.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If set to 0 when server starts up, the auto provision thread will not
start.</p>
</li>
<li>
<p>If changed from a non-0 value to 0 while server is running, the auto
provision thread will be shutdown.</p>
</li>
<li>
<p>If changed from 0 to a non-0 value while server is running, the auto
provision thread will be started.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="auto_provisioning_placeholders">Placeholders</h4>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 46. Placeholders for use with auto provisioning attributes</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tag</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%/n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User name and the @ symbol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This returns <em>user1@example.com</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User name without the @ symbol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This returns <em>user1</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%d</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This returns <em>example.com</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">%D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain as dc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This returns <em>example,dc=com</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="eager_mode_configuration">Eager Mode Configuration</h4>
<div class="paragraph">
<p>With Eager mode, ZCS polls the external directory for accounts to auto
provision.  You configure how often the external directory is polled for
new users, the maximum number of users to process at each interval, and the
domains to be scheduled for account auto-provisioning on specified servers.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the ZCS server as zimbra and type <code>zmprov</code> at the command
prompt.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov</code></pre>
</div>
</div>
</li>
<li>
<p>Enable EAGER mode on the domain.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvMode EAGER</code></pre>
</div>
</div>
</li>
<li>
<p>Set the maximum number of accounts to process in each interval</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvBatchSize &lt;#&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the interval (in minutes) between polling and provisioning of
accounts.  This must be set to a non-0 value for the auto provisioning
thread to start. Default = 15 minutes.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ms &lt;server.com&gt; zimbraAutoProvPollingInterval &lt;x minutes&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Select the domains to be scheduled for auto provisioning.  Multiple
domains can be scheduled on the server.</p>
<div class="paragraph">
<p>A domain can be scheduled on multiple servers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ms &lt;server.com&gt; +zimbraAutoProvScheduledDomains &lt;domain1.com&gt; \
  +zimbraAutoProvScheduledDomains &lt;domain2.com&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the external LDAP settings:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>LDAP URL</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapURL &quot;ldap://xxx.xxx.xxx.xxx:&lt;port&gt;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The LDAP port is typically 389.</p>
</div>
</li>
<li>
<p>(Optional) Enable StartTls.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapStartTlsEnabled TRUE</code></pre>
</div>
</div>
</li>
<li>
<p>LDAP admin bind DN for auto provision:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapAdminBindDn &quot;cn=admin, dc=autoprov, dc=company, dc=com&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>Administrator&#8217;s LDAP search bind password for auto provision.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapAdminBindPassword &lt;password&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Search template to use when searching for users to auto provision.</p>
<div class="paragraph">
<p>Example using the LDAP search filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapSearchFilter &quot;(uid=&lt;%placeholder&gt;)&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="#auto_provisioning_placeholders">Placeholders</a> for supported
placeholders.</p>
</div>
</li>
<li>
<p>LDAP search base for auto provisioning</p>
<div class="paragraph">
<p>This is the location in the directory from which the LDAP search begins.
This is used with <code>zimbraAutoProvLdapSearchFilter</code>.  If this is not set, the
LDAP directory root, <code>rootDSE</code>, is the starting point.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapSearchBase &quot;dc=autoprov,dc=company,dc=com&quot;
md &lt;example.com&gt; zimbraAutoProvLdapBindDn &lt;&quot;placeholder1&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="#auto_provisioning_placeholders">Placeholders</a> for supported
placeholders.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>(Optional) Define the attribute name that is mapped to the local part of
the account name on the external directory.  This is used to define the
account name on ZCS.  If this is not specified, the local part of the
account name is the principal user name used to authenticate to ZCS.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvAccountNameMap &lt;value&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional) Map the attribute values from the external entry to the ZCS
account attributes.  If this is not set up, no attributes from the external
directory are populated in the ZCS directory.  The value is mapped in the
form of <code>{external attribute}={zimbra attribute}</code>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Invalid mapping configuration will cause the account creating to fail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To map the "sn" value on the external entry to "displayName" on the
Zimbra account and map description value on the external entry to
description on the ZCS account, type</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; +zimbraAutoProvAttrMap sn=displayName +zimbraAutoProvAttrMap description=description</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional) If you want to send a Welcome email to new accounts, enter the
<em>from</em> address of the originator.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvNotificationFromAddress &lt;name@example.com&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>To exit zmprov, type</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">exit</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_lazy_mode_configuration">Lazy Mode Configuration</h4>
<div class="paragraph">
<p>Lazy mode auto provisioning automatically creates a new account after a
user authenticates from an external authentication mechanisms (LDAP,
preauth, Kerberos 5, and/or SPNEGO).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the ZCS server as zimbra and type <code>zmprov</code> at the command
prompt.</p>
</li>
<li>
<p>Enable LAZY mode,</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvMode LAZY</code></pre>
</div>
</div>
</li>
<li>
<p>Select the external authentication mechanism for the LAZY mode: LDAP,
PREAUTH, KRB5, SPNEGO.  You can specify multiple authentication mechanisms.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvAuthMech &lt;type&gt; +zimbraAutoProvAuthMech &lt;type2&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the external LDAP settings</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>LDAP URL:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapURL &quot;ldap://xxx.xxx.xxx.xxx:&lt;port&gt;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The LDAP port is usually 389.</p>
</div>
</li>
<li>
<p>(Optional) Enable StartTls</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapStartTlsEnabled TRUE</code></pre>
</div>
</div>
</li>
<li>
<p>LDAP Admin bind DN for auto provision in the format
<code>cn=&lt;LDAPadmin_name&gt;, dc=autoprov, dc=&lt;company_name&gt;, dc=&lt;com&gt;</code></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapAdminBindDn &lt;&quot;bindDN&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, <code>"cn=admin, dc=autoprov, dc=company, dc=com"</code></p>
</div>
</li>
<li>
<p>Administrator&#8217;s LDAP search bind password for auto provision.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapAdminBindPassword &lt;password&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional) Search template to use when searching for users to auto
provision.</p>
<div class="paragraph">
<p>Example: using LDAP search filter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapSearchFilter &lt;&quot;placeholder&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="#auto_provisioning_placeholders">Placeholders</a> for supported
placeholders.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
zimbraAutoProvLdapSearchFilter or zimbraAutoProvLdapBindDn MUST be
configured for LAZY mode.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>LDAP search base for auto provision.
This is the location in the directory from which the LDAP search begins.
This is used with <code>zimbraAutoProvLdapSearchFilter</code>.  If this is not set,
the LDAP directory root, <code>rootDSE</code>, is the starting point.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapSearchBase &lt;&quot;location&quot;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, <code>"dc=autoprov,dc=company,dc-com"</code></p>
</div>
</li>
<li>
<p>(Optional) Define the LDAP external DN template for account
provisioning.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvLdapBindDn &quot;uid=%&lt;placeholder1&gt;, %&lt;placeholder2&gt;&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Refer to <a href="#auto_provisioning_placeholders">Placeholders</a> for supported
placeholders.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>(Optional) Identify the attribute name on the external entry that
contains the local part of the account name to be provisioned in ZCS.  If
this is not specified, the local part of the account name is the principal
user used to authenticate to ZCS.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvAccountNameMap &lt;value&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional) Map the attribute values from the external entry to the ZCS
account attributes.  If this is not set up, no attributes from the external
directory are populated in the ZCS directory.  Value is in the form of
<code>{external attribute}={zimbra attribute}</code>.</p>
<div class="paragraph">
<p>To map the <strong>sn</strong> value on the external entry to <strong>displayName</strong> on the Zimbra
account and map description value on the external entry to description on
the ZCS account, type as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; +zimbraAutoProvAttrMap sn=displayName +zimbraAutoProvAttrMap description=description</code></pre>
</div>
</div>
</li>
<li>
<p>(Optional)  If you want to send a <strong>Welcome</strong> email to new accounts, enter
the <em>from</em> address of the originator.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvNotificationFromAddress &lt;name@example.com&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Exit zmprov, type <code>exit</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_manual_mode_configuration">Manual Mode Configuration</h4>
<div class="paragraph">
<p>Use the Manual Mode setting to disable auto provisioning with an external
LDAP server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log in to the ZCS server as zimbra and type <code>zmprov</code> at the
command prompt.</p>
</li>
<li>
<p>Enable MANUAL mode:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">md &lt;example.com&gt; zimbraAutoProvMode MANUAL</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_resources">Managing Resources</h3>
<div class="paragraph">
<p>A resource is a location or equipment that can be scheduled for a meeting.
Each meeting room location and other non-location specific resources such as AV equipment is set up as a resource account.
The <strong>Manage &#8594; Resources</strong> section in the Administration Console shows all resources that are configured for Zimbra Collaboration.</p>
</div>
<div class="paragraph">
<p>User accounts with the Calendar feature can select these resources for
their meetings.  The resource accounts automatically accept or reject
invitations based on availability.</p>
</div>
<div class="paragraph">
<p>Administrators do not need to monitor these mailboxes on a regular basis.
The contents of the resource mailboxes are purged according to the mail
purge policies.</p>
</div>
<div class="paragraph">
<p>A Resource Wizard guides you through the resource configuration.  You can
configure the account with the following details about the resource:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Type of resource, either location or equipment</p>
</li>
<li>
<p>Scheduling policy</p>
</li>
<li>
<p>Forwarding address to receive a copy of the invite</p>
</li>
<li>
<p>Description of the resource</p>
</li>
<li>
<p>Contact information, which can be a person to contact if there are issues</p>
</li>
<li>
<p>Location information, including room name, specific building location
including building and address, and room capacity</p>
</li>
<li>
<p>Customize auto response message and signatures to be used in the reply
email messages</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When you create a resource account, a directory account is created in the
LDAP server.</p>
</div>
<div class="paragraph">
<p>To schedule a resource, users invite the equipment resource and/or location
to a meeting.  When they select the resource, they can view the description
of the resource, contact information and free/busy status for the resource,
if these are set up.</p>
</div>
<div class="paragraph">
<p>When the meeting invite is sent, an email is sent to the resource account,
and, based on the scheduling policy, if the resource is free the meeting is
automatically entered in the resource&#8217;s calendar and the resource is shown
as Busy.</p>
</div>
<div class="sect3">
<h4 id="_set_up_the_scheduling_policy">Set Up the Scheduling Policy</h4>
<div class="paragraph">
<p>The scheduling policy establishes how the resource&#8217;s calendar is
maintained.  The following resource scheduling values can be set up:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Auto decline all recurring appointments</strong>&#8201;&#8212;&#8201;This value is enabled when
the resource can be scheduled for only one meeting at a time.  No recurring
appointments can be scheduled for this resource.</p>
</li>
<li>
<p><strong>Auto accept if available, auto-decline on conflict</strong>&#8201;&#8212;&#8201;When this option
is selected, the resource account automatically accepts appointments unless
the resource is already scheduled.  The free/busy times can be viewed.  You
can modify the auto-decline rule to accept some meetings that conflict.</p>
</li>
<li>
<p><strong>Manual accept, auto decline on conflict</strong>&#8201;&#8212;&#8201;When this option is selected,
the resource account automatically declines all appointments that conflict.
Appointment requests that do not conflict are marked as tentative in the
resource calendar and must be manually accepted.  If you set this up,
configure the forwarding address so a copy of the invite is sent to the
account that can manually accept the invitation.  You can modify the
auto-decline rule to accept some meetings that conflict.</p>
</li>
<li>
<p><strong>Auto accept always</strong>&#8201;&#8212;&#8201;The resource account automatically accepts
all appointments that are scheduled.  In this case, free/busy information is
not maintained, thus more than one meeting could schedule the resource at
the same time.  Because the resource always accepts the invitation, the
suggested use for this policy would be for a frequently used location off
premises that you want the location address to be included in the invite to
attendees.</p>
</li>
<li>
<p><strong>No auto accept or decline</strong>&#8201;&#8212;&#8201;The resource account is manually managed.
A delegated user must log into the resource account and accept or decline
all requests.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Conflict Rules</strong>&#8201;&#8212;&#8201;For accounts that include the auto decline on conflict
value, you can set up a threshold, either as a number of conflicts or as a
percentage of all the recurring appointments to partially accept recurring
appointments.</p>
</div>
<div class="paragraph">
<p><strong>Maximum allowed number of conflicts</strong> and/or <strong>Maximum allowed percent of
conflicts</strong> are configured to allow a recurring resource to be scheduled
even if it is not available for all the requested recurring appointment
dates.</p>
</div>
<div class="paragraph">
<p>The resource accepts appointments even if there are conflicts until either
the number of conflicts reaches the maximum allowed or the maximum
percentage of conflicts allowed.  In order for partial acceptance of a
series to work, both fields must be set to nonzero values.</p>
</div>
<div class="sect4">
<h5 id="_manage_resource_accounts">Manage Resource Accounts</h5>
<div class="paragraph">
<p>You can log on to the resource account and set preferences for the
resource.  The <strong>Resource Accounts Preference &#8594; Calendar</strong> can be configured
to let users manage the Resource&#8217;s Calendar.  You can configure the
following options to manage the resource.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An address to forward invites.  If the forwarding address was set up when
the account was provisioned, you can change the address</p>
</li>
<li>
<p>Who can use this resource.  In the Permissions section, Invites, select
<strong>Allow only the following internal users to invite me to meetings</strong> and add
the appropriate users' email addresses to the list.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can share the resource calendar with a user and give the user Manager
rights.  Users delegated as Manager have full administrative rights for
that calendar.  They can view, edit, add, remove, accept or decline the
invites.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_managing_user_accounts">Managing User Accounts</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_status_of_user_accounts">Status of User Accounts</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Manage &#8594; Accounts</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The status of an account determines whether a user can log in and receive mail.
The account status is displayed on the <strong>Accounts</strong> pane of the Administration Console.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 47. Status - User Accounts</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Status</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The normal state for a mailbox account.
Mail is delivered and users can log in to the client interface.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maintenance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logging is disabled and any mail addressed to this account is queued at the MTA.</p>
<p class="tableblock">Note that this state is automatically set for the account during a backup or when importing/exporting/ restoring the account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pending</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assignment for an account when it is created but not yet ready to become active.
While pending, the login is disabled and messages are bounced.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Locked</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user cannot log in but mail continues to be delivered to the account.
The locked state can be set if you suspect that a mail account has been compromised (used in an unauthorized manner).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Closed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login is disabled and messaged are bounced.
This status is used to soft-delete the account before deleting it from the server.
A closed account does not change the account license.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">LockOut</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The automatic state that occurs if the user attempts to log in with an incorrect password.
A LockOut cannot be administratively assigned but will occur after the number of user attempts exceeds the configured number of attempts allowed.
The duration of the lockout is also configurable.</p>
<p class="tableblock">The administrator can remove the locked out status at any time.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_deleting_an_account">Deleting an Account</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Manage &#8594; Accounts</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can delete accounts from the Administration Console.
This removes the account from the server, deletes the messages in the message store, and changes the number of accounts used against your license.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Before you delete an account, run a full backup of that account to save the account information.
See also <a href="#backup_and_restore">Backup and Restore</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_an_accounts_mailbox">Viewing an Accounts Mailbox</h3>
<div class="paragraph">
<p>You can view a selected account’s mailbox content, including all folders, calendar entries, and tags from the Administration Console.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Manage &#8594; Accounts &#8594; <em>account</em></strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Select an <em>account</em>, from the <strong>Gear</strong> icon select <strong>View Mail</strong>.  The user&#8217;s Zimbra account opens in a new browser window.</p>
</div>
<div class="paragraph">
<p>This feature can be used to assist users who are having trouble with their mail account as you and the account user can be logged on to the account at the same time.</p>
</div>
<div class="paragraph">
<p>Any View Mail action to access an account is logged to the <code>audit.log</code>
file.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_an_email_alias">Using an Email Alias</h3>
<div class="paragraph">
<p>An email alias is an email address that redirects all mail to a specified mail account.
An alias is not an email account.
Each account can have unlimited numbers of aliases.</p>
</div>
<div class="paragraph">
<p>When you select Aliases from the Manage Aliases navigation pane, all aliases that are configured are displayed in the content pane.
You can create an alias, view the account information for a specific alias, move the alias from one account to another, and delete the alias.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_distribution_lists">Working with Distribution Lists</h3>
<div class="paragraph">
<p>A distribution list is a group of email addresses contained in a list with a common email address.
When users send to a distribution list, they are sending the message to everyone whose address is included in the list.
The address line displays the distribution list address; the individual recipient addresses cannot be viewed.</p>
</div>
<div class="paragraph">
<p>You can create distribution lists that require an administrator to manage the member list and you can create dynamic distribution lists that automatically manages adding and deleting members in the list.
For more information about dynamic distribution lists, see
<a href="#using_dynamic_distribution_lists">Using Dynamic Distribution Lists</a>.</p>
</div>
<div class="paragraph">
<p>You can see which distribution lists a user is a member of from the user&#8217;s account "Member of" page.
When a Zimbra user&#8217;s email address is added to a distribution list, the user&#8217;s account Member Of page is updated with the distribution list name.
When a distribution list is deleted, the distribution list name is automatically removed from the account&#8217;s "Member Of" page.</p>
</div>
<div class="sect3">
<h4 id="_setting_subscription_policies_for_distribution_lists">Setting Subscription Policies for Distribution Lists</h4>
<div class="paragraph">
<p>Subscription policies can be set up to manage a distribution list&#8217;s membership.
Owners of the list manage the subscription policy from the Properties page of a distribution list.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Distribution Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">New Subscription Requests</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>Automatically accept</strong>&#8201;&#8212;&#8201;Membership is open to anyone who subscribes.</p>
</li>
<li>
<p><strong>Require list owner approval</strong>&#8201;&#8212;&#8201; To subscribe, users send an email to the owner of the distribution list and the owner replies to this email request.</p>
</li>
<li>
<p><strong>Automatically reject</strong>&#8201;&#8212;&#8201;No one can be added to this distribution list.</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsubscription Requests</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p><strong>Automatically accept</strong>&#8201;&#8212;&#8201; Anyone can remove their name from the list.</p>
</li>
<li>
<p><strong>Require list owner approval</strong>&#8201;&#8212;&#8201;To be removed from the distribution list, users send an email to the owner.
The owner must accept the email request to remove the name.</p>
</li>
<li>
<p><strong>Automatically reject</strong>&#8201;&#8212;&#8201;Users cannot remove themselves from the list.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_management_options_for_owners_of_distribution_lists">Management Options for Owners of Distribution Lists</h4>
<div class="paragraph">
<p>You can add owners to distribution lists and they manage the list from their Zimbra account&#8217;s Address Book, Distribution List folder.
Owners of a list can right-click a distribution list and click the <strong>Edit Group</strong> link to edit a list.</p>
</div>
<div class="paragraph">
<p>Besides adding and deleting members, distribution list properties that owners can configure include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Marking the list as private so it is hidden in the Global Address List</p>
</li>
<li>
<p>Managing who can send messages to the list</p>
</li>
<li>
<p>Setting a member subscription policy</p>
</li>
<li>
<p>Adding additional owners</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_distribution_list">Creating a Distribution List</h4>
<div class="paragraph">
<p>Use steps in this section to create a distribution list:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Manage &#8594; Distribution Lists</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>Gear</strong> icon, click <strong>New</strong>.</p>
</li>
<li>
<p>On the <strong>Members</strong> page, add the distribution list name.
Do not use spaces.
The other fields are optional.</p>
</li>
<li>
<p>Find members to add to the distribution list in the right column.
Select the members to add and click <strong>Add Selected</strong>.  If you want to add all addresses on the page, click <strong>Add This Page</strong>.  If you want to add members that are not in the company list, in the <strong>Or enter addresses below</strong> section, type a complete mail address.</p>
</li>
<li>
<p>Click <strong>Next</strong> to configure the <strong>Properties</strong> page.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 48. Distribution Properties Options</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Distribution Properties Options</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can receive mail</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enabled by default.
If this distribution list should not receive mail select this box.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hide in GAL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enable to create distribution lists that do not display in the Global Address List (GAL).  You can use this feature to limit the exposure of the distribution list to only those that know the address.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail Server</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This is set to auto by default.
To select a specific mail server, uncheck <strong>auto</strong> and select a specific server from the list.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Group</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>If you check this box, the <strong>Member URL</strong> field displays and you create a dynamic distribution list.</p>
</div>
<div class="paragraph">
<p>See <a href="#create_dynamic_distribution_lists">Create Dynamic Distribution Lists</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">New Subscription Requests</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatically accept</p>
</li>
<li>
<p>Require list owner approval</p>
</li>
<li>
<p>Automatically reject</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsubscription Requests</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select from:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Automatically accept</p>
</li>
<li>
<p>Require list owner approval</p>
</li>
<li>
<p>Automatically reject</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>In the <strong>Members Of</strong> page, select distribution lists that should be direct or indirect members of the list.</p>
</li>
<li>
<p>If the distribution list should have an alias, create it.</p>
</li>
<li>
<p>If this distribution list can be managed by other users, enter these email addresses in the <strong>Owners</strong> page.</p>
</li>
<li>
<p>Set how messages received to the distribution list should be replied to.</p>
</li>
<li>
<p>Click <strong>Finish</strong>.  The distribution list is enabled and the URL is created.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_managing_access_to_distribution_lists">Managing Access to Distribution Lists</h4>
<div class="paragraph">
<p>After a distribution list is created, you can manage who can view members of a distribution list and who can send messages to a distribution list.
The default is all users have access to all distribution lists.
This section describes how to use the CLI to manage access.</p>
</div>
<div class="paragraph">
<p>To limit who can access distribution lists, grant rights to individual users on a domain or if you want only members of a domain to access distribution lists, you can grant rights on the domain.
When you grant the right on the domain, all distribution lists on the domain inherit the grant.</p>
</div>
<div class="paragraph">
<p>You can grant the right on individual distribution lists and configure specific users that are allowed to access the distribution list.</p>
</div>
<div class="paragraph">
<p>You can restrict access to a distribution list from the CLI <code>zmprov grantRight</code> (<code>grr</code>) command.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more information about how granting rights works, see <a href="#delegated_administration">Delegated Administration</a>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_who_can_view_members_of_a_distribution_list">Who Can View Members of a Distribution List</h5>
<div class="paragraph">
<p>The default is that all users can view members addresses in a distribution list.
A distribution list address displays a <strong>+</strong> in the address bubble.
Users can click on this to expand the distribution list.
A list of the addresses in the distribution list is displayed.
Users can select individual addresses from the expanded list.</p>
</div>
<div class="paragraph">
<p>Restricting who can view addresses in a distribution list to individuals or to a domain:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>For individual users:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr domain &lt;domain_name&gt; usr &lt;user1@example.com&gt; viewDistList</code></pre>
</div>
</div>
</li>
<li>
<p>For all users in a domain:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr domain &lt;domain_name&gt; dom &lt;example.com&gt; viewDistList</code></pre>
</div>
</div>
</li>
<li>
<p>To grant rights on a distribution list and let specific users view the
list:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dll_name@example.com&gt; usr &lt;user1@example.com&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_who_can_send_to_a_distribution_list">Who Can Send to a Distribution List</h5>
<div class="paragraph">
<p>The default is that all users can send messages to all distribution lists.
You can grant rights to a distribution list or to a domain that defines who can send messages to a distribution list.
When users attempt to send to a distribution list that they are not authorized to use, a message is sent stating that they are not authorized to send messages to the recipient distribution list.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <strong>Milter Server</strong> must be enabled from <strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA</strong>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Restricting who can send messages to a distribution list to individuals or to a domain:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Granting rights to an individual user in a domain to send messages to all distribution lists.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr domain &lt;domain_name&gt; usr &lt;user1@example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>Granting rights to all users in a domain to send messages to all distribution lists.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr domain &lt;domain_name&gt; dom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Restricting access and to remove the restriction to individual distribution lists for different user types.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access to specific internal users:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; usr &lt;username@example.com&gt; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>Revoke access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; usr &lt;username@example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>Access only to members of the distribution list:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; grp &lt;dlname2@example.com&gt; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>Revoke access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; grp &lt;dlname2@example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>Access only to all users in a domain:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; dom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>Revoke access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; dom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>Access only to all users in an external domain:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; edom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>Revoke access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; edom &lt;example.com&gt; sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>Access only to internal users:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; all sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>Revoke access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; all sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>Access only to all public email addresses:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; pub sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>Revoke access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; pub sendToDistList</code></pre>
</div>
</div>
</li>
<li>
<p>Access only to specific external email address:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov grr dl &lt;dlname@example.com&gt; gst &lt;someone@foo.com&gt; &quot;&quot; sendToDistList</code></pre>
</div>
</div>
<div class="paragraph">
<p>Revoke access</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rvr dl &lt;dlname@example.com&gt; gst &lt;someone@foo.com&gt; &quot;&quot; sendToDistList</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_enabling_view_of_distribution_list_members_for_ad_accounts">Enabling View of Distribution List Members for AD Accounts</h5>
<div class="paragraph">
<p>To view Active Directory distribution list members in messages or in the address book, the GAL group handler for Active Directory must be configured in the ZCS GALsync account for each Active Directory.</p>
</div>
<div class="paragraph">
<p>Use steps in this section to update the GALsync account for each Active Directory.
This configuration requires that you know the GALsync account name and all data sources on that GALsync account.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Display the Zimbra ID of the GAL sync account:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gd {domain} zimbraGalAccountId</code></pre>
</div>
</div>
<div class="paragraph">
<p>To find the name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ga {zimbraId-of-the-GAL-sync-account} name</code></pre>
</div>
</div>
</li>
<li>
<p>Display data sources for the GALsync account:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gds {gal-sync-account-name-for-the-domain}</code></pre>
</div>
</div>
</li>
<li>
<p>Enable the group handler for the Active Directory:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mds {gal-sync-account-name-for-the-domain} {AD-data-source-name} \
 zimbraGalLdapGroupHandlerClass com.zimbra.cs.gal.ADGalGroupHandler</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="using_dynamic_distribution_lists">Using Dynamic Distribution Lists</h3>
<div class="paragraph">
<p>Dynamic distribution lists automatically manage their membership.
Users are added and removed from the distribution list automatically.
When you create a dynamic distribution list, a member URL is specified.
This member URL is used to identify who should be members of the list.
You can view this URL from the Administration Console distribution list&#8217;s Properties page.</p>
</div>
<div class="paragraph">
<p>You can create dynamic distribution lists from the Administration Console or from the CLI.
In the URL, you specify specific object classes that identify the type of users to be added to the dynamic distribution list.
For example, you can configure a dynamic distribution list with the object class= zimbraAccount.
In this case, when accounts are provisioned or accounts are deleted, the dynamic distribution list is updated.</p>
</div>
<div class="paragraph">
<p>You can create dynamic distribution lists for all mobile users or POP/IMAP users.</p>
</div>
<div class="paragraph">
<p>You can modify a distribution list to change the filter rules.
When you modify a distribution list, the members in the list are changed to reflect the new rule.</p>
</div>
<div class="sect3">
<h4 id="create_dynamic_distribution_lists">Create Dynamic Distribution Lists</h4>
<div class="paragraph">
<p>You can create a dynamic distribution list with the admin console or with the CLI, as described in this section.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Manage &#8594; Distribution Lists</strong>.</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the <strong>Gear</strong> icon, click <strong>New</strong>.</p>
</li>
<li>
<p>On the <strong>Members</strong> page, add the dynamic distribution list name.
Do not use spaces.
Do not add members to the list.</p>
</li>
<li>
<p>Click <strong>Next</strong> to configure the <strong>Properties</strong> page.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 49. Dynamic Distribution Lists Options</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can receive mail</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enabled by default.
If this distribution list should not receive mail select this box.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hide in GAL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Enable to create distribution lists that do not display in the Global Address List (GAL).  You can use this feature to limit the exposure of the distribution list to only those that know the address.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail Server</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This is set to auto by default.
To select a specific mail server, uncheck <strong>auto</strong> and select a specific server from the list.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Group</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Check this box.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Can be used in right management</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Uncheck this box.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Member URL</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Member URL is an LDAP-type URL defining a filter that determines which users are added to and removed from the list.</p>
</div>
<div class="paragraph">
<p>Type the URL for this list.
In the command, <code>ldap://??sub?</code> is the URL.
You can add any combination of filters to this to create different types of dynamic distribution lists.</p>
</div>
<div class="exampleblock">
<div class="title">Example 10. All users, GAL account names, and spam/ham account list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>ldap:///??sub?(objectClass=zimbraAccount)</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 11. Delegated administrators list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>ldap:///??sub?(&amp;(objectClass=zimbraAccount)(zimbraIsDelegatedAdminAccount=TRUE))</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 12. All active accounts</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>ldap:///??sub?(&amp;(objectClass=zimbraAccount)(ZimbraAccountStatus=active))</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 13. All users with the title manager</div>
<div class="content">
<div class="paragraph">
<p>The title is taken from the account&#8217;s <strong>Contact Information Job Title</strong> field.
In this example, this field would be set to "Manager".</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ldap:///??sub?(&amp;(objectClass=zimbraAccount)(title=Manager))</pre>
</div>
</div>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">New Subscription Requests</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select <strong>Automatically reject</strong>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsubscription Requests</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Select <strong>Automatically reject</strong>.</p>
</div></div></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>If the dynamic distribution list should have an alias, create it.</p>
</li>
<li>
<p>If this dynamic distribution list can be managed by other users, enter these email addresses in the <strong>Owners</strong> page.</p>
</li>
<li>
<p>If you want to set up a reply to address, enter it here.
Any replies to this distribution list are sent to this address.</p>
</li>
<li>
<p>Click <strong>Finish</strong>.  The dynamic distribution list is created.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Users are added automatically to the list based on the filter you specified.
If you add or delete users, the list is updated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you use the CLI to modify a dynamic distribution list originally created on the Administration Console, you must set <code>zimbraIsACLGroup</code> <strong>FALSE</strong> for that dynamic distribution list.
</td>
</tr>
</table>
</div>
<hr>
<div class="paragraph">
<p>Use the CLI <code>zmprov</code> command to manage dynamic distribution lists.
In the command, <code>ldap:///??sub?</code> is the URL.
You can add any combination of filters to this to create different types of dynamic distribution lists.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Creating a dynamic distribution list of all new and existing accounts</p>
<div class="paragraph">
<p>All users, GAL account names, and spam/ham account names are included.
When user accounts are deleted, they are removed from the list.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cddl &lt;all@domain.com&gt; zimbraIsACLGroup FALSE \
  memberURL 'ldap:///??sub?(objectClass=zimbraAccount)'</code></pre>
</div>
</div>
</li>
<li>
<p>Creating a COS and Assign Users</p>
<div class="paragraph">
<p>If you create COSs and assign users to the COS based on specific criteria, such as all managers, you can quickly modify a dynamic distribution list to be used for a specific COS.</p>
</div>
<div class="exampleblock">
<div class="title">Example 14. A dynamic distribution list that includes all users that have active accounts in a specific COS</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cddl &lt;allusers@domain.com&gt;  zimbraIsACLGroup FALSE \
  memberURL 'ldap:///??sub?(&amp;(objectClass-zimbraAccount) (zimbraCOSId=513e02e-9abc-4acf-863a-6dccf38252e3) (zimbraAccountStatus=active))'</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 15. A dynamic distribution list that includes all users based on job titles</div>
<div class="content">
<div class="paragraph">
<p>To use this, the account&#8217;s Contact Information <strong>Job Title</strong> field must include the title.
In this example it would be set to "Manager".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cddl &lt;allmanagers@domain.com&gt; zimbraIsACLGroup FALSE' \
  memberURL ldap:///??sub?(&amp;(objectClass-zimbraAccount) (zimbraCOSId=513e02e-9abc-4acf-863a-6dccf38252e3) (title=Manager))'</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 16. A dynamic distribution list for all delegated administrators</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cddl &lt;alldelegatedadmins@domain.com&gt; zimbraIsACLGroup FALSE \
  memberURL 'ldap:///??sub?(&amp;(objectClass-zimbraAccount) (zimbraCOSId=513e02e-9abc-4acf-863a-6dccf38252e3) (zimbraIsDelegatedADminAccount=TRUE))'</code></pre>
</div>
</div>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_moving_a_mailbox">Moving a Mailbox</h3>
<div class="paragraph">
<p>Mailboxes can be moved between Zimbra servers that share the same LDAP server.</p>
</div>
<div class="paragraph">
<p>You can move a mailbox from either the Administration Console or use the CLI command <code>zmmboxmove</code> to reposition a mailbox from one server to another, without taking down the servers.</p>
</div>
<div class="paragraph">
<p>The destination server manages the mailbox move process.
The move runs in the background and the account remains in active mode until most of the data has been moved.
The account is locked briefly to move the last data and then returned to active mode.</p>
</div>
<div class="paragraph">
<p>The mailbox move process goes through the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mailbox blobs are moved to the new server</p>
</li>
<li>
<p>When most of the content has been moved, the account is put into maintenance mode</p>
</li>
<li>
<p>Database tables, index directories, and any changed blobs are moved</p>
</li>
<li>
<p>The account is put back into active mode</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>After the mailbox is moved to a new server, a copy still remains on the older server, but the status of the old mailbox is closed.
Users cannot log on and mail is not delivered.
Check to see that all the mailbox content was moved successfully before purging the old mailbox.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Moving a mailbox to a new server</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxmove -a &lt;email@address&gt; --from &lt;servername&gt; --to &lt;servername&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Purging the mailbox from the old server</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmpurgeoldmbox -a &lt;email@address&gt; -s &lt;servernamee&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_global_configuration_options_for_moving_mailboxes">Global Configuration Options for Moving Mailboxes</h4>
<div class="paragraph">
<p>Global configuration options for moving a mailbox can be set to exclude search indexes, blobs, and HSM blobs when mailboxes are moved.
The following configuration options can be set on either the exporting server or the destination server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraMailboxMoveSkipSearchIndex</code>&#8201;&#8212;&#8201;If you do not include the search index data, the mailbox will have to be reindexed after the move.</p>
</li>
<li>
<p><code>zimbraMailboxMoveSkipBlobs</code>&#8201;&#8212;&#8201;Blobs associated with the mailbox, including primary and secondary volumes (HSM) are excluded.</p>
</li>
<li>
<p><code>zimbraMailboxMoveSkipHsmBlobs</code>&#8201;&#8212;&#8201;This is useful when HSM blobs already exist for the mailbox being moved.
Set this if <code>zimbraMailboxMoveSkipBlobs</code> is not configured, but you want to skip blobs on HSM volumes.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="delegated_administration">Delegated Administration (*)</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Starting with Zimbra 8.8</strong>, there are two versions of this feature, Standard and New Generation (NG) versions.
Zimbra 8.7 and earlier included only the Standard version, which is explained below.
To use and enable the NG version of this feature with Zimbra 8.8 and later, refer to the specific NG chapter later in this Guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The global administrator can create different delegated administrator
roles.</p>
</div>
<div class="paragraph">
<p>Delegated administrator roles can be as simple as having the rights to
manage one or more distribution lists or reset forgotten passwords for one
or more users, to having domain administration rights on one or more
domains.</p>
</div>
<div class="paragraph">
<p>Two frequently used delegated administrator roles, domain administrator and
distribution list administrator, are already defined. You can add
administrators to these predefined roles with no other configuration
necessary.</p>
</div>
<div class="sect2">
<h3 id="_target_types_for_granting_administrative_rights">Target Types for Granting Administrative Rights</h3>
<div class="paragraph">
<p>Delegated administration provides a way to define access control limits on
targets and grant rights to administrators to perform tasks on the target.</p>
</div>
<div class="paragraph">
<p>A target is a Zimbra Collaboration object on which rights can be
granted. Each target is associated with a target type that identifies the
type of access control entries you can grant on the target.</p>
</div>
<div class="paragraph">
<p>When selecting a target type for a target consider the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Target. Which specific target are you granting rights? For example, if
the target type you select is "domain", which domain do you mean? You
specify a specific domain&#8217;s name (Target Name = example.com). Access
Control Entries (ACE) are granted on that target. An ACE is stored in an
LDAP attribute on the target entry.</p>
</li>
<li>
<p>Is the right you want to grant applicable to the selected target type?  A
right can only be applied on the relevant target type. For example,
creating an account can only apply to a domain target type, and the setting
passwords can only apply to accounts and calendar resources target
types. If a right is granted on a target that is not applicable to the
target, the grant is ignored.</p>
</li>
<li>
<p>When defining rights, you need to consider the scope of targets in which
granted rights are effective. For example, the right to set the password is
applicable only to accounts and calendar resources, but if this right is
included in the domain targets list of rights, it is effective for all
accounts or calendar resource in the domain.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 50. Targets for rights</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Description of Target Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An account entry (a specific user)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A calendar resource entry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS entry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Distribution List</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Includes the distribution list and all distribution lists under this
distribution list.</p>
<p class="tableblock">If the right is applicable to accounts and calendar resources, all accounts
and calendar resources that are direct or indirect members of this
distribution list.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Applicable to a specific domain, not to any sub-domains.</p>
<p class="tableblock">Sub-domains must be explicitly marked as targets.</p>
<p class="tableblock">When domain is the target, the rights are granted for all accounts,
calendar resources and distribution lists in the domain.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grants specific to global config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global ACL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Administrator rights for all entries in a target type. For example, you
could add an ACE to the Global Access Control List (ACL) that grants the
right to create accounts on domains.</p>
<p class="tableblock">Delegated administrator accounts that are granted this right can create
accounts in all domains in the system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server entry</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet entry</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_rights">Rights</h3>
<div class="paragraph">
<p>Rights are the functions that a delegated administrator can or cannot
perform on a named target. A right is either system-defined or granted
at the attribute level.</p>
</div>
<div class="sect3">
<h4 id="_system_defined_rights">System-defined rights</h4>
<div class="paragraph">
<p>Types of system defined rights include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Preset rights (<strong>preset</strong>). For example, <code>createAccount</code> creates an account;
<code>renameDomain</code>, renames the domain.</p>
<div class="paragraph">
<p>Preset rights are associated with a fixed target type. For example,
<code>createAccount</code> is a right only on a domain; <code>renameAccount</code> is a right on an
account; <code>getServer</code> is a right on a server</p>
</div>
<div class="paragraph">
<p>No other rights are required to administer that action on the target.</p>
</div>
<div class="paragraph">
<p>Preset rights could involve accessing multiple targets. The grantee
needs to have adequate rights on all pertinent targets. For example, to
create an alias for an account, the grantee must have rights to add an
alias to an account and to create an alias on a domain.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_attribute_right">Attribute Right</h4>
<div class="paragraph">
<p>Granting rights at the attribute level allow a delegated administrator/
administrator group to modify or view (or not modify or view) a specific
attribute on a target.</p>
</div>
<div class="paragraph">
<p>Types of attributes rights include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Attribute (<code>setAttrs</code>) rights allow the domain administrator to modify
and view an attribute value. For example, the <code>modifyAccount</code> right allows
the domain administrator to modify all attributes of the account.</p>
</li>
<li>
<p>Get attribute rights (<code>getAttrs</code>) let the domain administrator view an
attribute value. For example, the <code>getAccount</code> right shows all the attributes
for a user&#8217;s account.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The specific attribute being granted is configured on the target and the
type of permission, read (get) or write (set), is specified.</p>
</div>
<div class="paragraph">
<p>Attribute rights can be granted in any combination of attributes to grant
positive or negative rights. This lets you negate some attributes from a
grant.</p>
</div>
<div class="sect4">
<h5 id="_combo_rights">Combo Rights</h5>
<div class="paragraph">
<p>Combo rights can be assigned to any target type and can include preset
rights and attribute rights. You can use combo right to grant multiple
attribute rights quickly on targets.</p>
</div>
</div>
<div class="sect4">
<h5 id="_negative_rights">Negative Rights</h5>
<div class="paragraph">
<p>Rights can be either positive or negative. Negative rights are rights
specifically denied to a grantee.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a negative right is granted to an admin group, all administrators in
the group are denied that right for the target and sub-targets on which the
right is granted.</p>
</li>
<li>
<p>When a negative right is granted to an administrator who may or may not
be in an admin group, the specific administrator is denied that right for
the target and sub-targets on which the right is granted.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An admin group is granted domain administrator rights, including the right
to create accounts on Domain1. AdminA is in this admin group, but you want
AdminA to have all domain administrator rights, except the right to create
accounts. You would grant a negative <code>createAccount</code> right to AdminA on the
target Domain1.</p>
</div>
<div class="paragraph">
<p>For grants on the same level, negative rights always take precedence.  For
example, AdminGroup1 is granted a positive right to view accounts in a
domain; AdminGroup2 is granted a negative right to view accounts in the
same domain. AdminA is a member in both admin groups. AdminA cannot view
any account in this domain because the negative right takes precedence.</p>
</div>
<div class="paragraph">
<p>For grants on different levels, the most specific grant takes
precedence. For example, AdminA is granted the negative right to view
accounts in GroupDistributionList1, which User1 is a member. AdminA is also
granted the positive right to view account directly on User1&#8217;s account. In
this case, AdminA can view User1&#8217;s account as the grant on the account
target is more specific than the grant on the distribution list.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_rights_list">Using the Rights List</h4>
<div class="paragraph">
<p>System rights are listed and described in the Rights folder in the
Administration Console Overview pane. You can use the Rights folder to help
you define which system-defined rights to grant to delegated
administrators. This folder displays the name of the right, the target
types associated with that right, the right type and a brief description.</p>
</div>
<div class="paragraph">
<p>When you select a right on the page and click on it, another page displays
more information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For combo rights, a list of the rights associated with the combo right
are listed.</p>
</li>
<li>
<p>For the other system rights, a list of attributes associated with the
right are listed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use <code>zmprov</code> commands to view combo rights.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Direct sub-rights of a combo right</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gr adminConsoleDLRights</code></pre>
</div>
</div>
</li>
<li>
<p>Second level sub-rights of the combo</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gr adminConsoleDLRights -e</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Viewing System Defined Rights Lists</strong></p>
</div>
<div class="paragraph">
<p>You can use <code>zmprov</code> commands to view system defined rights for a specific
topic:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 51. Viewing Combo Rights with zmprov</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">To View This</th>
<th class="tableblock halign-left valign-top">Use This <code>zmprov</code> Command</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Account</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t account</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Calendar Resources</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t calresource</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>COS</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t cos</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Distribution List <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. All rights for account and calendar resources can also be granted on distribution list targets. When these rights are granted on a distribution list, the ACEs apply the right to all direct or indirect account or calendar resource members of the distribution list.
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t dl</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Domain</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t domain</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Global Config <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. All rights for accounts and calendar resources can also be granted on domain targets.  All rights for distribution list can also be granted on domain targets.  When rights are granted on a domain, the ACEs apply the right to all direct or indirect account calendar resources, and members of the distribution list in the domain.
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t config</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Global Grant <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. All rights for all other targets can also be granted on the global targets. When any rights are granted on a global grant entry, the ACEs apply the right to all entries on the system. For example, if you grant a createAccount (which is a domain right) to AdminA on the global grant entry, AdminA can create accounts in all domains on the system.
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t global</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Server</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t server</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Zimlets</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gar -t zimlet</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_implementing_delegated_administration">Implementing Delegated Administration</h3>
<div class="paragraph">
<p>Before you create delegated administrators and grant rights, define the
role and which rights to assign to the targets the administrator will
manage.</p>
</div>
<div class="paragraph">
<p>For more efficient management of delegated administrators, create
administrator groups and add individual administrator accounts to the
group. An administrator group allows you to create role-based access
control. Administrators with the same or almost the same responsibilities
can be grouped into an admin group.</p>
</div>
<div class="paragraph">
<p>Delegated administration rights can be set up in one of the following
methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create an administrator or an administrator group and grant rights to the
account using the Administrator Wizard.</p>
</li>
<li>
<p>Configure grants on existing administrator accounts. Add new rights or
modify rights to an existing delegated administrator or administrator group
account.</p>
</li>
<li>
<p>Add, modify and delete rights directly in a target&#8217;s Access Control List
page.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_administrator_groups_and_administrators">Administrator Groups and Administrators</h4>
<div class="paragraph">
<p>Administrator and group administrator accounts are created in the
Administration Console.</p>
</div>
<div class="paragraph">
<p>Use the administration wizard to</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the create either an Admin Group or an Admin Account.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Admin Groups</strong> are distribution lists (DL) that have Admin Group enabled,
which flags it as a delegated administrator DL. After the admin group
administrator is created and configured with rights and admin views, you
add administrator user accounts to the admin group.</p>
</li>
<li>
<p><strong>Admin Account</strong> is a user account that has Administrator enabled on the
account.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the admin views for the account. You select the views from the
Directly Assigned Admin views list. An admin view represent the items the
delegated administrator sees when logged on to the Administration Console.</p>
<div class="paragraph">
<p>A directly assigned admin view is the view set on the admin account. An
inherited admin view is the view set on the admin group the account belongs
to.</p>
</div>
</li>
<li>
<p><strong>Configure the Grants.</strong> The Grants dialog displays a list the grants
requiredto display the items you selected in the Directly Assigned Views
column. You can accept these rights and add additional rights, skip this
page to not configure these rights, or click <strong>Finish</strong> to accept these
rights and quit the wizard.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_configure_grants_on_administrator_accounts_or_admin_groups">Configure Grants on Administrator Accounts or Admin Groups</h4>
<div class="paragraph">
<p>You can manage the rights granted to an administrator or an administrator
group through the Configure Grants link on the accounts toolbar. When you
click <strong>Configure Grant</strong> on the Manage Accounts Addresses toolbar, the
Content pane shows a list of direct and inherited grants. You can grant
rights, modify rights or delete rights on existing administrator accounts.</p>
</div>
</div>
<div class="sect3">
<h4 id="_grant_acls_to_a_target">Grant ACLs to a Target</h4>
<div class="paragraph">
<p>When you want to add a specific grantee or specific rights on a target you
can edit the target directly. Each target has an ACL page which lists the
granted ACLs. You can add, edit or delete the target&#8217;s grants.  The
administration account (grantee) is updated to reflect the change.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_revoking_rights">Revoking Rights</h3>
<div class="paragraph">
<p>Global administrators can revoke any rights granted to an administrator.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Manage &#8594; Accounts</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Open the desired administrator account and click <strong>Configure Grants</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the <em>right</em> to revoke and click <strong>Delete</strong>.</p>
</li>
<li>
<p>When the dialog asks if are sure, click <strong>Yes</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Delegated administrators can revoke rights if the right was created with
the <strong>Can Grant the right to other admins</strong> enabled.</p>
</div>
<div class="sect3">
<h4 id="_temporarily_revoke_delegated_admin_rights">Temporarily Revoke Delegated Admin Rights</h4>
<div class="paragraph">
<p>To temporarily revoke rights to a delegated administrator account, you can
edit the administrator account and remove the check next to the
Administrator field. The ACLs are not removed from the account.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_view_rights_granted_to_administrators">View Rights Granted to Administrators</h3>
<div class="paragraph">
<p>The View Rights link from an admin account or admin group account toolbar
displays the granted rights, readable attributes and modifiable attributes
associated with a specific target. Click on the tabs to view rights for
different targets.</p>
</div>
</div>
<div class="sect2">
<h3 id="_predefined_delegated_administrator_role">Predefined Delegated Administrator Role</h3>
<div class="paragraph">
<p>The following pre-configured administrator groups are created
automatically. You can assign administrator accounts to these groups.</p>
</div>
<div class="sect3">
<h4 id="_domain_administration_group">Domain Administration Group</h4>
<div class="paragraph">
<p>The <code>zimbradomainadmins</code> delegated admin group grants all the rights
necessary to support Zimbra Collaboration domain administration for
accounts, aliases, distribution lists and resources.</p>
</div>
<div class="paragraph">
<p>Administrators who are part of the <code>zimbradomainadmins</code> group can create
and manage accounts including setting the account quota, aliases,
distribution lists, and resources accounts in their domain.</p>
</div>
<div class="paragraph">
<p>When domain administrators log onto the Administration Console, only the
functions they are authorized to manage are displayed on the console&#8217;s
Navigation pane.</p>
</div>
<div class="sect4">
<h5 id="_create_link_from_zimbra_web_client_account_to_admin_console">Create Link from Zimbra Web Client Account to Admin Console</h5>
<div class="paragraph">
<p>For domain administrators, all tasks are performed from the Administration
Console. To facilitate easy log in, when a delegated administrator account
is created, their Web Client account can have a link to the Administration
Console.</p>
</div>
<div class="paragraph">
<p>The link is created from the <code>zmprov</code> CLI</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {server.example.com} zimbraWebClientAdminReference {https://server.example.com:7071/}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_distribution_list_administration_group">Distribution List Administration Group</h4>
<div class="paragraph">
<p>The <code>zimbradladmin</code> delegated admin group grants all the rights necessary
to log on to the Administration Console and manage distribution lists.</p>
</div>
<div class="paragraph">
<p>Administrators who are part of this group can</p>
</div>
<div class="ulist">
<ul>
<li>
<p>View the account list</p>
</li>
<li>
<p>Create new distribution lists and delete distribution lists</p>
</li>
<li>
<p>Add, edit and remove members in a distribution list</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_delegated_administrator_roles">Creating Delegated Administrator Roles</h3>
<div class="sect3">
<h4 id="_manage_multiple_domains">Manage multiple domains</h4>
<div class="paragraph">
<p>To have one domain administrator manage more than one domain, you assign
the rights to manage individual domains to the administrator account or
administrator group.</p>
</div>
<div class="paragraph">
<p>For example, to set up <a href="mailto:domanadministrator1@example.com">domanadministrator1@example.com</a> to manage
domainexample1.com and domainexample2.com. Create a new administrator account
on one of the domains to be managed.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the administrator account on one of the domains to be managed
(domainexample1.com)</p>
</li>
<li>
<p>Select the views that domain administrators need to manage a domain.
When the views are selected, the rights associated with these views
automatically display on the Configure the Grants dialog.</p>
</li>
<li>
<p>Configure the grants for this domain if they are different from the
grants associated with the views you select.</p>
</li>
<li>
<p>To add another domain to be managed (domainexample2.com).</p>
<div class="ulist">
<ul>
<li>
<p>On the Configure Grants page, click <strong>Add</strong></p>
</li>
<li>
<p>Select the target type as <strong>domain</strong></p>
</li>
<li>
<p>Enter the target&#8217;s domain name (domainexample2.com)</p>
</li>
<li>
<p>For Right Type, select System Defined Right</p>
</li>
<li>
<p>For Right Name type, adminConsoleAccountRights. <strong>Is Positive Right</strong>
should be selected.</p>
</li>
<li>
<p>Click <strong>Add and More</strong></p>
</li>
<li>
<p>The <strong>Add ACE</strong> page displays again and the Right Name field is empty.
Type, <strong>adminConsoleDLRights</strong> and click <strong>Add and More.</strong></p>
</li>
<li>
<p>Continue to add the following right names:</p>
<div class="ulist">
<ul>
<li>
<p><strong>adminConsoleAliasRights</strong></p>
</li>
<li>
<p><strong>adminConsoleResourceRights</strong></p>
</li>
<li>
<p><strong>adminConsoleSavedSearchRights</strong></p>
</li>
<li>
<p><strong>adminConsoleDomainRights</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>After the last right, click <strong>Add and Finish</strong>. The Configure the Grants
dialog displays these rights associated with the target domain. If you are
adding another domain to manage, click <strong>Add and More</strong>. Repeat Step 4. If
not, click <strong>Finish</strong>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_manage_distribution_lists">Manage Distribution Lists</h4>
<div class="paragraph">
<p>To assign a user to manage a distribution list, you create a distribution
list and enable Admin Group, select the view, grant the distribution list
rights, add the user to the list and make that user an administrator.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a new distribution list:</p>
<div class="ulist">
<ul>
<li>
<p>Check <strong>Admin Group</strong></p>
</li>
<li>
<p>Add the user who will be the administrator as a member of the DL.</p>
</li>
<li>
<p>Go to the <strong>Admin Views</strong> page and check <strong>Distribution List View</strong> so the admin
can view the distribution list.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>In the <strong>Configure Grants</strong> page, add the following rights.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 52. Rights</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><code>The following right let the administrator manage distribution lists.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listDistributionList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDistributionListAlias</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDistributionListMember</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyDistributionList</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDistributionListMembership</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeDistributionListMember</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><code>This domain right displays user account list that the administrator can
select from to add to a distribution list.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DL email address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_change_passwords">Change Passwords</h4>
<div class="paragraph">
<p>To create delegated administrators who only change passwords, you create
the admin or admin group, select the views and grant the set Account
Password combo right.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the following views</p>
<div class="ulist">
<ul>
<li>
<p><strong>Account List</strong> view to be able to select accounts to change passwords</p>
</li>
<li>
<p><strong>Alias List</strong> view to be able to find users who use an alias instead of
account name.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The Configure the Grants page displays recommended grants for the views
you have chosen. For Change Password rights, do not configure these
grants. Select <strong>Skip</strong>. Click <strong>Add</strong> to add the following right:</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setAccountPassword</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_view_mail_access_right">View Mail Access Right</h4>
<div class="paragraph">
<p>View Mail access right can be granted on accounts, domains, and
distribution lists.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminLoginAs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">account, domain, dl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">account, domain, or distribution list address</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SD Right <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. To deny the View Mail right on the target, check the box for <strong>Is Negative Right (Deny)</strong>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To prevent administrators from viewing an account with a domain or
distribution list, assign the <strong>Is Negative Right</strong> to the account.</p>
</div>
</div>
<div class="sect3">
<h4 id="_manage_class_of_service_assigned_to_users">Manage Class of Service Assigned to Users</h4>
<div class="paragraph">
<p>You can expand the domain administrator role to be able to view and change
the class of service (COS) assigned to a user. To add the rights to manage
the COS for a domain, add the following rights to the domain administrator
account or domain administrator admin group.</p>
</div>
<div class="paragraph">
<p>Add the System Defined Rights to each COS in the domain.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 53. System Defined Rights for COS</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listCos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getCos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>assignCos</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">COS name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock"><code>This domain right displays the COS information in the user account&#8217;s
General Information page.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraCOSId</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute Right<br>
Verb: <strong>Write</strong><br>
AR Target: <strong>account</strong></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_manage_cross_mailbox_search">Manage Cross Mailbox Search</h4>
<div class="paragraph">
<p>This role creates a delegated administrator role that can run the Search
Mail tool to search mail archives or live mail for accounts. This also
allows the administrator to create, abort, delete, purge or get status of a
cross mailbox search request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The Archiving and Discovery feature must be installed for this feature to
work.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleCrossMailboxSearchRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(combo)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server name where cross mailbox searches can be run</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For full functionality, this role includes the ability to create new
accounts so that the admin can create the target mailbox to receive the
search results. If you do not want this role to have the ability to create
accounts, grant the following negative right as well.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CreateAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SD Right <sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. To deny the Create Account right on the target, check the box for <strong>Is Negative Right (Deny)</strong>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If you want this admin to also view the target mailbox with the results of
the cross mailbox search, grant the right to view that mailbox only.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminLoginAs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">account</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cross mailbox search target account name</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>SD Right <sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup></p>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. To deny the View Mail right on the target, check the box for <strong>Is Negative Right (Deny)</strong>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_manage_zimlets">Manage Zimlets</h4>
<div class="paragraph">
<p>This role creates a delegated administrator role that can create, deploy
and view Zimlets.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleZimletRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server, domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server name or domain name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleAccountsZimletsTabRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server, domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server name or domain name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_manage_resources">Manage Resources</h4>
<div class="paragraph">
<p>This role creates a delegated administrator that can create and manage
resources.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleResourceRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">combo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server name or domain name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_access_to_the_saved_searches">Access to the Saved Searches</h4>
<div class="paragraph">
<p>This role creates a delegated administrator that can access all the
searches saved in the Administration Console Navigation pane, Search
section.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleSavedSearchRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">combo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">server name or domain name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_access_to_the_server_status_pages">Access to the Server Status Pages</h4>
<div class="paragraph">
<p>This role creates a delegated administrator that can access the Server
Status page. In addition to granting this right, you must also select the
Admin View, <strong>Global Server Status View</strong>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Right Name</th>
<th class="tableblock halign-left valign-top">Target Type</th>
<th class="tableblock halign-left valign-top">Target</th>
<th class="tableblock halign-left valign-top">Right Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>adminConsoleServerStatusRights</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SD Right</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Accounts that are configured as global administrator accounts cannot be
granted ACLs. Global administrator accounts automatically have full rights
on Zimbra Collaboration. If an ACL is added to a global administrator account, it
is ignored. If a delegated administrator account is changed to a global
administrator account, any ACLs associated with the account are ignored.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="monitoring_zcs_servers">Monitoring ZCS Servers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Zimbra Collaboration (ZCS) includes the following to
help you monitor the Zimbra servers, usage, and mail flow:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra Logger package to capture and display server statistics and server
status, and to create nightly reports</p>
</li>
<li>
<p>Mailbox quota monitoring</p>
</li>
<li>
<p>MTA mail queue monitoring</p>
</li>
<li>
<p>Log files</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Also, selected error messages generate SNMP traps, which can be monitored
using an SNMP tool.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Checking the overall health of the system as a whole is beyond the scope of
this document.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_zimbra_logger">Zimbra Logger</h3>
<div class="paragraph">
<p>The Logger includes tools for syslog aggregation and reporting.  Installing
the Logger is optional, but if you do not install it, server statistics and
server status information are not captured.</p>
</div>
<div class="paragraph">
<p>In environments with more than one Zimbra Collaboration server, Logger is
enabled on one mailbox server only.  This server is designated as the
monitor host.  The Zimbra Collaboration monitor host is responsible for
checking the status of all the other Zimbra Collaboration servers and
presenting this information on the Zimbra administration console.
Real-time service status, MTA, spam, virus traffic and performance
statistics can be displayed.  The Logger creates a daily report about mail
activity, such as the number of messages, average delivery delay, and
errors generated.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In a multi-server installation, you must set up the syslog configuration
files on each server to enable Logger to display the server statistics on
the Administration Console, and you must enable the Logger host.  If you
did not configure this when you installed Zimbra Collaboration, do so now.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_enabling_server_statistics">Enabling Server Statistics</h4>
<div class="paragraph">
<p>Enable server statistics to show both system- wide and server specific data
about the inbound message volume, inbound message count, anti-spam/anti-virus
activity and disk usage for messages processed in the last 48
hours, 30 days, 60 days, and the last year.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On each server, as root, type <code>/opt/zimbra/libexec/zmsyslogsetup</code>.  This
updates the syslog configuration to enable gathering server statistics.</p>
</li>
<li>
<p>On the logger monitor host, you must configure <strong>syslog</strong> to accept
syslog messages from remote machines.
See <a href="https://wiki.zimbra.com/wiki/Configuring-Logger-Host" class="bare">https://wiki.zimbra.com/wiki/Configuring-Logger-Host</a> for details.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These steps are not necessary for a single-node installation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_reviewing_server_status">Reviewing Server Status</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Monitor</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <strong>Server Status</strong> page lists all servers and services, their
status, and when the server status was last checked.  The servers include
the MTA, LDAP, and mailbox server.  The services include MTA, LDAP,
Mailbox, SNMP, Anti-Spam, Anti-Virus, Spell checker, and Logger.</p>
</div>
<div class="paragraph">
<p>To start a server if it is not running, use the <code>zmcontrol</code> CLI command.  You
can stop and start services from the Administration Console.</p>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_or_disabling_server_services">Enabling or Disabling Server Services</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Servers &#8594; <em>server</em></strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Server services are enabled or disabled from the <strong>Servers &#8594; <em>server</em></strong>
page.  Select <strong>Services</strong> in the Navigation pane and select to enable or
disable services.</p>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_server_performance_statistics">Viewing Server Performance Statistics</h4>
<div class="paragraph">
<p>If the Logger package is installed on a Zimbra mailbox server, Server
Statistics shows bar graphs of the message count, message volume,
anti-spam, and anti-virus activity.  The information is displayed for the
last 48 hours, and 30 days, 60 days, and 365 days.</p>
</div>
<div class="paragraph">
<p>When Server Statistics is selected in the Navigation pane, consolidated
statistics for all mailbox servers is displayed.  Selecting a specific
server in the expanded view shows statistics for that server only.  Server
specific information also includes disk usage, session information, and
mailbox quota details.</p>
</div>
<div class="paragraph">
<p>The following display system-wide information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Message Count</strong>&#8201;&#8212;&#8201;counts message transactions.  A transaction is defined
as either the SMTP receipt of a message per person (by Postfix) or a LMTP
delivery of it (by mailboxd) per person.  For example, if a message is sent
to three people, six transactions are displayed.  Three for SMTP to Postfix
and three for LMTP to mailboxd.  The message count is increased by six.</p>
</li>
<li>
<p><strong>Message Volume</strong>&#8201;&#8212;&#8201;displays the aggregate size in bytes of transactions
sentand received per hour and per day.  Graphs show the total inbound data
by volume in bytes.</p>
</li>
<li>
<p><strong>Anti-Spam/Anti-Virus Activity</strong>&#8201;&#8212;&#8201;displays the number of messages that
werechecked for spam or viruses and the number of messages that were tagged
as spam or deemed to contain a virus.  The AS/AV count is increased by one
per message scanned.  One message sent to three people counts as only one
message processed by AS/AV.</p>
<div class="paragraph">
<p>The Message Count and the Anti-spam/Anti-virus Activity graphs display a
different message count because:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Outbound messages may not go through the Amavisd filter, as the system
architecture might not require outbound messages to be checked.</p>
</li>
<li>
<p>Messages are received and checked by Amavisd for spam and viruses before
being delivered to all recipients in the message.  The message count shows
the number of recipients who received messages.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Server-specific statistics also include the following details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Disk</strong>&#8201;&#8212;&#8201;for a selected server displays the disk used and the disk
space available.  The information is displayed for the last hour, day,
month, and year.</p>
</li>
<li>
<p><strong>Session</strong>&#8201;&#8212;&#8201;displays information about the active Web client,
administrator and IMAP sessions.  You can see how many active sessions are
opened, who is logged on, when the session was created and the last time
the session was accessed.</p>
</li>
<li>
<p><strong>Mailbox Quota</strong>&#8201;&#8212;&#8201;displays information about each account sorted
by mailbox size in descending order.  See
<a href="#monitoring_mailbox_quotas">Monitoring Mailbox Quotas</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_configuring_logger_mail_reports">Configuring Logger Mail Reports</h4>
<div class="paragraph">
<p>The Logger generates a report about mail activity daily at 11:30 p.m. and
sends it to the administrator&#8217;s email address.</p>
</div>
<div class="paragraph">
<p>You can configure the number of accounts to include in the report.  The
default is 25 sender and 25 recipient accounts.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Changing the number of recipients to add to the report:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zimbra_mtareport_max_recipients=&lt;number&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Changing the number of senders to add to the report:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zimbra_mtareport_max_senders=&lt;number&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_disk_space_notifications">Configuring Disk Space Notifications</h3>
<div class="paragraph">
<p>You should regularly review your disk capacity and when disks are getting
full, take preventative measures to maintain service.  A warning alert
email notification is sent to the administrator account when disk space is
low.  The default is to send a warning alert when the threshold reaches 85%
and a critical alert when the threshold reaches 95%.</p>
</div>
<div class="paragraph">
<p>You can change these values.  Use <code>zmlocalconfig</code> to configure the
disk warning thresholds.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Warning alerts</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmdisklog_warn_threshold</code></pre>
</div>
</div>
</li>
<li>
<p>Critical alert:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmdisklog_critical_threshold</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When starting services with <code>zmcontrol</code>, if the threshold is exceeded a
warning is displayed before the services are started.  You should clean up
your disk to free up space.</p>
</div>
</div>
<div class="sect2">
<h3 id="_monitoring_servers">Monitoring Servers</h3>
<div class="paragraph">
<p>The Zimbra Collaboration server collects many performance related
statistics that can help you diagnose problems and load issues.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Monitor &#8594; Advanced Statistics</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <strong>Advanced Statistics</strong> page includes advanced graphing
options that lets you generate various charts based on statistical
information for the CPU, IO, mailboxd, MTA queue, MariaDB and other
components.</p>
</div>
<div class="paragraph">
<p>To chart the graphics in Advanced Statistics, select one of these groups
and then select from the list of specific counters for the type of
information to display.</p>
</div>
<div class="paragraph">
<p>The information covers a wide array of data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>cpu.csv</strong>&#8201;&#8212;&#8201;CPU utilization.  This group contains counters to keep track
ofCPU usage (iowait, idle, system, user, time etc.).  CPU information can
be tracked both at the server level and the process level.</p>
</li>
<li>
<p><strong>df.csv</strong>&#8201;&#8212;&#8201;Captures disk usage.  Disk utilization is tracked for each
diskpartition.</p>
</li>
<li>
<p><strong>fd.csv</strong>&#8201;&#8212;&#8201;file descriptor count.  Keeps track of system file descriptor
usageover time.  This is primarily used to track down "out-of-file
descriptor" errors.</p>
</li>
<li>
<p><strong>mailboxd.csv</strong>&#8201;&#8212;&#8201;Zimbra Collaboration server and JVM statistics.
Mailboxdstores almost all of its statistics here.  Interesting numbers to
keep track of are heap_used, heap_free, imap_conn, soap_sessions,
pop_conn, db_conn_count.</p>
</li>
<li>
<p><strong>mtaqueue.csv</strong>&#8201;&#8212;&#8201;Postfix queue.  This measures the mail queue size
innumber of messages and the size in bytes.</p>
</li>
<li>
<p><strong>proc.csv</strong>&#8201;&#8212;&#8201;Process statistics for Zimbra processes.  For example
mailboxd/java, MariaDB, OpenLDAP, etc.)</p>
</li>
<li>
<p><strong>soap.csv</strong>&#8201;&#8212;&#8201;SOAP request processing time.</p>
</li>
<li>
<p><strong>threads.csv</strong>&#8201;&#8212;&#8201;JVM thread counts.  Counts the number of threads with
acommon name prefix.</p>
</li>
<li>
<p><strong>vm.csv</strong>&#8201;&#8212;&#8201;Linux VM statistics (from the vmstat command).</p>
</li>
<li>
<p><strong>io-x.csv</strong> and <strong>io.csv</strong>&#8201;&#8212;&#8201;store data from the <code>iostat(1)</code> command (<code>io-x.csv</code>
with <code>iostat -x</code>).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_denial_of_service_filter_parameters">Configuring Denial of Service Filter Parameters</h3>
<div class="paragraph">
<p>The denial-of-service filter (DoSFilter) limits exposure to requests
flooding over HTTP/HTTPS.  The DoSFilter throttles clients sending a large number of
requests over a short period of time.</p>
</div>
<div class="paragraph">
<p>DosFilter is only applied to HTTP and HTTPS requests, in other words, it does not affect requests for any other protocols like POP3, IMAP or SMTP. You can modify the configuration to accommodate your specific environmental needs. DoSFilter is enabled by default on ZCS. Disabling the DoSFilter is not recommended. For information on preventing multiple failed login attempts see <a href="#passwordpolicy">Password Policy</a></p>
</div>
<div class="sect3">
<h4 id="_identifying_false_positives">Identifying False Positives</h4>
<div class="paragraph">
<p>Sometimes Zimbra Connector for Outlook (ZCO), mobile ActiveSync clients, or
running some <code>zmprov</code> commands trigger the DoSFilter.  When this happens, the
Zimbra mailbox service is unavailable.  You can review the following logs
to see if the DoSFilter was applied.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/opt/zimbra/log/sync.log</code>.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 17. <code>sync.log</code> entry showing the DoSFilter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2021-01-15 15:52:20,426 WARN [qtp1635701107-91:https://x.x.x.x/
Microsoft-Server-ActiveSync?User=zsupport2&amp;DeviceId=Appl5ddddd3NR&amp;DeviceType=iPhone&amp;Cmd=FolderSync][name=zsupport2@domain.com;mid=64;ip=10.1.2.3;Cmd=FolderSync;DeviceID=Appl5K0113UN3NR;Version=12.1;] sync - <strong>Service exception com.zimbra.common.service.ServiceException: error while proxying request to target server: HTTP/1.1 503 Service Unavailable</strong>
ExceptionId:qtp1635701107-91:https://10.10.0.54:443/Microsoft-Server-ActiveSync?User=zsupport2&amp;DeviceId=Appl5K0113UN3NR&amp;DeviceType=iPhone&amp;Cmd=FolderSync:1358286740426:c5ca7f36bb0a038f Code:service.PROXY_ERROR Arg:(url, STR,&quot;http://mail.domain.com:80/service/soap/SyncRequest&quot;</code></pre>
</div>
</div>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/opt/zimbra/log/zmmailboxd.out</code></p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="title">Example 18. <code>zmmailboxd.out</code> entry showing the DoSFilter</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2021-01-15 15:57:32.537:WARN:oejs.<strong>DoSFilter:DOS ALERT</strong>:ip=127.0.1.1,session=null,user=null</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_customizing_dosfilter_configuration">Customizing DoSFilter Configuration</h4>
<div class="paragraph">
<p>The following attributes are used with <code>zmprov</code> to configure the DoSFilter.
These attributes can be configured as global settings and as server
settings.  If these attributes are set in the server, the server settings
override the global settings.</p>
</div>
<div class="paragraph">
<p>You can modify these settings, but the default configuration is
recommended.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DoSFilter Delay</strong><br>
<code>zimbraHttpDosFilterDelay-Millis</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The delay given to all requests over the rate limit before they are
considered.  The default is -1.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>-1 = Reject request</p>
</li>
<li>
<p>0 = No delay</p>
</li>
<li>
<p>Any other value = Delay is in ms</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraHttpDosFilterDelayMillis {x}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DoSFilter Maximum Requests Per Second</strong><br>
<code>zimbraHttpDosFilterMaxRequestsPerSec</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The maximum number of requests from a connection per second.  Requests in
excess of this are throttled.  The default is 30 and the minimum is 1.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraHttpDosFilterMaxRequestsPerSec {x}</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DoSFilter IP Addresses Whitelist</strong><br>
<code>zmprov mcf zimbraHttpThrottleSafeIPs {x.x.x.x,192.168.x.x}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>IP addresses to ignore when applying the DosFilter.  This attribute does
not have a default value, however the following loopback IPs are
whitelisted by default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>127.0.0.1</p>
</li>
<li>
<p>::1</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The IP addresses should be comma separated.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraHttpThrottleSafeIPs {addresses}</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A mailbox server restart is required after modifying these attributes.
Type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailboxdctl restart</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tuning_considerations_for_zcs_8_0_3_and_later">Tuning Considerations for ZCS 8.0.3 and later</h4>
<div class="ulist">
<ul>
<li>
<p><strong>ZCS Member Servers</strong>&#8201;&#8212;&#8201;ZCS servers under the control of a single
masterLDAP server are automatically whitelisted by IP address.  These hosts
are discovered using a <strong>GetAllServersRequest</strong>.  Type as <code>zmprov gas</code>.</p>
</li>
<li>
<p><strong>External Provisioning Hosts/SOAP API</strong>&#8201;&#8212;&#8201;External provisioning hosts can
be added to the IP whitelist to ensure that the DoSFilter does not block
some requests.  For example, a mailbox reindex might make several calls per
second that can trigger the DoSFilter.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_mail_queues">Working with Mail Queues</h3>
<div class="paragraph">
<p>When the Zimbra MTA receives mail, it routes the mail through a series of
queues to manage delivery; incoming, active, deferred, held, and corrupt.</p>
</div>
<div class="paragraph">
<p>The <strong>incoming</strong> message queue holds the new mail that has been received.
Each message is identified with a unique file name.  Messages are moved to
the active queue when there is room.  If there are no problems, message
move through this queue very quickly.</p>
</div>
<div class="paragraph">
<p>The <strong>active</strong> message queue holds messages that are ready to be sent.  The
MTA sets a limit to the number of messages that can be in the active queue
at any one time.  From here, messages are moved to and from the anti-virus
and anti-spam filters before being delivered to another queue.</p>
</div>
<div class="paragraph">
<p>Messages that cannot be delivered are placed in the <strong>deferred</strong> queue.  The
reasons for the delivery failures are documented in a file in the deferred
queue.  This queue is scanned frequently to resend the message.  If the
message cannot be sent after the set number of delivery attempts, the
message fails.  The message is bounced back to the original sender.  The
default for the bounce queue lifetime is five days.</p>
</div>
<div class="paragraph">
<p>The <strong>held</strong> message queue keeps mail that could not be processed.  Messages
stay in this queue until the administrator moves them.  No periodic
delivery attempts are made for messages in the held queue.</p>
</div>
<div class="paragraph">
<p>The <strong>corrupt</strong> queue stores damaged unreadable messages.</p>
</div>
<div class="sect3">
<h4 id="_change_the_bounce_queue_lifetime">Change the Bounce Queue Lifetime</h4>
<div class="ulist">
<ul>
<li>
<p>The MTA server&#8217;s bounce queue lifetime is set for five days.  To change
the default queue lifetime setting</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e bounce_queue_lifetime={#}</code></pre>
</div>
</div>
</li>
<li>
<p>To permanently have messages bounced back to the sender, instead of being
sent to the deferred queue first</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zimbraLmtpPermanentFailureWhenOverQuota=TRUE</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_notifying_senders_of_bounced_messages">Notifying Senders of Bounced Messages</h4>
<div class="paragraph">
<p>Before the bounce queue lifetime sends the message back to the sender,
senders can be notified that the message they sent is in the deferred queue
and has not been delivered.</p>
</div>
<div class="paragraph">
<p>Configure the following attributes to send a warning message to the sender.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configure the time after which the sender receives the message headers of
email that is still queued.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -c postfix_delay_warning_time=0h</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the recipient of postmaster notifications with the message
headers of mail that the MTA did not deliver.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -c postfix_bounce_notice_recipient=postmaster</code></pre>
</div>
</div>
</li>
<li>
<p>Configure the list of error classes that are reported to the postmaster.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -c postfix_notify_classes=resource,software</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
See Postfix documentation for details on the impact of changes to these
Postfix attributes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can monitor the mail queues for delivery problems from the
Administration Console.</p>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_mail_queues">Viewing Mail Queues</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Monitor &#8594; Mail Queues</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If you are having problems with mail delivery, you can view the mail queues
from the <strong>Mail Queues</strong> page in the Administration Console to see if
you can fix the mail delivery problem.  When you open mail queues, the
content of the deferred, incoming, active, hold, and corrupt queues at that
point in time can be viewed.  You can view the number of messages and where
they are coming from and going to.</p>
</div>
<div class="paragraph">
<p>For each queue, the Summary pane shows a summary of messages by receiver
domain, origin IP, sender domain, receiver address, sender address, and for
the deferred queue, by error type.  You can select any of the summaries to
see detailed envelope information by message in the Messages pane.</p>
</div>
<div class="paragraph">
<p>The Messages pane displays individual message envelope information for
search filters selected from the Summary pane.</p>
</div>
<div class="paragraph">
<p>The following mailbox queue functions can be performed for all the messages
in a queue:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Hold</strong> to select a set of messages that you want to hold.  Incoming,
active,deferred, and corrupt messages can be moved to the Held queue.
Messages stay in this queue until the administrator moves them.</p>
</li>
<li>
<p><strong>Release</strong> to remove all message from the Held queue.  Messages are moved
to the Deferred queue.</p>
</li>
<li>
<p><strong>Requeue</strong> all messages in the queue being viewed.  Requeuing messages can
be used to send messages that were deferred because of a configuration
problem that has been fixed.  Messages are re-evaluated and earlier
penalties are forgotten.</p>
</li>
<li>
<p><strong>Delete</strong> all messages in the queue being viewed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Zimbra MTA, Postfix queue file IDs are reused.  If you requeue or
delete a message, note the message envelope information, not the queue ID.
It is possible that when you refresh the mail queues, the queue ID could be
used on a different message.</p>
</div>
</div>
<div class="sect3">
<h4 id="_flushing_message_queues">Flushing Message Queues</h4>
<div class="paragraph">
<p>You can flush the server of all messages.  When you click Flush on the Mail
Queue toolbar, delivery is immediately attempted for all messages in the
Deferred, Incoming and Active queues.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="monitoring_mailbox_quotas">Monitoring Mailbox Quotas</h3>
<div class="paragraph">
<p>Mailbox quotas apply to email messages, attachments, calendar appointments,
and tasks in a user&#8217;s account.  When an account quota is reached, all mail
messages are rejected.  Users must delete mail from their account to get
below their quota limit - this includes emptying their Trash, or you can
increase their quota.</p>
</div>
<div class="sect3">
<h4 id="_viewing_quota">Viewing Quota</h4>
<div class="paragraph">
<p>You can check mailbox quotas for individual accounts from <strong>Server Statistics</strong>
on the Administration Console.  Mailbox Quota gives you an instant view of
the Mailbox Size and Quota Used information for each account.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Monitor &#8594; Server Statistics</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the <strong><em>server</em></strong> for which you want to view statistics.</p>
</li>
<li>
<p>In the Navigation pane, select <strong>Mailbox Quota</strong>.  The Mailbox Quota page
displays with the following information:</p>
<div class="ulist">
<ul>
<li>
<p>Quota column shows the mailbox quota allocated to the account.  Quotas
are configured either in the COS or by account.</p>
</li>
<li>
<p>Mailbox Size column shows the disk space used.</p>
</li>
<li>
<p>Quota Used column shows what percentage of quota is used.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_increase_or_decrease_quota">Increase or Decrease Quota</h4>
<div class="paragraph">
<p>From a COS or Account, you can configure a quota threshold that, when
reached, sends a message alerting users that they are about to reach their
mailbox quota.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Advanced</strong><br>
<strong>Home &#8594; Manage &#8594; Accounts &#8594; <em>account</em> &#8594; Advanced</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Scroll down to the Quota section.</p>
</li>
<li>
<p>Modify the quota settings.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_mobilesync_statistics">Viewing MobileSync Statistics</h3>
<div class="paragraph">
<p>The <strong>MobileSync Statistics</strong> page in the Monitor section in the admin
console displays the number of currently connected ActiveSync devices that
are on the Zimbra Collaboration system.</p>
</div>
</div>
<div class="sect2">
<h3 id="_monitoring_authentication_failures">Monitoring Authentication Failures</h3>
<div class="paragraph">
<p>To protect against dictionary-based and distributed attacks, you can
configure the <code>zmauditwatch</code>.  The script attempts to detect more advanced
attacks by looking at where the authentication failures are coming from and
how frequently they are happening for all accounts on a Zimbra mailbox
server and sends an email alert to the administrator&#8217;s mailbox.</p>
</div>
<div class="paragraph">
<p>The types of authentication failures checked include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>IP/Account hash check</strong>&#8201;&#8212;&#8201;The default is to send an email alert if
10authenticating failures from an IP/account combination occur within a 60
second window.</p>
</li>
<li>
<p><strong>Account check</strong>&#8201;&#8212;&#8201;The default is to send an email alert if 15
authentication failures from any IP address occur within a 60 second window.
This check attempts to detect a distributed hijack based attack on a single
account.</p>
</li>
<li>
<p><strong>IP check</strong>&#8201;&#8212;&#8201;The default is to send an email alert if 20 authentication
failures to any account occur within a 60 second window.  This check
attempts to detect a single host based attack across multiple accounts.</p>
</li>
<li>
<p><strong>Total authentication failure check</strong>&#8201;&#8212;&#8201;The default is to send an email
alert if1000 auth failures from any IP address to any account occurs within
60 seconds.  The default should be modified to be 1% of the active accounts
on the mailbox server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The default values that trigger an email alert are changed in the following
<code>zmlocalconfig</code> parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IP/Account value, change <code>zimbra_swatch_ipacct_threshold</code></p>
</li>
<li>
<p>Account check, change <code>zimbra_swatch_acct_threshold</code></p>
</li>
<li>
<p>IP check, change <code>zimbra_swatch_ip_threshold</code></p>
</li>
<li>
<p>Total authentication failure check, change
<code>zimbra_swatch_total_threshold</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configure <code>zimbra_swatch_notice_user</code> with the email address that should
receive the alerts.</p>
</div>
</div>
<div class="sect2">
<h3 id="_viewing_log_files">Viewing Log Files</h3>
<div class="paragraph">
<p>Zimbra Collaboration logs its activities and errors to a combination of
system logs through the syslog daemon as well as Zimbra specific logs on
the local file system.  The logs described below are the primary logs that
are used for analysis and troubleshooting.</p>
</div>
<div class="paragraph">
<p>Local logs containing Zimbra Collaboration activity are in the <code>/opt/zimbra/log</code>
directory.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>audit.log</strong>&#8201;&#8212;&#8201;This log contains authentication activity of users
and administrators and login failures.  In addition, it logs admin activity
to be able to track configuration changes.</p>
</li>
<li>
<p><strong>clamd.log</strong>&#8201;&#8212;&#8201;This log contains activity from the anti-virus application
clamd.</p>
</li>
<li>
<p><strong>freshclam.log</strong>&#8201;&#8212;&#8201;This log contains log information related to the
updating of the clamd virus definitions.</p>
</li>
<li>
<p><strong>mailbox.log</strong>&#8201;&#8212;&#8201;This log is a mailboxd log4j server log containing the
logs from the mailbox server.  This includes the mailbox store, LMTP
server, IMAP and POP servers, and Index server.</p>
</li>
<li>
<p><strong>myslow.log</strong>&#8201;&#8212;&#8201;This slow query log consists of all SQL statements from
the mailbox server that took more then <code>long_query_time</code> seconds to execute.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>long_query_time</code> is defined in <code>/opt/zimbra/conf/my.cnf</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong>spamtrain.log</strong>&#8201;&#8212;&#8201;This log contains output from <code>zmtrainsa</code> during
regularly scheduled executions from the cron.</p>
</li>
<li>
<p><strong>sync.log</strong>&#8201;&#8212;&#8201;This log contains information about Zimbra Collaboration
mobilesync operations.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other logs include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>/opt/zimbra/jetty/logs/</strong>&#8201;&#8212;&#8201;This is where Jetty-specific activity is
logged.</p>
</li>
<li>
<p><strong>/opt/zimbra/db/data/&lt;hostname&gt;.err</strong>&#8201;&#8212;&#8201;This is the message store
database error log.</p>
</li>
<li>
<p><strong>/opt/zimbra/logger/db/data/&lt;hostname&gt;.err</strong>&#8201;&#8212;&#8201;This is the Logger
database error log.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zimbra Collaboration activity logged to System syslog</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>/var/log/zimbra.log</strong>&#8201;&#8212;&#8201;The Zimbra syslog details the activities of the
ZimbraMTA (Postfix, amavisd, anti-spam, anti-virus), Logger, Authentication
(cyrus-sasl), and Directory (OpenLDAP).  By default LDAP activity is logged
to <code>zimbra.log</code>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_syslog">Syslog</h4>
<div class="paragraph">
<p>Zimbra Collaboration modifies the systems syslog daemon to capture data from the mail and
local syslog facility to <code>/var/log/zimbra.log</code>.  This allows syslogd to
capture data from several Zimbra Collaboration components including
Postfix, Amavis, ClamAV, mailboxd, zmconfigd, and logger.  The SNMP module
uses the data from the log file to generate traps for critical errors.  The
zmlogger daemon also collects a subset of the data in this file to provide
statistics on the utilization of Zimbra Collaboration via the
Administration Console.</p>
</div>
<div class="paragraph">
<p>By default, mailboxd is configured to log its output to
<code>/opt/zimbra/log/mailbox.log</code>.  You can enable mailboxd to take advantage
of a centralized syslogd infrastructure by enabling the following either
globally or by server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraLogToSysLog TRUE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_log4j_to_configure_logging">Using log4j to Configure Logging</h4>
<div class="paragraph">
<p>The Zimbra Collaboration server uses <code>log4j</code>, a Java logging package as the
log manager.  By default, the Zimbra Collaboration server has <code>log4j</code>
configured to log to the local file system.  You can configure <code>log4j</code> to
direct output to another location.  Go to the
<a href="https://logging.apache.org/log4j/2.x/">Log4j website</a> for information about
using <code>log4j</code>.</p>
</div>
<div class="paragraph">
<p>ZCS does not check the log4j changes.  To remove all account loggers and
reloads in <code>/opt/zimbra/conf/log4j.properties</code>, use the <code>zmprov
resetAllLoggers</code> command.</p>
</div>
</div>
<div class="sect3">
<h4 id="_logging_levels">Logging Levels</h4>
<div class="paragraph">
<p>The default logging level is set to include logs that are generated for
INFO, WARNING, ERROR and FATAL.  When problems start to occur, you can turn
on the DEBUG or TRACE log levels.</p>
</div>
<div class="paragraph">
<p>To change the logging levels, edit the <code>log4j</code> properties,
<code>log4j.properties</code>, <code>log4j.logger.zimbra</code>.</p>
</div>
<div class="paragraph">
<p>When enabling DEBUG, you can specify a specific category to debug.  For
example, to see debug details for POP activity, you would type
<code>logger.zimbra.pop=DEBUG</code>.</p>
</div>
<div class="paragraph">
<p>The following categories are predefined in <code>log4j</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.acl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACL operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backup and restore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inmemory cache operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.calendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.dav</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAV operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.dbconn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database connection tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.extensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server extension loading</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail filtering</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.gal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAL operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.imap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP protocol operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filesystem operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.lmtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LMTP operations (incoming mail)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.mailbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General mailbox operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.misc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Miscellaneous</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.op</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes to mailbox state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.pop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP protocol operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.redolog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redo log operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.security</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security events</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User session tracking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.smtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP operations (outgoing mail)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.soap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAP protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.sqltrace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.store</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail store disk operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync client operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.system</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startup/shutdown and other system messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.wiki</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wiki operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.zimlet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet operations</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Changes to the log level take affect immediately.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 54. Logging Events</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Level</th>
<th class="tableblock halign-left valign-top">Local?</th>
<th class="tableblock halign-left valign-top">Syslog</th>
<th class="tableblock halign-left valign-top">SNMP Trap</th>
<th class="tableblock halign-left valign-top">When Used</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FATAL</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates very severe error events that the application to abort or impact
a large number of users.  For example, being unable to contact the MariaDB
database.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ERROR</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates error events that might still allow the application to continue
running or impact a single user.  For example, a single mailbox having a
corrupt index or being unable to delete a message from a mailbox.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>WARN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates potentially harmful situations but are usually recoverable or
can be ignored.  For example, user log in failed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>INFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Designates information messages that highlight the progress of the
application, basic transaction-level logging.  For example, server
start-ups, mailbox creation/deletion, account creation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DEBUG</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Events that would generally be useful to help a customer debug problems.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>(*) A few non-critical messages such, as service startup messages, will
generate traps.</p>
</div>
</div>
<div class="sect3">
<h4 id="_protocol_trace">Protocol Trace</h4>
<div class="paragraph">
<p>Protocol trace is available in the following logging categories:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>zimbra.smtp
zimbra.lmtp
zimbra.soap
zimbra.imap
zimbra.imap-client
zimbra.pop
zimbra.pop-client</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_reviewing_mailbox_log_records">Reviewing mailbox.log Records</h4>
<div class="paragraph">
<p>The <code>mailbox.log</code> file contains every action taken on the mailbox server,
including authentication sessions, LMTP, POP3, and IMAP servers, and Index
server.  Review the <code>mailbox.log</code> to find information about the health of
your server and to help identify problems.</p>
</div>
<div class="paragraph">
<p><code>mailbox.log</code> records valid and invalid login attempts, account activity
such as opening email, deleting items, creating items, indexing of new
mail, server activities including start and stop.  The progress of an
activity on the mail server is logged as INFO.  If the expected results of
the activity fails and errors occurs, an exception is written to the log.</p>
</div>
<div class="paragraph">
<p>You can set up logging options for a single account in order to trace
account activity for one user without filling up mailbox.log with log
messages for unrelated accounts.  See <a href="#command_line_utilities">Command-Line
Utilities</a>, the <code>zmprov</code> miscellaneous section.</p>
</div>
<div class="paragraph">
<p><strong>Log pattern</strong></p>
</div>
<div class="paragraph">
<p>by default log entries in <code>mailbox.log</code> have the following Log4j pattern:</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>%d %-5p [%t] [%z] %c{1} - %m%n</p>
</div>
</div>
</div>
<div class="paragraph">
<p>This pattern consists of 6 blocks of data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Date and time (e.g.: <code>2021-01-22 19:23:07,100</code>)</p>
</li>
<li>
<p>Log level (e.g. <code>INFO</code>)</p>
</li>
<li>
<p>Thread name (e.g. <code>[qtp1043351526-547:https:https://localhost:7071/service/admin/soap/DeleteAccountRequest]</code>, <code>[Index-9]</code>, etc.)</p>
</li>
<li>
<p>Zimbra Collaboration context</p>
</li>
<li>
<p>Component name (e.g. <code>soap</code>, <code>mailbox</code>, <code>mbxmgr</code>, etc.)</p>
</li>
<li>
<p>Log message. <strong>Note:</strong> the log message section may span multiple lines. When a log message contains an exception, the stack trace will always start on a new line below the error message.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can read more about Log4j patterns in <a href="https://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html">Log4j PatternLayout documentation</a>.</p>
</div>
<div class="paragraph">
<p><strong>Thread name in mailbox.log</strong></p>
</div>
<div class="paragraph">
<p>Thread names in mailbox.log are prefixed to identify internal components. Most threads have one of the following naming convention: "<strong>{thread prefix}-{thread number}</strong>" or "<strong>{thread prefix}-{thread number}:{url}</strong>".</p>
</div>
<div class="paragraph">
<p>The following <strong>{thread prefix}</strong> values are currently used for thread names in Zimbra Collaboration: <code>btpool</code>, <code>pool</code>, <code>LmtpServer</code>, <code>ImapServer</code>,<code>ImapSSLServer</code>, <code>Pop3Server</code>, <code>Pop3SSLServer</code>, <code>ScheduledTask</code>, <code>Timer</code>, <code>AnonymousIoService</code>, <code>CloudRoutingReaderThread</code>, <code>GC</code>, <code>SocketAcceptor</code>, <code>Thread</code>, <code>qtp</code>.</p>
</div>
<div class="paragraph">
<p>Threads with prefix <code>qtp</code> are created by Jetty <code>QueuedThreadPool</code> and have the following naming convention: "<strong>qtp{hash code}-{thread number}:{url}</strong>" where <strong>{hash code}</strong>` is the hash code value of the instance of <code>QueuedThreadPool</code> that owns the thread (see <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Object.html#hashCode()">Object::hashCode</a> in Java platform documentation).</p>
</div>
<div class="paragraph">
<p><strong>{thread number}</strong> in thread names is an integer that monotonically increases within each thread factory. Thread numbers are reset when <code>mailboxd</code> process is stopped or restarted.</p>
</div>
<div class="paragraph">
<p>Log records reported by threads that serve SOAP requests will usually contain URL of the request being served in <strong>{url}</strong> part of thread name, as in the following example:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/zwclogmessage.png" alt="Mailbox Log Entry for SOAP"></span></p>
</div>
<div class="paragraph">
<p>Due to a known bug in Zimbra Collaboration <strong>{url}</strong> part of the thread name may contain duplicate protocol identifier, as in the following example:</p>
</div>
<div class="paragraph">
<p><code>[qtp1043351526-547:https:https://localhost:7071/service/admin/soap/DeleteAccountRequest]</code></p>
</div>
<div class="paragraph">
<p><strong>Zimbra Collaboration Context in mailbox.log</strong></p>
</div>
<div class="paragraph">
<p><code>[%z]</code> section in the log pattern describes Zimbra Collaboration context and consists of key-value pairs in the format <code>key=value</code>, separated by semi-colons (;). In cases where a value contains a semi-colon, the semi-colon is replaced with a double semi-colon (;;). E.g., browser UserAgent strings often include semi-colons, such as this one "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Safari/537.36". In mailbox.log, this UserAgent string will appear as following:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/doublesemicolon.png" alt="ua value with double semi-colon"></span></p>
</div>
<div class="paragraph">
<p>The following key value pairs are currently supported and may be recorded in log entries in any order and any combination:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ip</code>&#8201;&#8212;&#8201;IP of the TCP/IP client making a request</p>
</li>
<li>
<p><code>oip</code>&#8201;&#8212;&#8201;originating IP address. When a request is made through NGINX proxy, this value will contain the IP address of the client application, while <code>ip</code> value will contain the IP address of the proxy server</p>
</li>
<li>
<p><code>cid</code>&#8201;&#8212;&#8201;connection id of a server that is monotonically increasing - useful for tracking individual connections</p>
</li>
<li>
<p><code>id</code>&#8201;&#8212;&#8201;ID of the target account</p>
</li>
<li>
<p><code>name</code>&#8201;&#8212;&#8201;name of the target account (email address)</p>
</li>
<li>
<p><code>aid</code>&#8201;&#8212;&#8201;ID of the authenticated account. Only present if target account is different then authenticated account</p>
</li>
<li>
<p><code>aname</code>&#8201;&#8212;&#8201;name of the authenticated account. Only present if target account is different then authenticated account</p>
</li>
<li>
<p><code>mid</code>&#8201;&#8212;&#8201;ID of requested mailbox. Only present if request is dealing with a mailbox</p>
</li>
<li>
<p><code>ua</code> &#8201;&#8212;&#8201;name of the client application (i.e. User Agent)</p>
</li>
<li>
<p><code>via</code>&#8201;&#8212;&#8201;list of IP addresses and user-agents of the request&#8217;s proxy chain</p>
</li>
<li>
<p><code>soapId</code>&#8201;&#8212;&#8201;ID assigned to a SOAP request to track proxied hops for a particular request</p>
</li>
<li>
<p><code>msgid</code>&#8201;&#8212;&#8201;value of Message-ID header of the message being operated on</p>
</li>
<li>
<p><code>ds</code>&#8201;&#8212;&#8201;name of the Data Source being operated on</p>
</li>
<li>
<p><code>port</code>&#8201;&#8212;&#8201;server port to which the client connected</p>
</li>
<li>
<p><code>oport</code>&#8201;&#8212;&#8201;originating port number of request</p>
</li>
<li>
<p><code>oproto</code>&#8201;&#8212;&#8201;originating protocol of request. This can be passed by internal components that make SOAP requests on behalf of a user (e.g. MTA)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The example below is a record showing that
on October 25, 2021, 28 minutes after midnight, a POP3 client with IP address <code>222.173.186.17</code> has contacted the Zimbra Collaboration server and that the request was proxied through a local proxy server with IP <code>10.1.1.136</code>.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/poplogmessage.png" alt="Mailbox Log Entry for POP"></span></p>
</div>
<div class="paragraph">
<p>The following example shows a record of a failed <code>IMAP STATUS</code> request sent by <code>user1@mydomain.com</code> using AquaMail mobile app. The user&#8217;s device has IP address <code>72.83.144.255</code> (as reported in <code>oip</code> field). The request came to IMAP server via Zimbra Collaboration nginx proxy, which has IP address <code>10.4.4.138</code> (as reported in <code>ip</code> and <code>via</code> fields).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/imaplogmessage.png" alt="Mailbox Log Entry for IMAP"></span></p>
</div>
<div class="paragraph">
<p>The following example shows a record of LMTP server delivering a message. The IP address in this log message most likely belongs to Zimbra Collaboration MTA running on local network.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/lmtplogmessage.png" alt="Mailbox Log Entry for LMTP"></span></p>
</div>
<div class="paragraph">
<p>The next example shows a record of <code>MailboxPurge</code> thread purging message with ID 462 from the mailbox of <code>test@mydomain.net</code>. This log message does not have <code>ip</code>, <code>oip</code>, <code>port</code> or <code>via</code> fields, because it originates from an internal process rather than from an external request.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/shortlogmessage.png" alt="Mailbox Log Entry for Purge"></span></p>
</div>
<div class="sect4">
<h5 id="_handler_exceptions_and_stack_traces">Handler Exceptions and Stack Traces</h5>
<div class="paragraph">
<p>If an error occurs during the progress of an activity, a handler exception
is added to the end of the log record to notify you that an event occurred
during the execution of the process that disrupted the normal flow.  This
signals that some type of error was detected.</p>
</div>
<div class="exampleblock">
<div class="title">Example 19. Handler Exception</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>007-06-25 00:00:10,379 INFO [btpool0-1064] [name=nriers@example.com;mid=228;ip=10.2.3.4;ua=zimbra Desktop/0.38;] SoapEngine - <strong>handler exception</strong></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Sometimes a stack trace is displayed after the exceptions notification.  A
stack trace reports the threads and monitors in Zimbra&#8217;s <strong>mailboxd</strong>
service.  This information aids in debugging, because the trace shows where
the error occurred.  The last few entries in the stack often indicate the
origin of the problem.  When the <strong>caused by</strong> descriptor is included in the
log line, this is the root of the error.  In the example below, the error
was caused by 501, bad address syntax.</p>
</div>
<div class="exampleblock">
<div class="title">Example 20. Stack Trace</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>com.example.cs.mailbox.MailServiceException: <strong>Invalid address</strong>: Jon R
at com.example.cs.mailbox.<strong>MailServiceException.internal_SEND_FAILURE</strong> (MailServiceException.java:412)
at com.example.cs.mailbox.<strong>MailServiceException.SEND_ABORTED_ADDRESS_FAILURE</strong> MailServiceException.java:416)
...
at org.mortbay.thread.BoundedThreadPool$PoolThread.run(BoundedThreadPool.java:442)

<strong>Caused by</strong>: com.example.cs.mailbox.MailSender$SafeSendFailedException: 501 Bad address syntax; chained exception is: com.sun.mail.smtp.SMTPAddressFailedException: 501 Bad address syntax
at com.sun.mail.smtp.SMTPTransport.rcptTo(SMTPTransport.java:1196)
at com.sun.mail.smtp.SMTPTransport.sendMessage(SMTPTransport.java:584)
at javax.mail.Transport.send0(Transport.java:169)
at javax.mail.Transport.send(Transport.java:98)
at com.example.cs.mailbox.MailSender.sendMessage(MailSender.java:409)
at com.example.cs.mailbox.MailSender.sendMimeMessage(MailSender.java:262)
... 30 more</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mailbox_log_files">Mailbox log files</h5>
<div class="paragraph">
<p>The <code>mailbox.log</code> files rotate daily.  The mailbox log files are saved in
<code>/opt/zimbra/log</code>.  Previous <code>mailbox.log</code> file names include the date the
file was made.  The log without a date is the current log file.  You can
back up and remove these files.</p>
</div>
</div>
<div class="sect4">
<h5 id="_troubleshooting_mail_problems">Troubleshooting Mail Problems</h5>
<div class="paragraph">
<p>To review the <code>mailbox.log</code> for errors, search for the email address or the
service that is experiencing the problem.  Also, search for WARN or ERROR
log levels, read the text of the message.  When you find the error, review
the records, tracing the events that happened before the problem was
recorded.</p>
</div>
</div>
<div class="sect4">
<h5 id="_system_crashing">System Crashing</h5>
<div class="paragraph">
<p>When your system crashes, locate the startup message and then look for
errors before the startup message date.  This example shows an
out-of-memory error on June 17, 2021.</p>
</div>
<div class="exampleblock">
<div class="title">Example 21. Startup message</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2021-06-25 01:56:18,725 INFO [main] [] soap - Servlet SoapServlet starting up</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Look for errors before the startup message.</p>
</div>
<div class="exampleblock">
<div class="title">Example 22. Error message</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2021-06-17 20:11:34,194 FATAL [btpool0-3335] [name=samd@example.com;aname=abcadmin@example.com;mid=142;ip=10.3.4.5;ua=zimbraConnectorForBES/5.0.207;] system - handler exception java.lang.OutOfMemoryError: PermGen space</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mail_delivery_problem">Mail Delivery Problem</h5>
<div class="paragraph">
<p>Locate the "LmtpServer" service.  This example includes a stack trace
report with a <strong>caused by</strong> explanation that the recipient address was
rejected as the address must be a fully-qualified address.</p>
</div>
<div class="exampleblock">
<div class="title">Example 23. Mail delivery problem</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2021-06-25 10:47:43,008 INFO [<strong>LmtpServer</strong>-250]
[name=bigen@example.com;mid=30;msgid=&lt;1291804360.35481182793659172.JavaMail.root@example.com&gt;;] <strong>lmtp - rejecting message bigen@example.com: exception occurred</strong>
com.zimbra.cs.mailbox.MailServiceException: redirect to too failed
at com.zimbra.cs.mailbox.MailServiceException.internal_SEND_FAILURE (MailServiceException.java:412)
at com.zimbra.cs.mailbox.MailServiceException.SEND_FAILURE(MailServiceException.java:424)
at com.zimbra.cs.filter.zimbraMailAdapter.executeActions(zimbraMailAdapter.java:286)
at org.apache.jsieve.SieveFactory.evaluate(SieveFactory.java:151)
at com.zimbra.cs.filter.RuleManager.applyRules(RuleManager.java:177)
at com.zimbra.cs.lmtpserver.zimbraLmtpBackend.deliverMessageToLocalMailboxes(zimbraLmtpBackend.java:325)
at com.zimbra.cs.lmtpserver.zimbraLmtpBackend.deliver(zimbraLmtpBackend.java:140)
at com.zimbra.cs.lmtpserver.LmtpHandler.doDATA(LmtpHandler.java:441)
at com.zimbra.cs.lmtpserver.LmtpHandler.processCommand(LmtpHandler.java:205)
at com.zimbra.cs.tcpserver.ProtocolHandler.processConnection(ProtocolHandler.java:231)
at com.zimbra.cs.tcpserver.ProtocolHandler.run(ProtocolHandler.java:198)
at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(Unknown Source)
at java.lang.Thread.run(Thread.java:619)

<strong>Caused by:</strong>
com.zimbra.cs.mailbox.MailSender$SafeSendFailedException: 504 &lt;too&gt;: Recipient address rejected: need fully-qualified address ;
chained exception is: com.sun.mail.smtp.SMTPAddressFailedException: 504 &lt;too&gt;: Recipient address rejected: need fully-qualified address
at com.sun.mail.smtp.SMTPTransport.rcptTo(SMTPTransport.java:1196)
at com.sun.mail.smtp.SMTPTransport.sendMessage(SMTPTransport.java:584)
at javax.mail.Transport.send0(Transport.java:169)
at javax.mail.Transport.send(Transport.java:120)
at com.zimbra.cs.filter.zimbraMailAdapter.executeActions(zimbraMailAdapter.java:281)
... 10 more</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_account_error_login_error">Account Error - Login error</h5>
<div class="paragraph">
<p><code>mailbox.log</code> logs any successful or unsuccessful login attempts from IMAP,
POP3 or ZWC.  When you are looking for a login error, start by looking for
"Auth."  This example shows that someone from IP address 10.4.5.6 was
trying to log in as admin on the Zimbra Web Client, using Firefox in a
Windows OS.  Permission was denied because it was not an admin account.</p>
</div>
<div class="exampleblock">
<div class="title">Example 24. Account Error - Login error</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>2021-06-25 09:16:11,483 INFO [btpool0-251] [ip=10.4.5.6;ua=zimbraWebClient - FFX.X (Win);] SoapEngine - <strong>handler exception</strong>
com.zimbra.common.service.ServiceException: permission denied: not an admin account
at com.zimbra.common.service.ServiceException.PERM_DENIED(ServiceException.java:205)
at com.zimbra.cs.service.admin.<strong>Auth</strong>.handle(<strong>Auth</strong>.java:103)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_account_errors_imap_or_pop_related">Account Errors - IMAP or POP related</h5>
<div class="paragraph">
<p>When you are looking for a log because of an IMAP or POP issue, look for
"ImapServer/Pop3Server." This example shows a fatal IMAP server error
occurred while trying to connect <a href="mailto:siress@example.com">siress@example.com</a>.</p>
</div>
<div class="exampleblock">
<div class="title">Example 25. Account Error - IMAP error</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mailbox.log.2021-06-19:2021-06-19 15:33:56,832 FATAL [<strong>ImapServer</strong>-2444] [name=sires@example.com;ip=127.0.0.1;] system - Fatal error occurred while handling connection</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_reading_a_message_header">Reading a Message Header</h3>
<div class="paragraph">
<p>Each email message includes a header that shows the path of an email from
its origin to destination.  This information is used to trace a message&#8217;s
route when there is a problem with the message.  The Zimbra email message
header can be viewed from the Zimbra Web Client Message view.  Right-click
on a message and select <strong>Show Original</strong>.</p>
</div>
<div class="paragraph">
<p>The following lines are in the message header:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Date</strong>&#8201;&#8212;&#8201;The date and time the message was sent.  When you specify time,
you can specify range by adding start and stop time to search for messages.</p>
</li>
<li>
<p><strong>From</strong>&#8201;&#8212;&#8201;The name of the sender and the email address</p>
</li>
<li>
<p><strong>To</strong>&#8201;&#8212;&#8201;The name of the recipient and the email address.  Indicates
primary recipients.</p>
</li>
<li>
<p><strong>Message-ID</strong>&#8201;&#8212;&#8201;Unique number used for tracing mail routing</p>
</li>
<li>
<p><strong>In-Reply-To</strong>&#8201;&#8212;&#8201;Message ID of the message that is a reply to.  Used to
link related messages together.</p>
</li>
<li>
<p><strong>Received: from</strong>&#8201;&#8212;&#8201;The name and IP address the message was sent from. The
header displays Received: from information from the MTA to the LMTP and
from the local host.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_fixing_corrupted_mailbox_index">Fixing Corrupted Mailbox Index</h3>
<div class="paragraph">
<p>Mail messages and attachments are automatically indexed before messages are
deposited in a mailbox.  Each mailbox has an index file associated with it.
This index file is required to retrieve search results from the mailbox.</p>
</div>
<div class="paragraph">
<p>If a mailbox&#8217;s index file becomes corrupt or is accidentally deleted, you
can re-index the messages in the mailbox from the Administration Console.</p>
</div>
<div class="paragraph">
<p>Text searches on an account might or might not fail with errors when the
index is corrupt.  You cannot count on a user reporting a failed text
search to identify that the index is corrupt.  You must monitor the index
log for messages about corrupt indexes.  If the server detects a corrupt
index, a message is logged to the Zimbra mailbox.log at the WARN logging
level.  The message starts with <strong>Possibly corrupt index</strong>.  When this
message is displayed, the administrator must correct the problem.  In many
cases correcting the problem might mean reindexing the mailbox.</p>
</div>
<div class="paragraph">
<p>Reindexing a mailbox&#8217;s content can take some time, depending on the number
of messages in the mailbox.  Users can still access their mailbox while
reindexing is running, but because searches cannot return results for
messages that are not indexed, searches may not find all results.</p>
</div>
<div class="sect3">
<h4 id="_checking_for_index_corruption">Checking for Index Corruption</h4>
<div class="paragraph">
<p>Run a sanity check on a specific mailbox index using the <code>zmprov
verifyIndex</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov verifyIndex &lt;user@example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If problems are detected, a failure status is returned and a repair can
be performed on the index.</p>
</div>
</div>
<div class="sect3">
<h4 id="_repairing_and_reindexing_a_corrupt_index">Repairing and Reindexing a Corrupt Index</h4>
<div class="paragraph">
<p>Use the <code>reIndexMailbox</code> command to repair and reindex a corrupt index.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov reIndexMailbox &lt;user@example.com&gt; start</code></pre>
</div>
</div>
<div class="paragraph">
<p>This returns a status of <em>started</em>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_snmp_monitoring_and_configuration">SNMP Monitoring and Configuration</h3>
<div class="sect3">
<h4 id="_snmp_monitoring_tools">SNMP Monitoring Tools</h4>
<div class="paragraph">
<p>You will probably want to implement server monitoring software in order to
monitor system logs, CPU and disk usage, and other runtime information.</p>
</div>
<div class="paragraph">
<p>Zimbra Collaboration uses swatch to watch the syslog output to generate
SNMP traps.</p>
</div>
</div>
<div class="sect3">
<h4 id="_snmp_configuration">SNMP Configuration</h4>
<div class="paragraph">
<p>Zimbra Collaboration includes an installer package with SNMP monitoring.
This package should be run on every server (Zimbra Collaboration, OpenLDAP,
and Postfix) that is part of the Zimbra Collaboration configuration.</p>
</div>
<div class="paragraph">
<p>The only SNMP configuration is the destination host to which traps should
be sent.</p>
</div>
</div>
<div class="sect3">
<h4 id="_errors_generating_snmp_traps">Errors Generating SNMP Traps</h4>
<div class="paragraph">
<p>The Zimbra Collaboration error message generates SNMP traps when a service
is stopped or is started.  You can capture these messages using third-party
SNMP monitoring software and direct selected messages to a pager or other
alert system.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_checking_mariadb">Checking MariaDB</h3>
<div class="paragraph">
<p>The MariaDB database is automatically checked weekly to verify the health
of the database.  This check takes about an hour.  If any errors are found,
a report is sent to the administrator&#8217;s account.  The report name that runs
the MariaDB check is <strong>zmbintegrityreport,</strong> and the crontab is automatically
configured to run this report once a week.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the MariaDB database is checked, running this report can consume a
significant amount of I/O.  This should not present a problem, but if you
find that running this report does affect your operation, you can change
the frequency with which zmbintegrityreport is run.  See
<a href="#zcs_crontab_jobs">ZCS Crontab Jobs</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_checking_for_zimbra_collaboration_software_updates">Checking for Zimbra Collaboration Software Updates</h3>
<div class="paragraph">
<p>When Zimbra Collaboration is installed, the Zimbra Collaboration software update
utility is automatically configured to check for the latest Zimbra Collaboration
version once a day and if there is an update, to send notification to the
address that is configured in the Administration Console&#8217;s <strong>Server
Updates</strong>.</p>
</div>
<div class="paragraph">
<p>The dates and times Zimbra Collaboration checked for updates is saved to the
<strong>Updates</strong> tab and an email notification is sent out until you update the
ZCS version.  If you do not want to receive an email
notification of updates, disable <strong>Send notification email when updates are
available</strong>.</p>
</div>
<div class="paragraph">
<p>You can configure the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Server that checks for updates</strong>&#8201;&#8212;&#8201;Available servers are listed and only
one server is configured.  The selected server checks for updates and the
result of the update response from www.zimbra.com is stored in LDAP.</p>
</li>
<li>
<p><strong>Check for updates every x</strong>&#8201;&#8212;&#8201;The default is to check once a day.  You
can change the frequency interval to check every x hours, minutes, or
seconds.  A cron job is configured to check for new updates.  If the
frequency interval is less than 2 hours, the crontab file must be modified.</p>
</li>
<li>
<p><strong>Updates URL</strong>&#8201;&#8212;&#8201;This address is the URL that the server connects to
when checking for updates.  When a Zimbra Collaboration server checks for
updates, it transmits its version, platform, and build number to Zimbra.
Normally, this URL is not changed.</p>
</li>
<li>
<p>To be notified of updates, check the <strong>Send notification email when
updates are available</strong> and enter the send to and send from addresses.  The
default address is the administrator&#8217;s address.</p>
</li>
<li>
<p>A generic email is created.  The subject and content of the email can be
changed.</p>
</li>
<li>
<p>When a server polls the URL specified, the response is displayed.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_updating_zimbra_connector_for_microsoft_outlook">Updating Zimbra Connector for Microsoft Outlook</h3>
<div class="paragraph">
<p>The Zimbra Connector for Microsoft Outlook (ZCO) msi file is available from
the Zimbra Utilities Downloads page on the Administration Console.  When a
newer version of ZCO is released before a new version of ZCS, you can
upload the newer ZCO msi file to the ZCS server from the Administration
Console.  The file is uploaded to the
<code>/opt/zimbra/jetty/webapps/zimbra/downloads</code> folder.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Tools and Migration &#8594; Client Upload</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the new ZCO file to a computer that you can access from
<strong>Client Upload</strong> in the Administration Console</p>
</li>
<li>
<p>Click <strong>Browse</strong> to locate the ZCO file to upload.</p>
</li>
<li>
<p>Restart ZCS:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
<div class="paragraph">
<p>or run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmupdatedownload</code></pre>
</div>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>downloads/index.html</code> file is updated with the latest ZCO client
version.  This new file can be downloaded from the ZCO link on the
Administration Console <strong>Home &#8594; Tools and Migration &#8594; Download</strong> page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you do not restart the server, the ZCO download link on the Zimbra
Utilities Download page does not select the newer version to download.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_notifications_and_alerts_sent_by_zimbra_collaboration">Notifications and Alerts Sent by Zimbra Collaboration</h3>
<div class="sect3">
<h4 id="_service_status_change_notification">Service status change notification</h4>
<div class="paragraph">
<p>This notification is sent when service are stopped or restarted.</p>
</div>
<div class="sect4">
<h5 id="_server_start_notification_message">Server Start Notification Message</h5>
<div class="listingblock">
<div class="content">
<pre>Subject: Service &lt;service_name&gt; started on &lt;zimbra_host&gt;

Service status change: &lt;zimbra_host&gt; &lt;service&gt; changed from stopped to running</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_server_stop_notification_message">Server Stop Notification Message</h5>
<div class="listingblock">
<div class="content">
<pre>Subject: Service &lt;service_name&gt; stopped on &lt;zimbra_host&gt;

Service status change: &lt;zimbra_host&gt; &lt;service&gt; changed from running to stopped</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_disk_usage_notification">Disk usage notification</h5>
<div class="paragraph">
<p>A warning alert email notification is sent to the admin account when disk
space is low.  The default is to send a warning alert when the threshold
reaches 85% and a critical alert when the threshold reaches 95%</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Subject: Disk &lt;volume&gt; at ##% on &lt;zimbra_host&gt;

Disk warning: &lt;zimbra_host&gt; &lt;volume&gt; on device &lt;device_name&gt; at ##%</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_duplicate_mysqld_processes_running_notification">Duplicate mysqld processes running notification</h4>
<div class="paragraph">
<p>A script is executed to see if mysqld process is running to detect cases
where corruption is likely to be caused.  An email is generated if it finds
more than 1 mysqld process running.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Subject: ZCS: Duplicate mysqld processes detected!

PID:$pid PPID:$ppid PGRP:$pgrp

CMD: $cmdline

More then $maxcnt mysqld processes are running Parent processes
include: $procs This should be investigated immediately as it may lead to
database corruption</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ssl_certificates_expiration_notification">SSL certificates expiration notification</h4>
<div class="paragraph">
<p>A report runs on the first of each month and warns of certificates expiring
with the next 30 days.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Subject: ZCS: SSL Certificates approaching expiration!

The Administration Console and CLI Certificate Tools guide provides
instructions on how to replace you self-signed or commercial certificate.

https://wiki.zimbra.com/index.php?title=Administration_Console_and_CLI_Certificate_Tools SSL Certificate expiration checked with $0 on &lt;zimbra_host&gt;.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_daily_report_notification">Daily report notification</h4>
<div class="paragraph">
<p>When the logger package is installed, a daily mail report is automatically
scheduled in the crontab.  The report is sent daily to the administrator&#8217;s
mailbox.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Subject: Daily mail report for &lt;day&gt;

&lt;daily report data&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_database_integrity_check_notification">Database integrity check notification</h4>
<div class="paragraph">
<p>The MariaDB database can be checked by running the zmdbintegrityreport
automatically scheduled in the crontab to run on a weekly basis.  A report
is sent to the administrator&#8217;s mailbox.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Subject: Database Integrity check report for &lt;zimbra_host&gt;

Generating report can't run $cmd: $!

Database errors found.

$cmd --password=XXXXXXXX

&lt;cmd output&gt;

No errors found

command failed $!</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_backup_completion_notification">Backup completion notification</h4>
<div class="paragraph">
<p>When configuring the type of backups that should be run, you can set up to
receive notification about the results of a backup session.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Subject: ZCS BackupReport:SUCCESS

Server: &lt;server&gt;

Type: incremental

Status: completed

Started: Fri, 2021/07/13 01:00:05.488 PDT

Ended: Fri, 2021/07/13 01:10:09.842 PDT

Redo log sequence range: 2 ..  2

Number of accounts: 500</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup_and_restore">Backup and Restore (*)</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Starting with Zimbra 8.8</strong>, there are two versions of this feature, Standard and New Generation (NG) versions.
Zimbra 8.7 and earlier included only the Standard version, which is explained below.
To use and enable the NG version of this feature with Zimbra 8.8 and later, refer to the specific NG chapter later in this Guide.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Standard Backup (aka Classic Backup) is deprecated and will be removed in the next release following Zimbra 8.8.12.
Installations that have not yet migrated to new Network Edition NG Modules or ZSP are encouraged to do so.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zimbra Collaboration includes a configurable backup manager that resides on every
Zimbra Collaboration server and performs both backup and restore functions. You
do not have to stop the Zimbra Collaboration server in order to run the backup
process.</p>
</div>
<div class="paragraph">
<p>This chapter describes how data is backed up and restored and how to use
the CLI tools to backup or restore your Zimbra Collaboration mailbox
server. In addition, this chapter also provides information and general
guidelines for disaster recovery.</p>
</div>
<div class="sect2">
<h3 id="_backing_up_the_mailbox_server_2">Backing Up the Mailbox Server</h3>
<div class="paragraph">
<p>Zimbra Collaboration includes a configurable backup manager that resides
on every Zimbra Collaboration server and performs both backup and
restore functions. You do not have to stop the Zimbra Collaboration
server in order to run the backup process. The backup manager can be
used to restore a single user, rather than having to restore the entire
system in the event that one user&#8217;s mailbox becomes corrupted. Full and
incremental backups are saved in <code>/opt/zimbra/backup</code>.</p>
</div>
<div class="sect3">
<h4 id="_redo_log">Redo Log</h4>
<div class="paragraph">
<p>Each Zimbra mailbox server generates redo logs that contain current and
archived transactions processed by the message store server since the
last incremental backup.</p>
</div>
<div class="paragraph">
<p>When the server is restored, after the backed up files are fully
restored, any redo logs in the archive and the current redo log in use
are replayed to bring the system to the point before the failure.</p>
</div>
<div class="paragraph">
<p>When the current redo log file size reaches 100MB, the current redo log
rolls over to an archive directory. At that point, the server starts a
new redo log. All uncommitted transactions from the previous redo log
are preserved. In the case of a crash, when the server restarts, the
current redo logs are read to re-apply any uncommitted transactions.</p>
</div>
<div class="paragraph">
<p>When an incremental backup is run, the redo logs are moved from the
archive to the backup directory.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backup_methods">Backup Methods</h3>
<div class="paragraph">
<p>Two backup methods are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>standard backup method</strong> is appropriate for enterprise deployments
where full backups are run during non-working days.</p>
</li>
<li>
<p>The <strong>auto-grouped backup method</strong> is recommended for large Zimbra Collaboration
environments where running a full backup of all accounts at one time would
take too long.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_standard_backup">Standard Backup</h4>
<div class="paragraph">
<p>The standard backup method runs a weekly full backup and daily
incremental backups. A full backup process backs up all the information
needed to restore mailboxes, including the LDAP directory server,
database, index directory, and message directory for each mailbox.</p>
</div>
<div class="paragraph">
<p>When backing up shared messages, if a file representing a message
already exists in the backup, it flags this object as such and does not
copy its content again.</p>
</div>
<div class="paragraph">
<p>An incremental backup process backs up the LDAP data and gathers all the
redo logs written since the last incremental backup. If the incremental
backup process finds no previous full backup for a mailbox, a full
backup is performed on that mailbox.</p>
</div>
<div class="paragraph">
<p>Incremental backups move the redo logs to the backup directory. The redo
logs are a journal of every activity that has taken place. They contain
a full copy of all messages delivered, as well as metadata such as tags,
contacts, and conversations.</p>
</div>
<div class="paragraph">
<p>These backup files can be used to restore the complete mailbox server or
individual mailboxes so that account and message data is completely
restored.</p>
</div>
<div class="paragraph">
<p>The LDAP directory is backed up as part of either the full or
incremental backup process. All accounts, domains, servers, COS, and
other data are backed up.</p>
</div>
<div class="paragraph">
<p>Each mailbox server generates redo logs that contain every transaction
processed by that server. If an unexpected shutdown occurs to the
server, the redo logs are used for the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To ensure that no uncommitted transactions remain, the server reads
the current redo log upon startup and re-executes and completes any
uncommitted transactions.</p>
</li>
<li>
<p>To recover data written since the last full backup in the event of a
server failure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When the server is restored, after the backed up files are fully
restored, any redo logs in the archive and the current redo log in use
are replayed to bring the system to the point before the failure.</p>
</div>
<div class="paragraph">
<p>The Zimbra MTA is not backed up, as the data is only on the server for a
very short time.</p>
</div>
<div class="paragraph">
<p>Custom configurations&#8201;&#8212;&#8201;such as <code>mailboxd&#8217;s `jetty/etc/*.xml</code>&#8201;&#8212;&#8201;are not backed up.</p>
</div>
<div class="sect4">
<h5 id="_backup_notification">Backup Notification</h5>
<div class="paragraph">
<p>A backup report is sent to the admin mailbox when full and incremental
backups are performed. This report shows the success or failure of the
backup and includes information about when the backup started and ended,
the number of accounts backed up and redo log sequence range.</p>
</div>
<div class="paragraph">
<p>If the backup failed, additional error information is included.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_auto_grouped_backup_method">Auto-Grouped Backup Method</h4>
<div class="paragraph">
<p>The auto-grouped backup method runs a full backup for a different group
of mailboxes at each scheduled backup. The auto-grouped backup method is
designed for very large Zimbra Collaboration environments where backing
up all accounts can take a long time. Because auto-grouped backups
combine full and incremental backup functions, there is no need for
incremental backups. Each auto-grouped session runs a full backup of the
targeted group of mailboxes. It is not recommended to run auto-grouped
backups manually since they are scheduled from the CLI and run
automatically at the scheduled times.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_directory_structure_for_backup_files">Directory Structure for Backup Files</h3>
<div class="paragraph">
<p>The backup destination is known as a backup target. To the backup
system, it is a path in the file system of the mail server. The Zimbra
default backup directory is <code>/opt/zimbra/backup</code>.</p>
</div>
<div class="paragraph">
<p>The backup directory structure created by the standard backup process is
shown in
<a href="#standard_backup_directory_structure">Standard Backup directory structure</a>.
You can run regularly scheduled backups to the same target area without
overwriting previous backup sessions.</p>
</div>
<div class="paragraph">
<p>The <strong>accounts.xml</strong> file lists all accounts that are in all the backups
combined. For each account, this file shows the account ID, the email
address, and the label of the latest full backup for that account. If
you save your backup sessions to another location, you must also save
the latest accounts.xml file to that location. The accounts.xml file is
used to look up the latest full Backup for an account during restore. If
the accounts.xml file is missing you must specify the backup label to
restore from.</p>
</div>
<div class="paragraph">
<p>The redo log directory is located at <code>/opt/zimbra/redolog/redo.log</code>. When
the current redo log file size reaches 100MB, the current redo log rolls
over to an archive directory, <code>/opt/zimbra/redolog/archive</code>. At this
point the server starts a new redo log. All uncommitted transactions
from the previous redo log are preserved. In the case of a crash, when
the server restarts, the current redo logs are read to re-apply any
uncommitted transactions.</p>
</div>
<div class="paragraph">
<p>Redo operations are time critical, therefore a directory move is
performed instead of a copy-then-delete function. This directory move
can only be performed if the source and destination paths are on the
same file system volume. In other words, the <code>redo</code> log and <code>redo-archive</code>
log must be on the same file system volume because the archive files are
a subdirectory of the redo log file system.</p>
</div>
<div class="paragraph">
<p>All incremental and auto-grouped backup sessions must be saved to the
same directory as all the redo logs must be found in the same backup
target. Standard full backup sessions can use a different target
directory.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 55. Standard Backup directory structure</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/opt/zimbra/backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default root of backups</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accounts.xml/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of all accounts, each with email file address, Zimbra ID, and latest
full backup label. The accounts.xml maintains the mapping of email
addresses to their current zimbraIds and also the most recent full backup
for each account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sessions/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root of backup sessions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>full-&lt;timestamp&gt;/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A full backup directory. The timestamp for a session is the backup start
time in GMT, including milliseconds. GMT is used rather than local time to
preserve visual ordering across daylight savings transitions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>session.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata about this backup label for a full or incremental session, such as
start and stop times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shared_blobs/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains message files that are shared among accounts in this backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global database tables and <code>localconfig</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db_schema.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database schema information for global tables. Each table dump file has a
<code>`.csv</code> format.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>localconfig.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Copy of <code>/opt/zimbra/conf/localconfig.xml</code> at the time of the backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;table name&gt;.dat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database table data dump.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>LDAP/ldap.bak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP dumps.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accounts/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Each account&#8217;s data is saved in a subdirectory of this.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;&#8230;&#8203;/zimbraId&gt;/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Root for each account.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>meta.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Metadata about this account&#8217;s backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account&#8217;s LDAP information, including aliases, identities, data sources,
distribution lists, etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap_latest.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this is present, this files links to ldap.xml of the most recent
incremental backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account-specific database table dumps.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db_schema.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database schema information for this account&#8217;s tables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;table name&gt;.dat</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database table data dump.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>blobs/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains blob files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>index/</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains Lucene index files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incr-&lt;timestamp&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An incremental backup directory. This directory is similar to the full
backup directory schema and includes these metafiles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>session.xml</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sys/db_schema.xml</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>accounts/&#8230;&#8203;/&lt;zimbraID&gt;/ldap.xml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incr-&lt;timestamp&gt;</code> does not include
<code>accounts/&#8230;&#8203;/&lt;zimbraId&gt;/db/db_schema.xml</code> because incremental backup does
not dump account tables.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For auto-grouped backups, the directory structure saves the
redo log files to the full backup session. There are no incremental
backup sessions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_backup_and_restore_using_the_administration_console">Backup and Restore Using the Administration Console</h3>
<div class="paragraph">
<p>Many of the backup and restore procedures can be run directly from the
Administration Console. In the Navigation pane, <strong>Monitoring&gt;Backup</strong>
lists each of the servers.</p>
</div>
<div class="sect3">
<h4 id="_configure_backup_from_the_admin_console">Configure Backup from the Admin Console</h4>
<div class="paragraph">
<p>Backups can be configured from the Administration Console as a global
settings configuration and as a server-specific configuration. Server
settings override global settings.</p>
</div>
<div class="paragraph">
<p>In the global settings, you can configure the email addresses to receive
notification about the results of the backup. The default is to send the
notification to the admin account.</p>
</div>
<div class="paragraph">
<p>For Auto-grouped, you configure the number of groups to divide the
backups into.</p>
</div>
<div class="paragraph">
<p>The standard backup is the default and is automatically scheduled. You do
not need to make any additional changes. But when running the auto-grouped
backup you must manually configure the backup schedule. To do so, access
the CLI and follow the steps under
<a href="#schedule_auto_group_backups">Schedule Auto-Group Backups</a>
to run <code>zmschedulebackup -D</code> to set the default
schedule for auto-grouped backups.</p>
</div>
<div class="paragraph">
<p><strong>Throttling option with auto-grouped backup.</strong> The auto-grouped backup
method automatically backs up mailboxes that have never been backed up
when the next backup is scheduled. This might not be the best option
every time a full backup is required on all mailboxes, such as
immediately after massive mailbox migrations or after a major upgrade.
Enabling <strong>Throttle automatic</strong> <strong>backups</strong> limits the mailbox count in a
daily backup to T/N. This breaks the constraint of backing up all
mailboxes in N days, but it helps backup to finish during off hours.</p>
</div>
<div class="paragraph">
<p>When all mailboxes are backed up at least once, disable throttling:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraBackupAutoGroupedThrottled TRUE</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backup_and_restore_using_the_command_line_interface">Backup and Restore Using the Command Line Interface</h3>
<div class="paragraph">
<p>The Zimbra backup and restore procedures can be run as CLI commands.</p>
</div>
<div class="paragraph">
<p>The following utilities are provided to create backup schedules,
perform full and incremental backups, restore the mail server, or
restore the LDAP server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zmschedulebackup</code>&#8201;&#8212;&#8201;This command is used to schedule full backups,
incremental backups, and deletion of old backups.</p>
</li>
<li>
<p><code>zmbackup</code>&#8201;&#8212;&#8201;This command executes full or incremental backup of the Zimbra Collaboration mailbox
server. This is run on a live server, while the <code>mailboxd</code> process and the
mailbox server are running. This command also has an option to manually
delete old backups when they are no longer needed.</p>
</li>
<li>
<p><code>zmbackupabort</code>&#8201;&#8212;&#8201;This command stops a full backup that is in process.</p>
</li>
<li>
<p><code>zmbackupabort -r</code>&#8201;&#8212;&#8201;This command stops an ongoing restore.</p>
</li>
<li>
<p><code>zmbackupquery</code>&#8201;&#8212;&#8201;This command lists the information about ongoing and
completed backups, including labels and dates.</p>
</li>
<li>
<p><code>zmrestore</code>&#8201;&#8212;&#8201;This command restores a backup to a running Zimbra Collaboration mailbox server.</p>
</li>
<li>
<p><code>zmrestoreoffline</code>&#8201;&#8212;&#8201;This command restores the Zimbra Collaboration mail server when the <code>mailboxd</code> process is stopped.</p>
</li>
<li>
<p><code>zmrestoreldap</code>&#8201;&#8212;&#8201;This command restores the complete LDAP directory
server, including accounts, domains, servers, COS and other data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Refer to <a href="#command_line_utilities">Appendix A: Command Line Utilities</a>
for usage and definitions for each of these commands.</p>
</div>
</div>
<div class="sect2">
<h3 id="_backing_up_using_the_standard_method">Backing up using the Standard Method</h3>
<div class="paragraph">
<p>When you initiate a backup, you can issue the command from the same
server being backed up, run the command remotely and specify the target
server on the command line, or use the Administration Console to start a
backup session.</p>
</div>
<div class="sect3">
<h4 id="_scheduling_a_standard_backup">Scheduling a Standard Backup</h4>
<div class="paragraph">
<p>When Zimbra Collaboration was installed, the backup schedule for the
standard method of full and incremental backups was added to the
crontab. Under the default schedule, the full backup is scheduled for
1:00 a.m., every Saturday. The incremental backups are scheduled for
1:00 a.m., Sunday through Friday.</p>
</div>
<div class="paragraph">
<p>By default, backups older than a month are deleted every night at 12
a.m.</p>
</div>
<div class="paragraph">
<p>You can change the backup schedule using the <code>zmschedulebackup</code> command.</p>
</div>
<div class="paragraph">
<p>Specify the fields as follows, separate each field with a blank space:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>minute&#8201;&#8212;&#8201;0 through 59</p>
</li>
<li>
<p>hour&#8201;&#8212;&#8201;0 through 23</p>
</li>
<li>
<p>day of the month&#8201;&#8212;&#8201;1 through 31</p>
</li>
<li>
<p>month&#8201;&#8212;&#8201;1 through 12</p>
</li>
<li>
<p>day of the week&#8201;&#8212;&#8201;0 through 7 (0 or 7 is Sunday, or use names)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Type an asterisk (*) in the fields you are not using.</p>
</div>
<div class="exampleblock">
<div class="title">Example 26. <code>zmschedulebackup</code> options</div>
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Replace the existing full backup, incremental backup and delete backup
schedule. When you use <code>-R</code>, the complete backup schedule is replaced. If
you use this command, remember to set the deletion schedule, if you want
backup sessions to be scheduled for automatic deletion. This example
replaces the existing schedule to have full backups run on Sunday at 1
a.m., incremental backups to run Monday through Saturday at 1 a.m., and
old backups deleted at 12:00 a.m. every day.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -R f &quot;0 1 * * 7&quot; i &quot;0 1 * * 1-6&quot; d 1m &quot;0 0 * * *&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>Add an additional full backup time to your current schedule. This
example adds a full backup on Thursday at 1 a.m.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -A f &quot;0 1 * * 4&quot;</code></pre>
</div>
</div>
</li>
<li>
<p>Review your backup schedule. The schedule is displayed.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -q</code></pre>
</div>
</div>
</li>
<li>
<p>Save the schedule command to a text file. This would allow you to
easily recreate the same schedule after a reinstall or upgrade</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -s</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To return backups to the default schedule use the command <code>zmschedulebackup -D</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_default_standard_backup_schedule">Default Standard Backup Schedule</h5>
<div class="paragraph">
<p>The default backup schedule is displayed similarly to the following
example:</p>
</div>
<div class="exampleblock">
<div class="title">Example 27. Default Backup Schedule</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">0 1 * * 6 /opt/zimbra/bin/zmbackup -f - all
0 1* * 0-5 /opt/zimbra/bin/zmbackup -i
0 0 * * * /opt/zimbra/bin/zmbackup -del 1m</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Read as follows:</p>
</div>
<div class="listingblock">
<div class="title">The full backup runs on 1 a.m. on Saturdays</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">0 1 * * * 6 /opt/zimbra/bin/zmbackup -f - all</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">An incremental backup runs at 1 a.m. from Sunday through Friday</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">0 1* * 0-5 /opt/zimbra/bin/zmbackup -i</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Backup sessions are deleted at midnight 1 month after they were created.</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">0 0 * * * /opt/zimbra/bin/zmbackup -del 1m</code></pre>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">How to read the crontable</div>
<div class="paragraph">
<p>Each crontab entry contains six fields that appear in this order:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top" colspan="6">Field</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>2</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>4</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>5</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>1</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>6</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/opt/zimbra/bin/zmbackup -f -all</code></p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>minute (0-59 allowed)</p>
</li>
<li>
<p>hour (0-23)</p>
</li>
<li>
<p>day of the month (1-31)</p>
</li>
<li>
<p>month (1-12 or names)</p>
</li>
<li>
<p>day of the week (0-7 or names allowed, with both 0 and 7 representing
Sunday</p>
</li>
<li>
<p>string to be executed</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The asterisk character works as a wild card, representing every
occurrence of the field&#8217;s value.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; Backup/Restore</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>You can add additional recipient addresses or change the notification email
address in the Administration Console.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_full_backup_process">Full Backup Process</h4>
<div class="paragraph">
<p>The full backup process goes through the following steps to back up the
mailbox, the database, the indexes, and the LDAP directory:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Backs up the global system data including system tables and
<code>localconfig.xml</code>.</p>
</li>
<li>
<p>Iterates through each account to be backed up and backs up the LDAP
entries for those accounts.</p>
</li>
<li>
<p>Places the account&#8217;s mailbox in maintenance mode to temporarily
block mail delivery and user access to that mailbox.</p>
</li>
<li>
<p>Backs up the mailbox.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Creates MariaDB dump for all data related to that mailbox.</p>
</li>
<li>
<p>Backs up the message directory for that mailbox.</p>
</li>
<li>
<p>Creates a backup of the index directory for that mailbox.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Returns that account&#8217;s mailbox to active mode and moves on to the
next one.</p>
</li>
<li>
<p>Backs up the LDAP directory.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A full backup is usually run asynchronously. When you begin the full
backup, the label of the ongoing backup process is immediately
displayed. The backup continues in the background. You can use the
<code>zmbackupquery</code> command to check the status of the running backup at any
time.</p>
</div>
<div class="paragraph">
<p>Backup files are saved as <code>zip</code> files without compression. To change the
default <code>zip</code> option, see <a href="#command_line_utilities">Appendix A: Command Line Utilities</a>,
zmbackup section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_incremental_backup_process">Incremental Backup Process</h4>
<div class="paragraph">
<p>Incremental backups are run using the CLI command, <strong>zmbackup</strong>. The
process for incremental backup is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Backs up the global system data including system tables and
<code>localconfig.xml</code>.</p>
</li>
<li>
<p>Iterates through each account to be backed up and backs up the LDAP
entries for those accounts.</p>
</li>
<li>
<p>Moves the archive redo logs, created since the last backup, to the
<code>&lt;backup_target&gt;/redologs</code> folder.</p>
<div class="paragraph">
<p>Archived logs that are less than an hour old at the time of incremental
backup are copied to the backup and are not deleted. These redologs are
deleted one hour after the backup. The interval is set by the
<code>localconfig</code> key <code>backup_archived_redolog_keep_time</code>. The default is 3600
seconds.</p>
</div>
<div class="paragraph">
<p>If no full backup for this account is found, the backup process performs
a full backup on this account, even if only an incremental backup was
specified.</p>
</div>
</li>
<li>
<p>Backs up the LDAP directory.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_performing_manual_backups">Performing Manual Backups</h5>
<div class="paragraph">
<p>Use the zmbackup command to perform the following backup operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Perform a manual backup of all mailboxes on server&lt;1&gt;:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackup -f -s server1.domain.com -a all</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Perform a manual, incremental backup of all mailboxes on <strong>server1</strong>
since last full backup</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackup -i -s server1.domain.com -a all</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Perform a manual, full backup of only <strong>user1&#8217;s</strong> mailbox on <strong>server1</strong></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackup -f -s server1.domain.com -a user1@domain.com</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_deleting_backup_sessions">Deleting Backup Sessions</h5>
<div class="paragraph">
<p>You can delete backup sessions either by label or by date.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deleting by label deletes that session and all backup sessions before
that session.</p>
</li>
<li>
<p>Deleting by date deletes all backup session prior to the specified
date.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example, <code>zmbackup -del 7d</code> deletes backups older than 7 days
from now. You can specify day (<code>d</code>), month (<code>m</code>), or year (<code>y</code>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_finding_a_specific_backups">Finding a Specific Backups</h4>
<div class="paragraph">
<p>Each full or incremental backup is a backup session.</p>
</div>
<div class="paragraph">
<p>Each backup session is labeled with date and time. For example, the
label <code>full-20210712.155951.123</code> says this is a backup from July 12,
2021 at 3:59:51.123.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The times set in the session label are GMT, not the local time. GMT is used
rather than local time to preserve visual ordering across daylight savings
transitions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <code>zmbackupquery</code> command to find full backup sessions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To find a specific full backup session:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery -lb full-20210712.155951.123</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To find a full backup sessions since a specific date:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery --type full --from "2021/01/01 12:45:45"</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To find all full backup sessions in the backup directory:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery --type full</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>To find the best point in time to restore for an account specify a
time window</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery -a user1@example.com --type full --from "2021/07/05 12:01:15" --to "2021/07/12 17:01:45"</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If a backup session is interrupted because the server crashes during backup
(not aborted), the interrupted backup session is saved as a temporary
session. The temporary backup session is put in
<code>&lt;backup_target&gt;/sessions_tmp</code> folder. You can use the <code>rm</code> command to delete the
directory.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aborting_a_full_backup_in_progress">Aborting a Full Backup in Progress</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Before you can abort a backup, you must know the backup session
label. This label is displayed when <code>zmbackup</code> first starts. If you do not
know the full backup label, use <code>zmbackupquery</code> to find the label.</p>
</li>
<li>
<p>Use the <code>zmbackupabort</code> command to stop a backup that is in progress.
The backup is immediately stopped and becomes a partially successful
backup.</p>
<div class="ulist">
<ul>
<li>
<p>Stop the backup, if you know the label name</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupabort -lb full-20210712.155951.123 -s server1</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Stop the backup, if you do not know the label</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmbackupquery
zmbackupabort -s server1 -lb full-20210712.155951.123</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backup_using_the_auto_grouped_method">Backup using the Auto-Grouped Method</h3>
<div class="paragraph">
<p>The auto-grouped backup method is configured either from the
Administration Console or from the CLI.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; Backup/Restore</strong> or<br>
<strong>Home &#8594; Configure &#8594; Servers &#8594; <em>server</em> &#8594; Backup/Restore</strong></p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_configuring_auto_grouped_backup_from_the_cli">Configuring Auto-Grouped Backup from the CLI</h4>
<div class="paragraph">
<p>Set the backup method in the global configuration, and you can override
the configuration on a per server basis if you do not want a particular
server to use the auto-grouped backup method.</p>
</div>
<div class="paragraph">
<p>To set up auto-grouped backup, you modify LDAP attributes with
the zmprov command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf &lt;ldap_attribute&gt; &lt;arg&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set the attributes at the server level using <code>zmprov ms</code>.</p>
</div>
<div class="paragraph">
<p>The following LDAP attributes are modified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraBackupMode</code>&#8201;&#8212;&#8201;Set it to be <strong>Auto-Grouped</strong>. The default is
Standard.</p>
</li>
<li>
<p><code>zimbraBackupAutoGroupedInterval</code>&#8201;&#8212;&#8201;Set this to the interval in either
days or weeks that backup sessions should run for a group. The default
is <code>1d</code>. Backup intervals can be 1 or more days, entered as <code>xd</code> (e.g. <code>1d</code>); or 1
or more weeks, entered as <code>xw</code> (e.g. <code>1w</code>).</p>
</li>
<li>
<p><code>zimbraBackupAutoGroupedNumGroups</code>&#8201;&#8212;&#8201;This is the number of groups to
spread mailboxes over. The default is 7 groups.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_schedule_auto_group_backups">Schedule Auto-Group Backups</h4>
<div class="paragraph">
<p>You must configure the auto-group backup schedule.</p>
</div>
<div class="paragraph">
<p>Run <code>zmschedulebackup -D</code> to set the default schedule for
auto-grouped backups based on your <code>zimbraBackupAutoGroupedInterval</code>
setting.</p>
</div>
<div class="paragraph">
<p>One group is backed up each interval. The auto-grouped backup
automatically adjusts for changes in the number of mailboxes on the
server. Each backup session backs up the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All mailboxes that have never been backed up before. These are newly
provisioned mailboxes.</p>
</li>
<li>
<p>All mailboxes that have not been backed within the number of scheduled
backup days. For example, if backups are scheduled to run over six days,
mailboxes that have not been backed up in the past 5 days are backed up.</p>
</li>
<li>
<p>More mailboxes, the oldest backup first. This is done so that the
daily auto-grouped backup load is balanced.</p>
<div class="paragraph">
<p>For example, if you configured the auto-grouped backup interval to be
daily (1d) and the number of groups to be 7, the first time auto-grouped
backup runs, all accounts are backed up. After the initial backup,
auto-grouped backup runs again the next day. This time accounts that
have been newly provisioned and a percentage of accounts close to
one-seventh of the total are backed up again. Accounts with the oldest
backup date are backed up first. The backup continues with newly
provisioned accounts and approximately one-seventh of accounts being
backed up daily over seven days.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>When backing up shared messages, if a file representing a message
already exists in the backup, it flags this object as such and does not
copy its content again.</p>
</div>
<div class="paragraph">
<p>Backup files are saved as <code>zip</code> files without compression. To change the
default <code>zip</code> option, see <a href="#command_line_utilities">Appendix A: Command Line Utilities</a>,
<code>zmbackup</code> section.</p>
</div>
<div class="paragraph">
<p>These backup files can be used to restore the complete Zimbra Collaboration
system or individual mailboxes so that account and message data is
completely restored. Archived redo logs are moved to the backup session as
part of the full backup. When the server is restored from an auto-grouped
backup, redo logs are replayed to bring the system to the point before the
failure.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_backup_options">Backup Options</h3>
<div class="paragraph">
<p>The backup process can be configured to selectively backup content and
to back up the MariaDB database.</p>
</div>
<div class="sect3">
<h4 id="_backup_up_content_options">Backup Up content Options</h4>
<div class="paragraph">
<p>You can configure these backup options so that search indexes, blobs,
and HSM blobs are not backed up during a full backup session.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraBackupSkipSearchIndex</code>&#8201;&#8212;&#8201;Default is <strong>FALSE</strong>. If set to <strong>TRUE</strong>, the search index is not backed up. The mailbox will have to be reindexed
after restoring from a backup without the search index.</p>
</li>
<li>
<p><code>zimbraBackupSkipBlobs</code>&#8201;&#8212;&#8201;Default is <strong>FALSE</strong>. If this is set to
<strong>TRUE</strong>, blobs are not backed up. This might be useful for getting a
quicker backup of just database data when the blobs reside on fault-tolerant storage. This configuration applies to all blobs, those
on the primary volumes as well as secondary (HSM) volumes.</p>
</li>
<li>
<p><code>zimbraBackupSkipHsmBlobs</code>&#8201;&#8212;&#8201;Default is <strong>FALSE</strong>. If this is set to
<strong>TRUE</strong>, blobs on HSM volumes are not backed up. Set this if
<code>zimbraBackupSkipBlobs</code> is <strong>FALSE</strong> but you want to skip blobs on HSM
volumes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_backup_the_mariadb_database">Backup the MariaDB Database</h4>
<div class="paragraph">
<p>You can configure Zimbra Collaboration backups to run <code>mysqldump</code> to
back up your MariaDB database during backup sessions. When this is enabled,
a <code>mysqldump</code> backup runs with each full, incremental, and auto-grouped
backup.</p>
</div>
<div class="paragraph">
<p>The <code>mysqldump</code> is a backup of your MariaDB database at a specific time.
Data changes that occur later than the dump file are written to the
binary log. To recover to a specific point in time, binary logging must
be enabled. See the Zimbra wiki article, MariaDB Backup and Restore at
<a href="https://wiki.zimbra.com/wiki/MySQL_Backup_and_Restore" class="bare">https://wiki.zimbra.com/wiki/MySQL_Backup_and_Restore</a>.</p>
</div>
<div class="paragraph">
<p>The MariaDB dump files are gzipped and placed in the backup target
directory, or to <code>/opt/zimbra/backup</code>, if no directory is specified.</p>
</div>
<div class="paragraph">
<p>These files can be quite large. Make sure that the free disk space is at
least three times greater than the actual MariaDB database file for each
MariaDB database backup file that is saved.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable <code>mysqldump</code> to run automatically with your backups, type</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmlocalconfig edit mysql_backup_retention=&lt;N&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>N</strong> is the number of copies of the MariaDB database backups that
are retained.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To restore a MariaDB database, contact Zimbra support for assistance.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_disk_space_for_backups">Managing Disk Space for Backups</h3>
<div class="paragraph">
<p>Backup sessions fail if the target disk does not have enough space. All
data backed up in the backup session is discarded and deleted.</p>
</div>
<div class="paragraph">
<p>You can choose to receive notification when your disk might not have
enough space to complete the backup</p>
</div>
<div class="paragraph">
<p>Configuring the <code>zimbraBackupMinFreeSpace</code> attribute helps you
manage running backup session by notifying you.</p>
</div>
<div class="paragraph">
<p>Set the value for attribute <code>zimbraBackupMinFreeSpace</code> to the amount of
free space required on the backup target disk before a backup session is
run. If the disk has less space than the value set in the attribute, the
back up session will not run and an email notification is sent to the
administrator.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are also backing up the MariaDB database, make sure you set the value
large enough to include the <code>myslqdump</code> file size.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The value for this attribute can be specified as a percentage of the
total disk space, for example <code>25%</code>, or as a number of bytes, for example
<code>300MB</code>, <code>50GB</code>, etc. The default value is <code>0</code>, meaning the check is disabled
and backup is always allowed to start.</p>
</div>
<div class="paragraph">
<p>The attribute can be set globally or by server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As global:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmprov mcf zimbraBackupMinFreeSpace &lt;value&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>By server:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>zmprov ms &lt;zmhostname&gt; zimbraBackupMinFreeSpace &lt;value&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Backup sessions run if the free disk space is at least the value you
set. If your backup file is larger than the value, the backup session
fails. You should monitor the size of the backup files and adjust the
attribute value if the backup requires more space than the configured
value.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restoring_data">Restoring Data</h3>
<div class="paragraph">
<p>Three types of restore procedures can be run:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>zmrestore</code> command is used to restore the mailboxes while the
Zimbra Collaboration mailbox server is running.</p>
</li>
<li>
<p>The <code>zmrestoreoffline</code> command is used to restore the mailbox server when
just the <code>mailboxd</code> process it is stopped. This command is run for disaster recovery.</p>
</li>
<li>
<p>The <code>zmrestoreldap</code> command is used to restore the content of the
LDAP directory server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The restore process allows all accounts or individual accounts to be
specified.</p>
</div>
<div class="sect3">
<h4 id="_restore_process">Restore Process</h4>
<div class="paragraph">
<p>The <strong>zmrestore</strong> process goes through the following steps to restore the
mailbox, the database, the indexes, and the LDAP directory.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieves specified accounts to be restored, or specify <strong>all</strong> for
all accounts that have been backed up.</p>
</li>
<li>
<p>Iterates through each mailbox:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Deletes the mailbox on the server to clear any existing data</p>
</li>
<li>
<p>Restores the last full backup of the MariaDB data, the index directory,
and the message directory for that mailbox</p>
</li>
<li>
<p>Replays redo logs in all incremental backups since last full backup</p>
</li>
<li>
<p>Replays all archived redo logs for that mailbox, from the redo log
archive area on the mailbox server</p>
</li>
<li>
<p>Replays the current redo log</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Accounts are restored, even if the account exceeds its quota.  The next
time the user performs an action that affects quota, they receive a warning
that they have exceeded their quota.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Users using the Zimbra Connector for Microsoft Outlook must perform an
initial sync on the Outlook client when they log on after the Zimbra server
is restored.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="exampleblock">
<div class="title">Example 28. Perform a full restore of all accounts on server1</div>
<div class="content">
<div class="paragraph">
<p>Including last full backup and any incremental backups since last full backup</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a all</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 29. Perform a single account restore on server1</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 30. Restore to a specific point in time (PIT)</div>
<div class="content">
<div class="paragraph">
<p>The following restore options affect redo log replay. If you do not specify
one of these options, all redo logs since the full backup you&#8217;re restoring
from are replayed</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
After you perform any of the following point-in-time restores, you should
immediately run a complete backup for those accounts to avoid future
restore problems with those accounts.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A restore that is run using any of the following options is a
point-in-time restore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-restoreToTime</code> <strong>&lt;arg&gt;</strong> - Replay the redo logs until the time
specified.</p>
</li>
<li>
<p><code>-restoreToIncrLabel</code> <strong>&lt;arg&gt;</strong> - Replay redo logs up to and including
this incremental backup.</p>
</li>
<li>
<p><code>-restoreToRedoSeq</code> <strong>&lt;arg&gt;</strong> - Replay up to and including this
redo log sequence.</p>
</li>
<li>
<p><code>-br</code> - Replays the redo logs in backup only, therefore excluding
archived and current redo logs of the system.</p>
</li>
<li>
<p><code>-rf</code> - Restores to the full backup only. This does not include any
incremental backups at all.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 31. Specify an exact time, the incremental backup label, or the redo log sequence to restore to.</div>
<div class="content">
<div class="paragraph">
<p>Restore stops at the earliest possible point in time if more than one point
in time restore options are specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com-restoreToTime &lt;arg&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Two common ways to write the &lt;timearg&gt; are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"YYYY/MM/DD hh:mm:ss"</code></p>
</li>
<li>
<p><code>YYYYMMDD.hhmmss</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 32. Perform an incremental restore only to last full backup, excluding incremental backups since then, for all accounts</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -rf --a all</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 33. Restore mailbox and LDAP data for an account</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -ra -a account@company.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 34. Restore to a new target account</div>
<div class="content">
<div class="paragraph">
<p>A prefix is prepended to the original account names</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -ca -a account@company.com -pre restore</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result from the above example would be an account called
<a href="mailto:restoreaccount@company.com">restoreaccount@company.com</a>.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 35. Restore system tables in the database (db) and <code>localconfig.xml</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -sys</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 36. Include <code>--contineOnError</code> (<code>-c</code>) to the command so that the restore process continues if an error is encountered.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a all -c</code></pre>
</div>
</div>
<div class="paragraph">
<p>When <code>-c</code> is designated, accounts that could not be restored are displayed
when the restore process is complete.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 37. Restore a specific account</div>
<div class="content">
<div class="paragraph">
<p>Can also be used to restore deleted accounts</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 38. Avoid restoring accounts that were deleted</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com -skipDeletedAccounts</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 39. Restore a mailbox, but exclude all the delete operations that were in the redolog replay</div>
<div class="content">
<div class="paragraph">
<p>When the mailbox is restored it will contain messages that were
deleted. This is useful if users use POP and remove messages from the
server</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@company.com --skipDeletes</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the latest point in time is requested, do not add a backup label
(<code>-lb</code>). Without specifying the label, the most recent full backup before the
requested point is automatically used as the starting point.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_stop_a_restore_process">Stop a Restore Process</h4>
<div class="paragraph">
<p>The <code>zmbackupabort -r</code> command interrupts a restore that is in process.
The restore process stops after the current account finishes being
restored. The command displays a message showing which accounts were not
restored.</p>
</div>
<div class="paragraph">
<p>To stop the restore type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackupabort -r</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_restore_mailboxes_when_mail_server_is_down">Restore Mailboxes When Mail Server Is Down</h4>
<div class="paragraph">
<p>The offline restore process can only be run when the$1`mailboxd` server is
not running. In general, offline restore is run under the following
circumstances:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Certain components of the Zimbra server are corrupted, and the server
cannot be started. For example, the data in LDAP or the database are
corrupted.</p>
</li>
<li>
<p>A disaster requires the Zimbra software to be reinstalled on the
server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The offline restore must be run before the Zimbra Collaboration mailbox
store server is started to keep the redo logs in sequence.</p>
</div>
<div class="paragraph">
<p>In a disaster recovery when the Zimbra software is reinstalled, if <code>mailboxd</code>
is started before the backup files are restored, the mail server would
begin to accept email messages and perform other activities, producing redo
logs in the process. Since the pre-disaster data have not been restored to
the server, the redo logs would be out of sequence. Once <code>mailboxd</code> is
running, it would be too late to restore the pre-disaster data.</p>
</div>
<div class="paragraph">
<p>The offline restore process goes through the following steps.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specified accounts to be restored are retrieved. If the command-line
does not specify any mailbox address, the list of all mailboxes on the
specified mail host is retrieved from Zimbra LDAP directory server.</p>
</li>
<li>
<p>Iterates through each mailbox:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Deletes the mailbox on the server to clear any existing data</p>
</li>
<li>
<p>Restores the last full backup of the MariaDB data, the index
directory, and the message directory for that mailbox</p>
</li>
<li>
<p>Replays redo logs in all incremental backups since last full backup</p>
</li>
<li>
<p>Replays all archived redo logs for that mailbox, from the redo log
archive area on the mailbox server</p>
</li>
<li>
<p>Replays the current redo log</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_restore_all_accounts">Restore All Accounts</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Restore all accounts on server1 when <code>mailboxd</code> is stopped</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline -a all</code></pre>
</div>
</div>
</li>
<li>
<p>Start <code>mailboxd</code> after the offline restore is complete</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol startup</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_restore_individual_accounts_on_a_live_system">Restore Individual Accounts on a Live System</h4>
<div class="paragraph">
<p>Use the <strong>zmrestore</strong> command to restore one or more selected accounts. In
the event that a user&#8217;s mailbox has become corrupted, you might want to
restore that user from the last full and incremental backup sets.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>For each account to be restored, put the account into maintenance mode</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;account&gt; zimbraAccountStatus maintenance</code></pre>
</div>
</div>
<div class="paragraph">
<p>Maintenance mode prevents the delivery of new emails during the restore.
Otherwise, the emails would be overwritten during the restore process.</p>
</div>
</li>
<li>
<p>Run the <code>zmrestore</code> command to restore the accounts</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a account@abc.com</code></pre>
</div>
</div>
</li>
<li>
<p>For each account that was restored, put the account back into active mode</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;account&gt; zimbraAccountStatus active</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If a user account is restored and the COS that the account was assigned no
longer exists, the default COS is assigned to the account.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_exclude_items_from_a_restore">Exclude Items from a Restore</h4>
<div class="paragraph">
<p>When you restore from a full backup, you can exclude the search index
and blobs.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Search index</strong>&#8201;&#8212;&#8201;If you do not restore the search index data, the
mailbox will have to be reindexed after the restore.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a &lt;all|account&gt; --exclude-search-index</code></pre>
</div>
</div>
</li>
<li>
<p><strong>Blobs</strong>&#8201;&#8212;&#8201;This is a useful option when all blobs for the mailbox being
restored already exist.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore &lt;all or account&gt;|--exclude-blobs</code></pre>
</div>
</div>
</li>
<li>
<p><strong>HSM-blobs</strong>&#8201;&#8212;&#8201;This is useful when all HSM blobs for the mailbox
being restored already exist.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore &lt;all or account&gt; --exclude-hsm-blobs</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_restore_the_ldap_server">Restore the LDAP Server</h4>
<div class="paragraph">
<p>In a disaster recovery where you need to restore the entire system,
restore the LDAP directory server first.</p>
</div>
<div class="paragraph">
<p>The <code>zmrestoreldap</code> command restores the global LDAP data including COS,
distribution lists, etc. You can restore the complete LDAP server, which
recreates the entire schema or you can restore specific accounts. You
specify the session to restore. The restore command has to be run on the
LDAP server being restored.</p>
</div>
<div class="paragraph">
<p><strong>Examples</strong></p>
</div>
<div class="exampleblock">
<div class="title">Example 40. Find the LDAP session labels</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap -lbs</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 41. Restore the complete LDAP directory server</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap -lb full20211130135236</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 42. Restore LDAP data for specific accounts</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap -lb full20211130135236 -a tac@abc.com jane@abc.com</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_general_steps_for_disaster_recovery">General Steps for Disaster Recovery</h3>
<div class="paragraph">
<p>Use the following steps to restore a mailbox store server in a general
disaster scenario involving multiple machines.</p>
</div>
<div class="sect3">
<h4 id="_preparation">Preparation</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Restore the LDAP directory server to a known good state before doing
anything with the mailbox store server.</p>
</li>
<li>
<p>Put all mailboxes into maintenance mode to prevent mail delivery and
user login while restoring the mailboxes.</p>
</li>
<li>
<p>Stop the mailbox store server if it is running.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_recovery">Recovery</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Reinstall the Zimbra Collaboration software on the mailbox server,
if necessary.</p>
</li>
<li>
<p>Restore mailboxes.</p>
</li>
<li>
<p>Start the Zimbra Collaboration server.</p>
</li>
<li>
<p>Put all Zimbra Collaboration mailboxes back in active mode.</p>
</li>
<li>
<p>Run a full backup of the server.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_crash_recovery_server_startup">Crash Recovery Server Startup</h4>
<div class="paragraph">
<p>When your system unexpectedly stops and then restarts on startup, the
server searches the redo log for uncommitted transactions and replays
any that it finds. Replaying the redo logs brings the system to a
consistent state.</p>
</div>
</div>
<div class="sect3">
<h4 id="_restore_zimbra_collaboration">Restore Zimbra Collaboration</h4>
<div class="paragraph">
<p>If a complete machine failure occurs, use the following steps to restore
to a new server.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The Zimbra Collaboration version you install on the new server <strong>must be the
same version</strong> as installed on the old server.  The server can have a
different operating system.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The new server hardware must meet the requirements described in the
Installation Prerequisites section of the Zimbra Collaboration Single
Server Installation guide. Install the new operating system, making any
necessary OS configuration modifications as described in the
installation guide.</p>
</div>
<div class="paragraph">
<p>You do the following to restore to a new server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare the new server.</p>
</li>
<li>
<p>Block client access to the old server&#8217;s IP address with firewall
rules.</p>
</li>
<li>
<p>Mount any volumes that were in use on the older server.</p>
</li>
<li>
<p>Delete the MariaDB data that is set up in the initial installation of
Zimbra Collaboration.</p>
</li>
<li>
<p>Copy the backup files to the new server.</p>
</li>
<li>
<p>Run <code>zmrestoreldap</code> to restore the global LDAP data.</p>
</li>
<li>
<p>Run <code>zmrestoreoffline</code> to restore account data from the backup sessions.</p>
</li>
<li>
<p>Prepare and run a new backup.</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_old_server_status">Old Server Status</h5>
<div class="paragraph">
<p>Two scenarios for disaster recovery are the server has died and the
Zimbra Collaboration files cannot be accessed, or Zimbra Collaboration
is still running, but the server hardware needs to be replaced.</p>
</div>
<div class="paragraph">
<p><strong>If the server is not running:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Block client access to the server IP address with firewall rules.</p>
</li>
<li>
<p>Find the latest full Zimbra Collaboration backup session to use.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>If the server is still running, to prepare the move to the new server:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Block client access to the server&#8217;s IP address with firewall rules.</p>
</li>
<li>
<p>Run a full backup of the old service, or if the backup is recent,
run an incremental backup to get the most current incremental backup
session.</p>
</li>
<li>
<p>Run <code>zmcontrol stop</code>, to stop Zimbra Collaboration. In order to
restore to the most current state, no new mail should be received after
the last incremental backup has run.</p>
</li>
<li>
<p>Change the hostname and IP address on the old server to something
else. Do not turn off the server.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_install_zcs_on_a_new_server">Install ZCS on a New Server</h4>
<div class="paragraph">
<p>Before you begin, make sure that the new server is correctly configured
with the IP address and hostname and that Zimbra Collaboration is
installed and configured with the same domain, hostname, passwords, etc.
as the previous server. See the Zimbra Collaboration installation guide
for more information about preparing the server. Before you begin to
install Zimbra Collaboration, note the information you need from the old
server including admin account name and password, LDAP, Amavis, and
Postfix passwords, spam training, and non-spam training user account
names, exact domain name, and the global document account name.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Make sure the computer time is set to the same time as the old
server. Verify that the old hostname and MX DNS records resolve to the new
server.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the Zimbra Collaboration License.xml file to a directory on the
new server. You cannot complete the Zimbra Collaboration installation if
the license is not on the new server.</p>
</li>
<li>
<p>Run <code>./install.sh</code> and follow the directions in the installation guide
to install Zimbra Collaboration. Make sure that you configure the same
domain, hostname, passwords as on the old server. During Zimbra
Collaboration install, the following settings must be changed to match
the original server settings:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Zimbra LDAP Server</strong>&#8201;&#8212;&#8201;For <strong>Domain to create</strong>, identify the same
default domain as on the old server.</p>
</li>
<li>
<p><strong>Zimbra Mailbox Server</strong>&#8201;&#8212;&#8201;An administrator&#8217;s account is
automatically created.</p>
<div class="ulist">
<ul>
<li>
<p>Make sure that the account name for <strong>Admin user to create</strong> is the same
name as on the original server.</p>
</li>
<li>
<p>Set the admin password to be the same as on the old server.</p>
</li>
<li>
<p>Set the LDAP password to be the same as on the old server.</p>
</li>
<li>
<p>Set the Postfix user and Amavis user passwords to be the same as on
the old server</p>
</li>
<li>
<p>Change the <strong>Spam training user</strong> and the <strong>Non-spam (HAM) training</strong>
<strong>user</strong> account names to be the same as the spam account names on the old
server.</p>
</li>
<li>
<p><strong>Global Document Account</strong>&#8201;&#8212;&#8201;This account name is
automatically generated and is usually named wiki. If you changed this,
change the Global Document Account name to be the same account name as
on the original server.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Change any other settings on the new server to match the
configuration on the original server.</p>
</li>
<li>
<p>In the main menu, set the default backup schedule and the automatic
starting of servers after the configuration is complete to <strong>NO</strong>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_restoring_a_backup_to_a_new_server">Restoring a Backup to a New Server</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Stop the new server</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol stop</code></pre>
</div>
</div>
</li>
<li>
<p>If the old server had additional storage volumes configured, mount
the additional volumes now.</p>
</li>
<li>
<p>Delete the MariaDB data and reinitialize an empty data directory. If
you do not do this, <code>zmrestoreoffline</code> will have errors. As <code>zimbra</code>, type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rm -rf /opt/zimbra/db/data/* /opt/zimbra/libexec/zmmyinit</code></pre>
</div>
</div>
<div class="paragraph">
<p>The MariaDB service is now running.</p>
</div>
</li>
<li>
<p>Copy all the files in the <code>/backup</code> folder from the old server or
from an archive location to <code>/opt/zimbra/backup</code>.</p>
</li>
<li>
<p>Restore the LDAP.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap -lb &lt;latest_label&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are restoring a large number of accounts, you might run a command
such as the UNIX command, <code>nohup</code>, so that the session does not terminate
before the restore is complete.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To find the LDAP session label to restore, type <code>zmrestoreldap –lbs</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Ensure that the following services are running before attempting to execute <code>zmrestoreoffline</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>mysqld</code> (MariaDB)</p>
</li>
<li>
<p><code>slapd</code> (OpenLDAP)</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol start</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Ensure that the following services are stopped before attempting to execute <code>zmrestoreoffline</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>mailboxd</code></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailboxdctl stop</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Because some Zimbra Collaboration services are running at this
point, type <code>zmconvertctl start</code>. This is required before running
<code>zmrestoreoffline</code>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Sync your LDAP password from backup directory to the new production
servers LDAP config.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -f -e zimbra_ldap_password=&lt;password&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Start the offline restore after stopping <code>mailboxd</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailboxdctl stop
zmrestoreoffline -sys -a all -c -br</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might run a command such as <code>nohup</code> here also. To watch the progress,
tail <code>/opt/zimbra/log/mailbox.log</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use <code>–c</code> on the command line so that accounts are restored,
even if some accounts encounter errors during the offline restore
process.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Because some Zimbra Collaboration services are running at this
point, type <code>zmcontrol stop</code> to stop all services.</p>
</li>
<li>
<p>Remove any old backup sessions because these sessions are no longer
valid.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">rm -rf /opt/zimbra/redolog/* /opt/zimbra/backup/*</code></pre>
</div>
</div>
</li>
<li>
<p>Start Zimbra Collaboration.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol start</code></pre>
</div>
</div>
</li>
<li>
<p>Run a full backup.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -f -a all</code></pre>
</div>
</div>
</li>
<li>
<p>Remove the firewall rules and allow client access to the new
server.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_restoring_from_different_failure_scenarios">Restoring from Different Failure Scenarios</h4>
<div class="paragraph">
<p>The restoration steps are similar for most server failures you may
encounter. If a failure occurs, review the disaster recovery section to
understand the process and then follow the steps below for the specific
type of failure.</p>
</div>
<div class="sect4">
<h5 id="_restore_when_ldap_is_corrupted">Restore When LDAP is Corrupted</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Reinstall the LDAP server. See the Zimbra Collaboration Installation
guide.</p>
</li>
<li>
<p>Find the label for the LDAP session to restore. Run the
<code>zmrestoreldap - lb &lt;label&gt;</code> command, with no arguments to restore all
accounts, domains, servers, COS, etc. for the LDAP server.</p>
</li>
<li>
<p>Make sure that all accounts are in active mode. From the command
line, type <code>zmprov ma zimbraAccountStatus active</code></p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_restore_after_replacing_corrupted_partitions">Restore After Replacing Corrupted Partitions</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If a partition becomes corrupted, replace the failed disk.</p>
</li>
<li>
<p>To restore the latest full and incremental backup files, run</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a all</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>zmrestore</strong> process automatically retrieves the list of all
mailboxes on the specified mail host from the backup date and iterates
through each mailbox to restore the mailboxes to the last known good
state.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_restore_after_corrupted_or_unreadable_redo_log">Restore After Corrupted or Unreadable Redo Log</h5>
<div class="paragraph">
<p>If the redo log becomes unreadable, the <code>mailboxd</code> service stops and
cannot restart. If this happens, inspect the hardware and software to
find the source of the problem before proceeding.</p>
</div>
<div class="paragraph">
<p>Without the latest redo log, the Zimbra mailbox server cannot be
returned to the most current state. The Zimbra mailbox data can be
restored to the latest archived redo log state. A new redo log for
current transactions is created after the Zimbra mailbox server is
restored.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>mailboxd</code> service must not be running, and all accounts must be in
maintenance mode before beginning.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Put all accounts into maintenance mode.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md &lt;domain&gt; zimbraDomainStatus maintenance</code></pre>
</div>
</div>
</li>
<li>
<p>With the <code>mailboxd</code> service not running, type</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline</code></pre>
</div>
</div>
<div class="paragraph">
<p>The offline restore process begins by retrieving the list of all
mailboxes on the specified mail host from the backup.</p>
</div>
<div class="paragraph">
<p>The offline restore than iterates through each mailbox to:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Delete the mailboxes on the server</p>
</li>
<li>
<p>Restore the last full backup from the backup area</p>
</li>
<li>
<p>Restore all incremental backups for that mailbox in order, since the
last full backup. This involves replaying the redo logs from the backup
target area</p>
</li>
<li>
<p>Replay all archived redo logs</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Because the redo log for current transactions is not available, the
mailbox server is returned to the state of the last archived redo log.</p>
</div>
</li>
<li>
<p>After the offline restore is complete, start ZCS.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol startup</code></pre>
</div>
</div>
</li>
<li>
<p>When the Zimbra mailbox server is up, run a full backup of the
Zimbra server. The full backup must be run immediately to have the
latest data backed up because the latest redo log is not available.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_change_local_configuration_files_after_restoring_zimbra">Change Local Configuration Files After Restoring Zimbra</h4>
<div class="paragraph">
<p>The <code>localconfig.xml</code> file, located in the <code>/opt/zimbra/conf</code> folder,
includes the core Zimbra server configuration, such as paths and passwords,
This file is backed up in full and incremental backups. When you run an
incremental or full restore, the backed-up version of the <code>localconfig.xml</code>
is renamed <code>localconfig.xml.restore</code> and is copied to the <code>/opt/zimbra/conf</code>
directory.</p>
</div>
<div class="paragraph">
<p>If you have made changes since the last backup, you might need to replace
the <code>localconfig.xml</code> file with the restored copy. Compare these files, and
if the <code><strong>.restore</strong></code> file has the latest local configuration data, delete the
<code>localconfig.xml</code> file and rename the file with the <code>.restore</code> extension to
<code>localconfig.xml</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_snapshots_to_backup_and_restore">Using snapshots to Backup and Restore</h3>
<div class="paragraph">
<p>You can backup and restore a server using the snapshot feature provided
by the storage layer rather than using Zimbra&#8217;s backup and restore
feature. Using snapshots, you can maintain a standby site and reroute users
to the standby site to keep operations running if the primary site fails.</p>
</div>
<div class="paragraph">
<p>Snapshots are taken for all volumes of data and are transferred to the
standby site periodically. Data volumes that are backed up using
snapshots include MariaDB, blobs, Lucene index, and <code>redologs</code>.</p>
</div>
<div class="paragraph">
<p>When the primary site is down, the <code>zmplayredo</code> command is used to bring
consistency to the snapshots and to reapply any changes in data to
minimize data loss across volumes</p>
</div>
<div class="paragraph">
<p>There are four volumes of data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MariaDB</p>
</li>
<li>
<p>Blob</p>
</li>
<li>
<p>Lucene index</p>
</li>
<li>
<p>Redologs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sets of snapshots are taken every hour and transferred to the remote
standby site. However, all snapshots are not taken at one instant and
could be a second to a minute apart from each other. Also, snapshots of
redologs may be taken more frequently. The sequence of events could look
like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>8:00:00 - snapshot mysql
8:00:01 - snapshot blob
8:00:02 - snapshot index
8:00:03 - snapshot redolog
8:05:00 - transfer the snapshot set to remote site completed
...
8:15:00 - snapshot redolog
8:15:05 - transfer of redolog snapshot to remote site completed
...
8:30:00 - snapshot redolog
8:30:05 - transfer of redolog snapshot to remote site completed
...
8:35:00 - primary site fails</pre>
</div>
</div>
<div class="paragraph">
<p>On the remote site, there are snapshots from the 8:00 set of data as
well as subsequent snapshots of the redologs. They all have to be
brought together so that the most recent information is available on the
standby site once users are rerouted to it.</p>
</div>
<div class="paragraph">
<p>You can now run the <code>zmplayredo</code> command to replay changes from 8:00:00.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmplayredo --fromTime &quot;2021/10/17 08:00:00:000&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>All data is brought forward to the current time and the standby site is
set up and running. Data from 8:30:00 to 8:35:00 is lost but that is
expected when the restore process is being carried out.</p>
</div>
</div>
<div class="sect2">
<h3 id="_notes_on_ephemeral_data">Notes on Ephemeral Data</h3>
<div class="paragraph">
<p>As of ZCS 8.8, ephemeral data is not backed up as part of the backup process.
Since auth tokens are ephemeral attributes, the implication is that clients
accessing accounts restored after deletion will need to re-authenticate;
auth tokens generated prior to the backup will no longer work.</p>
</div>
<div class="sect3">
<h4 id="_ephemeral_storage_ssdb_backend">Ephemeral Storage SSDB Backend</h4>
<div class="sect4">
<h5 id="_backing_up_ephemeral_data_in_ssdb">Backing up Ephemeral Data in SSDB</h5>
<div class="paragraph">
<p>If SSDB is used as the ephemeral backend, a backup will not include any ephemeral
attributes.</p>
</div>
<div class="paragraph">
<p>Note: This section does not detail how to deploy and administer an SSDB server.
For that information please see section <a href="#ssdb_configuration_options">SSDB Configuration Options</a>.</p>
</div>
<div class="paragraph">
<p>Backing up the data stored in SSDB (if so configured) is done as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ssdb-dump -h localhost -p 8888 -o /tmp/ephemeral-backup-&lt;date&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note: If running in master / slave configuration the <code>ssdb-dump</code> should be run on the <strong>master</strong>.</p>
</div>
<div class="sect5">
<h6 id="_example_backup">Example backup</h6>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ssdb-dump - SSDB backup command
Copyright (c) 2012-2015 ssdb.io

recv begin...
received 1 entry(s)
received 10 entry(s)
received 100 entry(s)
received 1000 entry(s)
received 10000 entry(s)
received 100000 entry(s)
received 200000 entry(s)
received 300000 entry(s)
received 400000 entry(s)
received 400021 entry(s)
recv end

total dumped 400021 entry(s)
                               Compactions
Level  Files Size(MB) Time(sec) Read(MB) Write(MB)
--------------------------------------------------
  2        1        7         0        0         7

compacting data...
                               Compactions
Level  Files Size(MB) Time(sec) Read(MB) Write(MB)
--------------------------------------------------
  2        2       10         0        0        10

backup has been made to folder: /tmp/ephemeral-backup-&lt;date&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_restoring_ephemeral_data_to_ssdb">Restoring Ephemeral Data to SSDB</h5>
<div class="paragraph">
<p>Restoring ephemeral data to SSDB from a backup can only be done with a backup from
an SSDB server.</p>
</div>
<div class="paragraph">
<p>Restoration can be done in one of two ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>import into a running server</p>
</li>
<li>
<p>override of existing data</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_importing_into_a_running_server">Importing into a running server</h6>
<div class="paragraph">
<p>Using the <code>leveldb-import</code> command provided with the SSDB software a backup created
with the <code>ssdb-dump</code> command can be imported into a running SSDB server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">leveldb-import localhost 8888 /tmp/ephemeral-backup-&lt;date&gt;/data</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_data_override">Data override</h5>
<div class="ulist">
<ul>
<li>
<p>Stop the SSDB server.</p>
</li>
<li>
<p>Copy the directory created using the <code>ssdb-dump</code> command previously to a known location.</p>
</li>
<li>
<p>Update <code>ssdb.conf</code> configuration file to update the <code>work_dir</code> option to the proper path.</p>
</li>
<li>
<p>Start the SSDB server back up and verify previously working logins still work.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_backups_with_ldap_backend">Backups with LDAP backend</h4>
<div class="paragraph">
<p>If the ephemeral backend is LDAP, a backup will not include auth tokens or CSRF
tokens, but it will include the last login timestamp. Upon account restore,
the appropriate "Last Login" value in the admin console will be restored.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_archiving_and_discovery">Archiving and Discovery</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimbra Archiving and Discovery is an optional feature that enables
archiving of messages that were delivered to or sent by Zimbra Collaboration and
to search across mailboxes.</p>
</div>
<div class="paragraph">
<p>The installation of the archiving feature provides the ZCS discovery tool
(also known as cross mailbox search) and sets the attributes that allow
archiving to be enabled on the Zimbra MTAs.</p>
</div>
<div class="paragraph">
<p>Archiving is configured on a per account basis. Each account enabled for
archiving requires a Zimbra archive license. When archiving is enabled for
an account, a copy of all email from or to that account is forked at the
MTA and a copy of the message is delivered to a predefined archive
mailbox. The archiving process is transparent to account users.</p>
</div>
<div class="paragraph">
<p>Discovery allows you to conduct a search for email messages across live and
archived mailboxes and copy the results to a specified mailbox.</p>
</div>
<div class="sect2">
<h3 id="_how_archiving_works">How Archiving Works</h3>
<div class="paragraph">
<p>When a message is sent or received by a user, the message is always routed
through the Postfix MTA. The Postfix MTA allows integrating software that
can perform actions on messages that are in flight. When archiving is
enabled for the sender or the recipient of messages, Zimbra Archiving
integrates with an MTA hook and the Amavisd-New utility to fork a copy of
the message.</p>
</div>
<div class="paragraph">
<p>The &#8220;<strong>does recipient or sender have archiving enabled</strong>&#8221; check is performed
on the SMTP standard envelope and not on the From or To/Cc headers. Since
checks are performed on the envelope, Bcc copies and messages sent to
distribution lists are captured.</p>
</div>
<div class="exampleblock">
<div class="title">Example 43. Sending messages with archiving enabled</div>
<div class="content">
<div class="paragraph">
<p>For example, if User A sends a message to User B, and if User B has
archiving enabled, the MTA delivers two messages — one to User B’s mailbox
and one to User B’s archive mailbox. The message received in User B’s
mailbox looks normal, as shown in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Received: from localhost (localhost.localdomain [127.0.0.1])…
From: userA@example.com
To:userB@example.com
Subject: New License Key
Message-ID: &lt;015f01c717fe$70f042d1$b1d6f61d@thom&gt;
Date: Mon, 04 Nov 2021 23:48:18 -0000

Hi B,

Can you send me the license key for the software again?

Thanks, A</pre>
</div>
</div>
<div class="paragraph">
<p>The message received in User B’s archive mailbox contains additional
<strong>X-Envelope-From</strong> and <strong>X-Envelope-To</strong> headers. These headers show the
real email address the message was sent from and each of the email
addresses that the message was sent to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Received: from localhost (localhost.localdomain [127.0.0.1])…
From: userA@example.com
To:userB@example.com
Subject: New License Key
Message-ID: &lt;015f01c717fe$70f042d1$b1d6f61d@thom&gt;
X-Envelope-From: userA@example.com
X-Envelope-To: userB@example.com
Date: Mon, 04 Nov 2021 23:48:18 -0000

Hi B,

Can you send me the license key for the software again?

Thanks, A</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Zimbra archiving can be set up to create archiving accounts that are
maintained within Zimbra Collaboration or to work with third-party
archiving systems using SMTP forwarding to send messages to a third-party
archive server. For third-party archiving, Zimbra Collaboration is
configured to act as the forwarding agent.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_discovery_works">How Discovery Works</h3>
<div class="paragraph">
<p>The discovery feature of Archiving and Discovery is used to search across
live<sup>*</sup> and archive mailboxes for email messages and attachments.  The
discovery tool can be run from the Administration Console and the results
are copied to a target mailbox that you specify.</p>
</div>
<div class="paragraph">
<p><sup>*</sup> A live mailbox is an account on the system other than archive accounts
and system accounts.</p>
</div>
<div class="paragraph">
<p>You can search outgoing and incoming email by date, from, to, cc, subject,
keywords, and attachments. You can also create queries to search by name,
dates and time ranges, distribution list, aliases.</p>
</div>
<div class="paragraph">
<p>Search results are placed in a target mailbox. You can organize your search
results by creating different target mailboxes or by creating individual
folders within a target mailbox for each search you run. <strong>X-zimbra-Source</strong>
header information is added to each message header that is copied to the
targeted mailbox. This header label includes the account ID, the account
name, and the server that the account resides on.</p>
</div>
<div class="paragraph">
<p>You can see the results of the search by logging on to the target mailbox
address.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_archiving_package">Installing the Archiving Package</h3>
<div class="paragraph">
<p>You can install the archiving package on an existing single-server
deployment or on a multi-server deployment.</p>
</div>
<div class="paragraph">
<p>If the mailbox server and the MTA server reside on the same node, you
configure and enable archiving as a single process. If your mailbox and MTA
servers are on separate nodes, the <code>zimbra-archive</code> package is installed
first on at least one mailbox server and then the archiving component is
enabled on each MTA in the deployment.</p>
</div>
<div class="sect3">
<h4 id="_installing_zimbra_archiving_in_a_single_server_environment">Installing <code>zimbra-archiving</code> in a Single-Server Environment</h4>
<div class="paragraph">
<p>The following scenario assumes that the LDAP, MTA, mailstore and archiving
servers are on the same node.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Refer to the Zimbra Collaboration Single Server Installation Guide to
open an SSH connection to the Zimbra Collaboration server. Log on to the
server as <strong>root</strong> and run the <code>./install.sh</code> command to begin the upgrade
process.</p>
</li>
<li>
<p>Accept the license agreement and type <strong>Yes</strong> to run the upgrade.</p>
</li>
<li>
<p>Type <strong>Yes</strong> for <code>zimbra-archiving</code> when presented with the packages to be
installed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The upgrade process begins and the archiving package is installed. At
this point, the Discovery feature is installed and can be used.</p>
</div>
<div class="paragraph">
<p>To enable archiving, switch to the <strong>zimbra</strong> user and enable archiving on the
MTA server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms &lt;zmhostname&gt; +zimbraServiceEnabled archiving</code></pre>
</div>
</div>
<div class="paragraph">
<p>Restart the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_installing_zimbra_archiving_in_a_multi_server_environment">Installing <code>zimbra-archiving</code> in a Multi-Server Environment</h4>
<div class="paragraph">
<p>The following upgrade scenario is adding a new server that is dedicated as
an archiving server to your Zimbra Collaboration environment.</p>
</div>
<div class="paragraph">
<p>Before beginning the install process, record the following information.
You need this information when you install the archiving server. Run the
<code>zmlocalconfig -s</code> command to find the information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>LDAP Admin Password _____________________
LDAP Hostname       _____________________
LDAP Port           _____________________</pre>
</div>
</div>
<div class="paragraph">
<p>Refer to the Multiple-Server Installation chapter in the Zimbra Collaboration
Multi-Server Installation guide for detailed steps on installing the
packages.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Open an SSH connection to the mailbox server that is being configured for
archiving. Log on to the server as <strong>root</strong> and unpack the Zimbra
software. Run the <code>./install.sh</code> command to begin the install process.</p>
</li>
<li>
<p>Type <strong>y</strong> and press <strong>Enter</strong> to install the following packages:</p>
<div class="ulist">
<ul>
<li>
<p><code>zimbra-store</code></p>
</li>
<li>
<p><code>zimbra-archiving</code></p>
<div class="paragraph">
<p>The <code>zimbra-core</code> package is installed by default.</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Type <strong>y</strong> and press <strong>Enter</strong> to modify the system.</p>
</li>
<li>
<p>The Main menu displays the default entries for the Zimbra component you
are installing. To expand the menu, type <strong>x</strong> and press <strong>Enter</strong>.</p>
</li>
<li>
<p>Select the <strong>Common Configuration</strong> menu and configure the LDAP Hostname,
LDAP password, and LDAP port.</p>
</li>
<li>
<p>Select the <strong>zimbra-store</strong> menu and configure the Admin password and the
License file location.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Complete the installation process following the steps in the Multi-server
Installation guide, under Installing Zimbra Mailbox Server.</p>
</div>
<div class="paragraph">
<p>At this point, the Discovery feature is installed and can be used.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_manage_archiving_from_the_administration_console">Manage Archiving From the Administration Console</h3>
<div class="paragraph">
<p>After Archiving is installed, you can set up archiving and manage it from
the Administration Console.</p>
</div>
<div class="sect3">
<h4 id="_enable_archiving">Enable Archiving</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; MTA</strong>,
from <strong>Archiving Configuration</strong> check <strong>Enable archiving</strong></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Restart ZCS from the command line</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol restart</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_dedicated_archive_cos">Creating a Dedicated Archive COS</h4>
<div class="paragraph">
<p>You can configure attributes in the COS to set mailbox features, quotas,
and passwords, turn off spam and virus checks, and hide the archive
accounts from GAL.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service</strong>, from the <strong>Gear</strong> icon select <strong>New</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change <strong>Features</strong> and <strong>Preferences</strong> as required for an Archiving COS.</p>
</li>
<li>
<p>If you have a dedicated archive server, in the Server Pool page, deselect
the archiver server from the list. In a multi-server deployment with a
dedicated archive server, the server should be removed from the COS server
pool so that the archive server is not randomly assigned to new accounts.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
These steps to remove the server from the server pool are not done in a
single-server deployment. Creating a dedicated archiving COS is a good idea
as this makes it easy to create archive mailboxes that are configured the
same.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Modify the options on the <strong>Advanced</strong> page if required.</p>
</li>
<li>
<p>In the <strong>Archiving</strong> page, check the <strong>Enable archiving</strong> box to make this
COS an archiving cos.</p>
</li>
<li>
<p>If you want to change the format for the naming scheme for archive
accounts, modify the two template fields. See the
<a href="#setting_up_an_archive_account_name">Setting Up an Archive Account Name</a>
section for more information.</p>
</li>
<li>
<p>Click <strong>Finish</strong>.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="setting_up_an_archive_account_name">Setting Up an Archive Account Name</h4>
<div class="paragraph">
<p>You use attributes to create and manage the naming scheme for archive
accounts. You can set up these attributes either by COS or by account.  For
COS, these attributes can be changed from the Administration Console, COS
or individual account’s Archiving page.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Account date template</strong>. Sets the date format used in the name
template. The default is <code>yyyyMMdd</code>. Adding the date to the account name makes
it easier to roll off older data from the system to backups.</p>
</li>
<li>
<p><strong>Account name template</strong>. Sets up how the archive mailbox name is
created. The default value is <code>${USER} ${DATE}@${DOMAIN}.archive</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The archive account address would be similar to the following example:</p>
</div>
<div class="paragraph">
<p><code>user-20210510@example.com.archive</code></p>
</div>
<div class="paragraph">
<p>If you change the default value, you must use syntax that creates a valid
email address. We recommend that you add <code>.archive</code> to all archive accounts
to create archive mailboxes in a non-routable domain to prevent spoofing of
the archives.</p>
</div>
<div class="paragraph">
<p>When the template based on the <code>zimbraArchiveAccountDateTemplate</code> attribute
is set up, <code>amavisArchiveQuarantineAccount</code> is updated to the new template
name when <code>zmconfigarchive</code> is run.</p>
</div>
<div class="sect4">
<h5 id="_administering_the_archive_server">Administering the archive server</h5>
<div class="paragraph">
<p>The <code>amavisd-new</code> server process controls account archiving as well as
antivirus and anti-spam processes. The <code>zmarchivectl</code> command can be used to
start, stop, restart or obtain the status of the <code>amavisd-new</code> server process
that controls account archiving. Caution should be taken when starting or
stopping the archiving process as it is a shared server process between
archiving, antivirus, and anti-spam processes. Performing actions on any of
them affect any of the other services that may be enabled in your
deployment.</p>
</div>
<div class="paragraph">
<p>If you want to disable archiving but not antivirus or anti-spam services,
disable the respective service either through the CLI or through the
Administration Console.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_set_up_archiving_for_a_users_mailbox">Set Up Archiving for a Users Mailbox</h4>
<div class="paragraph">
<p>Four attributes are related to the archive feature for accounts. Two that
configure a mailbox and two template attributes to construct the archive
account names.</p>
</div>
<div class="paragraph">
<p>To set up archiving for a mailbox two attributes are configured on the
primary user’s mailbox. One attributed enables archiving and the second
shows where messages are being archived.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Currently archived to</strong>&#8201;&#8212;&#8201;The current archive address. Archiving is to
a single account. If this is unset, archiving is not enabled.</p>
</li>
<li>
<p><strong>Archived accounts</strong>&#8201;&#8212;&#8201;Any previous and current archive addresses that
this mailbox was archived to. containing all the accounts that have been
archived for the given account.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_archive_mailboxes">Archive Mailboxes</h3>
<div class="paragraph">
<p>You can create an archive mailbox with or without an assigned COS. You
can also forward archive email to a third-party.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Accounts with archiving enabled are counted against the number of
Zimbra licenses purchased for archiving.  Archive mailboxes are listed
in the Administration Console along with the live accounts. To see
current license information, go to the Administration Console:<br>
<strong>Home &#8594; Configure &#8594; Global Settings &#8594; License</strong>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_creating_an_archive_mailbox_and_assigning_a_cos">Creating an archive mailbox and assigning a COS</h4>
<div class="paragraph">
<p>Archive accounts are created based on the Zimbra Archive name templates.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The attribute&#8201;&#8212;&#8201;<code>zimbraIsSystemResource</code>&#8201;&#8212;&#8201;is added to the archive
account and set to TRUE.</p>
</li>
<li>
<p>The archive account is displayed in the Administration Console.</p>
</li>
<li>
<p>When a message is received in a mailbox with archiving enabled, a copy of
the message is sent to the archive mailbox.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Log on as <code>zimbra</code>, and use the <code>zmarchiveconfig</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchiveconfig enable &lt;account@example.com&gt; archive-cos &lt;archive&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_an_archive_mailbox_with_no_cos_or_password">Creating an Archive Mailbox with No COS or Password</h4>
<div class="paragraph">
<p>If the archive account is not assigned a COS, the following settings are
set by default.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mailbox quota is set to 0, unlimited quota.</p>
</li>
<li>
<p>Spam and virus checks are disabled.</p>
</li>
<li>
<p>Hide in GAL is enabled, so the archive account does not display in the
GAL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Log on as <code>zimbra</code>, and use the <code>zmarchiveconfig</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchiveconfig enable &lt;user@example.com&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enabling_archive_forwarding_to_a_third_party_archiving_server">Enabling Archive Forwarding to a Third-party Archiving Server</h4>
<div class="paragraph">
<p>If the archive account is not maintained within Zimbra Collaboration,
you do not need to set a password, COS, or other attributes.</p>
</div>
<div class="paragraph">
<p>Log on as <code>zimbra</code>, and use the <code>zmarchiveconfig</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchiveconfig enable &lt;account@example.com&gt; \
 archive-address account-archive@offsite.com \
 archive-create false</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_searching_across_mailboxes">Searching Across Mailboxes</h3>
<div class="paragraph">
<p>When the archiving and discovery feature is installed, you can search
across mailboxes either from the Administration Console or through the
command line interface.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You do not need to have any archive mailboxes configured to search across
mailboxes, but the Archive package must be installed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can assign a user to run the mailbox searches from the Administration
Console by creating a delegated administrator with rights to access the
mailbox search tool.</p>
</div>
<div class="sect3">
<h4 id="_cross_mailbox_search_from_the_administration_console">Cross Mailbox Search from the Administration Console</h4>
<div class="paragraph">
<p>The discovery tool, <strong>Search Mail</strong>, is added to <strong>Tools and Migration</strong> on the
Navigation pane when the archiving package is added. To set up a cross-mailbox
search you configure the following information.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Tools and Migration &#8594; Search Mail</strong>, from the <strong>Gear</strong> icon select <strong>New</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Server name</strong>. The server name to be searched.</p>
</li>
<li>
<p><strong>Target mailbox and folders</strong>. One target mailbox and folder are
created automatically. You can use this mailbox for all your search results
and create new folders for each search, or you can create a new target
mailbox for each separate search.</p>
<div class="paragraph">
<p>A target mailbox is like any other mailbox and can have any features or
preferences that are defined by the COS or by account. Target mailboxes are
listed in the Administration Console Accounts list. You might want to give
the target mailboxes account names that identify them as target mailboxes
for cross-mailbox searches and configure a COS specific for target
mailboxes to be able to manage access.</p>
</div>
</li>
<li>
<p><strong>Limit the number of messages returned by the search</strong>. The default is
500 results.</p>
</li>
<li>
<p>You can select to send an email notification when the search is
completed. The email notification includes the search task ID and status on
the subject line and you can specify the type of information to include in
the message, such as the number of messages found, the list of addresses
resulting from the search and the search query used.</p>
</li>
<li>
<p>Select which mailboxes to search. When you check <strong>Select accounts to</strong>
<strong>search</strong>, you select which account addresses to search.</p>
</li>
<li>
<p><strong>Create the search query</strong>. You can search outgoing and incoming email by
date, from, to, cc, subject, keywords, and attachments. Advanced can be
used to quickly create a query to search by name, dates and time ranges,
distribution list, aliases.</p>
<div class="paragraph">
<p>When searching archive messages, you can search by the envelope address
using the <strong>envfrom</strong> and <strong>envto</strong> query language extensions.</p>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As the search runs, the Search Mailbox Content pane lists the search and
the status. Click <strong>Refresh</strong> to update this page.</p>
</div>
<div class="paragraph">
<p>Delete the search task when it is completed because it occupies server
memory. When the server is restarted, past searches are deleted.</p>
</div>
<div class="paragraph">
<p>When you use the discovery feature in the Administration Console, the tool
makes copies of messages in the target mailbox you create. The messages
occupy server space, increasing the size of your server. You might want to
delete these messages from the target mailbox when they are no longer
needed.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal_requests_for_information">Legal Requests for Information</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Legal Intercept feature makes copies of email messages sent, received, or saved as drafts from targeted accounts and sends these messages to a designated &#8220;shadow&#8221; email address.</p>
</div>
<div class="paragraph">
<p>Legal Intercept can be configured to send the complete content of the message or to send only the header information. When a targeted account sends, receives, or saves a draft message, an intercept message is automatically created to forward copies of the messages as attachments to the specified email address.</p>
</div>
<div class="sect2">
<h3 id="_legal_intercept_settings">Legal Intercept Settings</h3>
<div class="paragraph">
<p>The Legal Intercept feature can be configured either for a Class of Service or an individual account.
The feature is configured from the CLI, using <code>zmprov</code>.</p>
</div>
<div class="paragraph">
<p>The only required configuration to set up Legal Intercept is to enable the feature&#8201;&#8212;&#8201;<code>zimbraInterceptAddress</code>&#8201;&#8212;&#8201;on target accounts or COS.</p>
</div>
<div class="paragraph">
<p>You can enable the attribute <code>zimbraInterceptSendHeadersOnly</code> to send only the header information of the email message instead of sending the complete message.</p>
</div>
<div class="sect3">
<h4 id="_setting_up_legal_intercept">Setting Up Legal Intercept</h4>
<div class="paragraph">
<p>Specify the intercept address to receive intercepted messages.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If enabling intercept by COS:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;cosname&gt; zimbraInterceptAddress &lt;account@intercept.example.com&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>If enabling Intercept for an account:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;accountname@example.com&gt; zimbraInterceptAddress &lt;account@intercept.example.com&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are going to use the default intercept message template and From address (<code>postmaster@&lt;yourdomain.com&gt;`</code>), a Legal Intercept is set up.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_legal_intercept_to_forward_the_message_header">Setting Up Legal Intercept to Forward the Message Header</h4>
<div class="paragraph">
<p>To forward the header information, instead of the complete message for an account:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;accountname@example.com&gt; zimbraInterceptSendHeadersOnly TRUE</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modifying_the_intercept_cover_email_message">Modifying the Intercept Cover Email Message</h4>
<div class="paragraph">
<p>An email message is automatically created to forward copies of the intercepted messages as attachments.
The default message includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>From</strong> address is &#8220;postmaster@&lt;yourdomain.com&gt;&#8221;</p>
</li>
<li>
<p><strong>Subject</strong> line &#8220;Intercept message for &lt;<a href="mailto:account@yourdomain.com">account@yourdomain.com</a>&gt;
&lt;interceptedmessage subject&gt;&#8221;</p>
</li>
<li>
<p><strong>Message</strong> &#8220;Intercept message for &lt;<a href="mailto:account@yourdomain.com">account@yourdomain.com</a>&gt;.<br>
Operation=&lt;type of message&gt;, folder=&lt;foldername&gt;, folder ID=&lt;#&gt;&#8221;.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The cover email message can be modified.
Use the following parameters to modify the email message.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ACCOUNT_DOMAIN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain of the account being intercepted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ACCOUNT_ADDRESS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address being intercepted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MESSAGE_SUBJECT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject of the message being intercepted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OPERATION</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation that the user is performing, &#8220;add message&#8221;, &#8220;send message&#8221;, or &#8220;save draft&#8221;.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FOLDER_NAME</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the folder to which the message was saved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FOLDER_ID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ID of the folder to which the message was saved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NEWLINE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for formatting multi-line message bodies.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Use steps in this section to change the from-name, the subject line, or text in the message body:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To change the <strong>From</strong> name:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;accountname@example.com&gt; zimbraInterceptFrom '&lt;newname@example.com&gt;'</code></pre>
</div>
</div>
</li>
<li>
<p>To change the text of the <strong>Subject</strong> line:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;accountname@example.com&gt; zimbraInterceptSubject \
 '&lt;Intercepted message subject text&gt; parameter &lt;text&gt; parameter'</code></pre>
</div>
</div>
</li>
<li>
<p>To change the text in the <strong>message body</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma &lt;accountname@example.com&gt; zimbraInterceptBody \
 '&lt;Intercepted message text&gt; parameter &lt;text&gt; parameter'</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To modify by COS, type <code>zmprov mc {cosname} &#8230;&#8203;</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_mailbox_snapshots_for_legal_discovery">Creating Mailbox Snapshots for Legal Discovery</h3>
<div class="paragraph">
<p>You can create a query for the user&#8217;s mailbox using the REST URL format to search for specific types of email messages and attachments and have these messages zipped and saved to your computer.
This <code>zip</code> file can be forwarded to a requesting law enforcement agency.</p>
</div>
<div class="paragraph">
<p>The email message appears as an <code>.eml</code> file name after the subject line.
The attachments get saved in the format that they were delivered.</p>
</div>
<div class="sect3">
<h4 id="_creating_a_mailbox_snapshot_zip_file">Creating a Mailbox Snapshot <code>zip</code> File</h4>
<div class="paragraph">
<p>You must be logged into the ZCS Administration Console to create the <code>zip</code> file. You create a query for one account at a time.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the Administration Console address field of the browser, after the port number <strong>7071/</strong>, type:</p>
<div class="paragraph">
<p><code>home/&lt;username&gt;?fmt=zip&amp;query=&lt;searchquerystring&gt;</code></p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/mailbox_snapshot_zip_file.png" alt="Address Bar">
</div>
</div>
<div class="paragraph">
<p>In the above example, the search query is requesting a <code>zip</code> file of all accounts called <code>user1</code>.</p>
</div>
<div class="paragraph">
<p>You can use any search operators supported for searching in ZCS.
For example, you can search by folder (<code>in:folder_name</code>), by sender&#8217;s name (<code>from:&lt;someone&gt;</code>), and you can use multiple search terms.
See the Search Tips wiki page for keyword examples, <a href="https://wiki.zimbra.com/wiki/Search_Tips" class="bare">https://wiki.zimbra.com/wiki/Search_Tips</a>.</p>
</div>
</li>
<li>
<p>Press <strong>Enter</strong> or the arrow to create the zip.
A <strong>Confirm</strong> box displays, asking if you want to navigate away from this page.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
<li>
<p>Choose where you want to save the <code>zip</code> file.
This <code>zip</code> file is ready to be delivered.</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="color_and_logo_management">Color and Logo Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can change the logo and base colors of the Zimbra Web Client themes
without having to customize individual Zimbra Collaboration themes.  This
can be done from the administration console or the CLI.</p>
</div>
<div class="sect2">
<h3 id="_changing_theme_color_and_logos_on_the_zimbra_web_client">Changing Theme Color and Logos on the Zimbra Web Client</h3>
<div class="paragraph">
<p>Base colors for themes, and custom logos can be configured as a global
setting or as a domain setting.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When the global settings are changed, the changes apply to themes on all
servers.</p>
</li>
<li>
<p>When the domain settings are changed, the base color and logos for themes
on the domain are changed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If global settings and domain-level settings for theme base colors or logos
are not identical, the domain values are displayed for the domain.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If the logo and base colors are customized in multi-domain Zimbra Collaboration
environments, you must set a virtual host as the base color: logo
attributes are displayed based on the Host header sent by the browser.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Various Zimbra themes are included with Zimbra Collaboration.  Some of
these themes - such as lemongrass, Hot Rod, and Waves - have been designed
with graphics or color codes that do not change when you modify the base
color.  You might want to disable those themes from user’s Theme
preferences selection.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_customizing_base_theme_colors">Customizing Base Theme Colors</h4>
<div class="paragraph">
<p>The following base colors in Zimbra Web Client themes can be changed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The primary background color displayed in the client.</p>
<div class="paragraph">
<p>This color is the background of the page. Variants of the color are used
for buttons, background color of the Content and panes, tabs, and
selection highlight. In the following image, the background color
displays with the logo, the variant of the background color displays in
the login area.</p>
</div>
</li>
<li>
<p>The secondary color is the color used for the toolbar.</p>
</li>
<li>
<p>The selection color is the color displayed for a selected item such as
a message or an item in the Overview pane.</p>
</li>
<li>
<p>The foreground color is the text color displayed. The default text
color is black. The text color usually does not need to be changed.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_replacing_the_web_client_logo">Replacing the Web Client Logo</h4>
<div class="paragraph">
<p>You can replace the logo with your company’s logo globally or per domain.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong><em>License Policy for Logo Replacement</em></strong><br>
<em>The Zimbra Public License does not allow removing the Zimbra logo in
the Zimbra Web Client. Only Network Edition customers can replace Zimbra
logos that display in the Zimbra Web Client. Therefore, only customers
of the Network Edition should use these instructions. Additional
information about the license usage can be found at <a href="https://www.zimbra.com/license/" class="bare">https://www.zimbra.com/license/</a>.</em>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_graphics_to_replace">Graphics to Replace</h5>
<div class="paragraph">
<p>The following logo files can be changed. Your logos must be the same
size as specified here or the image might not display correctly.
These graphic files can be saved on another server or in a directory
that is not overwritten when Zimbra Collaboration is upgraded.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Company logo that displays on the login and splash screens for Zimbra Web Client and the Zimbra Collaboration administration console. The
dimension of the graphic must be exactly 300 x 30.</p>
</li>
<li>
<p>Small company logo in the upper-left of the Zimbra Web Client
application and the administration console. The dimension of the graphic
must be exactly 170 x 35.</p>
</li>
<li>
<p>Company Web address that links from the company logos.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_graphics_not_replaced">Graphics not replaced</h5>
<div class="paragraph">
<p>The icon that displays in the Advanced search toolbar and the
favicon.ico that displays in the URL browser address field cannot be
changed at this time.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_admin_console_to_modify_theme_colors_and_logo">Using the Admin Console to Modify Theme Colors and Logo</h4>
<div class="paragraph">
<p>On the administration console, the Global Settings and the Domains
settings include a Themes page that can be configured to customize the
color scheme and to add a company logo and logo URL. You upload your
company logo to be used on the Zimbra Web Client and administration
console pages.</p>
</div>
<div class="sect4">
<h5 id="_changing_base_theme_colors">Changing Base Theme Colors</h5>
<div class="paragraph">
<p>You can either select colors from popup view of predefined colors, or
enter the six-digit hexadecimal color value for an exact color match to
set theme colors for the following categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Foreground, which is the text color.</p>
</li>
<li>
<p>Background, which is the primary background color displayed in the
client.</p>
</li>
<li>
<p>Secondary, which is the color used for the toolbar and selection
headers in the pane.</p>
</li>
<li>
<p>Selection, which is the color displayed for a selected item such as a
message, right-click, or drop down menu selection.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Changes to theme settings require the server theme cache to be flushed.  To
flush a server, go to <strong>Home &#8594; Configure &#8594; Servers</strong> to get the list of
servers.  Right-click on a server and select <strong>Flush Cache</strong> from the popup
menu.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the <strong>Customize the theme colors</strong> container to set colors for your
theme categories:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; Themes</strong> or<br>
<strong>Home &#8594; Configure &#8594; Domains &#8594; <em>domain</em> &#8594; Themes</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click on the field alongside the theme category to be modified, then
use the popup color selector to define the color for your selection.</p>
<div class="paragraph">
<p>You can either click directly on a color, or use the entry field to
write the hexadecimal value of the color. In either case, your selection
will be displayed in the field.</p>
</div>
<div class="paragraph">
<p>If you opt out of your color selections, click <strong>reset all theme colors</strong>
to discard your settings.</p>
</div>
</li>
<li>
<p>Navigating away from this page results in query for save of the
settings.</p>
<div class="paragraph">
<p>Click <strong>Yes</strong> (to save) or <strong>No</strong> (to discard your settings).</p>
</div>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_adding_your_logo">Adding Your Logo</h5>
<div class="paragraph">
<p>You can replace the Zimbra Collaboration logo with your company’s logo
globally or per domain from the appropriate Themes page. Your logos must
be the same size as specified in the <strong>Graphics to Replace</strong>
section or the images might not display correctly. The graphic files are
saved on another server or in a directory that is not overwritten when
Zimbra Collaboration is upgraded.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When you configure the <strong>Customize the logo of the
themes</strong> section in the <strong>Global Settings &#8594; Theme</strong> page, all fields in
this section must be completed to display the graphics correctly.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Zimlet icon that displays in the Advanced search toolbar and the
favicon.ico that displays in the URL browser address field are not
changed.</p>
</div>
<div class="paragraph">
<p>Use the <strong>Customize the logo of the themes</strong> container to a logo to
accompany the theme:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Global Settings &#8594; Themes</strong> or<br>
<strong>Home &#8594; Configure &#8594; Domains &#8594; <em>domain</em> &#8594; Themes</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 56. Logo Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logo URL of the themes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The company web address to be linked from the logo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application logo banner URL of the themes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The company logo that displays on the login and splash screens for the
Zimbra Web Client and admin console. the dimension of the graphic must
be exactly 450x100.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application logo banner preview (200x35)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The company logo in the upper-left of the Zimbra Web Client application
and the administration console. the dimension of the graphics must be
exactly 120x35.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login logo banner URL of the themes</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login logo banner preview (440x60)</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_cli_to_change_theme_colors_and_logo">Using the CLI to Change Theme Colors and Logo</h4>
<div class="paragraph">
<p>To change the Zimbra Web Client theme base colors and logos, use the
zmprov command.  The following attributes are configured either as a
global config setting or as a domain settings.  Color values are
entered as a six-digit hexadecimal codes.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 57. Color Attributes</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinBackgroundColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hex color value for the primary background color displayed in the client.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinSecondaryColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hex color value for the toolbar and selected tabs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinSelectionColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hex color value for the color of the selected item.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinForegroundColor</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hex color value for the text. This usually does not need to be
changed as the default is black.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Changing base colors for themes</strong></p>
</div>
<div class="paragraph">
<p>Before you begin, identify the six-digit hexadecimal base color values
for the various elements you are changing. You will be using these in
your command entries.</p>
</div>
<div class="listingblock">
<div class="title">Global Settings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyConfig &lt;attribute-name&gt; [“#HEX_6digit_colorcode”]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Domain Settings</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyDomain &lt;domain&gt; &lt;attribute-name&gt; [“#HEX_6digit_colorcode”]</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Modifying a domain</strong></p>
</div>
<div class="paragraph">
<p>The example in this section demonstrates how to change to the following
base colors:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Background color = Coral, #FF7F50</p>
</li>
<li>
<p>Secondary color = turquoise, #ADEAEA</p>
</li>
<li>
<p>Selection color = yellow, #FFFF00</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Specify the skin colors:
Log in as the <code>zimbra</code> user and use <code>zmprov</code> to modify the domain:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov modifyDomain example.com \
 zimbraSkinBackgroundColor &quot;#FF7F50&quot; \
 zimbraSkinSecondaryColor &quot;#ADEAEA&quot; \
 zimbraSkinSelectionColor &quot;#FFFF00&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The quote marks, <code>""</code>, are required so the use of the <code>#</code> sign does not
comment out the text that follows.</p>
</div>
</li>
<li>
<p>Use the zmmailboxdctl command to apply the changes by restarting
the mailbox server process:</p>
<div class="literalblock">
<div class="content">
<pre>zmmailboxdctl restart</pre>
</div>
</div>
<div class="paragraph">
<p>Reload the Web Client, and Zimbra Collaboration themes for that domain should
now display these colors.</p>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Adding Your Logos</strong></p>
</div>
<div class="paragraph">
<p>You add the company logo information and URL by modifying these the
following attributes for logos:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 58. Logo Settings</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinLogoURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The company Web address that you want linked from the logo.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinLogoLoginBanner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The company logo file name that is displayed on the login and splash
screens for the Web Client and the Zimbra Collaboration administration console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSkinLogoAppBanner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The logo graphic file name for the graphic in the upper-left of the Web Client application and the administration console.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>To add logos for a domain</strong></p>
</div>
<div class="paragraph">
<p>If logo files are saved in the Zimbra Collaboration server, they must be
in a subdirectory of <code>/opt/zimbra/jetty/webapps/zimbra</code>.</p>
</div>
<div class="paragraph">
<p>If the logos are hosted on another machine, enter the full URL when
identifying the logo.</p>
</div>
<div class="paragraph">
<p>Use steps in this section to update the logo(s) displayed over a
domain:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Change the URL link:</p>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyDomain zimbraSkinLogoURL https://url.example.com/</pre>
</div>
</div>
</li>
<li>
<p>Modify the logo display:</p>
<div class="paragraph">
<p>To change the logo displayed in the login and splash screens:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyDomain zimbraSkinLogoLoginBanner /zimbra/loginlogo.png</pre>
</div>
</div>
<div class="paragraph">
<p>To change the logo displayed on the Zimbra Web Client main page:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmprov modifyDomain zimbraSkinLogoAppBanner /zimbra/applogo.png</pre>
</div>
</div>
</li>
<li>
<p>Stop/start the server:</p>
<div class="literalblock">
<div class="content">
<pre>zmcontrol restart</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Not currently supported:</em> Logo modification for the Zimbra Web Client.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zimlets">Zimlets</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Zimlets are a mechanism to integrate ZCS with different third-party
applications to enhance the user experience from the Zimbra Web Client.
With Zimlets, users can look at information and interact with the
third-party application from within their email messages. Zimlets can be
made available from the Zimbra Web Client Overview Pane to users by
modifying the Class of Service (COS).</p>
</div>
<div class="paragraph">
<p>ZCS includes several predefined Zimlets. You can also create Zimlets or
download them from the Zimlet Gallery located on the Zimbra Web site.</p>
</div>
<div class="paragraph">
<p>Predefined Zimlets when enabled let users preview the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Mouse over a date or time and see what is in calendar.</p>
</li>
<li>
<p>Mouse over a name or email address and see details from the address book
for this name.</p>
</li>
<li>
<p>Right-click on a phone number to make a call with your soft-phone.</p>
</li>
<li>
<p>Right-click on a date to schedule a meeting.</p>
</li>
<li>
<p>Right-click on a name, address, or phone number to update address book
information.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For information about creating Zimlets, see the Zimlet Development section
on the Zimbra Wiki.</p>
</div>
<div class="sect2">
<h3 id="_managing_zimlets_from_the_administration_console">Managing Zimlets from the Administration Console</h3>
<div class="paragraph">
<p>The following Zimlet management tasks are available from the Zimbra
Administration Console.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Deploy a Zimlet, which creates the Zimlet entry in the LDAP server,
installs the Zimlet files on the server, enables the Zimlet and makes it
available to the members of the default COS.</p>
</li>
<li>
<p>Make a Zimlet available or not available per COS or account.</p>
</li>
<li>
<p>Make a Zimlet mandatory.</p>
</li>
<li>
<p>Disable a Zimlet, which leaves it on the server, but the Zimlet is not
used.</p>
</li>
<li>
<p>Undeploy a Zimlet, which removes it from the COS listings and the Zimlets
list but does not uninstall the Zimlet from the server.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot uninstall the Zimlet from the Administration Console.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_deploying_custom_zimlets">Deploying Custom Zimlets</h4>
<div class="paragraph">
<p>You can download and deploy custom Zimlets from the Zimlet Gallery located
on the Zimbra Web site. When a Zimlet is deployed, it is available
immediately to everyone in the default COS. If a Zimlet is not deployed to
another COS directly, the COS displays the Zimlets but they are not
enabled.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Zimlets</strong>, from the <strong>Gear</strong> icon select <strong>Deploy</strong></p>
</dd>
</dl>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Browse to the Zimlet you want to deploy, then click <strong>Deploy</strong>.</p>
<div class="paragraph">
<p>The Zimlet deploys to the server. A dialog displays indicating the server
name where the Zimlet is deployed and the status of the deployment.</p>
</div>
</li>
<li>
<p>Click <strong>Finish</strong>.</p>
<div class="paragraph">
<p>Verify the Zimlet is enabled by viewing the Zimlets page.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_enable_disable_or_make_zimlets_mandatory">Enable, Disable, or Make Zimlets Mandatory</h4>
<div class="paragraph">
<p>You can enable, disable, or make Zimlets mandatory. You can also use
the toggle feature to choose if an installed Zimlet will be made
available for users to choose from.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service &#8594; <em>COS</em> &#8594; Zimlets</strong></p>
</dd>
</dl>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 59. Zimlet Operational Status Settings.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Setting</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet will always be enabled in user accounts. Users do not see these
Zimlets on their Zimlet page.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet will not be immediately available to users in the associated COS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">All deployed Zimlets will be enabled.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Users can enable or disable optional Zimlets from their account’s
<strong>Preferences &#8594; Zimlets</strong> page. If you select a Zimlet as mandatory, it
cannot be disabled by the user.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_undeploying_a_zimlet">Undeploying a Zimlet</h4>
<div class="paragraph">
<p>When a Zimlet is undeployed, it is removed from all COSs and then removed
from the LDAP.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Zimlets</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select a <em>Zimlet</em> to undeploy.</p>
</li>
<li>
<p>From the <strong>Gear</strong> icon menu select <strong>Undeploy</strong>.</p>
</li>
<li>
<p>Click <strong>Yes</strong> to confirm.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_adding_proxy_allowed_domains_to_a_zimlet">Adding Proxy-Allowed Domains to a Zimlet</h4>
<div class="paragraph">
<p>Proxy Allowed Domains lets you configure which external domains can be
accessed through a Zimlet. For the Zimlets that are included in ZCS, proxy
allowed domains are already configured. If you download and deploy other
Zimlets, you can add additional proxy domain names.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Class of Service</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the <em>COS</em> to edit.</p>
</li>
<li>
<p>In the <strong>Advanced</strong> page, scroll down to the <strong>Proxy Allowed Domains</strong>
section.</p>
</li>
<li>
<p>Click <strong>Add Domain</strong> to add domains.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_upgrading_a_zimlet">Upgrading a Zimlet</h4>
<div class="paragraph">
<p>Use the same steps as deploying a new Zimlet to upgrade a customized
Zimlet. The new Zimlet <code>zip</code> file should have the same name as the existing
Zimlet <code>zip</code> file.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Admin Console: </dt>
<dd>
<p><strong>Home &#8594; Configure &#8594; Zimlets</strong>, from the <strong>Gear</strong> icon select <strong>Deploy</strong></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check <strong>Flush Zimlet cache,</strong> so that the upgraded zimlet will be used.</p>
</li>
<li>
<p>Browse to the <em>Zimlet</em> you want to upgrade, then click <strong>Deploy</strong>.</p>
</li>
<li>
<p>Click <strong>Finish</strong>.</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_managing_zimlets_from_the_command_line_interface">Managing Zimlets from the Command Line Interface</h3>
<div class="paragraph">
<p>The following Zimlet management tasks are available from the command line
interface.</p>
</div>
<div class="sect3">
<h4 id="_deploying_zimlets">Deploying Zimlets</h4>
<div class="paragraph">
<p>When a Zimlet is deployed, it is available immediately to everyone in
the default COS. If a Zimlet is not deployed to another COS directly,
the COS displays the Zimlets but they are not enabled.</p>
</div>
<div class="paragraph">
<p>Deploy a Zimlet using the CLI, including modifying the COS before
deploying.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select a Zimlet and copy the Zimlet <code>zip</code> file to <code>/tmp</code> folder on your
Zimbra server.</p>
</li>
<li>
<p>Login as the zimbra user <code>su - zimbra</code></p>
</li>
<li>
<p>Deploy the Zimlet</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl deploy /tmp/&lt;zimlet&gt;.zip</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_adding_proxy_allowed_domains_to_a_zimlet_2">Adding Proxy Allowed Domains to a Zimlet</h4>
<div class="paragraph">
<p>When deploying a Zimlet, the COS attributes, <code>zimbraProxyAllowedDomains</code>,
must be set for the domain address that the Zimlet might call to get
information.</p>
</div>
<div class="paragraph">
<p>To set the <code>zimbraProxyAllowedDomains</code> attribute, type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;COSname&gt; +zimbraProxyAllowedDomains '*.example.com'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>*</code> must be added before the <code>example.com</code>.</p>
</div>
<div class="paragraph">
<p>This must be applied to all COSs that have your Zimlet enabled.</p>
</div>
</div>
<div class="sect3">
<h4 id="_deploying_a_zimlet_and_granting_access_to_a_cos">Deploying a Zimlet and Granting Access to a COS</h4>
<div class="paragraph">
<p>Use steps in this section to deploy a Zimlet to one or more COSs other than
the default:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Login as zimbra user: su – zimbra</p>
</li>
<li>
<p>Copy the Zimlet file from Gallery to <strong>/tmp</strong> folder.</p>
</li>
<li>
<p>Install the Zimlet to the default COS:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl deploy /tmp/&lt;zimlet&gt;.zip</code></pre>
</div>
</div>
</li>
<li>
<p>To deploy the zimlet to additional COSs, run:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl acl &lt;zimletname&gt; &lt;cosname1&gt; grant</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will grant permission to <code>cosname1</code>. You can also grant access to more
than one COS on the same command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl acl &lt;zimletname&gt; &lt;cosname1&gt; grant &lt;cosname2&gt; grant</code></pre>
</div>
</div>
</li>
<li>
<p>To allow this zimlet to use the allowed proxy domains, run the following
on each COS and add the allowed domains.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;COSname1&gt; +zimbraProxyAllowedDomains '*.example.com'
zmprov mc &lt;COSname2&gt; +zimbraProxyAllowedDomains '*.example.com'</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_installed_zimlets">Viewing Installed Zimlets</h4>
<div class="paragraph">
<p>Use the <code>zmzimletctl</code> command to view currently installed Zimlets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl listZimlets all</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output from this command displays the Zimlets installed on the server,
installed in LDAP, and those available by COS.</p>
</div>
</div>
<div class="sect3">
<h4 id="_changing_zimlet_configurations">Changing Zimlet Configurations</h4>
<div class="paragraph">
<p>Some Zimlets may require additional configuration after they are deployed.</p>
</div>
<div class="paragraph">
<p>The Zimlet configuration template allows you to make changes on the
configuration template and then install the new configuration file on the
Zimbra server.</p>
</div>
<div class="paragraph">
<p>Use steps in this section to change a Zimlet configuration:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extract the configuration template:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl getConfigTemplate &lt;zimlet.zip&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Make the required changes in the template, taking care to change only the
required areas, then save the file.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you have more than one custom Zimlet, rename the config template.xml
file before updating the configuration in LDAP so that files are not
overwritten.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use the <code>zmzimletctl</code> command to update the configuration in the LDAP.  If
you changed the name of the configuration template, replace
<code>config_template.xml</code> with the new name.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl configure config_template.xml</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_upgrading_a_zimlet_2">Upgrading a Zimlet</h4>
<div class="paragraph">
<p>Upgrading a customized Zimlet is performed by using the same steps as those
used to deploy a new Zimlet.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The new Zimlet <code>zip</code> file should be named identically to the existing Zimlet
<code>zip</code> file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use steps in this section upgrade a Zimlet:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy the Zimlet <code>zip</code> file to the <code>/opt/zimbra/zimlets-extra</code> folder,
replacing the older version.</p>
</li>
<li>
<p>Deploy the Zimlet</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl deploy &lt;zimlet.zip file name&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Zimlet is copied to the <code>/opt/zimbra/zimlets-deployed</code> folder. If
your Zimlet includes a <code>.jsp</code> file, the <code>.jsp</code> file is also copied to the
<code>/opt/zimbra/jetty/webapps/zimlet/&lt;zimletnamefolder&gt;</code>.</p>
</div>
</li>
<li>
<p>To ensure availability of the newer version, flush the cache:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov flushCache zimlet</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_zimbra_gallery">Using the Zimbra Gallery</h4>
<div class="paragraph">
<p>You can download and deploy Zimlets from the Zimlet Gallery located on the
Zimbra web site. Go to <a href="https://www.zimbra.org/extend/" class="bare">https://www.zimbra.org/extend/</a> and scroll through
the Extensions from the Zimbra Gallery section.</p>
</div>
</div>
<div class="sect3">
<h4 id="_developing_customized_zimlets">Developing Customized Zimlets</h4>
<div class="paragraph">
<p>To develop your own custom Zimlets, see the Zimlet Developers Guide on
the Zimbra Wiki at <a href="https://wiki.zimbra.com" class="bare">https://wiki.zimbra.com</a>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="voice_service">Using the Voice Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Unified Communications (UC) is the integration of multiple modes of communication services, allowing users to receive communication from one service, such as voice mail, and respond using another service, such as Click-to-Call.</p>
</div>
<div class="paragraph">
<p>Zimbra uses real-time communications services such as voice, telephony and presence to inter-operate with non-real-time services such as email and voice mail. The Zimbra Collaboration Voice Service feature includes Visual Voice Mail, Click-to-Call, and Presence (Cisco only). Zimbra Collaboration uses Cisco or Mitel servers, as a third-party voice server, or UC server, to bridge calls between Zimbra Collaboration and the Zimbra Web Client.</p>
</div>
<div class="paragraph">
<p><strong>Note:</strong> UC system administrators are responsible for configuring the UC server based on that UC server’s documentation.</p>
</div>
<div class="paragraph">
<p>You enable the voice service from the administration console. Users use the voice service feature from the Voice tab in the Web Client.</p>
</div>
<div class="paragraph">
<p>When users sign into the voice service from their Zimbra account, they are actually logging into a UC server. After the initial user set-up, the voice service is seamless and requires no additional account configuration.</p>
</div>
<div class="paragraph">
<p>Voice service features include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Visual Voice Mail:</strong> From the Voice tab, users can easily view and listen to voice mails and view details such as caller name, time details, and length of message. Users can call back the person that left the message, forward or reply to the message by email, save or delete the message, and select how to be notified of a new voice message. Supported audio formats include WAV and MP3.</p>
</li>
<li>
<p><strong>Click-to-Call:</strong> The ability to make a phone call from a the Zimbra account. Users can highlight and click phone number in their email to dial, or select a contact’s phone number from their contact lists. The call is bridged from the registered physical or soft phone the user selects to use to call the recipient. Click-to-Call eliminates the use for a dial pad on a phone.</p>
</li>
<li>
<p><strong>Click-to-Chat:</strong> (Cisco clients only) The ability to chat with a contact using the Cisco Jabber client and ZCS. Users must have the recipient’s IM address stored in their contact information. They can then access the recipient’s contact card and click the IM link to initiate a chat session.</p>
</li>
<li>
<p><strong>Presence:</strong> (Cisco clients only) The ability to display in real time the availability information about users or contacts. When using Cisco Jabber, users can manually set their presence status or it is automatically set for them. For example, when users are on a phone call their presence status is automatically set to “on a call”. Presence status is displayed as available, away, on a call, or do not disturb.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_order_of_configuration">Order of Configuration</h3>
<div class="paragraph">
<p>To create voice service, follow the order of configuration as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Access URLs, as described in Using a Third-Party Unified Communications Server.</p>
</li>
<li>
<p>Create the voice service, as described in Creating the Voice/Chat Service.</p>
</li>
<li>
<p>Enable the voice service and the voice feature, as described in Enabling the Voice/Chat Service. Enabling the voice feature allows the Voice tab to display in the Web Client.</p>
</li>
<li>
<p>Enable the appropriate Zimlets for the vendor server you are using, as described in Enabling the Voice/Chat Zimlets.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_voice_service_requirements">Voice Service Requirements</h3>
<div class="paragraph">
<p>The following are required for ZCS voice service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Voice Service license:</strong> A ZCS license with the voice service feature is required. To obtain this license, see the Zimbra Collaboration Server License section for more information.</p>
</li>
<li>
<p><strong>Unified Communications Server:</strong> Third-Party Unified Communications server requirements for either Cisco or Mitel are listed below. URLs from the UC server are used in the configuration of the ZCS voice service, as described in Using a Third-Party Unified Communications Server.</p>
<div class="ulist">
<ul>
<li>
<p><strong>For Cisco:</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Cisco Unity Connection (UC) 8.5 and above</strong>. Cisco UC generates the Voice URL used in the voice service configuration.</p>
</li>
<li>
<p><strong>Cisco Unified Communications Manager (CUCM) 7.1(3):</strong> Enable Web Dialer service for Click-to-Call functionality. Cisco CUCM generates the Call URL used in the voice service configuration.</p>
</li>
<li>
<p><strong>Cisco Unified Presence Server (CUPS) 8.0:</strong> Cisco CUPS requires Presence Web Service to be enabled, and an application user must be created for viewing the presence. This is done in Cisco Communications Manager (CUCM) &#8594; User Management. Cisco CUPS generates the Presence URL used in the voice service configuration.</p>
</li>
<li>
<p><strong>Cisco Jabber client provided to users for UC collaboration.</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>For Mitel:</strong></p>
<div class="ulist">
<ul>
<li>
<p><strong>Mitel Unified Communicator Advanced (Mitel UCA) 5.0.23.0 release and above.</strong> Mitel UCA generates the URLs used in the voice service configuration.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><strong>ZCS Zimlets:</strong> Voice Preferences Zimlet, Cisco Click2Call Zimlet or Mitel Click2Call Zimlet</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_third_party_unified_communications_server">Using a Third-Party Unified Communications Server</h3>
<div class="paragraph">
<p>The ZCS Voice Service uses a third-party Unified Communications (UC) server to bridge calls between ZCS and the UC server. UC server domain information is added to the ZCS administrator console as a Proxy Allowed Domain. This allows Zimlets that are used in the configuration of the voice service to send requests to the UC servers, such as for the Click-To-Call and/or Presence feature. The following URLs from the UC server are used to configure the voice service.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cisco_urls">Cisco URLs</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Voice URL:</strong> The Voice URL is the URL of the Cisco UC server. For example, <code>https://xx.xx.xxx.xx</code>. This URL is used by the ZCS server to fetch user’s voice mails from the Cisco UC server on behalf of users.</p>
</li>
<li>
<p><strong>Call URL:</strong> The Call URL is the URL of the Cisco CUCM server. For example, <code>https://xx.xx.xxx.xx/webdialer/services/WebdialerSoapService70</code>. This URL is used by the ZCS Cisco Click2Call Zimlet to send requests to the Cisco CUCM server to bridge calls.</p>
</li>
<li>
<p><strong>Presence URL:</strong> The Presence URL is the URL of the Cisco CUPS server and used to generate a session ID. For example, <code>http://xx.xx.xxx.xx:8082/presence-service/users</code>. This URL is used by the ZCS Email Zimlet to send fetch requests to the contact’s presence from the Cisco CUPS server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Provision an application user name and password using the Cisco Unified Presence Server (CUPS).</p>
</div>
</div>
<div class="sect2">
<h3 id="_mitel_urls">Mitel URLs</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Voice URL:</strong> The Voice URL is the URL of the Mitel server. For example <code>https://xx.xx.xxx.xx</code>. This URL is used by the ZCS server to fetch user’s voice mails from the Mitel Voice server on behalf of users.</p>
</li>
<li>
<p><strong>Call URL:</strong> The Call URL is the URL of the Mitel server. For example, <code>https://xx.xx.xxx.xx/webdialer/services/WebdialerSoapService70</code>. This URL is used by the ZCS Mitel Click2Call Zimlet to send requests to the Mitel server to bridge calls.</p>
</li>
<li>
<p><strong>User URL:</strong> The User URL is the URL of the Mitel server. This URL is used by ZCS for user identification/authentication.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_creating_the_voicechat_service">Creating the Voice/Chat Service</h3>
<div class="paragraph">
<p>When creating the voice/chat service in ZCS, you are enabling the bridge between ZCS and a third-party UC server. You create a service for a domain, Class of Service (COS), or user.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the ZCS administrator console, go to the <strong>Home&gt;Configure&gt;Voice/Chat Service</strong> page.</p>
</li>
<li>
<p>From the gear icon menu, select <strong>New</strong>.</p>
</li>
<li>
<p>On the Choose Voice/Chat Vendor, select your vendor from the drop-down menu.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
<li>
<p>Add a <strong>Display name</strong> for the domain, COS, or user you are creating.</p>
</li>
<li>
<p>Add the URLs for the voice services you want to enable.</p>
</li>
<li>
<p>Click <strong>OK</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_configure_presence_cisco_only">Configure Presence (Cisco only)</h3>
<div class="paragraph">
<p>If configuring Presence, you must generate a Presence Session ID.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to <strong>Configure&gt;Voice/Chat Service</strong> page.</p>
</li>
<li>
<p>Select the voice service for which you want to generate a Presence Session ID.</p>
</li>
<li>
<p>Click the gear icon drop down menu and select <strong>Generate Session ID</strong> from the menu.</p>
</li>
<li>
<p>Enter the <strong>Presence User Name</strong> and <strong>Presence Password</strong>, which are the credentials for the presence server to authenticate the voice connection between ZCS and the UC server. This allows ZCS to retrieve presence information for users.</p>
</li>
<li>
<p>Click <strong>OK</strong>. A presence session ID is generated and displays as the <strong>Presence Session ID</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_the_voicechat_service">Enabling the Voice/Chat Service</h3>
<div class="paragraph">
<p>After you create the voice/chat service for a domain, COS, or user, you must enable the voice/chat service. For COS and User accounts, you also enable the voice feature which displays the Voice tab in the Web Client.</p>
</div>
</div>
<div class="sect2">
<h3 id="_enable_voicechat_service_on_a_domain">Enable Voice/Chat Service on a Domain</h3>
<div class="paragraph">
<p>For Voice/Chat service on a domain, enable the service on the Domains&gt;General Information page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <strong>Configure&gt;Domains</strong> page.</p>
</li>
<li>
<p>Select the domain for which you want to enable voice service.</p>
</li>
<li>
<p>Click the gear icon menu and select <strong>Edit</strong>.</p>
</li>
<li>
<p>Scroll down to Voice and Chat section and from the <strong>Voice/Chat Service</strong> drop-down menu select the voice service to enable.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enable_voicechat_service_on_a_cos">Enable Voice/Chat Service on a COS</h3>
<div class="paragraph">
<p>For Voice/Chat service on a COS, you must first enable the voice/chat service and then enable the voice feature.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <strong>Configure&gt;Class of Service</strong> page.</p>
</li>
<li>
<p>Select the COS for which you want to enable the voice service.</p>
</li>
<li>
<p>Click the gear icon drop and select <strong>Edit</strong>.</p>
</li>
<li>
<p>On the General Information page, scroll down to <strong>Voice and Chat</strong> section and from the <strong>Voice/Chat Service</strong> drop-down menu select the voice service to enable.</p>
</li>
<li>
<p>In the Navigation pane, click <strong>Features</strong>.</p>
</li>
<li>
<p>On the Features page, scroll down to <strong>Voice and Chat Features</strong> section and click <strong>Enable Voice Feature</strong>. This displays the Voice tab in the Web Client.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enable_voicechat_service_on_a_user_account">Enable Voice/Chat Service on a User Account</h3>
<div class="paragraph">
<p>For Voice/Chat service on a User Account, you must first enable the voice/chat service and then enable the voice feature.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <strong>Home&gt;Manage&gt;Accounts</strong> page.</p>
</li>
<li>
<p>Select the account for which you want to enable voice service.</p>
</li>
<li>
<p>Click the gear icon drop and select <strong>Edit</strong>.</p>
</li>
<li>
<p>On the General Information page, scroll down to <strong>Voice and Chat</strong> section.</p>
</li>
<li>
<p>From the <strong>Voice/Chat Service</strong> menu select the voice service to enable.</p>
</li>
<li>
<p>Enter a <strong>Chat/Voice Username</strong> for the user.
This is the user account name in the third-party UC server.
If you do not provide a name, the default name is used.
For example for email account <code>user1@domain.com</code>, the default voice username is “user1”.</p>
</li>
<li>
<p>From the <strong>Voice/Chat Service</strong> menu select the voice service to enable.</p>
</li>
<li>
<p>In the Navigation pane, click <strong>Features</strong>.</p>
</li>
<li>
<p>On the Features page, scroll down to <strong>Voice and Chat Features</strong> section and click <strong>Enable Voice Feature</strong>. This displays the Voice tab in the Web Client.</p>
</li>
<li>
<p>Click <strong>Save</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_enabling_the_voicechat_zimlets">Enabling the Voice/Chat Zimlets</h3>
<div class="paragraph">
<p>Zimlets are used in the configuration of the voice service to enable the service and send requests to the UC servers. The Voice Preferences Zimlet adds a voice page to the user interface, and the vendor specific Click2Call Zimlets provide the click to call capability.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go to the <strong>Home&gt;Configure&gt;Zimlets</strong> page.</p>
</li>
<li>
<p>Enable the Voice Preferences Zimlet.</p>
<div class="ulist">
<ul>
<li>
<p>Select the <strong>Voice Preferences</strong> Zimlet in the Content pane.</p>
</li>
<li>
<p>Go to the gear icon menu and select <strong>Deploy</strong>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enable the vendor Zimlet for Click2Call.</p>
<div class="ulist">
<ul>
<li>
<p>Select the Zimlet appropriate to the vender server you are using:</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you are using Cisco, select the <strong>Cisco Click2Call</strong> Zimlet.</p>
</li>
<li>
<p>If you are using Mitel, select the <strong>Mitel Click2Call</strong> Zimlet.</p>
<div class="ulist">
<ul>
<li>
<p>Go to the gear icon menu and select <strong>Deploy</strong>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you want to undeploy a Zimlet, select the Zimlet and go to the gear icon drop down menu and select <strong>Undeploy</strong>, or you can toggle the Zimlet.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="backup-ng-guide">Backup NG</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="real-time-scan">Real-Time Scan</h3>
<div class="sect3">
<h4 id="what-is-the-real-time-scanner">What is the Real-Time Scanner?</h4>
<div class="paragraph">
<p>The Real-Time Scanner is the most significant innovation in Backup NG.
Each event on the system is recorded live to Zimbra&#8217;s RedoLog and saved by Backup NG, which means that it is always possible to rollback an account to a previous state.
Thanks to the Real-Time Scanner, all the restore modes work with split-second precision.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work">How Does it Work?</h4>
<div class="paragraph">
<p>The Real-Time Scanner reads all the events of the mail server almost real-time by following the flow of information provided by the RedoLog.
Then it 'replicates' the same operations on its data structure, creating items or updating their metadata.
No information in the backup gets overwritten, so every item has its complete history.</p>
</div>
</div>
<div class="sect3">
<h4 id="managing-the-real-time-scanner">Managing the Real-Time Scanner</h4>
<div class="sect4">
<h5 id="enabling-the-real-time-scanner">Enabling the Real-Time Scanner</h5>
<div class="sect5">
<h6 id="via-the-administration-zimlet">Via the Administration Zimlet</h6>
<div class="ulist">
<ul>
<li>
<p>Select the Backup NG Tab.</p>
</li>
<li>
<p>Under Real-Time Scanner, press the <code>Enable</code> button.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the Real-Time Scanner is enabled for the first time or re-enabled after a stop, a SmartScan is required.
A warning gets displayed after enabling the Real-Time Scanner, prompting you to start the SmartScan either via the CLI or the Admin Console.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="via-the-cli">Via the CLI</h6>
<div class="paragraph">
<p>The <code>ZxBackup_RealTimeScanner</code> property of the Backup NG module must be set to <code>true</code> to enable the Real-Time Scanner via the CLI:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup setProperty ZxBackup_RealTimeScanner TRUE</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="disabling-the-real-time-scanner">Disabling the Real-Time Scanner</h5>
<div class="sect5">
<h6 id="via-the-administration-zimlet-1">Via the Administration Zimlet</h6>
<div class="ulist">
<ul>
<li>
<p>Select the Backup NG Tab.</p>
</li>
<li>
<p>Under Real-Time Scanner, press the <code>Disable</code> button.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="via-the-cli-1">Via the CLI</h6>
<div class="paragraph">
<p>The <code>ZxBackup_RealTimeScanner</code> property of the Backup NG module must be set to <code>false</code> to disable the Real-Time Scanner via the CLI:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup setProperty ZxBackup_RealTimeScanner FALSE</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="why-should-i-disable-the-real-time-scanner">Why Should I Disable the Real-Time Scanner?</h6>
<div class="paragraph">
<p>The only time you should disable the Real-Time Scanner is while performing an External Restore of multiple domains, as a safety measure to avoid high load on your server.
After the import, re-enable the Real-Time Scanner and perform a SmartScan when prompted.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="limitations-and-safety-scan">Limitations and Safety Scan</h5>
<div class="paragraph">
<p>The main limitation when restoring data acquired via the Real-Time Scanner is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Emptied Folder</strong> - when a user uses the <code>Empty Folder</code> button in the right-click context menu</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In this case, and any time Backup NG cannot determine the status of an item by reading the metadata saved by the Real-Time Scan, an Account Scan on the given account is triggered BEFORE the restore.</p>
</div>
<div class="paragraph">
<p>Doing so fixes any misaligned data and sanitizes the backed up metadata for the mailbox.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="blobless-backup-mode">Blobless Backup Mode</h3>
<div class="paragraph">
<p>Blobless Backup Mode is a new feature that avoids backing up item blobs while still safeguarding all other item-related information.</p>
</div>
<div class="paragraph">
<p>This mode takes advantage of advanced storage capabilities of the storage solution, such as built-in backup or data replication, optimizing both the backup module&#8217;s disk space usage and restore speed.</p>
</div>
<div class="sect3">
<h4 id="blobless-requirements">Blobless Backup Requirements</h4>
<div class="paragraph">
<p>These are the requirements to enable Blobless Backup Mode:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The server is running Zimbra 8.8.15 or higher.</p>
</li>
<li>
<p>No "independent" third-party volumes must exist: Blobless Backup Mode is only compatible with local volumes and centralized third-party volumes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Blobless Backup Mode is storage-agnostic and can be enabled on any server or infrastructure that meets the requirements above regardless of the specific storage vendor.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-blobless-backup-mode-works">How Blobless Backup Mode works</h4>
<div class="paragraph">
<p>Blobless Backup Mode works exactly as its default counterpart: the RealTime Scanner takes care of backing up item changes while the SmartScan manages domain/cos/account consistency.
The only difference between the two is that in Blobless Backup Mode, the backup contains no items of kind <code>blob</code> while still saving all metadata and transaction history.</p>
</div>
<div class="paragraph">
<p>It&#8217;s essential to consider that once enabled, Blobless Backup Mode affects the entire server, and no blobs get backed up regardless of the target volume and HSM policies.</p>
</div>
</div>
<div class="sect3">
<h4 id="restoring-data-from-a-blobless-backup-dataset">Restoring Data from a Blobless Backup dataset</h4>
<div class="paragraph">
<p>To date, Blobless Backup Mode is only compatible with the "Raw Restore" operation.
In the future, additional restore operations will become compatible with blobless datasets.</p>
</div>
</div>
<div class="sect3">
<h4 id="enabling-blobless-backup-mode">Enabling Blobless Backup Mode</h4>
<div class="paragraph">
<p>Blobless Backup Mode can be enabled or disabled through the <code>backupBloblessMode</code> NG attribute at global and server level:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite config global set attribute backupBloblessMode value true
zxsuite config server set mail.example.com attribute backupBloblessMode value true</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="smartscan">SmartScan</h3>
<div class="sect3">
<h4 id="what-is-the-smart-scan">What is the SmartScan?</h4>
<div class="paragraph">
<p>The SmartScan is the primary coherency check for the health of your backup system.
It&#8217;s <code>Smart</code> because it operates only on accounts modified since the last SmartScan, hence improving system performance and decreasing scan time exponentially.</p>
</div>
<div class="paragraph">
<p>The default SmartScan schedule executes each night (if <code>Scan Operation Scheduling</code> is enabled in the Backup NG section of the Administration Zimlet).
Once a week, on a day set by the user, a Purge executes together with the SmartScan to clear Backup NG&#8217;s datastore from any deleted item that exceeded the retention period.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-1">How Does it Work?</h4>
<div class="paragraph">
<p>The Backup NG engine scans all the items on the Zimbra Datastore, looking for items modified after the last SmartScan.
It updates any outdated entry and creates any item not yet present in the backup while flagging as deleted any item found in the backup and not in the Zimbra datastore.</p>
</div>
<div class="paragraph">
<p>Finally, it updates all configuration metadata in the backup to store domains, accounts, COSs, and server configurations along with a dump of all LDAP data and config.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-is-a-smart-scan-executed">When is a SmartScan Executed?</h4>
<div class="ulist">
<ul>
<li>
<p>When the Backup NG module starts.</p>
</li>
<li>
<p>Daily, if the Scan Operation Scheduling is enabled in the Administration Zimlet.</p>
</li>
<li>
<p>When re-enabling the Real-Time Scanner via the Administration Zimlet after being previously disabled.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="running-a-smart-scan">Running a SmartScan</h4>
<div class="sect4">
<h5 id="starting-the-scan-via-the-administration-zimlet">Starting the Scan via the Administration Zimlet</h5>
<div class="paragraph">
<p>To start a SmartScan via the Administration Zimlet,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Administration Zimlet.</p>
</li>
<li>
<p>Click the Backup NG tab (be sure to have a valid license).</p>
</li>
<li>
<p>Click <code>Run Smartscan</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="starting-the-scan-via-the-cli">Starting the Scan via the CLI</h5>
<div class="paragraph">
<p>To start a FullScan via the CLI, use the <code>doSmartScan</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup doSmartScan [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME                TYPE
notifications(O)    Email Address[,..]

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup dosmartscan notifications user1@example.com,user2@example.com
Performs a smart scan and sends notifications to user1@example.com and user2@example.com</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-a-running-scan">Checking the Status of a Running Scan</h5>
<div class="paragraph">
<p>To check the status of a running scan via the CLI, use the <code>monitor</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup monitor {operation_uuid} [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME                 TYPE
operation_uuid(M)    Uiid
operation_host(O)    String

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="purge">Purge</h3>
<div class="sect3">
<h4 id="what-is-the-backup-purge">What is the Backup Purge?</h4>
<div class="paragraph">
<p>The Backup Purge is a cleanup operation that removes from the Backup Path any deleted item that exceeded the retention time defined by the
<code>Data Retention Policy</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-2">How Does it Work?</h4>
<div class="paragraph">
<p>The Purge engine scans the metadata of all deleted items, and it removes any item whose last update (deletion) timestamp is higher than the retention time.</p>
</div>
<div class="paragraph">
<p>Any item BLOB still referenced by one or more valid metadata files is not deleted, thanks to Backup NG&#8217;s built-in deduplication.</p>
</div>
<div class="paragraph">
<p>SPostfix customizations backed up by Backup NG also follow the backup path&#8217;s purge policies.
Change policies in the <code>Backup NG</code> section of the Administration Zimlet by unchecking the <code>Purge old customizations</code> checkbox.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-is-a-backup-purge-executed">When is a Backup Purge Executed?</h4>
<div class="ulist">
<ul>
<li>
<p>Weekly, if the Scan Operation Scheduling is enabled in the Administration Zimlet.</p>
</li>
<li>
<p>When manually started either via the Administration Console or the CLI.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="infinite-retention">Infinite Retention</h4>
<div class="paragraph">
<p>When the <code>Data Retention Policy</code> is set to <code>0</code>, meaning infinite retention, the Backup Purge immediately exits since no deleted item can exceed an infinite retention time.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-a-backup-purge">Running a Backup Purge</h4>
<div class="sect4">
<h5 id="starting-the-backup-purge-via-the-administration-zimlet">Starting the Backup Purge via the Administration Zimlet</h5>
<div class="paragraph">
<p>To start a BackupPurge via the Administration Zimlet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the Backup NG tab (be sure to have a valid license).</p>
</li>
<li>
<p>Click the <code>Run Purge</code> button in the top-right part of the UI.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="starting-the-backup-purge-via-the-cli">Starting the Backup Purge via the CLI</h5>
<div class="paragraph">
<p>To start a BackupPurge via the CLI, use the <code>doPurge</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup doPurge [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME              TYPE
purgeDays(O)      String
backup_path(O)    Path

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup dopurge purgeDays 30 backup_path /opt/zimbra/backup/backup_name</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-a-running-backup-purge">Checking the Status of a Running Backup Purge</h5>
<div class="paragraph">
<p>To check the status of a running Purge via the CLI, use the <code>monitor</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup monitor {operation_uuid} [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME                 TYPE
operation_uuid(M)    Uiid
operation_host(O)    String

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="external-backup">External Backup</h3>
<div class="sect3">
<h4 id="what-is-the-external-backup">What is the External Backup?</h4>
<div class="paragraph">
<p>The External Backup is one of the Backup Methods of Backup NG.
It creates a snapshot of the mail system, which is ready for migration or Disaster Recovery.
Exported data is deduplicated and compressed to optimize disk utilization, transfer times, and I/O rates.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-3">How Does it Work?</h4>
<div class="paragraph">
<p>The Backup NG engine scans all the data in the Zimbra datastore, saving all the items (deduplicated and compressed) into a folder of your choice.</p>
</div>
<div class="sect4">
<h5 id="folder-permissions">Folder Permissions</h5>
<div class="paragraph">
<p>The destination folder must be readable and writable by the <strong>zimbra</strong> user.</p>
</div>
<div class="paragraph">
<p>To create a valid export directory, run the following commands:</p>
</div>
<div class="paragraph">
<p><code>mkdir /opt/zimbra/backup/yourdestfolder</code></p>
</div>
<div class="paragraph">
<p><code>chown -R zimbra:zimbra /opt/zimbra/backup/yourdestfolder</code></p>
</div>
</div>
<div class="sect4">
<h5 id="preparing-the-migration">Preparing the Migration</h5>
<div class="paragraph">
<p>To minimize the risk of errors, please perform the following maintenance procedures before migrating:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Double check Zimbra permissions with the following command (must run as root): <code>/opt/zimbra/libexec/zmfixperms --verbose --extended</code></p>
</li>
<li>
<p>Reindex all mailboxes.</p>
</li>
<li>
<p>Check the BLOB consistency with the <code>zxsuite hsm doCheckBlobs</code> utility.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-an-external-backup">Running an External Backup</h4>
<div class="sect4">
<h5 id="via-the-administration-zimlet-2">Via the Administration Zimlet</h5>
<div class="paragraph">
<p>To start an External Backup via the Administration Zimlet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the Backup NG tab.</p>
</li>
<li>
<p>Click the <code>Export Backup</code> button under <code>Import/Export</code> to open the Export Backup wizard.</p>
</li>
<li>
<p>Enter the Destination Path in the textbox, and press Next.
The software checks if the destination folder is empty and whether the 'zimbra' user has R/W permissions.</p>
</li>
<li>
<p>Select the domains you want to export, and press Next.</p>
</li>
<li>
<p>Verify all your choices in the Operation Summary window.
You can also add additional email addresses for notification when the restore operation finishes.
Please note that the system sends notifications by default to the Admin account and the user who started the restore procedure.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="via-the-cli-2">Via the CLI</h5>
<div class="paragraph">
<p>To start an External Backup via the CLI, use <code>doExport</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup doExport {destination_path} [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME                   TYPE                  DEFAULT
destination_path(M)    Path
domains(O)             Domain Name[,..]      all
notifications(O)       Email Address[,..]

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doexport /opt/zimbra/backup/ domains example.com notifications john@example.com
Exports a backup of example.com to /opt/zimbra/backup/ and notifies john@example.com</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="scheduling-script">Scheduling Script</h4>
<div class="paragraph">
<p>You can use the NG CLI to schedule External Backup operations.
Scheduling is handy; for example, when you need to keep a daily/weekly/monthly backup for corporate or legal reasons.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restore-on-new-account">Restore on New Account</h3>
<div class="sect3">
<h4 id="what-is-the-restore-on-new-account">What is the Restore on New Account?</h4>
<div class="paragraph">
<p>The Restore on New Account procedure allows you to restore the contents and preferences of a mailbox as it was in a moment in time, into a completely new account.
The source account is unchanged in any way, so it is possible to recover one or more deleted items in a user&#8217;s account without actually rolling back the whole mailbox.
When you run this kind of restore, you can choose to hide the newly created account from the GAL as a security measure.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-4">How Does it Work?</h4>
<div class="paragraph">
<p>When a Restore on New Account starts, a new account gets created (the Destination Account), with all the items existing in the source account at the moment selected, including the folder structure and all the user&#8217;s data.
All restored items are created in the current primary store unless you check the <code>Obey HSM Policy</code> box.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When restoring data on a new account, shared items consistency is lost, as the original share rules refer to the source account&#8217;s ID, not to the new (restored) account.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="running-a-restore-on-new-account-via-the-administration-zimlet">Running a Restore on New Account via the Administration Zimlet</h4>
<div class="paragraph">
<p>A Restore on New Account can run in two ways.</p>
</div>
<div class="sect4">
<h5 id="from-the-accounts-tab">From the Account List</h5>
<div class="paragraph">
<p>Running Restore from the <code>Accounts</code> tab in the Zimbra Administration Console allows you to operate on users currently existing on the server.<br>
If you need to restore a deleted user, please proceed to Restore via the Administration Zimlet.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select <code>Accounts</code> in the left pane of the Administration Console to show the Accounts List.</p>
</li>
<li>
<p>Browse the list and click the account to restore (Source).</p>
</li>
<li>
<p>On the top bar, press the wheel and then the `Restore ` button.</p>
</li>
<li>
<p>Select <code>Restore on New Account</code> as the Restore Mode and enter the name of the new account (Destination) into the text box.
You can then choose whether to Hide in GAL the new account or not, then press <code>Next</code>.</p>
</li>
<li>
<p>Choose the restore date.
Day/Month/Year can be selected via a minical, the hour via a drop-down menu and minute and second via two text boxes.
Click <code>Next</code>.</p>
</li>
<li>
<p>Verify all your choice in the Operation Summary window.
You can also add additional email addresses for notification when the restore operation finishes.
Please note that the system sends notifications by default to the Admin account and the user who started the restore procedure.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Click <code>Finish</code> to start the restore.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-a-restore-on-new-account-via-the-cli">Running a Restore on New Account via the CLI</h4>
<div class="paragraph">
<p>To start a Restore on New Account via the CLI, use the doRestoreOnNewAccount command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup doRestoreOnNewAccount {source_account} {destination_account} {"dd/MM/yyyy HH:mm:ss"|last} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME                       TYPE                  EXPECTED VALUES
source_account(M)          Account Name
destination_account(M)     Account Name/ID
date(M)                    Date                  `dd/MM/yyyy HH:mm:ss`|last
restore_chat_buddies(O)    Boolean               true|false
notifications(O)           Email Address[,..]

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup dorestoreonnewaccount John NewJohn `28/09/2021 10:15:10`
Restores John's account in a new account named NewJohn</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="undelete-restore">Undelete Restore</h3>
<div class="sect3">
<h4 id="what-is-undelete-restore">What is Undelete Restore?</h4>
<div class="paragraph">
<p>Undelete Restore is one of the Restore Modes available in Backup NG.
It allows an administrator to restore all items deleted from a mailbox during a given period and put them into a dedicated Zimbra folder inside the mailbox itself.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-5">How Does it Work?</h4>
<div class="paragraph">
<p>During an Undelete Restore, the Backup NG engine searches the backup datastore for items flagged as <code>DELETED</code> and restores them in a dedicated folder in the selected mailbox.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The IMAP <code>deleted</code> flag is stripped from restored items so that they are visible for the user in the Zimbra Web Client.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="running-an-undelete-restore">Running an Undelete Restore</h4>
<div class="sect4">
<h5 id="via-the-administration-console">Via the Administration Console</h5>
<div class="ulist">
<ul>
<li>
<p>Select <code>Accounts</code> in the left pane of the Administration Console to show the Accounts List.</p>
</li>
<li>
<p>Browse the list and click the account to restore (Source).</p>
</li>
<li>
<p>On the top bar, press the wheel and then the `Restore ` button".</p>
</li>
<li>
<p>Select <code>Undelete</code> as the Restore Mode and press <code>Next</code>.</p>
</li>
<li>
<p>Choose the restore date-time slot.
Day/Month/Year can be selected via a minical, the hour via a drop-down menu and the minute and second via two text boxes.
Click <code>Next</code>.</p>
</li>
<li>
<p>Verify your choices in the Operation Summary window.
You can also add additional email addresses for notification when the restore operation finishes.
Please note that the system sends notifications by default to the Admin account and the user who started the restore procedure.</p>
</li>
<li>
<p>Click <code>Finish</code> to start the Restore.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="via-the-cli-3">Via the CLI</h5>
<div class="paragraph">
<p>To start an Undelete Restore operation, use the <code>doUndelete</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup doUndelete {account} {"dd/MM/yyyy HH:mm:ss"|first} {"dd/MM/yyyy HH:mm:ss"|last} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME                TYPE                  EXPECTED VALUES
account(M)          Account Name
start_date(M)       Date                  `dd/MM/yyyy HH:mm:ss`|first
end_date(M)         Date                  `dd/MM/yyyy HH:mm:ss`|last
notifications(O)    Email Address[,..]

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doundelete John `08/10/2021 10:15:00` last
Performs an undelete on John's account of all items created between 08/10/2021 10:15:00 and the latest data available</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="external-restore">External Restore</h3>
<div class="sect3">
<h4 id="what-is-the-external-restore">What is the External Restore?</h4>
<div class="paragraph">
<p>The External Restore is one of the Restore Modes of Backup NG.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-6">How Does it Work?</h4>
<div class="paragraph">
<p>The External Restore adds to the current Zimbra server all the data, metadata, and configuration data stored on an external backup.</p>
</div>
<div class="paragraph">
<p>The workflow of the import procedure is as follows:</p>
</div>
<div class="paragraph">
<p><strong>PHASE1</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>''Operation Started'' notification</em></p>
</li>
<li>
<p>Read Server Backup Data</p>
</li>
<li>
<p>Create empty Domains</p>
</li>
<li>
<p>Create needed COS (only those effectively used by the imported accounts)</p>
</li>
<li>
<p>Create empty DLs</p>
</li>
<li>
<p>Create empty Accounts</p>
</li>
<li>
<p>Restore all Accounts' attributes</p>
</li>
<li>
<p>Restore all Domains' attributes</p>
</li>
<li>
<p>Restore all DLs' attributes and share information</p>
</li>
<li>
<p><em>''PHASE1 Feedback'' Notification</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>PHASE2</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restore all Items</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>PHASE3</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restore all Mountpoints and Datasources</p>
</li>
<li>
<p><em>''Operation Ended'' notification with complete feedback</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="before-you-start-1">Before You Start</h4>
<div class="paragraph">
<p>If Backup NG previously initialized on the destination server, disable the RealTime Scanner to improve both memory usage and I/O performance.</p>
</div>
<div class="paragraph">
<p>To reduce the I/O overhead and the amount of disk space used for the migration, advanced users may tweak or disable Zimbra&#8217;s RedoLog for the duration of the import.</p>
</div>
<div class="paragraph">
<p>To further reduce the amount of disk space used, it&#8217;s possible to enable compression on your current primary volume before starting the import.
If you do not wish to use a compressed primary volume after migration, it&#8217;s possible to create a new and uncompressed primary volume.
Set the new volume to <code>Current</code> and the old one to <code>Secondary</code>.
All of this is supported using the HSM NG module.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-an-external-restore">Running an External Restore</h4>
<div class="sect4">
<h5 id="via-the-administration-zimlet-3">Via the Administration Zimlet</h5>
<div class="ulist">
<ul>
<li>
<p>Click the Backup NG tab.</p>
</li>
<li>
<p>Click the <code>Import Backup</code> button under <code>Import/Export</code> to open the Import Backup wizard.</p>
</li>
<li>
<p>Enter the Destination Path into the text box and press Forward.
The software checks if the destination folder contains a valid backup and whether the 'zimbra' user has Read permissions.</p>
</li>
<li>
<p>Select the domains you want to import and press Forward.</p>
</li>
<li>
<p>Select the accounts you want to import and press Forward.</p>
</li>
<li>
<p>Verify all your choices in the Operation Summary window.
You can also add additional email addresses for notification when the restore operation finishes.
Please note that the system sends notifications by default to the Admin account and the user who started the restore procedure.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="via-the-cli-4">Via the CLI</h5>
<div class="paragraph">
<p>To start an External Restore operation, use the <code>doExternalRestore</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup doExternalRestore {source_path} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME                          TYPE                 EXPECTED VALUES    DEFAULT
source_path(M)                Path
accounts(O)                   Account Name[,..]                       all
domains(O)                    Domain Name[,..]                        all
filter_deleted(O)             Boolean              true|false         true
skip_system_accounts(O)       Boolean              true|false         true
skip_aliases(O)               Boolean              true|false         false
skip_distribution_lists(O)    Boolean              true|false         false
provisioning_only(O)          Boolean              true|false         false
skip_coses(O)                 Boolean              true|false         false
notifications(O)              Email Address

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doexternalrestore /opt/zimbra/backup/restorePath/ accounts john@example.com,jack@example.com domains example.com filter_deleted false skip_system_accounts false
Restores the example.com domain, including all system accounts, and the john@example.com and jack@example.com accounts from a backup located in /opt/zimbra/backup/restorePath/</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="speeding-up-the-restore-through-multithreading">Speeding up the Restore through Multithreading</h4>
<div class="paragraph">
<p>The <code>concurrent_accounts</code> parameter allows you to restore multiple accounts at the same time, thus greatly speeding up the restore process.
<strong>This feature is not available via the Administration Console</strong>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Although resource consumption does not grow linearly with the number of accounts restored at once, it can easily become taxing.
Start from a low number of concurrent accounts and raise it according to your server&#8217;s performance.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>Usage example:

zxsuite backup doExternalRestore /tmp/external1 domains example0.com,example1.com concurrent_accounts 5

Restores the example0.com and example1.com domain, excluding system accounts, restoring 5 accounts at the same time from a backup located in /tmp/external1</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="after-the-restore-message-deduplication">After the Restore: Message Deduplication</h4>
<div class="paragraph">
<p>We strongly recommend running volume-wide deduplication with the HSM NG module after an External Restore.
The native deduplication system can be ineffective when sequentially importing accounts.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="restore-deleted-account">Restore Deleted Account</h3>
<div class="sect3">
<h4 id="what-is-the-restore-deleted-account">What is the Restore Deleted Account?</h4>
<div class="paragraph">
<p>The Restore Deleted Account procedure allows you to restore the contents and preferences of a mailbox into a completely new account, as it was when deleting the said mailbox.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-7">How Does it Work?</h4>
<div class="paragraph">
<p>When a Restore Deleted Account starts, a new account gets created (the Destination Account), with all the items existing in the source account at the moment of the deletion, including the folder structure and all the user&#8217;s data.
All restored items are created in the current primary store unless you&#8217;ve checked the <code>Obey HSM Policy</code> box.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When restoring data on a new account, shared items consistency is lost, as the original share rules refer to the source account&#8217;s ID, not to the new (restored) account.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="from-the-backup-ng-tab">From the Backup NG tab</h5>
<div class="ulist">
<ul>
<li>
<p>Select <code>Backup NG</code> in the left pane of the Administration Console to show the Backup NG tab.</p>
</li>
<li>
<p>On the top bar, push the <code>Restore Deleted Account</code> button.</p>
</li>
<li>
<p>Choose the restore date.
Day/Month/Year can be selected via a minical, the hour via a drop-down menu and the minute and second via two text boxes.
Click <code>Next</code>.</p>
</li>
<li>
<p>Browse the list and click the account to restore (Source).</p>
</li>
<li>
<p>Enter the name of the new account (Destination) in the text box.
You can then choose whether to Hide in GAL the new account or not then press <code>Next</code>.</p>
</li>
<li>
<p>Verify all your choices in the Operation Summary window.
You can also add additional email addresses for notification when the restore operation finishes.
Please note that the system sends notifications by default to the Admin account and the user who started the restore procedure.</p>
</li>
<li>
<p>Click <code>Finish</code> to start the Restore.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="item-restore">Item Restore</h3>
<div class="sect3">
<h4 id="what-is-the-item-restore">What is the Item Restore?</h4>
<div class="paragraph">
<p>The Item Restore is one of the Restore Modes of Backup NG.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-8">How Does it Work?</h4>
<div class="paragraph">
<p>A single item restores from the backup to the owner&#8217;s account.
You may restore any type of item this way.</p>
</div>
</div>
<div class="sect3">
<h4 id="running-an-item-restore">Running an Item Restore</h4>
<div class="sect4">
<h5 id="via-the-administration-zimlet-4">Via the Administration Zimlet</h5>
<div class="paragraph">
<p>Item Restore is only available through the CLI.</p>
</div>
</div>
<div class="sect4">
<h5 id="via-the-cli-5">Via the CLI</h5>
<div class="paragraph">
<p>To start an Item Restore operation, use the <code>doItemRestore</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup doItemRestore {account_name} {item_id} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME                 TYPE
account_name(M)      Account Name
item_id(M)           Integer
restore_folder(O)    String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doitemrestore john@example.com 4784
Restores item 4784 in the `john@example.com` mailbox</pre>
</div>
</div>
<div class="sect5">
<h6 id="how-to-obtain-the-itemid">How to Obtain the itemID</h6>
<div class="paragraph">
<p>The <code>itemID</code> is part of the <code>metadata</code> of an item, consisting of a unique code that identifies an item in a mailbox.</p>
</div>
<div class="paragraph">
<p>It resides along with all other metadata in a file inside the <code>items</code> directory of the proper account in</p>
</div>
<div class="paragraph">
<p><code>[backup path]/accounts/[accountID]/items/[last 2 digits of itemID]/[itemID]</code></p>
</div>
<div class="paragraph">
<p>e.g.:</p>
</div>
<div class="paragraph">
<p>Item 2057 of account 4a217bb3-6861-4c9f-80f8-f345ae2897b5, default backup path<br>
<code>/opt/zimbra/backup/ng/accounts/4a217bb3-6861-4c9f-80f8-f345ae2897b5/items/57/2057</code></p>
</div>
<div class="paragraph">
<p>Metadata storage uses a plain text file, so tools like <code>grep</code> and <code>find</code> are effective for searching contents.
To see the metadata contained in a file in a more readable format, you can use the <code>zxsuite backup getItem</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME              TYPE               EXPECTED VALUES            DEFAULT
account(M)        Account Name/ID
item(M)           Integer
backup_path(O)    Path                                          /opt/zimbra/backup/ng/
dump_blob(O)      Boolean            true|false                 false
date(O)           Date               dd/mm/yyyy hh:mm:ss|all    last

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup getitem a7300a00-56ec-46c3-9773-c6ef7c4f3636 1
Shows item with id = 1 belonging to account a7300a00-56ec-46c3-9773-c6ef7c4f3636
zimbra@simone:~$ zxsuite backup getitem

command getItem requires more parameters

Syntax:
   zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME              TYPE               EXPECTED VALUES            DEFAULT
account(M)        Account Name/ID
item(M)           Integer
backup_path(O)    Path                                          /opt/zimbra/backup/ng/
dump_blob(O)      Boolean            true|false                 false
date(O)           Date               dd/mm/yyyy hh:mm:ss|all    last

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup getitem a7300a00-56ec-46c3-9773-c6ef7c4f3636 1
Shows item with id = 1 belonging to account a7300a00-56ec-46c3-9773-c6ef7c4f3636</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="real-life-example">''Real Life'' Example</h4>
<div class="paragraph">
<p>Let&#8217;s say a user moves one item to the trash:</p>
</div>
<div class="paragraph">
<p><code>2021-07-18 15:22:01,495 INFO  [btpool0-4361://localhost/service/soap/MsgActionRequest [name=user@domain.com;mid=2538;oip=258.236.789.647;ua=zclient/7.2.4_GA_2900;] mailop - moving Message (id=339) to Folder Trash (id=3)</code></p>
</div>
<div class="paragraph">
<p>and then empties the trash.</p>
</div>
<div class="paragraph">
<p><code>2021-07-18 15:25:08,962 INFO  [btpool0-4364://localhost/service/soap/FolderActionRequest] [name=user@domain.com;mid=2538;oip=258.236.789.647;ua=zclient/7.2.4_GA_2900;] mailbox - Emptying 9 items from /Trash, removeSubfolders=true.</code></p>
</div>
<div class="paragraph">
<p>She then calls the Administrator to restore the deleted item.
Knowing the itemID and the email address, the Administrator runs the following as the <code>zimbra</code> user to restore the missing item:</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doItemRestore user@domain.com 339</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="raw-restore">Raw Restore</h3>
<div class="paragraph">
<p>The "Raw Restore" operation is a DR-type restore operation compatible with both standard and blobless backup.
In contrast to similar restore modes such as the External Restore, Raw Restore operates at a lower level to restore all item metadata, thus maintaining the original IDs for all objects restored.</p>
</div>
<div class="paragraph">
<p>The Raw Restore restores the source server&#8217;s Centralized Storage configuration.
This step ensures that any data stored inside of a Centralized Storage is immediately available.
 If you are using local or independent third-party volumes, it is easy to move the item BLOBs from the primary storage or to restore those from a backup using the Blob Restore operation.</p>
</div>
<div class="sect3">
<h4 id="differences-between-external-restore-and-raw-restore">Differences between External Restore and Raw Restore</h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">External Restore</th>
<th class="tableblock halign-left valign-top">Raw Restore</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Useable on any Zimbra version regardless of the source</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Must match the very same Zimbra version and patch level as those on the source server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does not restore any setting</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores Centralized Storage settings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does not support blobless Backup Paths</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is designed for blobless Backup Paths and compatible with standard Backup Paths</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does restore item BLOBs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Does not restore item BLOBs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restored objects get created anew</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restored objects maintain their original ID</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="what-will-be-restored">What <strong>will</strong> be restored</h5>
<div class="ulist">
<ul>
<li>
<p>Centralized Storage configuration and settings</p>
</li>
<li>
<p>Domains</p>
</li>
<li>
<p>Classes of Service</p>
</li>
<li>
<p>Distribution lists</p>
</li>
<li>
<p>Mailboxes</p>
</li>
<li>
<p>Mailbox preferences</p>
</li>
<li>
<p>Item metadata</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="what-will-not-be-restored">What <strong>will not</strong> be restored</h5>
<div class="ulist">
<ul>
<li>
<p>Item Blobs</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="running-a-raw-restore">Running a Raw Restore</h4>
<div class="paragraph">
<p>The Raw Restore is only available through the <code>zxsuite</code> CLI tool:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[zimbra@mail ~]$ zxsuite backup doRawRestore
Perform a disaster recovery

Syntax:
   zxsuite backup doRawRestore {source_path} [attr1 value1 [attr2 value2...]]


PARAMETER LIST

NAME                     TYPE                  EXPECTED VALUES    DEFAULT
source_path(M)           String
notifications(O)         Email Address[,..]
skipProvisioning(O)      Boolean               true|false         false
deleteWhenConflict(O)    Boolean               true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doRawRestore /my/backup/path notifications user1@example.com,user2@example.com skipProvisioning false deleteWhenConflict false
Performs a Raw Restore without restoring provisioning or deleting a mailbox when ids are conflicting, and sends notifications to user1@example.com and user2@example.com
The disaster recovery operation does not perform blob restore, use doRestoreBlobs when needed.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="usage-scenarios">Usage scenarios</h4>
<div class="paragraph">
<p><strong>Restore of a single-server infrastructure</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set up a new server (install Zimbra, configure Global and Server settings).</p>
</li>
<li>
<p>Manually create any local or independent 3rd-party volume as it was on the original server.</p>
</li>
<li>
<p>Start a Raw Restore using to restore domains, CoS mailboxes, and item metadata (mailboxes won&#8217;t be accessible until this step completes).</p>
</li>
<li>
<p>If the source backup was not running in Blobless Mode, run zxsuite backup doRestoreBlobs for all volumes to restore item BLOBS.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Loss of a single mailbox node in a multiserver infrastructure</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add a new mailbox node to the infrastructure.</p>
</li>
<li>
<p>Manually create any local or independent 3rd-party volume as it was on the original server.</p>
</li>
<li>
<p>Start a Raw Restore using the <code>skipProvisioning true</code> parameter to restore item metadata (mailboxes won&#8217;t be accessible until this step completes).</p>
</li>
<li>
<p>If the source backup was not running in Blobless Mode, run zxsuite backup doRestoreBlobs for all volumes to restore item BLOBS.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Loss of multiple mailbox servers in an infrastructure</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setup a new empty infrastructure (all servers and roles, setting up Global and Server configuration).</p>
</li>
<li>
<p>Delete default <code>admin</code>, <code>gal</code>, <code>ham</code>, and <code>spam</code> accounts.</p>
</li>
<li>
<p>On all mailbox servers, manually create any local or independent 3rd-party volume as it was on the original server.</p>
</li>
<li>
<p>On the first mailbox server, start a Raw Restore using to restore domains, CoS mailboxes, and item metadata (mailboxes won&#8217;t be accessible until this step completes).</p>
</li>
<li>
<p>On all other mailbox servers, start a Raw Restore using the <code>skipProvisioning true</code> parameter to restore item metadata.</p>
</li>
<li>
<p>Once steps 3 and 4 complete, If the source backup was not running in Blobless Mode, run <code>zxsuite backup doRestoreBlobs</code> for all volumes on all mailbox servers to restore item BLOBS.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="disaster-recovery">Disaster Recovery</h3>
<div class="sect3">
<h4 id="the-disaster">The Disaster</h4>
<div class="sect4">
<h5 id="what-can-go-wrong">What Can go Wrong</h5>
<div class="paragraph">
<p>Any of these occurrences serve to classify a problem as a <em>Disaster</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hardware failure of one or more vital filesystems (such as / or
/opt/zimbra/)</p>
</li>
<li>
<p>Contents of a vital filesystem made unusable by internal or external factors (like a careless <strong>rm *</strong> or an external intrusion)</p>
</li>
<li>
<p>Hardware failure of the physical machine hosting the Zimbra service or of the related virtualization infrastructure</p>
</li>
<li>
<p>A critical failure on a software or OS update/upgrade</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="minimizing-the-chances">Minimizing the Chances</h5>
<div class="paragraph">
<p>Some suggestions to minimize the chances of a disaster:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Always keep vital filesystems on different drives (namely /,
/opt/zimbra/ and your Backup NG path)</p>
</li>
<li>
<p>Use a monitoring/alerting tool for your server to become aware of problems as soon as they appear</p>
</li>
<li>
<p>Carefully plan your updates and migrations</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-recovery">The Recovery</h4>
<div class="sect4">
<h5 id="how-to-recover-your-system">How to Recover Your System</h5>
<div class="paragraph">
<p>Consider the recovery of a system divided into 2 steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base system recovery (OS installation and configuration, Zimbra installation and base configuration)</p>
</li>
<li>
<p>Data recovery (reimporting the last available data to the Zimbra server, including domain and user configurations, COS data and mailbox contents)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="how-can-backup-ng-help-with-recovery">How can Backup NG Help with Recovery?</h5>
<div class="paragraph">
<p>The <code>Import Backup</code> feature of Backup NG provides an easy and safe way to perform step 2 of recovery.</p>
</div>
<div class="paragraph">
<p>Using the old server&#8217;s backup path as the import path allows you to restore a basic installation of Zimbra to the last valid moment of your old server.</p>
</div>
<div class="paragraph">
<p>Here we&#8217;ve seen just one possible Disaster Recovery scenario: more advanced scenarios and techniques appear in the Zimbra Wiki.</p>
</div>
</div>
<div class="sect4">
<h5 id="the-recovery-process">The Recovery Process</h5>
<div class="ulist">
<ul>
<li>
<p>Install Zimbra on a new server and configure the Server and Global settings.</p>
</li>
<li>
<p>Install Network NG modules on the new server.</p>
</li>
<li>
<p>Mount the backup folder of the old server onto the new one.
If this is not available, use the last external backup available or the latest copy of either.</p>
</li>
<li>
<p>Begin an External Restore on the new server using the following CLI command:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zxsuite backup doExternalRestore /path/to/the/old/store</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The External Restore operation creates the domains, accounts and distribution lists, so as soon as the first part of the Restore completes (check your Network NG Modules Notifications), the system is ready for your users.
Emails and other mailbox items restore afterward.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="settings-and-configs">Settings and Configs</h5>
<div class="paragraph">
<p>Server and Global settings are backed up but not restored automatically.
Backup NG&#8217;s high-level integration with Zimbra allows you to restore your data to a server with a different OS/Zimbra Release/Networking/Storage setup without any constraints other than the minimum Zimbra version required to run Network NG Modules.</p>
</div>
<div class="paragraph">
<p>Whether you wish to create a perfect copy of the old server or just take a cue from the old server&#8217;s settings to adapt those to a new environment, Backup NG comes with a very handy CLI command:
<code>getServerConfig</code>.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite backup getServerConfig
command getServerConfig requires more parameters


Syntax:
   zxsuite backup getServerConfig {standard|customizations} [attr1 value1 [attr2 value2...


PARAMETER LIST


NAME              TYPE               EXPECTED VALUES                       DEFAULT
type(M)           Multiple choice    standard|customizations
date(O)           String             `dd/MM/yyyy HH:mm:ss`|"last"|"all"
backup_path(O)    Path                                                     /opt/zimbra/backup/ng/
file(O)           String             Path to backup file
query(O)          String             section/id/key
verbose(O)        String                                                   false
colors(O)         String                                                   false


(M) == mandatory parameter, (O) == optional parameter


Usage example:


zxsuite backup getserverconfig standard date last
 Display the latest backup data for Server and Global configuration.
zxsuite backup getserverconfig standard file /path/to/backup/file
 Display the contents of a backup file instead of the current server backup.
zxsuite backup getserverconfig standard date last query zimlets/com_zimbra_ymemoticons colors true verbose true
 Displays all settings for the com_zimbra_ymemoticons zimlet, using colored output and high verbosity.</pre>
</div>
</div>
<div class="paragraph">
<p>Specifically, this will display the latest backed up configurations:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup getServerConfig standard backup_path /your/backup/path/ date last query / | less</pre>
</div>
</div>
<div class="paragraph">
<p>You can change the <code>query</code> argument to display specific settings, e.g.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite backup getServerConfig standard date last backup_path /opt/zimbra/backup/ng/ query serverConfig/zimbraMailMode/test.domain.com


config date_______________________________________________________________________________________________28/02/2021 04:01:14 CET
test.domain.com____________________________________________________________________________________________________________both</pre>
</div>
</div>
<div class="paragraph">
<p>The {zimbrahome}/conf/ and {zimbrahome}/postfix/conf/ directories are
backed up as well:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite backup getServerConfig customizations date last verbose true
ATTENTION: These files contain the directories {zimbraHome}/conf/ and {zimbraHome}/postfix/conf/ compressed into a single archive.
           Restore can only be performed manually. Do it only if you know what you're doing.




        archives


                filename                                                    customizations_28_02_14#04_01_14.tar.gz
                path                                                        /opt/zimbra/backup/ng/server/
                modify date                                                 28/02/2021 04:01:14 CET</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="vms-and-snapshots">VMs and Snapshots</h4>
<div class="paragraph">
<p>Thanks to the advent of highly evolved virtualization solutions in the past years, virtual machines are now the most common way to deploy server solutions such as Zimbra Collaboration Suite.</p>
</div>
<div class="paragraph">
<p>Most hypervisors feature customizable snapshot capabilities and snapshot-based VM backup systems.
In case of a disaster, it&#8217;s always possible to roll back to the latest snapshot and import the missing data using the <code>External Restore</code> feature of Backup NG - using the server&#8217;s backup path as the import path.</p>
</div>
<div class="sect4">
<h5 id="disaster-recovery-from-a-previous-vm-state">Disaster Recovery from a Previous VM State</h5>
<div class="paragraph">
<p>Snapshot-based backup systems allow you to keep a <code>frozen</code> copy of a VM in a valid state and rollback to it at will.
To 100% ensure data consistency, it&#8217;s better to take snapshot copies of switched off VMs, but this is not mandatory.</p>
</div>
<div class="paragraph">
<p><strong>When using these kinds of systems, it&#8217;s vital to make sure that the Backup Path isn&#8217;t either part of the snapshot (e.g., by setting the vdisk to `Independent Persistent in VMWare ESX/i) or altered in any way when
rolling back, so the missing data is available for import.</strong></p>
</div>
<div class="paragraph">
<p>To perform a disaster recovery from a previous machine state with Backup NG, you need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restore the last valid backup into a separate (clone) VM in an isolated network, making sure that users can&#8217;t access it and that both incoming and outgoing emails are not delivered.</p>
</li>
<li>
<p>Switch on the clone and wait for Zimbra to start.</p>
</li>
<li>
<p>Disable Backup NG&#8217;s RealTime Scanner.</p>
</li>
<li>
<p>Connect the Virtual Disk containing the untampered Backup Path to the clone and mount it (on a different path).</p>
</li>
<li>
<p>Start an External Restore using the Backup Path as the Import Path.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Doing so parses all items in the Backup Path, and import the missing ones, speeding up the disaster recovery.
These steps can be repeated as many times as needed as long as you suppress user access and mail traffic.</p>
</div>
<div class="paragraph">
<p>After the restore completes, make sure that everything is functional and restore user access and mail traffic.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-aftermath">The Aftermath</h4>
<div class="sect4">
<h5 id="what-now">What Now?</h5>
<div class="paragraph">
<p>Should you need to restore any content from before the disaster, just initialize a new Backup Path and store the old one.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="unrestorable-items">Unrestorable Items</h3>
<div class="sect3">
<h4 id="how-can-i-check-if-all-of-my-items-have-been-restored">How can I check if all of my items have been restored?</h4>
<div class="paragraph">
<p>It&#8217;s very easy.
Check the appropriate <code>Operation Completed</code> notification you received as soon as the restore operation finished.
The notification is shown in the <code>Notifications</code> section of the Administration Zimlet and emailed to the <code>Notification E-Mail recipient address</code> you specified in the <code>Core</code> section of the Administration Zimlet.</p>
</div>
<div class="paragraph">
<p>The <code>skipped items</code> section contains a per-account list of unrestored items:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  [...]
  - stats -
  Restored Items: 15233
  Skipped Items:  125
  Unrestored Items: 10

  - unrestored items -
  account: account1@domain.com
  unrestored items: 1255,1369

  account: account2@domain.com
  unrestored items: 49965

  account: account14@domain.com
  unrestored items: 856,13339,45200, 45655
  [...]</pre>
</div>
</div>
<div class="sect4">
<h5 id="skipped-items-vs.-unrestored-items">Skipped Items vs. Unrestored Items</h5>
<div class="ulist">
<ul>
<li>
<p><code>Skipped</code> item: An item previously restored, either during the current restore or in a previous one.</p>
</li>
<li>
<p><code>Unrestored</code> item: An item not restored due to an issue in the restore process.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="why-some-of-my-items-have-not-been-restored">Why have some of my items not been restored?</h4>
<div class="paragraph">
<p>There are different possible causes, the most common of which are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Read Error</strong>: Either the raw item or the metadata file is not readable due to an I/O exception or a permission issue.</p>
</li>
<li>
<p><strong>Broken item</strong>: Both the raw item and the metadata file are readable by Backup NG, but their content is broken/corrupted.</p>
</li>
<li>
<p><strong>Invalid item</strong>: Both the raw item and the metadata file are readable, and the content is correct, but Zimbra refuses to inject the item.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="how-can-i-identify-unrestored-items">How Can I Identify Unrestored Items?</h4>
<div class="paragraph">
<p>There are two ways to do so: via the CLI to search for the item within the backup/import path or via the Zimbra Web Client to view the items in the source server.</p>
</div>
<div class="sect4">
<h5 id="identifying-unrestorable-items-through-the-cli">Identifying Unrestorable Items through the CLI</h5>
<div class="paragraph">
<p>The <code>getItem</code> CLI command can display an item and the related metadata, extracting all information from a backup path/external backup.</p>
</div>
<div class="paragraph">
<p>The syntax of the command is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME              TYPE               EXPECTED VALUES            DEFAULT
account(M)        Account Name/ID
item(M)           Integer
backup_path(O)    Path                                          /opt/zimbra/backup/ng/
dump_blob(O)      Boolean            true|false                 false
date(O)           Date               dd/mm/yyyy hh:mm:ss|all    last

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
<div class="paragraph">
<p>To extract the raw data and metadata information of the item whose itemID is <em>49965</em> belonging to <em>account2@domain.com</em>, also including the full dump of the item&#8217;s BLOB, the command would be:</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getItem account2@domain.com 49965 dump_blob true</code></p>
</div>
</div>
<div class="sect4">
<h5 id="identifying-unrestorable-items-through-the-zimbra-webclient">Identifying Unrestorable Items through the Zimbra WebClient</h5>
<div class="paragraph">
<p>The comma-separated list of unrestored items displayed in the <code>Operation Complete</code> notification can serve as a search argument in the Zimbra Web Client to perform an item search.</p>
</div>
<div class="paragraph">
<p>To do so:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log into the Zimbra Administration Console in the source server.</p>
</li>
<li>
<p>Use the <code>View Mail</code> feature to access the account containing the unrestored items.</p>
</li>
<li>
<p>In the search box, enter <strong>item:</strong> followed by the comma-separated list of itemIDs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>e.g.</code><br>
<code>item: 856,13339,45200,45655</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Remember that any search executes only within its tab, so if you are running the search from the <code>Email</code> tab and get no results try to run the same search in the <code>Address Book</code>, <code>Calendar</code>, <code>Tasks</code> and <code>Briefcase</code> tabs.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-can-i-restore-unrestored-items">How Can I Restore Unrestored Items?</h4>
<div class="paragraph">
<p>An item not being restored is a clear sign of an issue, either with the item itself or with your current Zimbra setup.
In some cases, there are good chances of being able to restore an item through subsequent attempts.</p>
</div>
<div class="paragraph">
<p>The following paragraphs contain a collection of tips and tricks that can be helpful when dealing with different kinds of unrestorable items.</p>
</div>
<div class="sect4">
<h5 id="items-not-restored-because-of-a-read-error">Items Not Restored because of a Read Error</h5>
<div class="paragraph">
<p>Carefully distinguish the read errors that can cause items not to restore:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>hard</strong> errors: Hardware failures and all other <code>destructive</code> errors that cause an unrecoverable data loss.</p>
</li>
<li>
<p><strong>soft</strong> errors: <code>non-destructive</code> errors such as wrong permissions, filesystem errors, RAID issues (e.g., broken RAID1 mirroring).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While there is nothing much to do about hard errors, you can prevent or mitigate soft errors by following these guidelines:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Run a filesystem check.</p>
</li>
<li>
<p>If using a RAID disk setup, check the array for possible issues
(depending on RAID level).</p>
</li>
<li>
<p>Make sure that the 'zimbra' user has r/w access to the backup/import path, all its subfolders, and all thereby contained files.</p>
</li>
<li>
<p>Carefully check the link quality of network-shared filesystems.
If link quality is poor, consider transferring the data with rsync.</p>
</li>
<li>
<p>If using SSHfs to remotely mount the backup/import path, make sure to run the mount command as root using the <code>-o allow_other</code> option.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="items-not-restored-because-identified-as-broken-items">Items Not Restored because Identified as Broken Items</h5>
<div class="paragraph">
<p>Unfortunately, this is the worst category of unrestored items in terms of <code>salvageability</code>.</p>
</div>
<div class="paragraph">
<p>Based on the degree of corruption of the item, it might be possible to recover either a previous state or the raw object (this is only valid for emails). To identify the degree of corruption, use the <code>getItem</code> CLI command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME              TYPE               EXPECTED VALUES            DEFAULT
account(M)        Account Name/ID
item(M)           Integer
backup_path(O)    Path                                          /opt/zimbra/backup/ng/
dump_blob(O)      Boolean            true|false                 false
date(O)           Date               dd/mm/yyyy hh:mm:ss|all    last

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
<div class="paragraph">
<p>Searching for the broken item, setting the <code>backup_path</code> parameter to the import path, and the <code>date</code> parameter to <code>all</code>, displays all valid states for the item.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite backup getItem admin@example.com 24700 backup_path /mnt/import/ date all
       itemStates                              
               start_date                                                  12/07/2021 16:35:44
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
               start_date                                                  12/07/2021 17:04:33
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
               start_date                                                  15/07/2021 10:03:26
               type                                                        message
               deleted                                                     true
               blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=</pre>
</div>
</div>
<div class="paragraph">
<p>If the item is an email, you are able to recover a standard <code>.eml</code> file through the following steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify the latest valid state</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>/mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=
              start_date                                                  15/07/2021 10:03:26
              type                                                        message
              deleted                                                     true
              blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Identify the <code>blob path</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>blob path /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ=</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use gzip to uncompress the BLOB file into an <code>.eml</code> file</p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ gunzip -c /mnt/import/items/c0/c0,gUlvzQfE21z6YRXJnNkKL85PrRHw0KMQUqo,pMmQ= &gt; /tmp/restored.eml

zimbra@test:~$ cat /tmp/restored.eml

Return-Path: zimbra@test.example.com

Received: from test.example.com (LHLO test.example.com) (192.168.1.123)
by test.example.com with LMTP; Fri, 12 Jul 2021 16:35:43 +0200 (CEST)

Received: by test.example.com (Postfix, from userid 1001) id 4F34A120CC4; 
Fri, 12 Jul 2021 16:35:43 +0200 (CEST)
To: admin@example.com
From: admin@example.com
Subject: Service mailboxd started on test.example.com
Message-Id: &lt;20210712143543.4F34A120CC4@test.example.com&gt;
Date: Fri, 12 Jul 2021 16:35:43 +0200 (CEST)

Jul 12 16:35:42 test zmconfigd[14198]: Service status change: test.example.com mailboxd changed from stopped to running</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Done! You can now import the <code>.eml</code> file into the appropriate mailbox
using your favorite client.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="items-not-restored-because-identified-as-invalid-items">Items Not Restored because Identified as Invalid Items</h5>
<div class="paragraph">
<p>An item is identified as <code>Invalid</code> when, albeit being formally correct, it is discarded by Zimbra&#8217;s LMTP Validator upon injection.
This behavior is common when importing items created on an older version of Zimbra to a newer one; Validation rules update very often, so some messages considered valid by a certain Zimbra version may not be considered valid by a newer version.</p>
</div>
<div class="paragraph">
<p>If you experience a lot of unrestored items during an import, momentarily disable the LMTP validator and repeat the import:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To disable Zimbra&#8217;s LMTP Validator, run the following command as the Zimbra user:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zmlocalconfig -e zimbra_lmtp_validate_messages=false</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Once the import completes, you can enable the LMTP validator running</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>zmlocalconfig -e zimbra_lmtp_validate_messages=true</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This is a <code>dirty</code> workaround, as items deemed invalid by the LMTP validator might cause display or mobile synchronization errors.
Use it at your own risk.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="docoherencycheck">doCoherencyCheck</h3>
<div class="sect3">
<h4 id="what-is-the-coherency-check">What is the Coherency Check?</h4>
<div class="paragraph">
<p>The <code>Coherency Check</code> performs a deeper check of a Backup Path than the one done by the SmartScan.</p>
</div>
<div class="paragraph">
<p>While the SmartScan works <code>incrementally</code> by only checking items that changed since the last SmartScan, the Coherency Check performs a thorough check of all metadata and BLOBs in the backup path.</p>
</div>
<div class="paragraph">
<p>The objective is to detect corrupted metadata and BLOBs.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-it-work-9">How Does it Work?</h4>
<div class="paragraph">
<p>The Coherency Check verifies the integrity of all metadata in the backup path and the related BLOBs.
Should any errors be found, try running the check with the <code>fixBackup</code> option to move any orphaned or corrupted metadata/BLOB to a dedicated directory within the backup path.</p>
</div>
</div>
<div class="sect3">
<h4 id="when-should-a-coherency-check-be-executed">When Should a Coherency Check be Executed?</h4>
<div class="ulist">
<ul>
<li>
<p>At interval periods to make sure that everything is ok (e.g.
every 3 or 6 months).</p>
</li>
<li>
<p>After a system crash.</p>
</li>
<li>
<p>After the filesystem or storage device containing the backup path experiences any issue.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Should the SmartScan detect a possible item corruption, a Coherency Check starts automatically.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Coherency Check is highly I/O consuming, so make sure to run it only during off-peak periods
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="running-a-coherency-check">Running a Coherency Check</h4>
<div class="sect4">
<h5 id="starting-the-check-via-the-administration-zimlet">Starting the Check via the Administration Zimlet</h5>
<div class="paragraph">
<p>The Coherency Check is not available via the Administration Zimlet.</p>
</div>
</div>
<div class="sect4">
<h5 id="starting-the-check-via-the-cli">Starting the Check via the CLI</h5>
<div class="paragraph">
<p>To start a Coherency Check via the CLI, use the <code>doCoherencyCheck</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup doCoherencyCheck {backup_path} [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME                TYPE                    EXPECTED VALUES    DEFAULT
backup_path(M)      Path
accounts(O)         Account Name/ID[,..]                       all
checkZimbra(O)      Boolean                 true|false         false
fixBackup(O)        Boolean                 true|false         false
notifications(O)    Email Address[,..]

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup docoherencycheck /opt/zimbra/backup/ng/ accounts jack@exmaple.com,john@exmaple.com
Performs a coherency check on /opt/zimbra/backup/ng/ for Jack's and John's accounts
zxsuite backup docoherencycheck /opt/zimbra/backup/ng/ fixBackup true
Performs a coherency check on /opt/zimbra/backup/ng/ and moves corrupted backup files and blob files not referenced by any metadata out of backup</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="checking-the-status-of-a-running-check">Checking the Status of a Running Check</h5>
<div class="paragraph">
<p>To check the status of a running scan via the CLI, use the <code>monitor</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite backup monitor {operation_uuid} [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME                 TYPE
operation_uuid(M)    Uiid
operation_host(O)    String

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="taking-additional-and-offsite-backups-of-backup-ngs-datastore">Taking Additional and Offsite Backups of Backup NG&#8217;s Datastore</h3>
<div class="sect3">
<h4 id="who-watches-the-watchmen">Who Watches the Watchmen?</h4>
<div class="paragraph">
<p>Having backup systems is a great safety measure against data loss.
Still, each backup system must be part of a broader <code>backup strategy</code> to ensure the highest possible level of reliability.
The lack of a proper backup strategy gives a false sense of security while turning even the best backup systems in the world into yet another breaking point.</p>
</div>
<div class="paragraph">
<p>Devising a backup strategy is no easy matter, and at some point, you will most likely face the following question:
<strong><em>What if I lose the data I backed up?</em></strong>.
The chances of this happening ultimately only depend on how you make and manage your backups.
You are more likely lose all of your backed up data if you store both your data and your backups in a single SATAII disk than if you store your backed up data on a dedicated SAN using a RAID 1+0 setup.</p>
</div>
<div class="paragraph">
<p>Here are some suggestions and best practices to improve your backup strategy by making a backup of the Backup NG&#8217;s datastore and storing it offsite.</p>
</div>
</div>
<div class="sect3">
<h4 id="making-an-additional-backup-of-backup-ngs-datastore">Making an Additional Backup of Backup NG&#8217;s Datastore</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Atomicity</strong>: Any transaction is committed and written to the disk only when completed.</p>
</li>
<li>
<p><strong>Consistency</strong>: Any committed transaction is valid, and no invalid transaction is committed and written to the disk.</p>
</li>
<li>
<p><strong>Isolation</strong>: All transactions execute sequentially so that no more than 1 transaction can affect the same item at once.</p>
</li>
<li>
<p><strong>Durability</strong>: A committed transaction remains so even in case of a crash (e.g., power loss or hardware failure).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Due to this, it&#8217;s very easy to make a backup.
The best (and easiest) way to do so is by using <a href="https://rsync.samba.org/"><code>rsync</code></a>.
Specific options and parameters depend on many factors, such as the amount of data to sync and the storage in use, while connecting to an rsync daemon instead of using a remote shell as a mode of transport is usually much faster in transferring the data.</p>
</div>
<div class="paragraph">
<p>You can leave both Zimbra and the Real-Time Scanner running, yet make an additional backup of Backup NG&#8217;s datastore using rsync, and you are always able to stop the sync at any time and reprise it afterward if needed.</p>
</div>
</div>
<div class="sect3">
<h4 id="storing-your-backup-ngs-datastore-backup-offsite">Storing Your Backup NG&#8217;s Datastore Backup Offsite</h4>
<div class="paragraph">
<p>As seen in the previous section, making a backup of Backup NG&#8217;s Datastore is very easy, and the use of rsync makes it just as easy to store your backup in a remote location.</p>
</div>
<div class="paragraph">
<p>We recommend the following best practices to optimize your backup strategy when dealing with this kind of setup:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you schedule your rsync backups, make sure that you leave enough time between an rsync instance and the next one for the transfer to complete.</p>
</li>
<li>
<p>Use the <code>--delete</code> options, so that deleted files in the source server are deleted in the destination server to avoid inconsistencies.</p>
<div class="ulist">
<ul>
<li>
<p>If you notice that using the <code>--delete</code> option takes too much time, schedule two different rsync instances: one with <code>--delete</code> to run after the weekly purge and one without this option.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Make sure you transfer the whole folder tree recursively starting from Backup NG&#8217;s Backup Path, and include server config backups and mapfiles.</p>
</li>
<li>
<p>Make sure the destination filesystem is case sensitive (just as Backup NG&#8217;s Backup Path must be).</p>
</li>
<li>
<p>If you plan to restore directly from the remote location, make sure that the <em>zimbra</em> user on your server has read and write permissions on the transferred data.</p>
</li>
<li>
<p>Expect to experience slowness if your transfer speed is much higher than your storage throughput (or vice versa).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="additionaloffsite-backup-f.a.q.">Additional/Offsite Backup F.A.Q.</h4>
<div class="sect4">
<h5 id="why-shouldnt-i-use-the-export-backup-feature-of-backup-ng-instead-of-rsync">Q: Why shouldn&#8217;t I use the <code>Export Backup</code> feature of Backup NG instead of <code>rsync</code>?</h5>
<div class="paragraph">
<p>For many reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>Export Backup</code> feature is designed to perform migrations.
It exports a <code>snapshot</code> that is an end in itself with no capacity for incremental management.
Each Export Backup run time remains more-or-less constant while using rsync is much more time-efficient.</p>
</li>
<li>
<p>Being a Backup NG operation, any other operation started while the Export Backup is running is queued until the Export Backup completes.</p>
</li>
<li>
<p>An <code>Export Backup</code> operation has a higher impact on system resources than an rsync.</p>
</li>
<li>
<p>Should you need to stop an Export Backup operation, you won&#8217;t be able to reprise it, and you&#8217;ll need to start from scratch.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="can-i-use-this-for-disaster-recovery">Q: Can I use this for Disaster Recovery?</h5>
<div class="paragraph">
<p>Yes.
If your Backup Path is still available, it&#8217;s better to use that, as it restores all items and settings to the last valid state.
However, should your Backup Path be lost, you&#8217;ll be able to use your additional/offsite backup.</p>
</div>
</div>
<div class="sect4">
<h5 id="can-i-use-this-to-restore-data-on-the-server-the-backup-copy-belongs-to">Q: Can I use this to restore data back to the server that produced the backup copy?</h5>
<div class="paragraph">
<p>Yes, but not through the <code>External Restore</code> operation, since item and folder IDs are the same.</p>
</div>
<div class="paragraph">
<p>The most appropriate steps to restore data from a copy of the backup path to the very same server are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Stop the RealTime Scanner.</p>
</li>
<li>
<p>Change the Backup Path to the copy you wish to restore your data from.</p>
</li>
<li>
<p>Run either <code>Restore on New Account</code> or a <code>Restore Deleted Account</code>.</p>
</li>
<li>
<p>Once the restore is over, change the backup path to the original one.</p>
</li>
<li>
<p>Start the RealTime Scanner.
A SmartScan triggers to update the backup data.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="can-i-use-this-to-create-an-activestandby-infrastructure">Q: Can I use this to create an Active/Standby infrastructure?</h5>
<div class="paragraph">
<p>No, because the <code>External Restore</code> operation does not perform any deletions.
By running several External Restores, you&#8217;ll end up filling up your mailboxes with unwanted content, since items deleted from the original mailbox persist on the <code>standby</code> server.</p>
</div>
<div class="paragraph">
<p>The <code>External Restore</code> operation&#8217;s design ensures that accounts are available for use as soon as the operation starts, so your users are able to send and receive emails even if the restore is running.</p>
</div>
</div>
<div class="sect4">
<h5 id="are-there-any-other-ways-to-do-an-additionaloffsite-backup-of-my-system">Q: Are there any other ways to do an Additional/Offsite backup of my system?</h5>
<div class="paragraph">
<p>There are for sure, and some of them might even be better than the one described here.
These are just guidelines that apply to the majority of cases.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="multistore-informations">Multistore Information</h3>
<div class="sect3">
<h4 id="backup-ng-in-a-multistore-environment">Backup NG in a Multistore Environment</h4>
<div class="sect4">
<h5 id="command-execution-in-a-multistore-environment">Command Execution in a Multistore Environment</h5>
<div class="paragraph">
<p>The new Network Administration Zimlet makes the management of multiple servers very easy.
You can select a server from the Backup NG tab and perform all backup operations on that server, even when logged into the Zimbra Administration Console of another server.</p>
</div>
<div class="paragraph">
<p>Specific differences between SingleStore and MultiStore environments are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In a Multistore environment, <code>Restore on New Account</code> operations ALWAYS create the new account in the Source account&#8217;s mailbox server.</p>
</li>
<li>
<p>All operations are logged on the target server, not in the server that launched the operation.</p>
</li>
<li>
<p>If a target server for an operation is inappropriate, Zimbra automatically proxies the operation request to the correct server.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="backup-and-restore">Backup and Restore</h5>
<div class="paragraph">
<p>Backup and Restore in a Multistore environment works exactly like in a SingleStore environment.</p>
</div>
<div class="paragraph">
<p>The different servers are configured and managed separately via the Administration Zimlet, but certain operations like Live Full Scan and Stop All Operations can be 'broadcast' to all the mailstores via the <code>zxsuite_ CLI</code> using the <code>--hostname all_servers</code> option.
Backup NG settings support this, too.
(See the CLI wiki page for more details.)</p>
</div>
<div class="paragraph">
<p>Backup and Restore operations behave as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Smartscans can be executed on single servers via the Administration Zimlet or on multiple servers via the CLI.</p>
</li>
<li>
<p>Restores can start from the <code>Accounts</code> tab in the Zimbra Admin Console, from each server tab in the Backup NG menu of the Administration Zimlet and via the CLI.
The differences between these methods are:</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operation started from:</th>
<th class="tableblock halign-left valign-top">Options</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Accounts tab</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The selected account&#8217;s restore is automatically started
in the proper server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Server tab</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any accounts eligible for a restore on the selected server can serve as the restore 'source'.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Any account on any server can restored, but there is no
automatic server selection.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="export-and-import">Export and Import</h5>
<div class="paragraph">
<p>Export and Import functions are those that differ the most when performed on a Multistore environment.</p>
</div>
<div class="paragraph">
<p>Here are the basic scenarios.</p>
</div>
<div class="sect5">
<h6 id="export-from-a-singlestore-and-import-to-a-multistore">Export from a Singlestore and Import to a Multistore</h6>
<div class="paragraph">
<p>Importing multiple accounts of a single domain to a different store breaks the consistency of ALL items shared from/to a mailbox on a different server.</p>
</div>
<div class="paragraph">
<p>A command in the CLI is available to fix the shares for accounts imported on different servers.</p>
</div>
</div>
<div class="sect5">
<h6 id="export-from-a-multistore-and-import-to-a-single-or-multistore">Export from a Multistore and Import to a Single or Multistore</h6>
<div class="paragraph">
<p>Two different scenarios apply here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Mirror</code> import: Same number of source and destination mailstores.
Each source mailstore import occurs on a different server.
This import breaks the consistency of ALL items shared from/to a mailbox on a different server.
The <code>doCheckShares</code> and <code>doFixShares</code> CLI commands are available to check and fix share consistency (see below).</p>
</li>
<li>
<p><code>Composite</code> import: Same or different number of source and destination servers.
Domains or accounts get manually imported into different servers.
This import breaks the consistency of ALL items shared from/to a mailbox on a different server.
The <code>doCheckShares</code> and <code>doFixShares</code> CLI commands are available to check and fix share consistency (see below)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="the-docheckshares-and-dofixshares-commands">The <code>doCheckShares</code> and <code>doFixShares</code> Commands</h5>
<div class="paragraph">
<p>The <code>doCheckShares</code> command parses all share information in local accounts and report any error:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite help backup doCheckShares

Syntax:
   zxsuite backup doCheckShares


Usage example:

zxsuite backup doCheckShares
Check all shares on local accounts</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>doFixShares</code> fixes all share inconsistencies using a migration.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@test:~$ zxsuite help backup doFixShares

Syntax:
   zxsuite backup doFixShares {import_idmap_file}


PARAMETER LIST

NAME                    TYPE
import_idmap_file(M)    String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doFixShares idmap_file
Fixes the shares' consistency after an import according to the
mapping contained in the /opt/zimbra/backup/ng/idmap_file</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="operation-queue-and-queue-management">Operation Queue and Queue Management</h3>
<div class="sect3">
<h4 id="backup-ngs-operation-queue">Backup NG&#8217;s Operation Queue</h4>
<div class="paragraph">
<p>Every time a Backup NG operation starts, either manually or through scheduling, it queues in a dedicated, unprioritized FIFO queue.
Each operation executes as soon as any preceding operation is dequeued (either because it completes or terminates).</p>
</div>
<div class="paragraph">
<p>The queue system affects the following operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>External backup</p>
</li>
<li>
<p>All restore operations</p>
</li>
<li>
<p>Smartscan</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Changes to Backup NG&#8217;s configuration are not enqueued and are applied immediately.</p>
</div>
</div>
<div class="sect3">
<h4 id="operation-queue-management">Operation Queue Management</h4>
<div class="sect4">
<h5 id="through-the-administration-console">Through the Administration Console</h5>
<div class="sect5">
<h6 id="viewing-the-queue">Viewing the Queue</h6>
<div class="paragraph">
<p>To view the operation queue, access the <code>Notifications</code> tab in the Administration Zimlet and click the <code>Operation Queue</code> button.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Administration Zimlet displays operations queued both by Backup NG and HSM NG in a single view.
No dependency should be inferred by that view, as the two queues are completely separate, in that one Backup NG operation and one HSM NG operation can run at the same time.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="emptying-the-queue">Emptying the Queue</h6>
<div class="paragraph">
<p>To stop the current operation and empty Backup NG&#8217;s operation queue, enter the <code>Backup NG</code> tab in the Administration Zimlet and click the <code>Stop all Operations</code> button.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="through-the-cli">Through the CLI</h5>
<div class="sect5">
<h6 id="viewing-the-queue-1">Viewing the Queue</h6>
<div class="paragraph">
<p>To view Backup NG&#8217;s operation queue, use the <code>getAllOperations</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@server:~$ zxsuite help backup getAllOperations

Syntax:
   zxsuite backup getAllOperations [attr1 value1 [attr2 value2...


PARAMETER LIST

NAME          TYPE       EXPECTED VALUES    DEFAULT
verbose(O)    Boolean    true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup getAllOperations
Shows all running and queued operations</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="emptying-the-queue-1">Emptying the Queue</h6>
<div class="paragraph">
<p>To stop the current operation and empty Backup NG&#8217;s operation queue, use the <code>doStopAllOperations</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite help backup doStopAllOperations

Syntax:
   zxsuite backup doStopAllOperations


Usage example:

zxsuite backup doStopAllOperations
Stops all running operations</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="removing-a-single-operation-from-the-queue">Removing a Single Operation from the Queue</h6>
<div class="paragraph">
<p>To stop the current operation or to remove a specific operation from the queue, use the <code>doStopOperation</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite help backup doStopOperation

Syntax:
   zxsuite backup doStopOperation {operation_uuid}


PARAMETER LIST

NAME                 TYPE
operation_uuid(M)    Uiid

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite backup doStopOperation 30ed9eb9-eb28-4ca6-b65e-9940654b8601
Stops operation with id = 30ed9eb9-eb28-4ca6-b65e-9940654b8601</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cos-level-backup-management">COS-level Backup Management</h3>
<div class="sect3">
<h4 id="what-is-cos-level-backup-management">What is COS-level Backup Management?</h4>
<div class="paragraph">
<p>COS-level Backup Management allows the administrator to disable ALL Backup NG functions for a whole Class of Service to lower storage usage.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-cos-level-backup-management-work">How Does COS-level Backup Management Work?</h4>
<div class="sect4">
<h5 id="what-happens-if-i-disable-the-backup-ng-module-for-a-class-of-service">What happens if I disable the Backup NG Module for a Class of Service?</h5>
<div class="ulist">
<ul>
<li>
<p>The Real-Time Scanner ignores all accounts in the COS.</p>
</li>
<li>
<p>The Export Backup function DOES NOT EXPORT accounts in the COS.</p>
</li>
<li>
<p>The backup system treats accounts in the COS as <code>Deleted</code>.
After the data retention period expires, all data for such accounts gets purged from the backup store.
Re-enabling the backup for a Class of Service resets this.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="how-is-the-backup-enabledbackup-disabled-information-saved">How is the <code>backup enabled</code>/<code>backup disabled</code> information saved?</h5>
<div class="paragraph">
<p>Disabling the backup for a Class of Service adds the following marker to the Class of Service&#8217;s <code>Notes</code> field: <strong>${ZxBackup_Disabled}</strong></p>
</div>
<div class="paragraph">
<p>While the Notes field remains fully editable and usable, changing or deleting this marker re-enables the backup for the COS.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="incremental-migration-with-backup">Incremental Migration with Backup NG</h3>
<div class="sect3">
<h4 id="description">Description</h4>
<div class="ulist">
<ul>
<li>
<p>This guide describes how to perform an Incremental Migration using Backup NG.</p>
</li>
<li>
<p>Incremental Migration is specifically designed for the migration of a production environment, minimizing the downtime and aiming to be transparent for the users.</p>
</li>
<li>
<p>If correctly planned and executed, your mail system won&#8217;t suffer any downtime, and the impact on the users is close to zero.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All the CLI commands in this guide must be executed as the <code>zimbra</code> user unless otherwise specified.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="what-will-be-migrated">What Gets Migrated?</h4>
<div class="ulist">
<ul>
<li>
<p>Emails and email folders</p>
</li>
<li>
<p>Contacts and address books</p>
</li>
<li>
<p>Appointments and calendars</p>
</li>
<li>
<p>Tasks and task lists</p>
</li>
<li>
<p>Files and briefcases</p>
</li>
<li>
<p>Share information</p>
</li>
<li>
<p>User preferences</p>
</li>
<li>
<p>User settings</p>
</li>
<li>
<p>Class of Service settings</p>
</li>
<li>
<p>Domain settings</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="what-will-not-be-migrated">What Will NOT be Migrated?</h4>
<div class="ulist">
<ul>
<li>
<p>Server settings (migrated for reference but not restored)</p>
</li>
<li>
<p>Global settings (migrated for reference but not restored)</p>
</li>
<li>
<p>Customizations (e.g., Postfix, Jetty.)</p>
</li>
<li>
<p>Items moved or deleted during the process are not moved or deleted on the destination server.</p>
</li>
<li>
<p>Preferences (e.g., passwords) changed during the process are reset
upon each import</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Avoid using incremental migration to set up a server-to-server mirroring.
Using multiple imports to create a mirrored copy of the source server won&#8217;t create a <strong>mirrored</strong> copy at all, since the import process performs no deletions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="pre-migration-checks">Pre-Migration Checks</h4>
<div class="sect4">
<h5 id="servers">Servers</h5>
<div class="ulist">
<ul>
<li>
<p>Source Server: Any Zimbra server can be the source of your migration, provided that it&#8217;s running Backup NG or Zimbra Suite Plus.</p>
</li>
<li>
<p>Destination Server: Any Zimbra server can be the destination of your migration, provided that it&#8217;s running Backup NG.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="storage">Storage</h5>
<div class="ulist">
<ul>
<li>
<p>On the Source server: Before enabling Backup NG on the source server, make sure you have an amount of free disk space <em>comparable</em> to the size of the <code>/opt/zimbra/store/</code> folder.
Compressing the exported data using the gzip algorithm and deduplicating all Zimbra items typically reduces the exported size to 70% of the original size.</p>
</li>
<li>
<p>On the Destination server: Make sure you free space greater than the size of the <code>/opt/zimbra/store/</code> and of the <code>export</code> folders on the source server combined.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="data-transfer">Data Transfer</h5>
<div class="paragraph">
<p>While you can choose to transfer the data in any other way, rsync is our method of choice because it&#8217;s a good compromise between speed and convenience.</p>
</div>
<div class="paragraph">
<p>The main data transfer executes, while the source server is still active and functional.
Since the transfer is via the network, carefully plan your transfer so that you&#8217;ll transfer <strong>all of your data</strong> before migrating.</p>
</div>
</div>
<div class="sect4">
<h5 id="alternative-ways-to-transfer-your-data">Alternative Ways to Transfer Your Data</h5>
<div class="paragraph">
<p>Anything from a remote mount to a physical drive move is ok as long as it suits your needs.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Never underestimate the bandwidth of a station wagon full of tapes hurtling down the highway.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Andrew S. Tanenbaum(1996)<br>
<cite>Computer Networks. New Jersey: Prentice-Hall. p. 83. ISBN 0-13-349945-6</cite>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="dns">DNS</h4>
<div class="paragraph">
<p>Set the TTL value of your MX record to <code>300</code> on your <em>real</em> DNS to allow a fast switch between source and destination servers.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-setup">The Setup</h4>

</div>
<div class="sect3">
<h4 id="step-1-coherency-checks">Step 1: Coherency Checks</h4>
<div class="paragraph">
<p>To avoid any possible data-related issues, run the following checks on the source server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.zimbra.com/wiki/Zimbra_Next_Generation_Modules/Zimbra_NG_HSM/Advanced_Volume_Operations#doCheckBlobs"><code>zxsuite hsm doCheckBlobs</code></a> checks the consistency between Zimbra&#8217;s metadata and BLOBs.</p>
</li>
<li>
<p><a href="https://wiki.zimbra.com/wiki/Zmdbintegrityreport"><code>zmdbintegrityreport</code></a>  checks the integrity of the Zimbra database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Repair any error found.</p>
</div>
<div class="paragraph">
<p>Running a reindex of all mailboxes is also suggested.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-2-network-ng-modules-setup">Step 2: Network NG Modules Setup</h4>
<div class="paragraph">
<p>Disable the Real-Time Scanner on both servers:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup setProperty ZxBackup_RealTimeScanner false</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
We strongly recommend a dedicated device for data export for the best performance and least impact on the running system.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Mount any such device on the <code>/opt/zimbra/backup/</code> path, and the ensure the <code>zimbra</code> user has r/w permissions for it.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-3-data-export-smartscan">Step 3: Data Export (SmartScan)</h4>
<div class="paragraph">
<p>Run a SmartScan on the source server:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doSmartScan</pre>
</div>
</div>
<div class="paragraph">
<p>All your data is exported to the default backup path
(/opt/zimbra/backup/ng/).</p>
</div>
<div class="sect4">
<h5 id="pro-tip-single-domains-export">Pro-Tip: Single Domains Export</h5>
<div class="paragraph">
<p>You can also choose to only migrate one or more domains instead of all of them.
To do so, run the following command <strong>instead</strong> of the SmartScan:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExport /path/to/export/folder/ domains yourdomain.com,yourdomain2.com[..]</pre>
</div>
</div>
<div class="paragraph">
<p>Mind that if you start with the <code>SmartScan</code> method, you&#8217;ll have to carry on the migration with this method.
If you start with the <code>Single Domains</code> method, you&#8217;ll have to carry on the migration with this method.
Do not mix the two methods.</p>
</div>
<div class="sect5">
<h6 id="data-export-smartscan-via-the-administration-zimlet">Data Export (SmartScan) via the Administration Zimlet</h6>
<div class="paragraph">
<p>You can also choose to export your data using the Administration Zimlet.</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-4-data-synchronization">Step 4: Data Synchronization</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If Backup NG is used or planned for use on the destination server, ensure the destination folder is not in Backup NG&#8217;s backup path there, to avoid unnecessary backup activity.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>(You can skip this step if you choose to transfer your data by other means than rsync.)</em></p>
</div>
<div class="paragraph">
<p>Using <code>rsync</code>, copy the data contained in the
/opt/zimbra/backup/ng/ onto a directory in the destination server
(make sure the Zimbra user has r/w permissions on the folder). Use a
terminal multiplexer like <em>screen</em> or <em>tmux</em>.
This process might need <strong>considerable time</strong> depending on network speed and amount of data involved.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[run this command as Root]
rsync -avH /opt/zimbra/backup/ng/ root@desinationserver:/path/for/the/data/</pre>
</div>
</div>
<div class="sect4">
<h5 id="alternate-synchronization-method">Alternate Synchronization Method</h5>
<div class="paragraph">
<p>While the suggested method is great for high-bandwidth situations, the first synchronization can involve large amounts of data.
If the rsync method is too slow, you might consider a physical move of the device (or the proper disk file if running on a virtual environment).</p>
</div>
<div class="paragraph">
<p>After moving the disk, you can remotely mount it back to the source server (e.g., via SSHFS), as the additional synchronizations needed for
the migration involves substantially less data.
In this case, be sure to remount the device on the source server as <code>/opt/zimbra/backup/ng/</code> with all due permissions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-5-first-import">Step 5: First Import</h4>
<div class="paragraph">
<p>Import all previously exported data to the destination server.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/</pre>
</div>
</div>
<div class="paragraph">
<p>Network NG imports your data onto the destination server.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not edit or delete the backup path after this step.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="first-import-via-the-administration-zimlet">First Import via the Administration Zimlet</h5>
<div class="paragraph">
<p>You can also choose to import your data using the Administration Zimlet.
While importing via the Administration Zimlet, be sure to remove all system accounts (like GalSync, Ham, Spam, and Quarantine.)
from the imported account list.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-5-alternate-first-import-for-large-migrations-advanced-users-only">Step 5 (alternate): First Import for Large Migrations [ADVANCED Users Only]</h4>
<div class="paragraph">
<p>If you are planning to migrate a very large infrastructure where an export/import lasts for hours or even days, there is an alternative way to handle the migration from this point forward.</p>
</div>
<div class="paragraph">
<p>Instead of importing all of your data to the destination server, you can run a <code>Provisioning Only</code> import that only creates Domains, classes of service, and accounts on the destination server, skipping all mailbox contents.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/ provisioning_only TRUE</pre>
</div>
</div>
<div class="paragraph">
<p>After doing this, switch the mail flow to the new server.
When the switch completes, start the <code>real</code> import.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/</pre>
</div>
</div>
<div class="paragraph">
<p>Your users may now connect to the new server where new emails are delivered while restoring old emails.</p>
</div>
<div class="paragraph">
<p>This approach has pros and cons.</p>
</div>
<div class="paragraph">
<p><strong>Pros</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Since items are only imported once and never modified or deleted afterward, using this method results in fewer discrepancies than the
<code>standard</code> incremental migration.</p>
</li>
<li>
<p>This is the option that has less impact on the source server (e.g.
good if you are in a hurry to decommission it).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Cons</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Items are restored to users' mailboxes while they work on it.
Depending on the scheduling of the operation, this method has a higher impact on your users.</p>
</li>
<li>
<p>Since the import uses compute resources on a running system, you might notice some slowdowns.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="the-situation-so-far">The Situation so Far</h4>
<div class="paragraph">
<p>Now the vast majority of the data has already been imported to the destination server.
The source server is still active and functional, and you are ready to perform the actual migration.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-migration">The Migration</h4>

</div>
<div class="sect3">
<h4 id="step-6-pre-migration-checks">Step 6: Pre-Migration Checks</h4>
<div class="paragraph">
<p>Before switching the mail flow, ALWAYS make sure that the new server is ready to become active (check things like your firewall, your DNS settings, and your security systems.)</p>
</div>
</div>
<div class="sect3">
<h4 id="step-7-the-switch">Step 7: The Switch</h4>
<div class="paragraph">
<p>At the end of this step, the destination server is active and functional.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Repeat step 3, step 4, and step 5 (only new data is exported and synchronized).</p>
</li>
<li>
<p>Switch the mail flow to the new server.</p>
</li>
<li>
<p>Once NO MORE EMAILS arrive at the source server, repeat step 3, step 4 and step 5.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Destination server is now active and functional.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-8-post-migration-checks">Step 8: Post-Migration Checks</h4>
<div class="paragraph">
<p>Run the following command to check for inconsistencies with shares:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doCheckShares</pre>
</div>
</div>
<div class="paragraph">
<p>Should this command report any inconsistency, this command parses the import mapfile used as the first argument and fix any broken share:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doFixShares</pre>
</div>
</div>
<div class="paragraph">
<p>Mapfiles reside in the Backup Path of the destination server as
<code>map_[source_serverID]</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="step-9-galsync">Step 9: Galsync</h4>
<div class="paragraph">
<p>Delete any imported GalSync accounts from the Zimbra Administration Console.
Then, if needed, create new GalSync accounts on all the imported domains and resync all the GalSync accounts with the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmgsautil forceSync -a galsync.randomstring@domain.com -n [resourcename]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="step-10-message-deduplication">Step 10: Message Deduplication</h4>
<div class="paragraph">
<p>Running a Volume Deduplication using the HSM NG module is highly suggested after a migration.</p>
</div>
</div>
<div class="sect3">
<h4 id="what-now-1">What Now?</h4>
<div class="ulist">
<ul>
<li>
<p>Initialize Backup NG on the new server to make sure all of your data is safe.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="incremental-migration-faq">Incremental Migration FAQ</h4>
<div class="sect4">
<h5 id="q-do-i-need-a-valid-license-in-order-to-perform-an-incremental-migration">Q: Do I need a valid license to perform an incremental migration?</h5>
<div class="paragraph">
<p>Yes.
It can be either a trial license or a purchased one.</p>
</div>
</div>
<div class="sect4">
<h5 id="q-what-will-be-migrated">Q: What gets migrated?</h5>
<div class="paragraph">
<p>Everything except the server configuration is migrated, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User data</p>
</li>
<li>
<p>User preferences</p>
</li>
<li>
<p>Classes of Service configurations</p>
</li>
<li>
<p>Domain configurations</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="q-will-i-lose-my-shares-will-i-need-to-re-configure-all-my-shares">Q: Will I lose my shares? Will I need to re-configure all my shares?</h5>
<div class="paragraph">
<p>Not at all!</p>
</div>
</div>
<div class="sect4">
<h5 id="q-how-should-i-transfer-the-exported-data-between-my-servers">Q: How should I transfer the exported data between my servers?</h5>
<div class="paragraph">
<p>Again, anything that suits your needs is ok.
You just need to be very sure about what your <strong>needs</strong> are.</p>
</div>
<div class="paragraph">
<p>Do you need to move the data very fast?
Physically moving a USB disk between your servers might not be a good idea.</p>
</div>
<div class="paragraph">
<p>Do you need to move the data in a very reliable way?
Mounting the export folder via SSHFS to the destination server might not be a good idea if your internet connection is sloppy.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mobile-ng-guide">Mobile NG</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="enable-for-whole-cos">Enable Mobile NG Synchronization for a COS</h3>
<div class="paragraph">
<p>By enabling Mobile NG for a all users in a Class of Service, you authorize all users in that COS to use all the mobile functions of Mobile NG.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-to-enable-the-mobile-ng-module-for-all-users-in-a-class-of-service">How to Enable Mobile NG for all Users in a Class Of Service</h3>

</div>
<div class="sect2">
<h3 id="from-the-administration-console">From the Administration Console</h3>
<div class="paragraph">
<p>To enable Mobile NG for all users in a COS from the Administration Console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Zimbra Administration Console.</p>
</li>
<li>
<p>Double-click the Class Of Service you want to edit (on the left, under Configuration &#8594; Class of Service).</p>
</li>
<li>
<p>Click  the Mobile tab.</p>
</li>
<li>
<p>Check the <code>Enable mobile synchronization</code> button.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="from-the-zimbra-cli">From the Zimbra CLI</h3>
<div class="paragraph">
<p>To enable Mobile NG for all users in a COS from the CLI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As the 'zimbra' user run: <strong><code>zmprov mc COSName zimbraFeatureMobileSyncEnabled TRUE</code></strong></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="how-to-disable-the-mobile-ng-module-for-all-users-in-a-class-of-service">How to Disable Mobile NG for all Users in a Class Of Service</h3>

</div>
<div class="sect2">
<h3 id="from-the-administration-console-1">From the Administration Console</h3>
<div class="paragraph">
<p>To disable Mobile NG for all users in a COS from the Administration Console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Zimbra Administration Console.</p>
</li>
<li>
<p>Double-click the Class Of Service you want to edit (on the left, under Configuration &#8594; Class of Service).</p>
</li>
<li>
<p>Click the Mobile tab and uncheck the <code>Enable mobile synchronization</code> button.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="from-the-zimbra-cli-1">From the Zimbra CLI</h3>
<div class="paragraph">
<p>To disable Mobile NG for all users in a COS from the CLI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As the 'zimbra' user run: <strong><code>zmprov mc COSName zimbraFeatureMobileSyncEnabled FALSE</code></strong></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="note-about-settings-hierarchy">Note about Settings Hierarchy</h4>
<div class="paragraph">
<p>COS-level settings are overridden by user-level settings.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="enable-for-single-user">Enable Mobile NG for a Single User</h3>
<div class="paragraph">
<p>By enabling the Mobile NG Module for a single user you authorize a single user to use all the mobile functions of the Mobile NG Module.</p>
</div>
<div class="sect3">
<h4 id="how-to-enable-the-mobile-ng-module-for-a-single-user">How to Enable Mobile NG for a Single User</h4>
<div class="sect4">
<h5 id="from-the-zimbra-administration-console">From the Zimbra Administration Console</h5>
<div class="paragraph">
<p>To enable Mobile NG for a single user from the Administration Console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Zimbra Administration Console.</p>
</li>
<li>
<p>Double-click the user you want to edit (on the left, under Manage &#8594; Accounts).</p>
</li>
<li>
<p>Click the Mobile tab.</p>
</li>
<li>
<p>Check <code>Enable mobile synchronization</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="from-the-zimbra-cli-2">From the Zimbra CLI</h5>
<div class="paragraph">
<p>To enable Mobile NG for a single user from the CLI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As the 'zimbra' user run: <strong><code>zmprov ma <a href="mailto:user@domain.tld">user@domain.tld</a> zimbraFeatureMobileSyncEnabled TRUE</code></strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="how-to-disable-the-mobile-ng-module-for-a-single-user">How to Disable Mobile NG for a Single User</h4>
<div class="sect4">
<h5 id="from-the-zimbra-administration-console-1">From the Zimbra Administration Console</h5>
<div class="paragraph">
<p>To disable Mobile NG for a single user from the CLI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Zimbra Administration Console.</p>
</li>
<li>
<p>Double-click the user you want to edit (on the left, under Manage &#8594; Accounts).</p>
</li>
<li>
<p>Click the Mobile NG tab and uncheck <code>Enable mobile synchronization</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="from-the-zimbra-cli-3">From the Zimbra CLI</h5>
<div class="paragraph">
<p>To disable Mobile NG for a single user from the CLI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>As the 'zimbra' user run: <strong><code>zmprov ma <a href="mailto:user@domain.tld">user@domain.tld</a> zimbraFeatureMobileSyncEnabled FALSE</code></strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="note-about-settings-hierarchy-1">Note about Settings Hierarchy</h4>
<div class="paragraph">
<p>User-level settings override COS-level settings.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="the-mobile-password-feature">The Mobile Password Feature</h3>
<div class="sect3">
<h4 id="mobile-passwords-and-you">Mobile Passwords and You</h4>
<div class="paragraph">
<p>The <code>Mobile Password</code> feature allows to set an additional password for an account to be used for Exchange ActiveSync authentications only.</p>
</div>
<div class="paragraph">
<p>The main benefits of using this feature are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enforce <code>set-and-forget</code> safe passwords, regardless of any other password policy, so that you won&#8217;t need to change the password saved on all mobile devices synchronized with an account should this account&#8217;s Zimbra password change.</p>
</li>
<li>
<p>Avoid the <code>real</code> password to be disclosed in case of unauthorized access to the device/client.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A <code>Mobile Password</code> will not be valid for Webmail/POP3/IMAP/SMTP logins, and the account password will not be valid for mobile logins.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_storage">Data Storage</h3>
<div class="paragraph">
<p>Both Mobile Passwords and QR Code data is saved in a local HSQL database.</p>
</div>
<div class="paragraph">
<p>All passwords, tokens and sensitive information are stored in hashed form using the SHA256 algorithm using auto-generated keys and no credential or sensitive information is ever stored cleartext.</p>
</div>
<div class="sect3">
<h4 id="how-to-set-a-mobile-password-for-a-mailbox">How to Set a Mobile Password for a Mailbox</h4>
<div class="paragraph">
<p><strong>versions up to 8.8.15 patch15</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Zimbra Administration Console.</p>
</li>
<li>
<p>Right-click the user for which you want to set a Mobile Password and select <code>Edit</code>.</p>
</li>
<li>
<p>In the <code>Mobile</code> tab within the user&#8217;s settings, check the <code>Enable mobile password</code> checkbox.</p>
</li>
<li>
<p>Enter the desired password in the <code>Mobile password</code> field and enter it again in the <code>Confirm mobile password</code> field.
You can also choose to generate a random mobile password by clicking <b class="button">Generate random password</b>.</p>
</li>
<li>
<p><b class="button">Save</b>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Zimbra 8.8.15 patch 16+</strong>
Starting from Zimbra 8.8.15-Patch16, Mobile Passwords are now managed by the user via the new Auth Zimlet, which can be installed by running <code>zxsuite auth doDeployAuthZimlet</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This new Mobile Password management system allows the user to set multiple independent Mobile Passwords for an account, to be used with different devices.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the Zimlet is deployed and enabled, the user can create a new Mobile Password following this steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the Zextras Auth Zimlet and click on "New Password";</p>
</li>
<li>
<p>Enter an easy to remember identifier for the password in the "Password Label" field and select "Text code" as the Password Type;</p>
</li>
<li>
<p>Click "Next";</p>
</li>
<li>
<p>The new Mobile Password will be displayed;</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Mobile Passwords are randomly generated and cannot be displayed again after the creation is complete.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on "Done" to close the Zextras Auth window. An entry for the new Mobile Password is now visible in the "Active Passwords" list of the Zextras Auth Zimlet.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Admins can also create a Mobile Password from the CLI, use the <code>zxsuite auth credential</code> command with the following attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>password: enter the password you wish to set as the Mobile Password</p>
</li>
<li>
<p>label: enter the label for the Mobile Password</p>
</li>
<li>
<p>service: use <code>eas</code> to set a Mobile Password</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>E.g.
To add the <code>gn89hg95hvmn59..]</code> Mobile Password to the <code>john.doe@domain.com</code> account, labeled as "Personal Phone", run:</p>
</div>
<div class="paragraph">
<p><code>zxsuite auth credential add <a href="mailto:john.doe@domain.com">john.doe@domain.com</a> password "gn89hg95hvmn59..]" label "Personal Phone" service eas</code></p>
</div>
<div class="paragraph">
<p>The system will confirm the success of the operation and display all the password&#8217;s information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Credential correctly added

        values
            generated                                               0
            created                                                 1603120995372
            label                                                   Personal Phone
            id                                                      Fr2jM
            services

                    service                                                         EAS
            hash                                                    +Crk6YcPL7IapCg6xfT6oXWP977uTeZdJTVQDQZd+Io=
            enabled                                                 true
            algorithm                                               SHA256
        text_data
            auth_method                                             password
            password                                                gn89hg95hvmn59..]
            user                                                    john.doe@domain.com</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_list_existing_mobile_passwords">List existing Mobile Passwords</h4>
<div class="paragraph">
<p>Any user can see the list of active Mobile Passwords in the Zextras Auth Zimlet. Each entry of the list displays the label of the password, its status, the service it is valid for and its creation date.</p>
</div>
<div class="paragraph">
<p>Specifically, all passwords valid for the "EAS" service are Mobile Passwords.</p>
</div>
<div class="paragraph">
<p>System Administrators, on the other hand, can view an extended list of all credentials, including Mobile Passwords,</p>
</div>
</div>
<div class="sect3">
<h4 id="_editing_a_mobile_password">Editing a Mobile Password</h4>
<div class="paragraph">
<p>While a Mobile Password itself cannot be edited, the System Administrator can edit its label and properties using the <code>zxsuite auth credential update command</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_application_password_qr_code">Application Password (QR Code)</h3>
<div class="paragraph">
<p>The Auth Zimlet can speed up and manage Application logins, such as those for the Drive and Team/Connect apps made by Zextras.</p>
</div>
<div class="paragraph">
<p>This is achieved through the creation of a QR Code in the Zimbra WebClient, which the user can then scan from the App&#8217;s login page to log in.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
QR Codes are a one-time credential only, meaning that once generated it will grant access to the app until the relevant credential itself is deleted from the account.
Once generated, the QR Code can only be viewed once.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_qr_code_requirements">QR Code Requirements</h4>
<div class="paragraph">
<p>The QR Code Application Password feature requires the following properties to be set at domain level in order to be functional:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraPublicServiceHostname</code></p>
</li>
<li>
<p><code>zimbraPublicServicePort</code></p>
</li>
<li>
<p><code>zimbraPublicServiceProtocol</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Should one or more of the properties be unset, a notification will be delivered to the Admin reporting the affected domains and their missing properties.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_a_new_qr_code_credential">Creating a new QR Code Credential</h4>
<div class="paragraph">
<p>While, as all credentials, QR Codes can be created from both the Zextras Auth Zimlet and Zextras CLI, only the former allows the user to use the QR code itself so the latter will not be taken into consideration in this guide.</p>
</div>
<div class="sect4">
<h5 id="_creating_a_qr_code_credential_from_the_zextras_auth_zimlet">Creating a QR Code Credential from the Zextras Auth Zimlet</h5>
<div class="paragraph">
<p>To create a new QR Code, open the Auth Zimlet and click on "New Password";:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter an easy to remember identifier for the password in the "Password Label" field and select "QR code" as the Password Type;</p>
</li>
<li>
<p>Click "Next";</p>
</li>
<li>
<p>The new QR Code will be displayed;</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
QR Codes are randomly generated and cannot be displayed again after the creation is complete.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>Click on "Done" to close the Auth Zimlet. An entry for the new QR Code is now visible in the "Active Passwords" list of the Auth Zimlet.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mobile-device-management-a.k.a.-mobile-provisioning">Mobile Device Management a.k.a. Mobile Provisioning</h3>
<div class="sect3">
<h4 id="what-is-mobile-device-management">What is Mobile Device Management?</h4>
<div class="paragraph">
<p>Mobile Device Management (MDM - also known as provisioning) allows an administrator to define a set of rules and security settings that are applied Over The Air to one or more mobile devices, ranging from PIN policies to Allowed/Blocked app lists and including <code>one time</code> commands, such as the remote wipe of the entire device.</p>
</div>
<div class="paragraph">
<p>MDM effectively allows administrators to limit and restrict the use of corporate mobile devices to avoid risky or improper behaviors.</p>
</div>
<div class="paragraph">
<p>MDM is also a priceless aid for <code>Bring Your Own Device</code> corporate policies, allowing users to connect their personal mobile devices to the corporate servers, while minimizing the risk of security breaches.</p>
</div>
<div class="sect4">
<h5 id="provisioning-features-available-on-your-client">Provisioning Features Available on Your Client</h5>
<div class="paragraph">
<p>Not all provisioning features are available on all clients.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="network-ng-modules-and-mdm">Network NG and MDM</h4>
<div class="paragraph">
<p>Network NG features advanced MDM features through the Exchange ActiveSync protocol version 14+.</p>
</div>
<div class="paragraph">
<p>Mobile policies can be enabled at COS and mailbox levels, allowing both a quick 'one-for-many' setup and user-based customized management.
In both cases, Mobile Management Options are available in the <code>Mobile</code> tab.</p>
</div>
<div class="sect4">
<h5 id="provisioning-options">Provisioning Options</h5>
<div class="paragraph">
<p>The following provisioning options are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable Mobile Device Management: Enable or disable the use of mobile policies for the current user/COS.</p>
</li>
<li>
<p>Allow non-provisionable devices: Allow the user to synchronize any device that does not support provisioning.</p>
</li>
<li>
<p>Allow partial policy enforcement on device: Allow the user to synchronize any device that does not support one or more applicable policies.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default, MDM is disabled in NG MobileSync.
To enable navigate to Network Modules NG &#8594; Mobile &#8594; Advanced Settings and check the “Enable Mobile Device Management” option
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="enforceable-policies">Enforceable Policies</h5>
<div class="paragraph">
<p>Enforceable Policies are available right below the <code>Mobile Devices</code>
list, grouped in the following categories:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sync Settings: Set synchronization spans and limits.</p>
</li>
<li>
<p>Device Settings: Enable or disable device features such as camera, WiFi, removable storage or Bluetooth.</p>
</li>
<li>
<p>Device Security Settings: Force an unlock code and define the minimum requirements for the code itself.</p>
</li>
<li>
<p>Device Applications: Enable or disable <code>standard</code> device applications such as the Browser and POP/IMAP client or unsigned apps.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two lists are also available for application whitelist/blacklist management:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Approved Applications: A customizable list of approved applications.</p>
</li>
<li>
<p>Blocked Applications: A customizable list of blocked applications that won&#8217;t be usable on the device.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="mobile-password">Mobile Password</h5>
<div class="paragraph">
<p>While conceptually similar, the mobile password feature is not part of Mobile Device Management and can be used with any version of the EAS protocol.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="syncstates">SyncStates</h3>
<div class="sect3">
<h4 id="mobile-ng-and-the-syncstate">Mobile NG and the SyncState</h4>
<div class="paragraph">
<p>The SyncState (short for Synchronization Status) is a set of information kept on the server about the synchronization with a mobile device.
Each time a device establishes a connection with Mobile NG, the following steps take place:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1. The device requests a folderSync operation to synchronize the local Folders with the ones on the server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>    One SyncKey per local folder is sent (or a single SyncKey set to '0' if this is the first connection between the device and the server)   </code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>2. The server replies with a list of available folders.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>    One SyncKey per folder is sent by the server.</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>3. Then, the device requests an itemSync operation to synchronize all due items.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>    The server stores the items synchronized in the SyncState.</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>4. After completing the itemSync operation, the device sends a 'ping'
command to keep the connection alive.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>    Step 4 is repeated as long as no changes happen to the synchronized account.</code></p>
</div>
<div class="paragraph">
<p>Every time a new item is stored on the mailbox or an old item is modified, the server notifies the availability to the device, which closes the active connection (the one kept alive by the ping command) and repeats steps 3 and 4.</p>
</div>
<div class="paragraph">
<p>The SyncState is the combination of the SyncKeys saved on step 2 and the itemIds saved on step 3. It&#8217;s saved by the server per the userId/deviceId unique pair.</p>
</div>
<div class="sect4">
<h5 id="sync-request">Sync Request</h5>
<div class="paragraph">
<p>The Sync Request is the actual synchronization process, started by either Mobile NG or by the client.
During a sync request, any change in the mailbox that happened since the last request is synchronized to the device and vice versa.</p>
</div>
<div class="paragraph">
<p>A sync request is issued when:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The SyncState changes.</p>
</li>
<li>
<p>A sync is forced client-side.</p>
</li>
<li>
<p>The current <code>ping</code> expires and a new one is sent by the device (the keepalive duration is defined by the client).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="managing-the-syncstates">Managing the SyncStates</h4>
<div class="sect4">
<h5 id="syncstates-via-the-administration-zimlet">Via the Administration Zimlet</h5>
<div class="paragraph">
<p>Mobile NG provides two options in the Administration Zimlet to manage the SyncStates of synchronized mobile devices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reset Device: Resets the device&#8217;s SyncState for a single account, forcing a full re-synchronization the next time the device connects to the server.</p>
</li>
<li>
<p>Wipe Device: Removes all the device&#8217;s SyncState and history from the server.
Useful when a mobile device is not used anymore or is assigned to a different employee in the same company.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="syncstates-via-the-cli">Via the CLI</h5>
<div class="paragraph">
<p>To manage the SyncStates of synchronized mobile devices via the CLI, use one of the following commands:</p>
</div>
<div class="sect5">
<h6 id="the-doremovedevice-command">The doRemoveDevice command</h6>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite mobile doRemoveDevice {account} {device_id}

PARAMETER LIST

NAME            TYPE
account(M)      Account Name
device_id(M)    String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile doRemoveDevice john@example.com Appl79032X2WA4S
Removes John's Appl79032X2WA4S device SyncState</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="the-doresetaccount-command">The doResetAccount command</h6>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite mobile doResetAccount {account}

PARAMETER LIST

NAME          TYPE
account(M)    Account Name

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile doResetAccount john@example.com
Resets all the device states for John's account</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="the-doresetdevice-command">The doResetDevice command</h6>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite mobile doResetDevice {account} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME            TYPE            DEFAULT
account(M)      Account Name
device_id(O)    String          all

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile doResetDevice john@example.com Appl79032X2WA4S
Resets John's Appl79032X2WA4S device SyncState</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-settings">Advanced Settings</h3>
<div class="sect3">
<h4 id="mobile-ng-performance-tuning">Mobile NG Performance Tuning</h4>
<div class="paragraph">
<p>Mobile NG provides three useful options to fine-tune Mobile NG according to system performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="performance-tuning-settings">Performance Tuning Settings</h4>
<div class="sect4">
<h5 id="available-settings">Available Settings</h5>
<div class="ulist">
<ul>
<li>
<p>Notifications Latency (ZxMobile_NotificationsLatency): The seconds of delay between an event on the server and its notification to the mobile device.</p>
</li>
<li>
<p>Use Instant Notifications (ZxMobile_UseInstantNotficiations):
Enable/Disable instant notifications.
Overrides Notifications Latency if true.</p>
</li>
<li>
<p>Max Ping Heartbeat (ZxMobile_MaxPingHeartbeat): Maximum interval between 'ping' commands.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All settings can be edited in the Administration Zimlet or via CLI using the
<code>setProperty</code> command.</p>
</div>
</div>
<div class="sect4">
<h5 id="when-to-edit-the-performance-tuning-settings">When to Edit the Performance Tuning Settings</h5>
<div class="paragraph">
<p>Default settings should be optimal for most situations.
If you experience one or more of the problems below, please apply the proper solution.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Problem</th>
<th class="tableblock halign-left valign-top">Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">High system load</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable instant notifications</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">High system load after disabling instant notifications</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Raise notification latency</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mobile users experience high network usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable instant notifications and tweak notifications latency</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Devices can connect but sessions are interrupted frequently</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adjust Max Ping Heartbeat according to your network configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Items are synchronized from server-to-device with an excessive delay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lower notification latency or enable instant notifications</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="and-shared-folders">Shared Folders</h3>
<div class="sect3">
<h4 id="shared-folders-and-you-and-your-mobile">Shared Folders and You (and Your Mobile)</h4>
<div class="paragraph">
<p>With Network NG, it&#8217;s possible to synchronize folders that are not owned by the user itself to mobile devices.
This applies to all item types available through the Exchange ActiveSync protocol, so you&#8217;ll be able to sync any shared email folder, address book, calendar or task list to mobile devices.</p>
</div>
<div class="paragraph">
<p>Specific features available on mobile devices might differ, based on the client in use.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Not all clients support the synchronization of multiple address books, calendars or task lists via Exchange ActiveSync.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="how-to-sync-a-shared-folder-to-your-mobile-devices">How to Sync a Shared Folder to Your Mobile Devices</h4>
<div class="paragraph">
<p>To allow a higher level of control over synchronization, users are allowed to choose which shared folders are to be synchronized with their mobile devices.</p>
</div>
<div class="sect4">
<h5 id="enable-the-mobile-synchronization-for-a-folder">Enable Mobile Synchronization for a Folder</h5>
<div class="paragraph">
<p>To enable mobile synchronization for a shared folder:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log in to the Zimbra Web Client.</p>
</li>
<li>
<p>Right-click the shared folder you want to sync.</p>
</li>
<li>
<p>Select <code>Folder Sync Settings</code> in the drop-down menu.</p>
</li>
<li>
<p>Check the <code>Enable synchronization for this folder</code> checkbox.</p>
</li>
<li>
<p>Press OK.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The new folder will be synchronized to any mobile device connected to the account.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="restrictions">Restrictions</h4>
<div class="paragraph">
<p>The following restrictions apply to shared folder synchronization:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s not possible to sync a mountpoint referring to a full account share.</p>
</li>
<li>
<p>It&#8217;s not possible to sync a subfolder of a shared folder, as doing so would return an incomplete folder tree.</p>
</li>
<li>
<p>It&#8217;s not possible to sync a read-only share, as the Exchange ActiveSync protocol does not envision the concept of a <code>read-only</code>
resource.
Synchronizing a read-only folder will cause severe inconsistencies between the client and the server, along with many errors.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_eas_filters">EAS Filters</h3>
<div class="paragraph">
<p>In the EAS protocol, the protocol version used for the synchronization is defined during the initial handshake and never changed.
The server presents a list of all available protocol versions and the client chooses one among that list.</p>
</div>
<div class="paragraph">
<p>EAS filters are a way to limit the EAS version available to a subset of users or clients to ensure that the proper version is used.</p>
</div>
<div class="paragraph">
<p>Multiple EAS filters can be set up and will be evaluated in sequential order (see the <code>getAllEASFilters</code> and <code>doMoveEASFilter</code> commands below).</p>
</div>
<div class="sect3">
<h4 id="_anatomy_of_an_eas_filter">Anatomy of an EAS Filter</h4>
<div class="paragraph">
<p>An EAS filter is composed of 5 parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Type</code>: Defines the type of filter rule.</p>
</li>
<li>
<p><code>Parameter</code>: The filtering identifier (e.g. device brand or email address).</p>
</li>
<li>
<p><code>Mode</code>: Defines whether the software will limit the available versions or provide a fixed list.</p>
</li>
<li>
<p><code>easversions</code> field: Contains the protocol versions enforced by the filter.</p>
</li>
<li>
<p><code>Blocking</code> boolean value: Defines whether other filters are executed once the current one is successfully matched.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_managing_eas_filters">Managing EAS Filters</h4>
<div class="paragraph">
<p>EAS filters are managed through the CLI using the following four dedicated commands.</p>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_getalleasfilters">zxsuite mobile getAllEASFilters</h5>
<div class="paragraph">
<p>This command lists all existing filters.</p>
</div>
<div class="paragraph">
<p>Sample Output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>        filters

                ID                                                          0
                mode                                                        fixed
                rule                                                        [type = or; rules = [[type = contains; rule = outlook/] OR [type = contains; rule = microsoft.outlook]]
                easversions                                                 14.0
                blocking                                                    true

                ID                                                          1
                mode                                                        limit
                rule                                                        [type = contains; rule = samsung]
                easversions                                                 2.5
                blocking                                                    false

                ID                                                          2
                mode                                                        limit
                rule                                                        [type = always]
                easversions                                                 14.1
                blocking                                                    false</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_doaddeasfilter">zxsuite mobile doAddEASFilter</h5>
<div class="paragraph">
<p>This command adds a new EAS filter.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doAddEASFilter

Syntax:
   zxsuite mobile doAddEASFilter {and|or|regex|contains|account} {text|people@example.com|account=example@ff.com,contains=android} {add|subtract|fixed|limit} {easversions} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME              TYPE               EXPECTED VALUES
type(M)           Multiple choice    and|or|regex|contains|account
parameter(M)      String             text|people@example.com|account=example@ff.com,contains=android
mode(M)           Multiple choice    add|subtract|fixed|limit
easversions(M)    String[,..]
blocking(O)       Boolean            true|false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile doAddEASFilter contains android fixed 2.5,12.0,14.1
Adds a protocol filter that will restrict the pool of available EAS versions to 2.5, 12.0 and 14.1 if the user agent name
contains the string 'android'.

zxsuite mobile doAddEASFilter and account=user@example.com,contains=android fixed 14.1 blocking true
Adds a protocol filter that will restrict the pool of available EAS versions to 14.1 if the user agent name
contains the string 'android' only for user@example.com. No more EAS filters will be evaluated after this one due to the 'blocking' directive.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_dodeleteeasfilter">zxsuite mobile doDeleteEASFilter</h5>
<div class="paragraph">
<p>This command deletes an existing EAS Filter.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doDeleteEASFilter
command doDeleteEASFilter requires more parameters

Syntax:
   zxsuite mobile doDeleteEASFilter {id}

PARAMETER LIST

NAME     TYPE
id(M)    Integer

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile doDeleteEASFilter 2
Removes the filter with id = 2.
To show a list of the filters, use the
	zxsuite mobile getAllEASFilters
command.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_domoveeasfilter">zxsuite mobile doMoveEASFilter</h5>
<div class="paragraph">
<p>This command is used to move EAS filters to a different position in the filter queue.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doMoveEASFilter
command doMoveEASFilter requires more parameters

Syntax:
   zxsuite mobile doMoveEASFilter {from} {to}

PARAMETER LIST

NAME       TYPE
from(M)    Integer
to(M)      Integer

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile doMoveEASFilter 0 5
Moves the filter with id = 0 to the position 5.
To show a list of the filters, use the
	zxsuite mobile getAllEASFilters
command.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mobile_account_loggers">Mobile Account Loggers</h3>
<div class="paragraph">
<p>Mobile account loggers are dedicated loggers that can output the entirety of a user&#8217;s EAS logs into a dedicated logfile, with a different verbosity than the one of the <code>sync.log</code>. This allows for quicker troubleshooting.</p>
</div>
<div class="paragraph">
<p>When creating an account logger, the following parameters must be specified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The target <code>account</code>.</p>
</li>
<li>
<p>The <code>log_level</code> (verbosity) of the log.</p>
</li>
<li>
<p>The dedicated <code>log_file</code>.</p>
</li>
<li>
<p>The <code>window_size</code> to enforce on all devices synchronizing with the account while the logger is running.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Account loggers are removed automatically when the mailboxd is stopped or restarted and do not usually survive a mailboxd crash.
Log files won&#8217;t be affected.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_account_logger_management">Account Logger Management</h4>
<div class="paragraph">
<p>Account loggers can only be managed via the CLI through the following commands:</p>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_doaddaccountlogger">zxsuite mobile doAddAccountLogger</h5>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doAddAccountLogger
command doAddAccountLogger requires more parameters

Syntax:
   zxsuite mobile doAddAccountLogger {account} {debug|info|warn|err|crit} {log_file} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME              TYPE               EXPECTED VALUES
account(M)        Account Name
log_level(M)      Multiple choice    debug|info|warn|err|crit
log_file(M)       Path
window_size(O)    Integer            a value &gt; 0

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile doaddaccountlogger john@example.com info /tmp/john_logger
Creates an info account logger for john's account to file /tmp/john_logger

zxsuite mobile doaddaccountlogger john@example.com info /tmp/john_logger window_size 1
Creates an info account logger for john's account to file /tmp/john_logger with window size set to 1.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_doremovelogger">zxsuite mobile doRemoveLogger</h5>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile doRemoveLogger
command doRemoveLogger requires more parameters

Syntax:
   zxsuite mobile doRemoveLogger {logger_id|"all_loggers"}

PARAMETER LIST

NAME            TYPE               EXPECTED VALUES
logger_id(M)    Multiple choice    logger_id|"all_loggers"

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile doremovelogger 5
Removes the account logger with ID = 5</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_zxsuite_mobile_getaccountloggers">zxsuite mobile getAccountLoggers</h5>
<div class="paragraph">
<p>Sample output:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite mobile getAccountLoggers

        loggers

                id                                                          7
                level                                                       DEBUG
                name                                                        AccountLogger
                description                                                 Logging account user@domain.com using level debug, log file /tmp/user.log
                remove command                                              zxsuite mobile doRemoveLogger 7</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hsm-ng-guide">HSM NG</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="hierarchical-storage-management">Hierarchical Storage Management</h3>
<div class="sect3">
<h4 id="the-hierarchical-storage-management-technique">The Hierarchical Storage Management Technique</h4>
<div class="paragraph">
<p>HSM is a data storage technique that moves data between different stores
according to a defined policy.</p>
</div>
<div class="paragraph">
<p>The most common use of the HSM technique is the move of <em>older</em> data from a
faster-but-expensive storage device to a slower-but-cheaper one based on the
following premises:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fast storage costs more.</p>
</li>
<li>
<p>Slow storage costs less.</p>
</li>
<li>
<p><em>Old</em> data will be accessed much less frequently than <em>new</em> data.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The advantages of the HSM technique are clear: Lowering the overall storage cost since only a small part of your data needs to be
on costly storage, and improving the overall user experience.</p>
</div>
<div class="sect4">
<h5 id="stores-volumes-and-policies">Stores, Volumes and Policies</h5>
<div class="paragraph">
<p>Using HSM requires a clear understanding of some
related terms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Primary Store: The <em>fast-but-expensive</em> store where all your data
is initially placed.</p>
</li>
<li>
<p>Secondary Store: The <em>slow-but-cheap</em> store where <em>older</em> data will
be moved to.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zimbra-stores">Zimbra Stores</h3>
<div class="sect3">
<h4 id="the-basics-types-of-stores-and-their-uses">The Basics: Types of Stores and Their Uses</h4>
<div class="paragraph">
<p>Zimbra allows for <strong>two</strong> different types of stores:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Index Store</strong>: A store that contains information about your data that is used
by Apache Lucene to provide indexing and search functions.</p>
</li>
<li>
<p><strong>Data Store</strong>: A store that contains all your Zimbra data organized in
a MySql database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can have multiple stores of each type, but only one Index Store, one
Primary Data Store and one Secondary Data Store can be set as <em>Current</em>
(meaning that is currently used by Zimbra).</p>
</div>
<div class="sect4">
<h5 id="primary-and-secondary-data-stores">Primary and Secondary Data Stores</h5>
<div class="paragraph">
<p>A data store in Zimbra can be either a Primary Data Store or a Secondary
Data Store.</p>
</div>
<div class="paragraph">
<p>Data is moved between the <em>current</em> Primary Data Store and the <em>current</em>
Secondary Data Store according to a defined policy.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hsm-ngmoving-items-between-stores">HSM NG: Moving Items between Stores</h4>
<div class="paragraph">
<p>The main feature of the HSM NG module is the ability to apply
defined HSM policies.</p>
</div>
<div class="paragraph">
<p>The move can be triggered in three ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the <em>Apply Policy</em> button in the Administration Zimlet.</p>
</li>
<li>
<p>Start the <code>doMoveBlobs</code> operation through the CLI.</p>
</li>
<li>
<p>Enable Policy Application Scheduling in the Administration Zimlet
and wait for it to start automatically.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the move is started, the following operations are performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HSM NG scans through the Primary Store to see which items comply with
the defined policy.</p>
</li>
<li>
<p>All the Blobs of the items found in the first step are copied to the
Secondary Store.</p>
</li>
<li>
<p>The database entries related to the copied items are updated to
reflect the move.</p>
</li>
<li>
<p>If the second and the third steps are completed successfully (and only
in this case), the old Blobs are deleted from the Primary Store.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Move operation is <em>stateful</em> - each step is executed only if the previous step has been completed successfully - so the risk of data loss during a Move operation is nonexistent.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domoveblobs">doMoveBlobs</h3>
<div class="sect3">
<h4 id="the-domoveblobs-operation-of-hsm-ng">The doMoveBlobs Operation of HSM NG</h4>
<div class="paragraph">
<p>The doMoveBlobs is the heart of HSM NG.</p>
</div>
<div class="paragraph">
<p>It moves items between the Current Primary Store and the
Current Secondary Store according to the proper HSM policy.</p>
</div>
<div class="paragraph">
<p>The move is performed by a transactional algorithm. Should an error
occur during one of the steps of the operation, a rollback takes
place and no change will be made to the data.</p>
</div>
<div class="paragraph">
<p>Once HSM NG identifies the items to be moved, the following steps are
performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A copy of the Blob to the Current Secondary Store is created.</p>
</li>
<li>
<p>The Zimbra Database is updated to notify Zimbra of the item&#8217;s new
position.</p>
</li>
<li>
<p>The original Blob is deleted from the Current Primary Store.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="what-will-be-moved">What is Moved?</h5>
<div class="paragraph">
<p>Every item that complies with the specified HSM policy is moved.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="paragraph">
<p>The following policy</p>
</div>
<div class="literalblock">
<div class="content">
<pre>message,document:before:-20day
message:before:-10day has:attachment</pre>
</div>
</div>
<div class="paragraph">
<p>will move all emails and documents older than 20 days along with all
emails older than 10 days that contain an attachment.</p>
</div>
</div>
<div class="sect4">
<h5 id="policy-order">Policy Order</h5>
<div class="paragraph">
<p>All conditions for a policy are executed in the exact order they are
specified. HSM NG will loop on all items in the Current Primary Store
and apply each separate condition before starting the next one.</p>
</div>
<div class="paragraph">
<p>This means that the following policies</p>
</div>
<div class="literalblock">
<div class="content">
<pre>message,document:before:-20day
message:before:-10day has:attachment</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>message:before:-10day has:attachment
message,document:before:-20day</pre>
</div>
</div>
<div class="paragraph">
<p>applied daily on a sample server that sends/receives a total of 1000
emails per day, 100 of which contain one or more attachments, will
have the same final result. However, the execution time of the second policy will probably be
slightly higher (or much higher, depending on the number and size of the
emails on the server).</p>
</div>
<div class="paragraph">
<p>This is because in the first policy, the first condition
(message,document:before:-20day) will loop on all items and move many of
them to the Current Secondary Store, leaving fewer items for the second
condition to loop on.</p>
</div>
<div class="paragraph">
<p>Likewise, having the <code>message:before:-10day has:attachment</code> as the first condition will leave more items for the second condition to loop
on.</p>
</div>
<div class="paragraph">
<p>This is just an example and does not apply to all cases, but gives an idea of the need to carefully plan your HSM policy.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="executing-the-domoveblobs-operation-a.k.a.-applying-the-hsm-policy">Executing the doMoveBlobs Operation (a.k.a. Applying the HSM Policy)</h4>
<div class="paragraph">
<p><em>Applying a policy</em> means running the <code>doMoveBlobs</code> operation in order
to move items between the Primary and Secondary store according to the
defined policy.</p>
</div>
<div class="paragraph">
<p>HSM NG gives you three different options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Via the Administration Zimlet</p>
</li>
<li>
<p>Via the CLI</p>
</li>
<li>
<p>Through Scheduling</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="apply-the-hsm-policy-via-the-administration-zimlet">Apply the HSM Policy via the Administration Zimlet</h5>
<div class="paragraph">
<p>To apply the HSM Policy via the Administration Zimlet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log into the Zimbra Administration Console.</p>
</li>
<li>
<p>Click the <em>HSM NG</em> entry in the Administration Zimlet.</p>
</li>
<li>
<p>Click the <em>Apply Policy</em> button.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="apply-the-hsm-policy-via-the-cli">Apply the HSM Policy via the CLI</h5>
<div class="paragraph">
<p>To apply the HSM Policy via the CLI, run the following command
as the <em>zimbra</em> user:</p>
</div>
<div class="paragraph">
<p>` zxsuite hsm doMoveBlobs`</p>
</div>
</div>
<div class="sect4">
<h5 id="apply-the-hsm-policy-through-scheduling">Apply the HSM Policy through Scheduling</h5>
<div class="paragraph">
<p>To schedule a daily execution of the <code>doMoveBlobs</code> operation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log into the Zimbra Administration Console.</p>
</li>
<li>
<p>Click the <em>HSM NG</em> entry in the Administration Zimlet.</p>
</li>
<li>
<p>Enable scheduling by selecting the <code>Enable HSM Session scheduling:</code> button.</p>
</li>
<li>
<p>Select the hour to run the operation under <code>HSM Session scheduled for:</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="domoveblobs-stats-and-info">doMoveBlobs Stats and Info</h4>
<div class="paragraph">
<p>Information about disk space savings, operation performances and more
are available by clicking the <em>Stats</em> button under the <code>Secondary
Volumes</code> list in the HSM NG tab of the Administration Zimlet.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="volume-management">Volume Management</h3>
<div class="paragraph">
<p>Both primary and secondary volumes can be created on either local storage or on supported third-party storage
solutions.</p>
</div>
<div class="sect3">
<h4 id="zimbra-volumes">Zimbra Volumes</h4>
<div class="paragraph">
<p>A volume is a distinct entity (path) on a filesystem with all the associated
properties that contain Zimbra Blobs.</p>
</div>
<div class="sect4">
<h5 id="volume-properties">Volume Properties</h5>
<div class="paragraph">
<p>All Zimbra volumes are defined by the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Name: A unique identifier for the volume.</p>
</li>
<li>
<p>Path: The path where the data is going to be saved.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <em>zimbra</em> user must have r/w permissions on this path.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Compression: Enable or Disable the file compression for the volume.</p>
</li>
<li>
<p>Compression Threshold: The minimum file size that will trigger the
compression. 'Files under this size will never be compressed even if the
compression is enabled.'</p>
</li>
<li>
<p>Current: A <em>Current</em> volume is a volume where data will be written
upon arrival (Primary Current) or HSM policy application (Secondary
Current).</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="volume-management-with-hsm-ng">Volume Management with HSM NG - Administration Zimlet</h5>
<div class="sect5">
<h6 id="_creating_a_new_volume_with_the_administration_zimlet">Creating a New Volume with the Administration Zimlet</h6>
<div class="paragraph">
<p>To create a new volume from the HSM NG tab of the Administration Zimlet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the appropriate <em>Add</em> option in the <em>Volumes Management</em> section
according to the type of volume you want to create.</p>
</li>
<li>
<p>Select the store type, choosing between local mount point or S3 Bucket.</p>
</li>
<li>
<p>Enter the new volume&#8217;s name.</p>
</li>
<li>
<p>Enter a path for the new volume.</p>
</li>
<li>
<p>Check the <em>Enable Compression</em> button if you wish to activate data
compression on the new volume.</p>
</li>
<li>
<p>Select the Compression Threshold.</p>
</li>
<li>
<p>If you are using an S3 Bucket, it&#8217;s possible to store information for multiple buckets.</p>
</li>
<li>
<p>Press <em>OK</em> to create the new volume. Should the operation fail, a
notification containing any related errors will be generated.</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_editing_a_volume_with_the_administration_zimlet">Editing a Volume with the Administration Zimlet</h6>
<div class="paragraph">
<p>To edit a volume from the Administration Zimlet, simply select an existing volume
and press the appropriate <em>Edit</em> button.</p>
</div>
</div>
<div class="sect5">
<h6 id="deleting-a-volume">Deleting a Volume with the Administration Zimlet</h6>
<div class="paragraph">
<p>To delete a volume from the Administration Zimlet, select an existing volume and press the appropriate <em>Delete</em> button.
Remember that only <strong>empty</strong> volumes can be deleted.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_volume_management_with_hsm_ng_from_the_cli">Volume Management with HSM NG - From the CLI</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Beginning with release 8.8.9, all volume creation and update commands have been updated, as the <code>storeType</code> argument is now required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>storeType</code> argument is <strong>mandatory</strong>, it is always the on the first position and accepts any one value corresponding to the <a href="#s3-compatible-services">S3-Compatible Services</a> listed previously.
The arguments that follow in the command now depend on the selected <code>storeType</code>.</p>
</div>
<div class="sect5">
<h6 id="_fileblob_local">FileBlob (Local)</h6>
<div class="paragraph">
<p>Updated <code>zxsuite</code> syntax to create new FileBlob zimbra volume:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Add volume, run as zimbra user
zxsuite hsm doCreateVolume FileBlob name secondary /path/to/store
# Delete volume
zxsuite hsm doDeleteVolume name
# set current
zxsuite hsm doUpdateVolume FileBlob name current_volume true</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doCreateVolume FileBlob</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doCreateVolume FileBlob {volume_name} {primary|secondary|index} {volume_path} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES             DEFAULT
volume_name(M)                  String
volume_type(M)                  Multiple choice     primary|secondary|index
volume_path(M)                  Path
volume_compressed(O)            Boolean             true|false                  false
compression_threshold_bytes(O)  Long                                            4096

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doCreateVolume FileBlob volumeName secondary /path/to/store volume_compressed true compression_threshold_bytes 4096</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doUpdateVolume FileBlob</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doUpdateVolume FileBlob {current_volume_name} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES             DEFAULT
current_volume_name(M)          String
volume_type(O)                  String              primary|secondary|index
volume_name(O)                  String
volume_path(O)                  Path
current_volume(O)               Boolean             true|false                  false
volume_compressed(O)            String
compression_threshold(O)        String

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_s3_amazon_and_any_s3_compatible_solution_not_explicitly_supported">S3 (Amazon and any S3-compatible solution not explicitly supported)</h6>
<div class="literalblock">
<div class="content">
<pre># Add volume, run as zimbra user
zxsuite hsm doCreateVolume S3 name secondary bucket_name bucket access_key accessKey secret secretString region EU_WEST_1
# Delete volume
zxsuite hsm doDeleteVolume name
# set current
zxsuite hsm doUpdateVolume S3 name current_volume true</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doCreateVolume S3</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doCreateVolume S3 {Name of the zimbra store} {primary|secondary} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES
volume_name(M)                  String              Name of the zimbra store
volume_type(M)                  Multiple choice     primary|secondary
bucket_name(O)                  String              Amazon AWS bucket
access_key(O)                   String              Service username
secret(O)                       String              Service password
server_prefix(O)                String              Prefix to the server id used in all objects keys
bucket_configuration_id(O)      String              UUID for already existing S3 service credentials
                                                    (zxsuite config global get attribute s3BucketConfigurations)
region(O)                       String              Amazon AWS Region
url(O)                          String              S3 API compatible service url (ex: s3api.service.com)
prefix(O)                       String              Prefix added to blobs keys
use_infrequent_access(O)        Boolean             true|false
infrequent_access_threshold(O)  String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

S3 AWS Bucket:
    zxsuite hsm doCreateVolume S3 volumeName primary bucket_name bucket access_key accessKey secret secretKey prefix objectKeysPrefix region EU_WEST_1 user_infrequent_access TRUE infrequent_access_threshold 4096

S3 compatible object storage:
    zxsuite hsm doCreateVolume S3 volumeName primary bucket_name bucket access_key accessKey secret secretKey url http://host/service

Using existing bucket configuration:
    zxsuite hsm doCreateVolume S3 volumeName primary bucket_configuration_id 316813fb-d3ef-4775-b5c8-f7d236fc629c</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doUpdateVolume S3</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doUpdateVolume S3 {current_volume_name} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES             DEFAULT
current_volume_name(M)          String
volume_name(O)                  String
volume_type(O)                  String              primary|secondary
server_prefix(O)                String              Prefix to the server id used in all objects keys
bucket_configuration_id(O)      String              UUID for already existing service credentials
                                                    (zxsuite config global get attribute s3BucketConfigurations)
use_infrequent_access(O)        Boolean             true|false
infrequent_access_threshold(O)  String
current_volume(O)               Boolean             true|false                  false

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_scality_s3_compatible_object_storage">Scality (S3 compatible object storage)</h6>
<div class="literalblock">
<div class="content">
<pre># Add volume, run as zimbra user
zxsuite hsm doCreateVolume ScalityS3 name secondary bucket_name mybucket access_key accessKey1 secret verySecretKey1 url http://{IP_ADDRESS}:{PORT}
# Delete volume
zxsuite hsm doDeleteVolume name
# set current
zxsuite hsm doUpdateVolume ScalityS3 name current_volume true</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doCreateVolume ScalityS3</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doCreateVolume ScalityS3 {volume_name} {primary|secondary} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES
volume_name(M)                  String
volume_type(M)                  Multiple choice     primary|secondary
bucket_name(O)                  String              Bucket name
url(O)                          String              S3 API compatible service url (ex: s3api.service.com)
access_key(O)                   String              Service username
secret(O)                       String              Service password
server_prefix(O)                String              Prefix to the server id used in all objects keys
bucket_configuration_id(O)      String              UUID for already existing service credentials
                                                    (zxsuite config global get attribute s3BucketConfigurations)
prefix(O)                       String              Prefix added to blobs keys

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doCreateVolume ScalityS3 volumeName primary bucket_name bucket url http://host/service access_key accessKey secret secretKet
zxsuite hsm doCreateVolume ScalityS3 volumeName primary bucket_configuration_id uuid</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doUpdateVolume ScalityS3</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doUpdateVolume ScalityS3 {current_volume_name} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES             DEFAULT
current_volume_name(M)          String
volume_name(O)                  String
volume_type(O)                  String              primary|secondary
server_prefix(O)                String              Prefix to the server id used in all objects keys
bucket_configuration_id(O)      String              UUID for already existing S3 service credentials
                                                    (zxsuite config global get attribute s3BucketConfigurations)
current_volume(O)               Boolean             true|false                  false

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_emc_s3_compatible_object_storage">EMC (S3 compatible object storage)</h6>
<div class="literalblock">
<div class="content">
<pre># Add volume, run as zimbra user
zxsuite hsm docreatevolume EMC name secondary bucket_name bucket access_key ACCESSKEY secret SECRET url https://url.of.storage
# Delete volume
zxsuite hsm doDeleteVolume name
# set current
zxsuite hsm doUpdateVolume EMC name current_volume true</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doCreateVolume EMC</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doCreateVolume EMC {volume_name} {primary|secondary} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES
volume_name(M)                  String
volume_type(M)                  Multiple choice     primary|secondary
bucket_name(O)                  String              Bucket name
url(O)                          String              S3 API compatible service url (ex: s3api.service.com)
access_key(O)                   String              Service username
secret(O)                       String              Service password
server_prefix(O)                String              Prefix to the server id used in all objects keys
bucket_configuration_id(O)      String              UUID for already existing service credentials
                                                    (zxsuite config global get attribute s3BucketConfigurations)
prefix(O)                       String              Prefix added to blobs keys

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doCreateVolume EMC volumeName primary bucket_name bucket url http://host/service access_key accessKey secret secretKet
zxsuite hsm doCreateVolume EMC volumeName primary bucket_configuration_id uuid</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doUpdateVolume EMC</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doUpdateVolume EMC {current_volume_name} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES             DEFAULT
current_volume_name(M)          String
volume_name(O)                  String
volume_type(O)                  String              primary|secondary
server_prefix(O)                String              Prefix to the server id used in all objects keys
bucket_configuration_id(O)      String              UUID for already existing service credentials
                                                    (zxsuite config global get attribute s3BucketConfigurations)
current_volume(O)               Boolean             true|false                  false

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_openio">OpenIO</h6>
<div class="literalblock">
<div class="content">
<pre># add volume, run as zimbra user
zxsuite hsm doCreateVolume OpenIO name secondary http://{IP_ADDRESS} ZeXtras OPENIO
# Delete volume
zxsuite hsm doDeleteVolume name
# set current
zxsuite hsm doUpdateVolume OpenIO name current_volume true</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doCreateVolume OpenIO</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doCreateVolume OpenIO {volume_name} {primary|secondary} {url} {account} {namespace} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES
volume_name(M)                  String
volume_type(M)                  Multiple choice     primary|secondary
url(M)                          String
account(M)                      String
namespace(M)                    String
proxy_port(O)                   Integer
account_port(O)                 Integer

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doCreateVolume OpenIO volumeName primary http://host/service</pre>
</div>
</div>
<div class="paragraph">
<p>accountName namespaceString proxy_port 6006 account_port 6009</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
zxsuite hsm doUpdateVolume OpenIO {current_volume_name} [attr1 value1
[attr2 value2...]]
PARAMETER LIST
NAME                            TYPE                EXPECTED VALUES             DEFAULT
current_volume_name(M)          String
volume_name(O)                  String
volume_type(O)                  String              primary|secondary
url(O)                          String
account(O)                      String
namespace(O)                    String
proxy_port(O)                   Integer
account_port(O)                 Integer
current_volume(O)               Boolean             true|false                  false

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_swift">Swift</h6>
<div class="literalblock">
<div class="content">
<pre># add volume, run as zimbra user
zxsuite hsm doCreateVolume Swift name secondary http://{IP_ADDRESS}:8080/auth/v1.0/ user:username password maxDeleteObjectsCount 100
# Delete volume
zxsuite hsm doDeleteVolume name
# set current
zxsuite hsm doUpdateVolume Swift name current_volume true</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doCreateVolume Swift</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doCreateVolume Swift {volume_name} {primary|secondary} {url} {username} {password} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                        TYPE        EXPECTED VALUES             DEFAULT
volume_name(O)              String
volume_type(O)              String      primary|secondary
url(O)                      String
username(O)                 String
password(O)                 String
maxDeleteObjectsCount(O)    Integer     Number of object in a single bulk delete request
                                                                    500

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doCreateVolume Swift volumeName primary http://host/service accountName password max_delete_objects_count 100</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doUpdateVolume Swift</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doUpdateVolume Swift {current_volume_name} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                        TYPE        EXPECTED VALUES             DEFAULT
current_volume_name(M)      String
volume_name(O)              String
volume_type(O)              String      primary|secondary
url(O)                      String
username(O)                 String
password(O)                 String
maxDeleteObjectsCount(O)    Integer     Number of object in a single bulk delete request
                                                                    500
current_volume(O)           Boolean     true|false                  false

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_cloudian_s3_compatible_object_storage">Cloudian (S3 compatible object storage)</h6>
<div class="literalblock">
<div class="content">
<pre># add volume, run as zimbra user
zxsuite hsm doCreateVolume Cloudian name secondary bucket_name bucket access_key ACCESSKEY secret SECRET url https://url.of.storage
# Delete volume
zxsuite hsm doDeleteVolume name
# set current
zxsuite hsm doUpdateVolume Cloudian name current_volume true</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doCreateVolume Cloudian</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doCreateVolume Cloudian {volume_name} {primary|secondary} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES
volume_name(M)                  String
volume_type(M)                  Multiple choice     primary|secondary
bucket_name(O)                  String              Bucket name
url(O)                          String              S3 API compatible service url (ex: s3api.service.com)
access_key(O)                   String              Service username
secret(O)                       String              Service password
server_prefix(O)                String              Prefix to the server id used in all objects keys
bucket_configuration_id(O)      String              UUID for already existing service credentials
                                                    (zxsuite config global get attribute s3BucketConfigurations)
prefix(O)                       String              Prefix added to blobs keys

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doCreateVolume Cloudian volumeName primary bucket_name bucket url http://host/service access_key accessKey secret secretKet
zxsuite hsm doCreateVolume Cloudian volumeName primary bucket_configuration_id uuid</pre>
</div>
</div>
<div class="paragraph">
<p>zxsuite hsm doUpdateVolume Cloudian</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doUpdateVolume Cloudian {current_volume_name} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                            TYPE                EXPECTED VALUES             DEFAULT
current_volume_name(M)          String
volume_name(O)                  String
volume_type(O)                  String              primary|secondary
server_prefix(O)                String              Prefix to the server id used in all objects keys
bucket_configuration_id(O)      String              UUID for already existing service credentials
                                                    (zxsuite config global get attribute s3BucketConfigurations)
current_volume(O)               Boolean             true|false                  false

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_volume_deletion">Volume Deletion</h5>
<div class="paragraph">
<p>zxsuite hsm doDeleteVolume</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doDeleteVolume {volume_name}

PARAMETER LIST

NAME                            TYPE
volume_name(M)                  String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm dodeletevolume hsm
Deletes volume with name hsm</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_move_all_data_from_a_volume_to_another">Move all data from a volume to another</h5>
<div class="literalblock">
<div class="content">
<pre>Syntax:
    zxsuite hsm doVolumeToVolumeMove {source_volume_name} {destination_volume_name}

PARAMETER LIST

NAME                            TYPE
source_volume_name(M)           String
destination_volume_name(M)      String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doVolumeToVolumeMove sourceVolume destVolume
Moves the whole contents of sourceVolume to destVolume</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="centralized-storage">Centralized Storage</h3>
<div class="paragraph">
<p>The Centralized Storage feature allows to use an S3 bucket to host data coming from multiple servers at the same time sharing the same directory structure, as opposed to "independent" volumes which are self-contained and whose directory structure is strictly related to the server and volume itself.</p>
</div>
<div class="paragraph">
<p>This allows for better data management in large multistore environments and greatly improves mailbox move speed.</p>
</div>
<div class="sect3">
<h4 id="enabling-centralized-storage">Enabling Centralized Storage</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the centralized volume on any one of your servers using the <code>zxsuite hsm doCreateVolume</code> command.</p>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>All volume types except for FileBlob are compatible;</p>
</li>
<li>
<p>Make sure to add the centralized TRUE flag to set the volume as a Centralized Storage;</p>
</li>
<li>
<p>The full syntax for the command depends on the storage type;</p>
</li>
</ol>
</div>
</li>
<li>
<p>Once the Centralized Volume has been created, use the <code>zxsuite doCreateVolume Centralized</code> command on all other mailbox servers to copy the Centralized Volume&#8217;s configuration from the first server and add it to the volume list.</p>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>The full syntax for the command is zxsuite hsm doCreateVolume Centralized {server_name} {volume_name}</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="centralized-storage-structure">Centralized Storage Structure</h4>
<div class="paragraph">
<p>Storage Structure
Data is stored in a Centralized Volume plainly, as the main directory of the volume contains a single empty directory for each server connected to the volume and a directory for each mailbox stored in it at the very same level.</p>
</div>
<div class="paragraph">
<p>In the following example, servers 3aa2d376-1c59-4b5a-94f6-101602fa69c6 and 595a4409-6aa1-413f-9f45-3ef0f1e560f5 are both connected to the same Centralized volume, where 3 mailboxes are stored. As you can see, the effective server where the mailboxes are hosted is irrelevant to the storage.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>_
|- 3aa2d376-1c59-4b5a-94f6-101602fa69c6/
|- 595a4409-6aa1-413f-9f45-3ef0f1e560f5/
|- ff46e039-28e3-4343-9d66-92adc60e60c9/
\
 |-- 357-104.msg
 |-- 368-115.msg
 |-- 369-116.msg
 |-- 373-120.msg
 |-- 374-121.msg
 |-- 375-122.msg
 |-- 376-123.msg
 |-- 383-130.msg
|- 4c022592-f67d-439c-9ff9-e3d48a8c801b/
\
 |-- 315-63.msg
 |-- 339-87.msg
 |-- 857-607.msg
 |-- 858-608.msg
 |-- 859-609.msg
 |-- 861-611.msg
 |-- 862-612.msg
 |-- 863-613.msg
 |-- 864-614.msg
 |-- 865-615.msg
 |-- 866-616.msg
 |-- 867-617.msg
 |-- 868-618.msg
|- dafd5569-4114-4268-9201-14f4a895a3d5/
\
 |-- 357-104.msg
 |-- 368-115.msg
 |-- 369-116.msg
 |-- 373-120.msg
 |-- 374-121.msg
 |-- 375-122.msg
 |-- 376-123.msg
 |-- 383-130.msg
 |-- 384-131.msg</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="policy-management">Policy Management</h3>
<div class="sect3">
<h4 id="what-is-a-policy">What is a Policy?</h4>
<div class="paragraph">
<p>An HSM policy is a set of rules that define what items
will be moved from the Primary Store to the Secondary Store when the
<code>doMoveBlobs</code> operation of HSM NG is triggered, either manually or by
scheduling.</p>
</div>
<div class="paragraph">
<p>A policy can consist of a single rule that is valid for all item types
(<em>Simple</em> policy) or multiple rules valid for one or more item types
(<em>Composite</em> policy). Also, an additional <em>sub-rule</em> can be defined
using Zimbra&#8217;s
<a href="http://wiki.zimbra.com/wiki/Zimbra_Web_Client_Search_Tips">search
syntax</a>.</p>
</div>
<div class="sect4">
<h5 id="policy-examples">Policy Examples</h5>
<div class="paragraph">
<p>Here are some policy examples. To see how to create the policies in the HSM NG module, see
below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Move all items older than 30 days</em></p>
</li>
<li>
<p><em>Move emails older than 15 days and items of all other kinds older than 30 days</em></p>
</li>
<li>
<p><em>Move calendar items older than 15 days, briefcase items older than 20 days and all emails in the "Archive" folder</em></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="defining-a-policy">Defining a Policy</h4>
<div class="paragraph">
<p>Policies can be defined both from the HSM NG tab of the Administration
Zimlet and from the CLI. You can specify a Zimbra Search in both cases.</p>
</div>
<div class="sect4">
<h5 id="policy-from-the-administration-zimlet">From the Administration Zimlet</h5>
<div class="paragraph">
<p>To define a policy from the Administration Zimlet:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log into the Zimbra Administration Console.</p>
</li>
<li>
<p>Click <em>HSM NG</em> on the Administration Zimlet.</p>
</li>
<li>
<p>Click the <em>Add</em> button in the Storage Management Policy section.</p>
</li>
<li>
<p>Select the Item Types from the <code>Items to Move:</code> list.</p>
</li>
<li>
<p>Enter the Item Age from the <code>Move Items older than:</code> box.</p>
</li>
<li>
<p><strong>OPTIONAL</strong>: Add a Zimbra Search in the <em>Additional Options</em> box.</p>
</li>
<li>
<p>You can add multiple <em>lines</em> to narrow down your policy. Every <em>line</em>
will be evaluated and executed after the line before has been applied.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="policy-from-the-cli">From the CLI</h5>
<div class="paragraph">
<p>Two policy management commands are available in the CLI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>setHsmPolicy</p>
</li>
<li>
<p>+setHsmPolicy</p>
</li>
</ul>
</div>
<div id="zxsuite-hsm-ng-sethsmpolicy-policy" class="paragraph">
<p>zxsuite hsm setHsmPolicy {policy}</p>
</div>
<div class="paragraph">
<p>This command resets the current policy and creates a new one as
specified by the <em>policy</em> parameter.</p>
</div>
<div class="paragraph">
<p>The <em>policy</em> parameter must be specified in the following syntax</p>
</div>
<div class="paragraph">
<p><code>itemType1[,itemType2,itemtype3,etc]:query</code></p>
</div>
<div id="zxsuite-hsm-ng-sethsmpolicy-policy-1" class="paragraph">
<p>zxsuite hsm +setHsmPolicy {policy}</p>
</div>
<div class="paragraph">
<p>This command adds the query specified by the <em>policy</em> parameter to the
current HSM Policy.</p>
</div>
<div class="paragraph">
<p>The <em>policy</em> parameter must be specified in the following syntax</p>
</div>
<div class="paragraph">
<p><code>itemType1[,itemType2,itemtype3,etc]:query</code></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_volumes_on_amazon_s3_compatible_services">Volumes on Amazon S3 Compatible Services</h3>
<div class="sect3">
<h4 id="hsm-ng-and-s3-buckets">HSM NG and S3 buckets</h4>
<div class="paragraph">
<p>Primary and Secondary volumes created with
HSM NG can be hosted on S3 buckets, effectively moving the largest
part of your data to secure and durable cloud storage.</p>
</div>
<div class="sect4">
<h5 id="s3-compatible-services">S3-compatible Services</h5>
<div class="paragraph">
<p>While any storage service compatible with the Amazon S3 API should work
out of the box with HSM NG, listed here are the only
officially supported platforms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>FileBlob (standard local volume)</p>
</li>
<li>
<p>Amazon S3</p>
</li>
<li>
<p>EMC</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenIO</p>
</li>
<li>
<p>Swift</p>
</li>
<li>
<p>Scality S3</p>
</li>
<li>
<p>Cloudian</p>
</li>
<li>
<p>Custom S3 (any unsupported S3-compliant solution)</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_primary_volumes_and_the_incoming_directory">Primary Volumes and the "Incoming" directory</h5>
<div class="paragraph">
<p>In order to create a remote <em>Primary Store</em> on a mailbox server a local "Incoming"
directory must exist on that server. The default directory is
<code>/opt/zimbra/incoming</code>, but you can check or modify the current value using these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite config server get $(zmhostname) attribute incomingPath
zxsuite config server set $(zmhostname) attribute incomingPath value /path/to/dir</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="local-cache">Local Cache</h5>
<div class="paragraph">
<p>Storing a volume on third-party remote storage solutions requires a local
directory to be used for item caching, which must be readable and
writable by the <em>zimbra</em> user.</p>
</div>
<div class="paragraph">
<p>The local directory must be created manually and its path must be entered in
the <em>HSM NG</em> section of the Administration Zimlet in the Zimbra
Administration Console.</p>
</div>
<div class="paragraph">
<p>If the Local Cache directory is not set, you won&#8217;t be able to create any secondary volume on an S3-compatible device or service.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Failing to correctly configure the cache directory will cause items
to be unretrievable, meaning that users will get a <code>No such BLOB</code> error
when trying to access any item stored on an S3 volume.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_local_volumes">Local Volumes</h4>
<div class="paragraph">
<p>Local Volumes (i.e. FileBlob type) can be hosted on any mountpoint on the system
regardless of the mountpoint&#8217;s destination and are defined by
the following properties:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Name:</strong> A unique identifier for the volume.</p>
</li>
<li>
<p><strong>Path:</strong> The path where the data is going to be saved. The <em>zimbra</em> user must have r/w permissions on this path.</p>
</li>
<li>
<p><strong>Compression:</strong> Enable or Disable file compression for the volume.</p>
</li>
<li>
<p><strong>Compression Threshold:</strong> the minimum file size that will trigger the compression.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Files under this size will never be compressed even if compression is enabled.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_current_volumes">Current Volumes</h4>
<div class="paragraph">
<p>A <em>Current Volume</em> is a volume where data will be written upon arrival (Primary Current) or HSM Policy Application (Secondary Current).
Volumes not set as Current won&#8217;t be written upon except by specific manual operations such as the Volume-to-Volume move.</p>
</div>
</div>
<div class="sect3">
<h4 id="bucket-setup">Bucket Setup</h4>
<div class="paragraph">
<p>HSM NG doesn&#8217;t need any dedicated setting or configuration on the S3
side, so setting up a bucket for your volumes is easy. Although creating
a dedicated user bucket and access policy are not required, they are strongly suggested because they make it much easier to manage.</p>
</div>
<div class="paragraph">
<p>All you need to start storing your secondary volumes on S3 is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An S3 bucket. You need to know the bucket&#8217;s name and region in order
to use it.</p>
</li>
<li>
<p>A user&#8217;s Access Key and Secret.</p>
</li>
<li>
<p>A policy that grants the user full rights on your bucket.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_bucket_management">Bucket Management</h5>
<div class="paragraph">
<p>A centralized Bucket Management UI is available in the Zimbra Administration Console.
This facilitates saving bucket information to be reused when creating a new volume
on an S3-compatible storage instead of entering the information each time.</p>
</div>
<div class="paragraph">
<p>To access the Bucket Management UI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Access the Zimbra Administration Console</p>
</li>
<li>
<p>Select the "Configure" entry on the left menu</p>
</li>
<li>
<p>Select the "Global Settings" entry</p>
</li>
<li>
<p>Select the S3 Buckets entry</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any bucket added to the system will be available when creating a new volume of
the following type: Amazon S3, Cloudian, EMC, Scality S3, Custom S3.</p>
</div>
</div>
<div class="sect4">
<h5 id="_bucket_paths_and_naming">Bucket paths and naming</h5>
<div class="paragraph">
<p>Files are stored in a bucket according to a well-defined path, which can be customized at will in order to make your bucket&#8217;s contents easier
to understand even on multi-server environments with multiple secondary volumes:</p>
</div>
<div class="paragraph">
<p><code>/Bucket Name/Destination Path/[Volume Prefix-]serverID/</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <strong>Bucket Name</strong> and <strong>Destination Path</strong> are not tied to the volume itself, and there can be as many volumes under the same
destination path as you wish.</p>
</li>
<li>
<p>The <strong>Volume Prefix</strong>, on the other hand, is specific to each volume and it&#8217;s a quick way to differentiate and recognize different
volumes within the bucket.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_creating_volumes_with_hsm_ng">Creating Volumes with HSM NG</h4>
<div class="paragraph">
<p>To create a new volume with HSM NG from the Zimbra Administration Console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter the HSM Section of the NG Administration Zimlet in the Zimbra Administration Console</p>
</li>
<li>
<p>Click on <em>Add</em> under either the <em>Primary Volumes</em> or <em>Secondary Volumes</em> list</p>
</li>
<li>
<p>Select the Volume Type among the available storage choices</p>
</li>
<li>
<p>Enter the required volume information</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Each volume type will require different information to be set up, please refer to your storage provider&#8217;s online resources to obtain
those details.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_editing_volumes_with_hsm_ng">Editing Volumes with HSM NG</h4>
<div class="paragraph">
<p>To edit a volume with HSM NG from the Zimbra Administration Console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter the HSM Section of the NG Administration Zimlet in the Zimbra Administration Console</p>
</li>
<li>
<p>Select a volume</p>
</li>
<li>
<p>Click on <em>Edit</em></p>
</li>
<li>
<p>When done, click <em>Save</em></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_deleting_volumes_with_hsm_ng">Deleting Volumes with HSM NG</h4>
<div class="paragraph">
<p>To delete a volume with HSM NG from the Zimbra Administration Console:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter the HSM Section of the NG Administration Zimlet in the Zimbra Administration Console</p>
</li>
<li>
<p>Select a volume</p>
</li>
<li>
<p>Click on <em>Delete</em></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Only empty volumes can be deleted.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="amazon-s3-tips">Amazon S3 Tips</h4>
<div class="sect4">
<h5 id="bucket">Bucket</h5>
<div class="paragraph">
<p>Storing your secondary Zimbra volumes on Amazon S3 doesn&#8217;t have any
specific bucket requirements, but we suggest that you create a dedicated
bucket and disable Static Website Hosting for easier management.</p>
</div>
</div>
<div class="sect4">
<h5 id="user">User</h5>
<div class="paragraph">
<p>To obtain an Access Key and the related Secret, a <code>Programmatic
Access</code> user is needed. We suggest that you create a dedicated user in Amazon&#8217;s
IAM Service for easier management.</p>
</div>
</div>
<div class="sect4">
<h5 id="rights-management">Rights Management</h5>
<div class="paragraph">
<p>In Amazon&#8217;s IAM, you can set access policies for your users. It&#8217;s
mandatory that the user of your Access Key and Secret has a set
of appropriate rights both on the bucket itself and on its contents.
For easier management, we recommend granting full rights as shown in the following example:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>{
    `Version`: `[LATEST API VERSION]`,
    `Statement`: [
        {
            `Sid`: `[AUTOMATICALLY GENERATED]`,
            `Effect`: `Allow`,
            `Action`: [
                `s3:*`
            ],
            `Resource`: [
                `[BUCKET ARN]/*`,
                `[BUCKET ARN]`
            ]
        }
    ]
}</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This is not a valid configuration policy. Don&#8217;t copy and paste it into your user&#8217;s settings as it won&#8217;t be validated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you only wish to grant minimal permissions, change the <code>Action</code>
section to:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Action": [
                `s3:PutObject`,
                `s3:GetObject`,
                `s3:DeleteObject`,
                `s3:AbortMultipartUpload`
              ],</pre>
</div>
</div>
<div class="paragraph">
<p>The bucket&#8217;s ARN is expressed according to Amazon&#8217;s standard naming
format: <strong>arn:partition:service:region:account-id:resource</strong>. For more
information about this topic, please see Amazon&#8217;s documentation.</p>
</div>
</div>
<div class="sect4">
<h5 id="bucket-paths-and-naming">Bucket Paths and Naming</h5>
<div class="paragraph">
<p>Files are stored in a bucket according to a well-defined path, which can
be customized at will to make your bucket&#8217;s contents easier to
understand (even on multi-server environments with multiple secondary
volumes):</p>
</div>
<div class="paragraph">
<p>/<strong>Bucket Name</strong>/<strong>Destination Path</strong>/<strong class="*Volume Prefix*-">serverID</strong>/</p>
</div>
<div class="paragraph">
<p>The <strong>Bucket Name</strong> and <strong>Destination Path</strong> are not tied to the volume
itself, and there can be as many volumes under the same destination path
as you wish.</p>
</div>
<div class="paragraph">
<p>The <strong>Volume Prefix</strong>, on the other hand, is specific to each volume and
it&#8217;s a quick way to differentiate and recognize different volumes within
the bucket.</p>
</div>
</div>
<div class="sect4">
<h5 id="infrequent-access-storage-class">Infrequent Access Storage Class</h5>
<div class="paragraph">
<p>HSM NG is compatible with the <code>Amazon S3 Standard - Infrequent access</code>
storage class and will set any file larger than the <code>Infrequent Access
Threshold</code> value to this storage class as long as the option has been enabled on the volume.</p>
</div>
<div class="paragraph">
<p>For more information about Infrequent Access, please refer to the
<a href="https://aws.amazon.com/s3/storage-classes">official Amazon S3
Documentation</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="intelligent-tiering-storage-class">Intelligent Tiering Storage Class</h5>
<div class="paragraph">
<p>HSM NG is compatible with the <code>Amazon S3 - Intelligent Tiering</code>
storage class and will set the appropriate Intelligent Tiering flag on all files, as long as the option has been enabled on the volume.</p>
</div>
<div class="paragraph">
<p>For more information about Intelligent Tiering, please refer to the
<a href="https://aws.amazon.com/about-aws/whats-new/2021/11/s3-intelligent-tiering/">official Amazon S3
Documentation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="item-deduplication">Item Deduplication</h3>
<div class="sect3">
<h4 id="what-is-item-deduplication">What is Item Deduplication</h4>
<div class="paragraph">
<p>Item deduplication is a technique that allows you to save disk space by
storing a single copy of an item and referencing it multiple times
instead of storing multiple copies of the same item and referencing each
copy only once.</p>
</div>
<div class="paragraph">
<p>This might seem like a minor improvement. However, in practical use, it
makes a significant difference.</p>
</div>
<div class="sect4">
<h5 id="item-deduplication-in-zimbra">Item Deduplication in Zimbra</h5>
<div class="paragraph">
<p>Item deduplication is performed by Zimbra at the moment of storing a new
item in the Current Primary Volume.</p>
</div>
<div class="paragraph">
<p>When a new item is being created, its <code>message ID</code> is compared to a list
of cached items. If there is a match, a hard link to the cached
message&#8217;s BLOB is created instead of a whole new BLOB for the message.</p>
</div>
<div class="paragraph">
<p>The dedupe cache is managed in Zimbra through the following config
attributes:</p>
</div>
<div class="paragraph">
<p><strong>zimbraPrefDedupeMessagesSentToSelf</strong></p>
</div>
<div class="paragraph">
<p>Used to set the deduplication behavior for sent-to-self messages.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;attr id="144" name="zimbraPrefDedupeMessagesSentToSelf" type="enum" value="dedupeNone,secondCopyifOnToOrCC,dedupeAll" cardinality="single"
optionalIn="account,cos" flags="accountInherited,domainAdminModifiable"&gt;
  &lt;defaultCOSValue&gt;dedupeNone&lt;/defaultCOSValue&gt;
  &lt;desc&gt;dedupeNone|secondCopyIfOnToOrCC|moveSentMessageToInbox|dedupeAll&lt;/desc&gt;
&lt;/attr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>zimbraMessageIdDedupeCacheSize</strong></p>
</div>
<div class="paragraph">
<p>Number of cached Message IDs.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;attr id="334" name="zimbraMessageIdDedupeCacheSize" type="integer" cardinality="single" optionalIn="globalConfig" min="0"&gt;
  &lt;globalConfigValue&gt;3000&lt;/globalConfigValue&gt;
  &lt;desc&gt;
    Number of Message-Id header values to keep in the LMTP dedupe cache.
    Subsequent attempts to deliver a message with a matching Message-Id
    to the same mailbox will be ignored.  A value of 0 disables deduping.
  &lt;/desc&gt;
&lt;/attr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>zimbraPrefMessageIdDedupingEnabled</strong></p>
</div>
<div class="paragraph">
<p>Manage deduplication at account or COS-level.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;attr id="1198" name="zimbraPrefMessageIdDedupingEnabled" type="boolean" cardinality="single" optionalIn="account,cos" flags="accountInherited"
 since="8.0.0"&gt;
  &lt;defaultCOSValue&gt;TRUE&lt;/defaultCOSValue&gt;
  &lt;desc&gt;
    Account-level switch that enables message deduping.  See zimbraMessageIdDedupeCacheSize for more details.
  &lt;/desc&gt;
&lt;/attr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p><strong>zimbraMessageIdDedupeCacheTimeout</strong></p>
</div>
<div class="paragraph">
<p>Timeout for each entry in the dedupe cache.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;attr id="1340" name="zimbraMessageIdDedupeCacheTimeout" type="duration" cardinality="single" optionalIn="globalConfig" since="7.1.4"&gt;
  &lt;globalConfigValue&gt;0&lt;/globalConfigValue&gt;
  &lt;desc&gt;
    Timeout for a Message-Id entry in the LMTP dedupe cache. A value of 0 indicates no timeout.
    zimbraMessageIdDedupeCacheSize limit is ignored when this is set to a non-zero value.
  &lt;/desc&gt;
&lt;/attr&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>(older Zimbra versions might use different attributes or lack some of
them)</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="item-deduplication-and-hsm-ng">Item Deduplication and HSM NG</h4>
<div class="paragraph">
<p>The HSM NG features a <code>doDeduplicate</code> operation that parses a
target volume to find and deduplicate any duplicated item.</p>
</div>
<div class="paragraph">
<p>Doing so you will save even more disk space, as while Zimbra&#8217;s automatic
deduplication is bound to a limited cache, HSM NG&#8217;s deduplication will also find and take care of multiple copies of the same email regardless
of any cache or timing.</p>
</div>
<div class="paragraph">
<p>Running the <code>doDeduplicate</code> operation is also highly suggested after a
migration or a large data import in order to optimize your storage
usage.</p>
</div>
<div class="sect4">
<h5 id="running-a-volume-deduplication">Running a Volume Deduplication</h5>

</div>
<div class="sect4">
<h5 id="dedupe-via-the-administration-zimlet">Via the Administration Zimlet</h5>
<div class="paragraph">
<p>To run a volume deduplication via the Administration Zimlet, simply click
on the <em>HSM NG</em> tab, select the volume you wish to deduplicate and press
the <em>Deduplicate</em> button.</p>
</div>
</div>
<div class="sect4">
<h5 id="dedupe-via-the-cli">Via the CLI</h5>
<div class="paragraph">
<p>To run a volume deduplication through the CLI, use the <code>doDeduplicate</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mailserver:~$ zxsuite hsm doDeduplicate

command doDeduplicate requires more parameters

Syntax:
   zxsuite hsm doDeduplicate {volume_name} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME              TYPE           EXPECTED VALUES    DEFAULT
volume_name(M)    String[,..]
dry_run(O)        Boolean        true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm dodeduplicate secondvolume
Starts a deduplication on volume secondvolume</pre>
</div>
</div>
<div class="paragraph">
<p>To list all available volumes, you can use the <em>`zxsuite hsm
getAllVolumes`</em> command.</p>
</div>
</div>
<div class="sect4">
<h5 id="dodeduplicate-stats"><code>doDeduplicate</code> Stats</h5>
<div class="paragraph">
<p>The <code>doDeduplicate</code> operation is a valid target for the <code>monitor</code>
command, meaning that you can watch the command&#8217;s statistics while it&#8217;s
running through the <code>zxsuite hsm monitor [operationID]</code> command.</p>
</div>
<div class="paragraph">
<p><em>Sample Output</em></p>
</div>
<div class="literalblock">
<div class="content">
<pre>Current Pass (Digest Prefix):  63/64
 Checked Mailboxes:             148/148
 Deduplicated/duplicated Blobs: 64868/137089
 Already Deduplicated Blobs:    71178
 Skipped Blobs:                 0
 Invalid Digests:               0
 Total Space Saved:             21.88 GB</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><em>Current Pass (Digest Prefix)</em>: The <code>doDeduplicate</code> command will
analyze the BLOBS in groups based on the first character of their digest
(name).</p>
</li>
<li>
<p><em>Checked Mailboxes</em>: The number of mailboxes analyzed for the current
pass.</p>
</li>
<li>
<p><em>Deduplicated/duplicated Blobs</em>: Number of BLOBS deduplicated by the
current operation / Number of total duplicated items on the volume.</p>
</li>
<li>
<p><em>Already Deduplicated Blobs</em>: Number of deduplicated blobs on the
volume (duplicated blobs that have been deduplicated by a previous run).</p>
</li>
<li>
<p><em>Skipped Blobs</em>: BLOBs that have not been analyzed, usually because
of a read error or missing file.</p>
</li>
<li>
<p><em>Invalid Digests</em>: BLOBs with a bad digest (name different from the
actual digest of the file).</p>
</li>
<li>
<p><em>Total Space Saved</em>: Amount of disk space freed by the doDeduplicate
operation.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Looking at the sample output above we can see that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The operation is running the second to last pass on the last mailbox.</p>
</li>
<li>
<p>137089 duplicated BLOBs have been found, 71178 of which have already
been deduplicated previously.</p>
</li>
<li>
<p>The current operation deduplicated 64868 BLOBs, for a total disk space
saving of 21.88GB.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-volume-operations">Advanced Volume Operations</h3>
<div class="sect3">
<h4 id="hsm-ng-more-than-meets-the-eye">HSM NG: More than Meets the Eye</h4>
<div class="paragraph">
<p>At first sight, HSM NG seems to be strictly dedicated
to HSM. However, it also features some highly useful volume-related tools that
are not directly related to HSM.</p>
</div>
<div class="paragraph">
<p>Due to the implicit risks in volume management, these tools are only
available through the CLI.</p>
</div>
</div>
<div class="sect3">
<h4 id="volume-operations-at-a-glance">Volume Operations at a Glance</h4>
<div class="paragraph">
<p>The following volume operations are available:</p>
</div>
<div class="paragraph">
<p><strong>doCheckBlobs</strong>: Perform BLOB coherency checks on one or more volumes.</p>
</div>
<div class="paragraph">
<p><strong>doDeduplicate</strong>: Start Item Deduplication on a volume.</p>
</div>
<div class="paragraph">
<p><strong>doVolumeToVolumeMove</strong>: Move all items from one volume to another.</p>
</div>
<div class="paragraph">
<p><strong>getVolumeStats</strong>: Display information about a volume&#8217;s size and number
of thereby contained items/blobs.</p>
</div>
</div>
<div class="sect3">
<h4 id="volume-operation-analysis">Volume Operation Analysis</h4>
<div class="sect4">
<h5 id="docheckblobs">doCheckBlobs</h5>
<div id="usage" class="paragraph">
<p>Usage</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite hsm doCheckBlobs

command doCheckBlobs requires more parameters

Syntax:
   zxsuite hsm doCheckBlobs {start} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME                           TYPE            EXPECTED VALUES    DEFAULT
action(M)                      String          start
volume_ids(O)                  Integer[,..]    1,3
mailbox_ids(O)                 Integer[,..]    2,9,27
missing_blobs_crosscheck(O)    Boolean         true|false         true
traced(O)                      Boolean         true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

Usage examples:
zxsuite hsm doCheckBlobs start: Perform a BLOB coherency check on all message volumes.

zxsuite hsm doCheckBlobs start volume_ids 1,3: Perform a BLOB coherency check on volumes 1 and 3.

zxsuite hsm doCheckBlobs start mailbox_ids 2,9,27: Perform a BLOB coherency check on mailboxes 2,9 and 27.

zxsuite hsm doCheckBlobs start missing_blobs_crosscheck false: Perform a BLOB coherency check without checking on other volumes.

zxsuite hsm doCheckBlobs start traced true: Perform a BLOB coherency check, logging even the correct checked items.</pre>
</div>
</div>
<div id="description-and-tips" class="paragraph">
<p>Description and Tips</p>
</div>
<div class="paragraph">
<p>The doCheckBlobs operation can be used to run BLOB coherency checks on
volumes and mailboxes. This can be useful when experiencing issues
related to broken or unviewable items, which are often caused because
either Zimbra cannot find or access the BLOB file
related to an item or there is an issue with the BLOB content itself.</p>
</div>
<div class="paragraph">
<p>Specifically, the following checks are made:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DB-to-BLOB coherency: For every Item entry in Zimbra&#8217;s DB, check
whether the appropriate BLOB file exists.</p>
</li>
<li>
<p>BLOB-to-DB coherency: For every BLOB file in a volume/mailbox, check
whether the appropriate DB data exists.</p>
</li>
<li>
<p>Filename coherency: Checks the coherency of each BLOB&#8217;s filename with
its content (as BLOBs are named after their file&#8217;s SHA hash).</p>
</li>
<li>
<p>Size coherency: For every BLOB file in a volume/mailbox, checks
whether the BLOB file&#8217;s size is coherent with the expected size (stored
in the DB).</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The old <code>zmblobchk</code> command is deprecated and replaced by <code>zxsuite hsm doCheckBlobs</code> on all infrastructures using HSM NG module.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="dodeduplicate">doDeduplicate</h5>
<div id="usage-1" class="paragraph">
<p>Usage</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite hsm doDeduplicate

command doDeduplicate requires more parameters

Syntax:
   zxsuite hsm doDeduplicate {volume_name} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME              TYPE           EXPECTED VALUES    DEFAULT
volume_name(M)    String[,..]
dry_run(O)        Boolean        true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm dodeduplicate secondvolume
Starts a deduplication on volume secondvolume</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="dovolumetovolumemove">doVolumeToVolumeMove</h5>
<div class="paragraph">
<p><strong>Usage</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite hsm doVolumeToVolumeMove

command doVolumeToVolumeMove requires more parameters

Syntax:
   zxsuite hsm doVolumeToVolumeMove {source_volume_name} {destination_volume_name}

PARAMETER LIST

NAME                          TYPE
source_volume_name(M)         String
destination_volume_name(M)    String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doVolumeToVolumeMove sourceVolume destVolume
Moves the whole sourceVolume to destVolume</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Description and Tips</strong></p>
</div>
<div class="paragraph">
<p>This command can prove highly useful in all situations
where you need to stop using a volume, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Decommissioning old hardware: If you want to get rid of an old disk
in a physical server, create new volumes on other/newer disks and
move your data there.</p>
</li>
<li>
<p>Fixing <em>little mistakes</em>: If you accidentally create a new volume in the wrong place, move the
data to another volume.</p>
</li>
<li>
<p>Centralize volumes: Centralize and move volumes as you
please, for example, if you redesigned your storage
infrastructure or you are tidying up your Zimbra
volumes.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="getvolumestats">getVolumeStats</h5>
<div class="paragraph">
<p><strong>Usage</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mail:~$ zxsuite hsm getVolumeStats

command getVolumeStats requires more parameters

Syntax:
   zxsuite hsm getVolumeStats {volume_id} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME                   TYPE       EXPECTED VALUES    DEFAULT
volume_id(M)           Integer
show_volume_size(O)    Boolean    true|false         false
show_blob_num(O)       Boolean    true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

**BE CAREFUL** show_volume_size and show_blob_num options are IO intensive and thus disabled by default

zxsuite hsm getVolumeStats 2
Shows stats for the volume with ID equal to 2</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Description and Tips</strong></p>
</div>
<div class="paragraph">
<p>This command provides the following information about a volume:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ID of the volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Name of the volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Path of the volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compressed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compression enabled/disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threshold</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compression threshold (in bytes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastMoveOutcome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exit status of the latest doMoveBlobs operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastMoveTimestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">End timestamp of the latest doMoveBlobs operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastMoveDuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Duration of the last doMoveBlobs operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastItemMovedCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of items moved to the current secondary
volume during the latest doMoveBlobs operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytesSaved</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total amount of disk space freed up thanks to deduplication
and compression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bytesSavedLast</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amount of disk space freed up thanks to deduplication
and compression during the latest doMoveBlobs operation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>show_volume_size</code> and <code>show_blob_num</code> options will add the
following data to the output:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">option</th>
<th class="tableblock halign-left valign-top">name</th>
<th class="tableblock halign-left valign-top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_volume_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">totSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total disk space used up by the volume</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">show_blob_num</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blobNumber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of BLOB files in the volume</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_moving_mailboxes_between_mailstores">Moving Mailboxes Between Mailstores</h3>
<div class="paragraph">
<p>The <code>doMailboxMove</code> command allows you to move a single mailbox or all accounts
from a given domain, from one mailbox server to another within the same
Zimbra infrastructure.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If the HSM NG module is installed and enabled, this command replaces the old <code>zmmboxmove</code> and <code>zmmailboxmove</code> commands. Using any of the legacy commands will return an error and won&#8217;t move any data.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Syntax</strong></p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite hsm doMailboxMove {destinationHost} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME                           TYPE             EXPECTED VALUES                                      DEFAULT
destinationHost(M)             String
accounts(O)                    String[,..]      john@example.com,smith@example.com[,...]
domains(O)                     String[,..]      example.com,test.com[,...]
input_file(O)                  String
stages(O)                      String[,..]      blobs|backup|data|account data=blobs+backup[,...]    blobs,backup,account
compress(O)                    Boolean          true|false                                           true
checkDigest(O)                 Boolean          if false skip digest calculation and check           false
overwrite(O)                   Boolean          true|false                                           true
threads(O)                     Integer                                                               1
hsm(O)                         Boolean          true|false                                           false
notifications(O)               Email Address
ignore_partial(O)              Boolean          true|false                                           false
drop_network_backup(O)         Boolean          true|false                                           false
read_error_threshold(O)        Integer
blob_destination_volume(O)     String           current_primary|current_secondary|6                  current_primary
drive_destination_volume(O)    String           drive_primary|drive_secondary|same_as_blob|7         same_as_blob

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite hsm doMailboxMove mail2.example.com accounts john@example.com stages data,account
Move mailbox for account john@example.com to mail2.example.com host</pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 60. Parameter List</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">destinationHost(M)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host where the mailbox must be moved to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">accounts(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of mailbox(es) to move. Can be combined with the "domains" option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domains(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of domain(s) to move. Can be combined with the "accounts" option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">input_file(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File containing the list of mailboxes to move, one per line.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stages(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The stages of the move to perform among blobs, backup, data, account. The "Data" stage will move both blobs and backup, while the "account" stage will effectively move the mailbox information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compress(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to compress the moved blobs on the destination host or not.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">checkDigest(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to check item digests during the move or not. Safer but slower.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overwrite(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to overwrite previously moved items for the same mailbox.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threads(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of threads to use for the move. Higher threads mean faster moves but with more impact on the system&#8217;s performances.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hsm(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to apply the HSM policies on the destination host when moving the blobs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">notifications(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of email addresses to notify about the outcome of the operation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignore_partial(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignore previous move attempts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">drop_network_backup(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete Legacy Backup data during the move</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read_error_threshold(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum amount of read I/O errors to allow before stopping the operation.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>doMailboxMove Details</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>When moving a domain, each account from the current server is enumerated and moved
sequentially.</p>
</li>
<li>
<p>The mailbox is set to maintenance mode only during the 'account' stage.</p>
</li>
<li>
<p>The move will be stopped if 5% or more write errors are encountered on items being moved.</p>
<div class="ulist">
<ul>
<li>
<p>When multiple mailboxes are moved within the same operation, the error count is global and not per-mailbox.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Moves will not start if the destination server does not have
enough space available to host the mailbox.</p>
<div class="ulist">
<ul>
<li>
<p>When a single operation is used to move multiple mailboxes, the space check will be performed before moving each mailbox.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All data is moved at a low-level and will not be changed except for the mailbox id.</p>
</li>
<li>
<p>The operation is made up of 3 stages: blobs|backup|account. For each mailbox:</p>
<div class="ulist">
<ul>
<li>
<p>blobs: All blobs are copied from the source server to the destination server.</p>
</li>
<li>
<p>backup: All backup entries are copied from the source server to the destination server.</p>
</li>
<li>
<p>account: All database entries are moved as-is and LDAP entries are updated, effectively moving the mailbox.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All of the stages are executed sequentially.</p>
</li>
<li>
<p>On the reindex stage&#8217;s completion, a new HSM operation is submitted to the
destination server, if not specified otherwise.</p>
</li>
<li>
<p>All volumes' compression options are taken.</p>
</li>
<li>
<p>The MailboxMove operation can be executed if and only if no others operations
are running on the source server.</p>
</li>
<li>
<p>A move will not start if the destination server does not have enough space available or the user just belongs to the destination host.</p>
</li>
<li>
<p>By default, items are placed in the Current Primary volume of the destination server.</p>
<div class="ulist">
<ul>
<li>
<p>The <code>hsm true</code> option can be used to apply the HSM policies of the destination server after a mailbox is
successfully moved.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If, for any reason, the move stops before it is completed the original account will still be active and the appropriate notificaton will be issued.</p>
</li>
<li>
<p>Should the mailboxd crash during move, the "Operation Interrupted" notification is issued as for all operations, warning the users about the interrupted operation.</p>
</li>
<li>
<p>Index information are moved during the 'account' stage, so no manual reindexing is needed nor one will be triggered automatically.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="hsm-ng-attachment-indexing">HSM NG Attachment Indexing</h3>
<div class="sect3">
<h4 id="how-indexing-works">How Indexing Works</h4>
<div class="paragraph">
<p>A new indexing engine has been added to HSM NG to index attachment contents.</p>
</div>
<div class="paragraph">
<p>The indexing engine works together with Zimbra&#8217;s default engine. The main Zimbra indexing process analyzes the contents of an item, splitting it into several parts
based on the MIME parts of the object. Next, Zimbra handles the indexing of
<em>known</em> contents - plaintext - and passes the datastream on to the
HSM NG handlers for all other content.</p>
</div>
<div class="paragraph">
<p>The indexing engine includes an indexing cache that speeds up the indexing process of
any content that has already been analyzed. Datastreams over 10Kb are
cached by default, and the cache hold 10000 entries, while smaller
datastreams are not cached as the cache benefits only apply to large
datastreams.</p>
</div>
</div>
<div class="sect3">
<h4 id="indexed-formats">Indexed Formats</h4>
<div class="sect4">
<h5 id="web">Web</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Parser</th>
<th class="tableblock halign-left valign-top">Content-type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>asp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HtmlParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-asp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>htm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HtmlParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/xhtml+xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>html</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HtmlParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/xhtml+xml, text/html</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>shtml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HtmlParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/xhtml+xml</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xhtml</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HtmlParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/xhtml+xml</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="documents">Documents</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Parser</th>
<th class="tableblock halign-left valign-top">Content-type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rtf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTFParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/rtf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pdf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PDFParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/pdf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pub</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-mspublisher</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xls</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-excel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xlt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-excel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xlw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-excel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ppt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-powerpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pps</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-powerpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mpp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-project</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>doc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/msword</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dot</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/msword</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-outlook</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vsd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.visio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vst</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.visio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vss</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.visio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vsw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OfficeParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.visio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xlsm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-excel.sheet.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pptm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-powerpoint.presentation.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xltx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.openxmlformats-officedocument.spreadsheetml.template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.openxmlformats-officedocument.wordprocessingml.document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>potx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.openxmlformats-officedocument.presentationml.template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xlsx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pptx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.openxmlformats-officedocument.presentationml.presentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xlam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-excel.addin.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>docm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-word.document.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xltm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-excel.template.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dotx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.openxmlformats-officedocument.wordprocessingml.template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ppsm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-powerpoint.slideshow.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ppam</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-powerpoint.addin.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dotm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.ms-word.template.macroenabled.12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ppsx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OOXMLParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.openxmlformats-officedocument.presentationml.slideshow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>odt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ods</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.spreadsheet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>odp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.presentation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>odg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.graphics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>odc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.chart</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>odf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.formula</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>odi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.image</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>odm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.text-master</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ott</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.text-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ots</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.spreadsheet-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>otp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.presentation-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>otg</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.graphics-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>otc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.chart-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>otf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.formula-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oti</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.image-template</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>oth</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.oasis.opendocument.text-web</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sxw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OpenDocumentParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/vnd.sun.xml.writer</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="packages-and-archives">Packages and Archives</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Extension</th>
<th class="tableblock halign-left valign-top">Parser</th>
<th class="tableblock halign-left valign-top">Content-Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-compress</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-bzip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>boz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-bzip2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bz2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-bzip2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/gzip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-gzip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gzip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-gzip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompressorParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-xz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-tar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/java-archive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-7z-compressed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cpio</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-cpio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PackageParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/zip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RarParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">application/x-rar-compressed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>txt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TXTParser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text/plain</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="parser-controls">Parser Controls</h4>
<div class="paragraph">
<p>Parsers can be turned on or off by changing the related value to <code>true</code>
or <code>false</code> via the <code>zxsuite config</code> CLI command.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Parsers</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pdfParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDFParser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">odfParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenDocumentParser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">archivesParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CompressorParser, PackageParser, RarParser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">microsoftParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OfficeParser, OOXMLParser, OldExcelParser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rtfParsingEnabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RTFParser</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>e.g. to disable PDF parsing run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite config server set server.domain.com attribute pdfParsingEnabled value false</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, all parsers are active.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_abq_service">ABQ Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The "Allow/Block/Quarantine" feature allows for granular access control of mobile devices connecting to the server. It&#8217;s a "pre-emptive" type
of security feature, meaning that it acts upon the first connection to the server and it&#8217;s made to ensure that only authorized devices can
finalize synchronization with server. This allows a full administrator to keep track of all mobile device used in their network.
Presently only CLI tools are provided; a web GUI will be released in the future.</p>
</div>
<div class="sect2">
<h3 id="_components">Components</h3>
<div class="paragraph">
<p>The ABQ feature is composed of three main logical components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a Device Control List</p>
</li>
<li>
<p>an Authorization Engine</p>
</li>
<li>
<p>a set of CLI tools</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_device_control_list">Device Control List</h4>
<div class="paragraph">
<p>The Device Control List, also known as the "ABQ List", holds the information about allowed devices within the NG config engine.
Devices can be added to the Device Control List via CLI based on their “Device ID” which can be obtained via CLI.</p>
</div>
<div class="paragraph">
<p>It is also possible to further limit access by limiting the accounts that can synchronise with the server on a specific device.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On module startup, if the Device Control List is empty all mobile devices previously recognized by the
Zimbra server will be imported as <strong>Allowed</strong>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_authorization_engine">Authorization Engine</h4>
<div class="paragraph">
<p>The Authorization Engine takes care of checking devices against the Device Control List and setting their ABQ status to the appropriate
value.</p>
</div>
<div class="paragraph">
<p>Each rule is applied to all accounts connecting using a device it is a device id. It applies to a specific account connecting using that device if it has the format device_id/account_id or device_id/accountName</p>
</div>
</div>
<div class="sect3">
<h4 id="_cli_toolset">CLI Toolset.</h4>
<div class="paragraph">
<p>The CLI Toolset allows administrators to interact with the device control list and with the synchronization status of a device, specifically to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Display the Device Control List</p>
</li>
<li>
<p>Display all Quarantined and Blocked Devices</p>
</li>
<li>
<p>Add one or more devices to the Device Control List</p>
</li>
<li>
<p>Move a device from “Quarantine” to “Allowed” or “Blocked”</p>
</li>
<li>
<p>Change the synchronization status of a device</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Every time the administrator changes a device&#8217;s status in an ABQ-enabled environment,
depending on the issued state the device will be forced to re-sync folders with the server
resulting in an immediate re-route to either a <a href="#_dummy_data"><em>dummy virtual mailbox</em></a> that will explain to the user what&#8217;s happened,
or to the real mailbox to perform the re-sync.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_abq_modes">ABQ Modes</h3>
<div class="paragraph">
<p>The ABQ feature is triggered for every mobile device that tries to synchronize with server, and can be set to one of four possible modes:
"Permissive", "Interactive", "Strict” and "Disabled". This attribute is Global for all the cluster.</p>
</div>
<div class="sect3">
<h4 id="_permissive_mode">"Permissive" mode:</h4>
<div class="paragraph">
<p>The Authorization Engine is not active, so after authenticating the user and checking their account status for safety reasons, the
synchronization will continue. It is still possible to block specific devices but non-blocked devices will always be allowed to sync.</p>
</div>
</div>
<div class="sect3">
<h4 id="_interactive_mode">"Interactive" mode:</h4>
<div class="paragraph">
<p>After authenticating the user and checking their account status for safety reasons, the Device Control system will check the "Device ID"
sent by the device against the list of allowed devices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the device/user couple is in the "allowed" list the synchronization will continue.</p>
</li>
<li>
<p>if the device/user couple is not in the device list but device is in the "allowed" list the synchronization will continue.</p>
</li>
<li>
<p>if the device is not in the “allowed” list the synchronization will be paused, a dummy email notifying the user of its
"Quarantine" status will be sent and the connection will be set to "Quarantine" status.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Administrators can be notified at regular intervals, and every notification email will only include new Quarantined devices.
They will then be able to allow or deny the synchronization for each device using the appropriate CLI tools.</p>
</div>
</div>
<div class="sect3">
<h4 id="_strict_mode">"Strict" mode:</h4>
<div class="paragraph">
<p>After authenticating the user and checking their account status for safety reasons, the Device Control system will check the "Device ID"
sent by the device against the list of allowed devices:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>if the device/user couple or the device by itself is in the "allowed" list the synchronization will continue.</p>
</li>
<li>
<p>if the device is not in the “allowed” list the synchronization will be put in "Blocked" state, no data will be synchronized and a
dummy email notifying the user of the device&#8217;s "Blocked" status will be sent.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_disabled_mode">"Disabled" mode:</h4>
<div class="paragraph">
<p>ABQ is disabled, no checks are triggered and no policies are enforced.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_abq_mode_control">ABQ Mode Control</h3>
<div class="paragraph">
<p>The current mode can be checked by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite config global get attribute abqMode</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ABQ mode can be changed running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite config global set attribute abqMode value [Permissive|Interactive|Strict|Disabled]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dummy_data">Dummy data</h3>
<div class="paragraph">
<p>The feature makes use of “Dummy emails” and a “Dummy mailbox” to put devices on hold while waiting for authorization (Interactive Mode)
or to notify their “Blocked” status (Permissive Mode, Interactive Mode and Strict Mode).</p>
</div>
<div class="paragraph">
<p>The Dummy Mailbox is a virtual mailbox consisting of only an “Inbox” folder that will be synchronized to the device while this is in either
Quarantine or Block status. Dummy Emails are predefined email messages that are synchronized to a device in Quarantine or Block status to
alert the user. For now these messages aren&#8217;t customizable, and will be localized in the future. Whenever the ABQ status of a device is
changed, the device&#8217;s sync state will be reset.</p>
</div>
<div class="paragraph">
<p>This was designed to make sure the user knows what’s happening, the alternative being forcing the synchronization to fail with no descriptive
response for the user itself – which would likely cause a significant overhead on support calls.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_abq_emails">Custom ABQ emails</h3>
<div class="paragraph">
<p>Quarantine and block dummy emails can be customized by using the <code>zxsuite mobile setABQMessage</code> message command.</p>
</div>
<div class="paragraph">
<p>Messages can be customized globally or by domain, and multiple languages can be set.</p>
</div>
<div class="paragraph">
<p>The <code>zxsuite mobile setABQMessage</code> command accepts the following parameters:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Value</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">configLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global,domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">only if config != global</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">messageClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blocked,quarantined</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">language</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">locale (e.g. "en-us")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">from</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin Address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reply_to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">subject</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Built-in default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">body_plain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Built-in default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">body_plain_file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the file to use as plain text body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">body_html</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Built-in default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">body_html_file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the file to use as html body</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<div class="title">Setup Example</div>
<p>Given two files, <code>/tmp/quarantine_body.txt</code> and <code>/tmp/quarantine_body.html</code> containing the French language plaintext and html message bodies and the <code>support@domain.com</code> support email address, the following command will set the quarantine message for the <code>domain.com</code> domain without affecting other domains or users:</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile setABQMessage domain domain.com quarantined fr from <a href="mailto:support@domain.com">support@domain.com</a> body_plain_file /tmp/quarantine_body.txt body_html_file /tmp/quarantine_body.html</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Before being able to customize the ABQ messages, a default must be set using <code>default</code> as the language in the command, e.g.<br>
<br>
<code>zxsuite mobile setABQMessage global quarantined default [&#8230;&#8203;]</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_notifications">Notifications</h3>
<div class="paragraph">
<p>Administrators can be notified via email of quarantined devices at a specific interval defined by the <code>abqNotificationsInterval</code> NG
configuration attribute, expressed in milliseconds:</p>
</div>
<div class="paragraph">
<p>The interval can be checked by running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite config global get attribute abqNotificationsInterval</code></pre>
</div>
</div>
<div class="paragraph">
<p>The interval can be changed running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite config global set attribute abqNotificationsInterval value [delay in milliseconds]</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>abqNotificationsInterval</code> is set to 0 - meaning that no notifications will be delivered.</p>
</div>
<div class="sect3">
<h4 id="_abq_service_status">ABQ Service Status</h4>
<div class="paragraph">
<p>The ABQ service status can be checked running the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite mobile getServices</code></pre>
</div>
</div>
<div class="paragraph">
<p>The service can be stopped or started using the default service control of the Mobile NG module:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite mobile doStartService abq
zxsuite mobile doStopService abq</code></pre>
</div>
</div>
<div class="paragraph">
<p>When mode is Disabled ABQ service won&#8217;t automatically start and devices are always allowed to sync.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_abq_cli">ABQ CLI</h3>
<div class="paragraph">
<p>A list of all ABQ CLI commands can be displayed running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zxsuite mobile abq

Allow/Block/Quarantine mobile devices management

    list                    - List devices.
                              zxsuite mobile ABQ list [attr1 value1 [attr2 value2...] ]

    add                     - add/import devices
                              zxsuite mobile ABQ add [attr1 value1 [attr2 value2...] ]

    allow                   - Allow synchronization for a quarantined device
                              zxsuite mobile ABQ allow {device_id}

    block                   - Deny synchronization for a quarantined device
                              zxsuite mobile ABQ block {device_id}

    set                     - Set synchronization status for a device
                              zxsuite mobile ABQ set {device_id} {Allowed|Blocked|Quarantined}

    delete                  - Delete device from ABQ
                              zxsuite mobile ABQ delete {device_id}

    setNotificationInterval - Set the notification interval for new quarantined devices
                              zxsuite mobile ABQ setNotificationInterval {45m|6h|1d|0}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_abq_list_command">ABQ "list" Command</h4>
<div class="paragraph">
<p>List all devices ABQ status. The "status" argument will filter the list in order to only show devices in that specific status.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zxsuite mobile abq list
List devices.

Syntax:
   zxsuite mobile ABQ list [attr1 value1 [attr2 value2...] ]


PARAMETER LIST

NAME        TYPE    EXPECTED VALUES
status(O)   String  Allowed|Blocked|Quarantined

(M) == mandatory parameter, (O) == optional parameter</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[zimbra@mail ~]$ zxsuite mobile abq list

        devices

                device_id   androidc133785981
                status      Quarantined

                device_id   androidc1024711770
                status      Blocked

                device_id   SAMSUNG1239862958
                status      Allowed</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abq_import_command">ABQ "import" Command</h4>
<div class="paragraph">
<p>This command imports a list of device ids from a file, and always requires two parameters:
an Input File with a list of Device IDs separated by a newline and the "status" the imported device(s) will be set to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[zimbra@mail ~]$ zxsuite mobile abq import
command import requires more parameters

Syntax:
    zxsuite mobile ABQ import {Path to file} {Allowed|Blocked|Quarantined}

PARAMETER LIST

NAME            TYPE        EXPECTED VALUES
input_file(M)   String      Path to file
status(M)       String      Allowed|Blocked|Quarantined

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite mobile ABQ import /path/to/file Allowed</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">[zimbra@mail ~]$ zxsuite mobile abq import /tmp/list Allowed
3 devices added

[zimbra@mail ~]$ cat /tmp/list
androidc133785981
androidc1024711770
SAMSUNG1239862958/user@domain.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above, devices <code>androidc133785981</code> and <code>androidc1024711770</code> are allowed to sync entirely regardless of the account, while device <code>SAMSUNG1239862958</code> can only synchronize the <code>user@domain.com</code> account</p>
</div>
</div>
<div class="sect3">
<h4 id="_abq_allow_command">ABQ "allow" Command</h4>
<div class="paragraph">
<p>This is a specific command for quarantined device, and sets device status to <strong>Allowed</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zxsuite mobile abq allow
Allow synchronization for a quarantined device

Syntax:
   zxsuite mobile ABQ allow {device_id} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME            TYPE      EXPECTED VALUES
device_id(M)    String
account(O)      String    27ee8dd9-d813-4ca7-a988-580df0027a58|user1@example.com


(M) == mandatory parameter, (O) == optional parameter</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abq_block_command">ABQ "block" Command</h4>
<div class="paragraph">
<p>This is a specific command for quarantined device, and sets device status to <strong>Blocked</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zxsuite mobile abq block
Deny synchronization for a quarantined device

Syntax:
   zxsuite mobile ABQ block {device_id} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME            TYPE      EXPECTED VALUES
device_id(M)    String
account(O)      String    27ee8dd9-d813-4ca7-a988-580df0027a58|user1@example.com

(M) == mandatory parameter, (O) == optional parameter</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abq_set_command">ABQ "set" Command</h4>
<div class="paragraph">
<p>Set any status for any single device (either known or unknown).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zxsuite mobile abq set
Set synchronization status for a device

Syntax:
   zxsuite mobile ABQ set {device_id} {Allowed|Blocked|Quarantined} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME            TYPE      EXPECTED VALUES
device_id(M)    String
status(M)       String    Allowed|Blocked|Quarantined
account(O)      String    27ee8dd9-d813-4ca7-a988-580df0027a58|user1@example.com

(M) == mandatory parameter, (O) == optional parameter</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abq_delete_command">ABQ "delete" Command</h4>
<div class="paragraph">
<p>Delete a device from all lists.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zxsuite help mobile abq delete
Delete device from ABQ

Syntax:
   zxsuite mobile ABQ delete {device_id} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME            TYPE      EXPECTED VALUES
device_id(M)    String
account(O)      String    27ee8dd9-d813-4ca7-a988-580df0027a58|user1@example.com

(M) == mandatory parameter, (O) == optional parameter</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_abq_setnotificationinterval_command">ABQ "setNotificationInterval" Command</h4>
<div class="paragraph">
<p>Set notification interval for new quarantined devices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zxsuite mobile abq setNotificationInterval
command setNotificationInterval requires more parameters

Syntax:
    zxsuite mobile ABQ setNotificationInterval {45m|6h|1d}

PARAMETER LIST

NAME            TYPE        EXPECTED VALUES
interval(M)     String      45m|6h|1d

(M) == mandatory parameter, (O) == optional parameter

Usage example:

Set notification of new quarantined devices every 45 minutes
    zxsuite mobile abq setNotificationInterval 45m
Set notification of new quarantined devices every 6 hours
    zxsuite mobile abq setNotificationInterval 6h
Set notification of new quarantined devices once every day
    zxsuite mobile abq setNotificationInterval 1d
Disable notifications of new quarantined devices
    zxsuite mobile abq setNotificationInterval 0</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="admin-ng-guide">Admin NG</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="delegated-admin-provisioning">Delegated Admin Provisioning</h3>
<div class="sect3">
<h4 id="what-is-delegated-admin-provisioning">What is Delegated Admin Provisioning?</h4>
<div class="paragraph">
<p>Delegated Admin Provisioning is the set of operations that allow you to
grant, edit and revoke Domain Admin rights to a user.</p>
</div>
<div class="paragraph">
<p>All Delegated Admin Provisioning operations can be performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>From the Admin NG tab of the Administration Zimlet</p>
</li>
<li>
<p>From the CLI, running the appropriate <em>zxsuite</em> command as the
<em>zimbra</em> user</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="granting-delegated-admin-rights-to-a-user">Granting Delegated Admin Rights to a User</h4>
<div class="sect4">
<h5 id="add-da-from-the-administration-zimlet">From the Administration Zimlet</h5>
<div class="paragraph">
<p>In the <code>Delegated Admins</code> section of the Admin NG tab in the
Administration Zimlet, click the <code>Add</code> button.</p>
</div>
<div class="paragraph">
<p>You will be prompted for the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Account: The email address to which you want to grant Delegated Admin rights.</p>
</li>
<li>
<p>Domain: The domain on which the Delegated Admin will have control.</p>
</li>
<li>
<p>Delegated Auth: Check this box to allow the Delegated Admin to use the
<code>View Mail</code> features on any mailbox in the selected domain.</p>
</li>
<li>
<p>Grant Limit: The maximum mailbox quota this Delegated Admin can assign to a
user.</p>
</li>
<li>
<p>Edit Features: Defines whether the Delegated Admin is able to edit the
contents of the <code>Features</code> tab for its assigned users.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If the <code>Domain Quota</code> is lower than the <code>Grant Limit</code>, the
<code>Grant Limit</code> value will be ignored.<br>
Disk space and Quota limits can be entered in Gigabytes (gb), Megabytes
(mb) or Kilobytes (kb).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="add-dafrom-the-cli">From the CLI</h5>
<div class="paragraph">
<p>To grant Delegated Admin rights to a user, use the <code>doAddDelegationSettings</code>
command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite admin doAddDelegationSettings {account} {domain} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME               TYPE       EXPECTED VALUES    DEFAULT
account(M)         String
domain(M)          String
viewMail(O)        Boolean    true|false         false
editFeatures(O)    Boolean    true|false         false
adminQuota(O)      String                        -1

(M) == mandatory parameter, (O) == optional parameter

Usage example:


zxsuite admin doAddDelegationSettings john@example.com example.com viewMail true adminQuota -1
Adds John as delegated administrator of domain example.com, with the right to view user mail on such domain and
no right to grant quotas to users.

zxsuite admin doAddDelegationSettings john@example.com example.com adminQuota 0
Adds John as delegated administrator of domain example.com, with the right to assign unlimited quotas to users.

zxsuite admin doAddDelegationSettings john@example.com example.com adminQuota 10gb
Adds John as delegated administrator of domain example.com, with the right to assign quotas up to 10gb to each user.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="editing-the-rights-of-an-existing-delegated-admin">Editing the Rights of an Existing Delegated Admin</h4>
<div class="sect4">
<h5 id="edit-da-from-the-administration-zimlet-1">From the Administration Zimlet</h5>
<div class="paragraph">
<p>In the <code>Delegated Admins</code> section of the Admin NG tab in the
Administration Zimlet, select an entry in the list and click the <code>Edit</code>
button.</p>
</div>
<div class="paragraph">
<p>You can also double click an entry on the list to edit it.</p>
</div>
</div>
<div class="sect4">
<h5 id="edit-da-from-the-cli-1">From the CLI</h5>
<div class="paragraph">
<p>To edit the rights of an existing Delegated Admin, use the
<code>doEditDelegationSettings</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite admin doEditDelegationSettings {account} {domain} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME               TYPE       EXPECTED VALUES
account(M)         String
domain(M)          String
viewMail(O)        Boolean    true|false
editFeatures(O)    Boolean    true|false
adminQuota(O)      String

(M) == mandatory parameter, (O) == optional parameter

Usage example:


zxsuite admin doEditDelegationSettings john@example.com example.com viewMail true adminQuota -1
Edits John's delegation rights for domain example.com, with the right to view user mail on such domain and
no right to grand quotas to users.

zxsuite admin doEditDelegationSettings john@example.com example.com adminQuota 0
Edits John's delegation rights for domain example.com, with the right to assign unlimited quotas to users.

zxsuite admin doEditDelegationSettings john@example.com example.com adminQuota 10gb
Edits John's delegation rights for domain example.com, with the right to assign quotas up to 10gb to each user.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="revoke-delegated-admin-rights-from-a-user">Revoke Delegated Admin Rights from a User</h4>
<div class="sect4">
<h5 id="from-the-administration-zimlet-2">From the Administration Zimlet</h5>
<div class="paragraph">
<p>In the <code>Delegated Admins</code> section of the Admin NG Tab in the
Administration Zimlet, select an entry in the list and click the <code>Delete</code>
button.</p>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-2">From the CLI</h5>
<div class="paragraph">
<p>To revoke Delegated Admin rights from a user, use the
<code>doRemoveDelegationSettings</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite admin doRemoveDelegationSettings {account} {domain}

PARAMETER LIST

NAME          TYPE
account(M)    String
domain(M)     String

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite admin doRemoveDelegationSettings john@example.com example.com
John no longer administers domain example.com</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="quota-management">Quota Management</h3>
<div class="sect3">
<h4 id="what-is-quota-management">What is Quota Management?</h4>
<div class="paragraph">
<p>Admin NG allows the Global Administrator to set two different types of
quota limits: the <code>Grant Limit</code> and the <code>Domain Quota</code>.</p>
</div>
<div class="paragraph">
<p>Neither the <code>Domain Quota</code> nor the <code>Grant Limit</code> are mandatory, meaning
that a Delegated Admin can be allowed to grant any quota to a user and
that a domain can lack a maximum quota limit.</p>
</div>
<div class="sect4">
<h5 id="the-grant-limit">The <code>Grant Limit</code></h5>
<div class="paragraph">
<p>The <code>Grant Limit</code> is one of the properties of a Delegated Admin.</p>
</div>
<div class="paragraph">
<p>It specifies the maximum mailbox quota that the Delegated Admin can grant to a
mailbox and can be set and changed in the Delegated Admin&#8217;s settings.</p>
</div>
<div class="paragraph">
<p>Three options are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>None: The Delegated Admin cannot edit the Quota attribute of a
mailbox.</p>
</li>
<li>
<p>Custom: The Delegated Admin can grant up to the specified value. This
overrides any domain/COS quota setting.</p>
</li>
<li>
<p>Unlimited: The Delegated Admin can grant any quota to the mailbox.
This overrides any domain/COS quota setting.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="the-domain-quota">The <code>Domain Quota</code></h5>
<div class="paragraph">
<p>The <code>Domain Quota</code> is a property that specifies the maximum mailbox quota that
<strong>any Administrator</strong> can
grant to a mailbox in the domain.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Assigning an unlimited quota to a mailbox will override the
Domain Quota setting.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="grant-limit-vs-domain-quota"><code>Grant Limit</code> vs <code>Domain Quota</code></h4>
<div class="paragraph">
<p>The <code>Grant Limit</code> and <code>Domain Quota</code> properties are mutually exclusive
on a restrictive basis.</p>
</div>
<div class="paragraph">
<p>This means that the following scenarios may occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Global Admin grants a user a higher quota than the allowed Domain
Quota</p>
</li>
<li>
<p>A Delegated Admin grants a user a higher quota than the allowed Domain
Quota</p>
</li>
<li>
<p>A Delegated Admin&#8217;s Grant Limit is lower than the Domain Quota</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Let&#8217;s examine these scenario one by one.</p>
</div>
<div class="sect4">
<h5 id="a-global-admin-grants-a-user-a-higher-quota-than-the-allowed-domain-quota">A Global Admin grants a user a higher quota than the allowed Domain Quota</h5>
<div class="paragraph">
<p>Since the Domain Quota applies to a given domain, not to a given Admin,
the effective quota for the user will be the maximum quota allowed by
the <code>Domain Quota</code> setting.</p>
</div>
</div>
<div class="sect4">
<h5 id="a-delegated-admin-grants-a-user-a-higher-quota-than-the-allowed-domain-quota">A Delegated Admin grants a user a higher quota than the allowed Domain Quota</h5>
<div class="paragraph">
<p>In this case, the effective quota for the user will be the maximum quota
allowed by the <code>Domain Quota</code> setting, even if the Delegated Admin&#8217;s
Grant Limit is higher than the Domain Quota.</p>
</div>
</div>
<div class="sect4">
<h5 id="a-delegated-admins-grant-limit-is-lower-than-the-domain-quota">A Delegated Admin&#8217;s Grant Limit is lower than the Domain Quota</h5>
<div class="paragraph">
<p>In this case, the maximum quota that the Delegated Admin can grant to a
user will be the one defined by the Grant Limit, even if the Domain
Quota is higher. A Global Admin, which is not bound to any Grant Limit
restriction, will be allowed to assign any mailbox quota to the user up
to the limit allowed by the Domain Quota.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="domain-limits">Domain Limits</h3>
<div class="sect3">
<h4 id="what-is-domain-limit-management-a.k.a.-domain-settings">What is Domain Limit Management (a.k.a. <code>Domain Settings</code>)?</h4>
<div class="paragraph">
<p>Domain Limit Management is a feature of the Admin NG module. It allows a
Global Administrator to set domain level
limits that cannot be exceeded by any Administrator.</p>
</div>
<div class="paragraph">
<p>The only way to exceed a Domain Limit is to change the Domain Limit
itself.</p>
</div>
<div class="sect4">
<h5 id="domain-limits-1">Domain Limits</h5>
<div class="ulist">
<ul>
<li>
<p>Global Account Limit: The maximum number of accounts that can be created on this domain.</p>
</li>
<li>
<p>Domain Quota: The maximum mailbox quota that any Administrator can grant to a
mailbox in the domain.</p>
</li>
<li>
<p>COS Limits: Define which Classes of Service can be used for users in the domain
and the maximum number of users per Class of Service.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="edit-the-limits-of-a-domain">Edit the Limits of a Domain</h4>
<div class="sect4">
<h5 id="from-the-administration-zimlet-3">From the Administration Zimlet</h5>
<div class="paragraph">
<p>All the domains in the Zimbra infrastructure are listed in the <code>Domain
Settings</code> list in the Admin NG tab of the Administration Zimlet.</p>
</div>
<div class="paragraph">
<p>To edit the limits of a domain, select the domain from the <code>Domain
Settings</code> list and press the <code>Edit</code> button.</p>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-3">From the CLI</h5>
<div class="paragraph">
<p>To edit the limits of a domain through the CLI, use the <code>setDomainSettings</code>
command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite admin setDomainSettings {domain} [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME                       TYPE       EXPECTED VALUES                   DEFAULT
domain(M)                  String
account_limit(O)           Integer                                       don't change setting
domain_account_quota(O)    String                                        don't change setting
cos_limits(O)              String     cosname1:limit1,cosname2:limit2    don't change setting

(M) == mandatory parameter, (O) == optional parameter

Usage example:


zxsuite admin setDomainSettings example.com account_limit 100 domain_account_quota 100mb cos_limits cos1:30,cos2:80

Sets a global account limit on the domain example.com of 100 accounts,
with a domain account quota of 100 megabytes
and with cos account limits of 30 for cos1 and 80 for cos2.

Note: A cos limit of -1 removes the limit for the cos.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="reset-the-limits-of-a-domain">Reset the Limits of a Domain</h4>
<div class="sect4">
<h5 id="from-the-administration-zimlet-4">From the Administration Zimlet</h5>
<div class="paragraph">
<p>All the domains in the Zimbra infrastructure are listed in the <code>Domain
Settings</code> list in the Admin NG tab of the Administration Zimlet.</p>
</div>
<div class="paragraph">
<p>To reset the limits of a domain, select the domain from the <code>Domain
Settings</code> list and press the <code>Reset</code> button, then click <code>Ok</code> in the
confirmation pop-up.</p>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-4">From the CLI</h5>
<div class="paragraph">
<p>To reset the limits of a Domain through the CLI, use the
<code>resetDomainSettings</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite admin resetDomainSettings {domain}

PARAMETER LIST

NAME         TYPE
domain(M)    String

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="zimbra-administration-as-a-delegated-admin">Zimbra Administration as a Delegated Admin</h3>
<div class="sect3">
<h4 id="accessing-the-zimbra-administration-console-as-a-delegated-admin">Accessing the Zimbra Administration Console as a Delegated Admin</h4>
<div class="paragraph">
<p>To access the Zimbra Administration Console, connect to port
7071 of your mailserver with a web browser and login with your Zimbra
credentials.</p>
</div>
<div class="paragraph">
<p>E.g: <a href="https://mail.domain.com:7071" class="bare">https://mail.domain.com:7071</a></p>
</div>
</div>
<div class="sect3">
<h4 id="delegated-admin-can-and-cant-table">Delegated Admin CAN and CAN&#8217;T Table</h4>
<div class="paragraph">
<p>Here is a quick reference of what a Delegated Admin CAN and CAN&#8217;T do through the
Admin NG module.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CAN</th>
<th class="tableblock halign-left valign-top">CAN&#8217;T</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the account list of any domain for which they are granted Delegate Admin
rights</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View the account list belonging to any other domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit any user account in any domain for which they are granted Delegate Admin
rights</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit any user account belonging to any other domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit any alias, distribution list or resource in any domain for which they are
granted Delegate Admin rights</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit any alias, distribution list or
resource belonging to any other domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit any Global Admin account</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Grant Global Admin or Delegated Admin rights to any user</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an account on a domain for which they are granted Delegated Admin rights</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Create an account on any other domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select the Class Of Service of an account between those available for
that account&#8217;s domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arbitrarily set the Class of Service of an
account between those available on the server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit COS settings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit Domain Settings that may interfere with the proper functioning
of the server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See or edit any server setting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">See or edit any global setting</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="overview-of-the-zimbra-administration-console-for-delegated-admins">Overview of the Zimbra Administration Console for Delegated Admins</h4>
<div class="ulist">
<ul>
<li>
<p><code>Manage</code>:</p>
<div class="ulist">
<ul>
<li>
<p><code>Accounts</code>: Manage the Accounts belonging to any domain for which
delegated admin rights have been granted.</p>
</li>
<li>
<p><code>Aliases</code>: Manage Aliases of accounts belonging to any domain for
which delegated admin rights have been granted.</p>
</li>
<li>
<p><code>Distribution Lists</code>: Manage the Distribution Lists belonging to any
domain for which delegated admin rights have been granted.</p>
</li>
<li>
<p><code>Resources</code>: Manage the Resources belonging to any domain for which
delegated admin rights have been granted.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Configure</code>: View the configuration of any domain for which
delegated admin rights have been granted.</p>
</li>
<li>
<p><code>Search</code>: Perform advanced Searches.</p>
</li>
<li>
<p><code>Network NG</code></p>
<div class="ulist">
<ul>
<li>
<p><code>Mobile NG</code>: Manage the synchronization of mobile devices and clients
belonging to any domain for which delegated admin rights have been
granted.</p>
</li>
<li>
<p>"Admin NG: View the list of Delegated Admins belonging to any domain for
which delegated admin rights have been granted as well as quota usage
informations.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Search Bar</code>: Perform quick searches.</p>
</li>
<li>
<p><code>[username]</code>: Log Out from the Zimbra Administration Console.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="delegated-admin-log-browsing">Delegated Admin Log Browsing</h3>
<div class="sect3">
<h4 id="what-is-delegated-admin-log-browsing">What is Delegated Admin Log Browsing?</h4>
<div class="paragraph">
<p>The Admin NG allows a Global Admin to easily keep track of all Admins'
activity through a search-based graphical log browser.</p>
</div>
</div>
<div class="sect3">
<h4 id="the-admin-ng-log-browser">The Admin NG Log Browser</h4>
<div class="paragraph">
<p>The Admin NG Log Browser can be accessed by clicking <code>Browse Logs</code>
in the Admin NG tab of the Administration Zimlet. The <code>Filter Log</code>
pop-up dialog will open, allowing you to apply some filters to the logs
you want to browse.</p>
</div>
<div class="paragraph">
<p>The available filters are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Basic</code> filters</p>
<div class="ulist">
<ul>
<li>
<p><code>Admin</code>: Filter the logs to only view operations performed by a
single Domain Admin.</p>
</li>
<li>
<p><code>Action</code>: Filter the logs to only view one particular action. See
below for the available actions.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Advanced</code> filters</p>
<div class="ulist">
<ul>
<li>
<p><code>Client IP</code>: Filters the logs to only show operations performed from
a determined IP address.</p>
</li>
<li>
<p><code>Show Logins</code>: Select this checkbox to also show when the Domain
Admins log into the Zimbra Web Client.</p>
</li>
<li>
<p><code>Outcome</code>: Filters the logs to either show all operations, successful
operations or failed operations.</p>
</li>
<li>
<p><code>Start</code> and <code>End</code>: Limits the logs shown to a specific timespan
(default: the current day).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clicking the <code>Details</code> button will apply the selected filters and show the
log browser.</p>
</div>
<div class="sect4">
<h5 id="the-action-filter">The <code>Action</code> filter</h5>
<div class="paragraph">
<p>Any operation an Administrator can perform is available in the drop-down
menu of the <code>Action</code> filter.</p>
</div>
<div class="paragraph">
<p>All of these operations are important to keep track of your admin&#8217;s
actions and to troubleshoot issues.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Auth</code>: All authentications.</p>
</li>
<li>
<p><code>DelegateAuth</code>: All Delegated Authentications, either through the
<code>View Mail</code> button or through the <code>-z</code> option of the <em>zmmailbox</em>
command.</p>
</li>
<li>
<p><code>CreateAccount</code>: All account creations.</p>
</li>
<li>
<p><code>DeleteAccount</code>: All account deletions.</p>
</li>
<li>
<p><code>Set Password</code>: All mailbox password changes.</p>
</li>
<li>
<p><code>RemoveAccountAlias</code>: All alias deletions.</p>
</li>
<li>
<p><code>DeleteDistributionList</code>: All distribution lists deletions.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="reports-and-informations">Reports and Information</h3>
<div class="sect3">
<h4 id="admin-ng-monthly-reports">Admin NG Monthly Reports</h4>
<div class="paragraph">
<p>The Admin NG module includes a very useful <code>Monthly Reports</code> feature
that allows Global Administrators to keep track of both Delegated Admin
operations and domain status for a given month.</p>
</div>
</div>
<div class="sect3">
<h4 id="how-does-the-monthly-report-system-work">How does the Monthly Report system work?</h4>
<div class="paragraph">
<p>On the first day of each month, the Admin NG module automatically
creates a report based on the data gathered in the Admin NG Log.</p>
</div>
<div class="paragraph">
<p>This monthly report includes:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">GLOBAL REPORT</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">First logged action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of the first action performed by an
Admin this month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last logged action</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of the last action performed by an Admin
this month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last admin login by</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest administrative login timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most active admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Admin with the highest number of actions
logged</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most used address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most common IP Address for admin logins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total accounts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total number of mailboxes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total created accounts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of mailboxes created during the month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total deleted accounts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of mailboxes deleted during the month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total created domains</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of domains created during the month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total created distribution lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of distribution lists created
during the month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total deleted distribution lists</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of distribution lists deleted
during the month</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">DOMAIN REPORT</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the domain this data refers to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last admin login</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Latest administrative login timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account/max accounts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current and maximum number of accounts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current Domain Size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sum of the quotas used by all mailboxes in the
domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum Domain Size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sum of the maximum quota of all mailboxes
(excluding <code>Unlimited</code> mailboxes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts with no quota limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of mailboxes that don&#8217;t have a
quota limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total size of accounts with no quota limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sum of the quotas used by
all mailboxes with no quota limit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System Resources in the domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of system resource accounts in
the domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar Resources in the domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of calendar resource accounts
in the domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Successful domain actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of successful actions done by admins
on this domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsuccessful domain actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of unsuccessful actions done by
admins on this domain</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ADMIN REPORT</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the admin this data refers to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Successful logins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of successful logins into the Admin Console</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unsuccessful logins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of unsuccessful logins into the Admin
Console</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">View mails</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of times this admin used the <code>View Mail</code> feature
during the month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Last login</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timestamp of the last login of this admin into the
Administration Console</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Most used address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The email address most used by this admin to login</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total actions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of actions performed by this admin during the
month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts created</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of accounts created by this admin during the
month</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accounts deleted</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of accounts deleted by this admin during the
month</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="how-to-access-the-monthly-reports">How to Access the Monthly Reports</h4>
<div class="sect4">
<h5 id="from-the-administration-zimlet-5">From the Administration Zimlet</h5>
<div class="paragraph">
<p>To access the <code>Monthly Reports</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Log into the Zimbra Administration Console as a Global Admin.</p>
</li>
<li>
<p>On the Admin NG tab of the Administration Zimlet, click the <code>Monthly Reports</code>
button on the top-right of the page.</p>
</li>
<li>
<p>Select the month you wish to view and click <code>Show
Report</code>.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="from-the-cli-5">From the CLI</h5>
<div class="paragraph">
<p>To view the Monthly Reports from the CLI, use the
<code>getMonthlyReport</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite admin getMonthlyReport [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME        TYPE       EXPECTED VALUES    DEFAULT
month(O)    String     mm/yyyy            12/2021
local(O)    Boolean    true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite admin getMonthlyReport
Shows the monthly report for the previous month

zxsuite admin getMonthlyReport month 11/2021
Shows the monthly report for the month '11/2021'</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="partial-reports">Partial Reports</h4>
<div class="paragraph">
<p>To create a partial report for the current month, use the
<code>doMonthlyReport</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite admin doMonthlyReport [attr1 value1 [attr2 value2...

PARAMETER LIST

NAME        TYPE       EXPECTED VALUES    DEFAULT
month(O)    String     mm/yyyy            12/2021
force(O)    Boolean    true|false         false

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite admin doMonthlyReport
Generates the monthly report for the previous month and saves it in the current Admin NG log path

zxsuite admin doMonthlyReport month 01/2021
Generates a PARTIAL monthly report for the current month, without saving it to disk

** NOTE**

This command is automatically executed once a month to generate a file containing
the report for the
previous month. To overwrite an existing report file, set the 'force' parameter to true.</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="the-admin-ng-log-path">The Admin NG Log Path</h4>
<div class="paragraph">
<p>The Admin NG Module stores all monthly reports, together with the
logs used to generate the Monthly reports and to provide
information via the <code>Admin Log Browser</code> feature, in a path inside the
<code>/opt/zimbra/conf/</code> folder (default <code>/opt/zimbra/conf/zextras/zxadmin/</code>).
This particular default path has been chosen because it is the only directory
that CANNOT be deleted during a Zimbra update.</p>
</div>
<div class="sect4">
<h5 id="the-admin-ng-log-path-structure-and-contents">The Admin NG Log Path Structure and Contents</h5>
<div class="paragraph">
<p>The Admin NG log path is a flat directory containing the following
files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One or more <code>YYYY_MM</code> files containing the logs for the file&#8217;s
namesake month.</p>
</li>
<li>
<p>Zero or more <code>YYYY_MM.report</code> files containing the monthly report for
the file&#8217;s namesake month.</p>
</li>
<li>
<p>Zero or more <code>YYYY_MM.X</code> files containing partial logs for the file&#8217;s
namesake month. These files are created when changing the Admin NG Log
Path.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="changing-the-admin-ng-log-path">Changing the Admin NG Log Path</h5>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Carefully read this paragraph before changing the Admin NG Log
Path. Any error on the procedure will cause a potential log loss that
will render the <code>Monthly Report</code> and <code>Show Admin Logs</code> features highly
unreliable.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To safely change the Admin NG Log Path, follow these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create the folder that will contain the logs:</p>
<div class="ulist">
<ul>
<li>
<p>The folder&#8217;s ownership must be <code>zimbra:zimbra</code>.</p>
</li>
<li>
<p>The 'zimbra' user must have read and write permissions to the folder.</p>
</li>
<li>
<p>The folder must be empty.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Log into the Zimbra Administration Console as a Global Admin.</p>
</li>
<li>
<p>Open the Admin NG tab in the Administration Zimlet.</p>
</li>
<li>
<p>In the <code>Basic Module Configuration</code> section, click the <code>Change</code> button
near the Admin Log Path line.</p>
</li>
<li>
<p>Enter the new path and click <code>Change Path</code>.</p>
</li>
<li>
<p>If no errors are shown, move all the contents of the old log path.</p>
<div class="ulist">
<ul>
<li>
<p>It&#8217;s perfectly normal to only see <code>.report</code> and <code>.X</code> files in the old
log path, as the current log file will be given the <code>.1</code> extension to
mark it as a partial. Any previous <code>.X</code> files will have their extension
number increased by 1.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration-reset">Configuration Reset</h3>
<div class="sect3">
<h4 id="what-is-the-admin-ng-configuration-reset">What is the Admin NG Configuration Reset?</h4>
<div class="paragraph">
<p>The Admin NG Configuration Reset is a free feature of the Admin NG
module that allows a Global Administrator to completely wipe all
delegation rights from the server.</p>
</div>
<div class="paragraph">
<p>This is not a <code>rollback</code> feature that cleans the Admin NG module&#8217;s
configuration. Resetting the Admin Configuration will affect both Admin
NG and Zimbra delegation rights.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using the Admin Configuration Reset feature will completely
wipe all delegation configuration from the server, bringing it back to
the state of a fresh installation. Only Admin Delegation settings will
be wiped, no other kind of data will be affected.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="what-does-the-admin-configuration-reset-clear">What does the Admin Configuration Reset clear?</h5>
<div class="paragraph">
<p>The Admin Configuration Reset clears the following configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>isDelegatedAdmin</code> account property for all accounts on the server</p>
</li>
<li>
<p>All Access Control Entries and all Access Control Lists for</p>
<div class="ulist">
<ul>
<li>
<p>Users</p>
</li>
<li>
<p>Domains</p>
</li>
<li>
<p>Classes of service</p>
</li>
<li>
<p>Local configuration</p>
</li>
<li>
<p>Server configuration</p>
</li>
<li>
<p>Zimlets</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="when-should-i-use-the-admin-config-reset">When should I use the Admin Config Reset?</h4>
<div class="paragraph">
<p>The Admin Config Reset should only be used in the following cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To completely reset a compromised situation</p>
<div class="ulist">
<ul>
<li>
<p>If one or more wrong ACL or ACE settings cause your Zimbra
Administration Console to be unstable or not to properly show (e.g.
displaying a blank page or missing one or more UI elements), use the
Admin Configuration Reset as a final resolution.</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you plan to stop using the Admin NG module</p>
<div class="ulist">
<ul>
<li>
<p>The reset option is available even if no valid Network NG license is
active. Remember that this will also wipe any manually set Delegation
settings.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="how-do-i-use-the-admin-configuration-reset">How do I use the Admin Configuration Reset?</h4>
<div class="paragraph">
<p>If you <strong>really</strong> want to reset the Admin Delegation configuration, simply
run this CLI command:</p>
</div>
<div class="paragraph">
<p><code>zxsuite core doDeleteAllDelegatedRights</code></p>
</div>
<div class="paragraph">
<p>You will be asked to enter a confirmation string
to avoid any accidental use of the command.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cli-ng-guide">NG Modules CLI</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="nwtwork-ng-modules-cli">Network NG Modules CLI</h3>

</div>
<div class="sect2">
<h3 id="zxsuite---network-ng-modules-command-line-interface"><em>zxsuite</em> - Network NG Modules Command-Line Interface</h3>
<div class="sect3">
<h4 id="basic-usage">Basic Usage</h4>
<div class="paragraph">
<p>Every module of Network NG, including the core, has its own set of
<em>zxsuite</em> commands. All <em>zxsuite</em> commands are invoked with the
following syntax:</p>
</div>
<div class="paragraph">
<p>::
  <em>zxsuite [--host|--offline] [--json] [--progress] [--sync] {module} {action}
  [options]</em></p>
</div>
<div class="paragraph">
<p><strong>Available switches:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>--host [hostname|ip] - Specify a target host for the command. Leave
blank for localhost. Use all_servers to broadcast the command to all servers.</p>
</li>
<li>
<p>--offline - Use if Zimbra is not started. Some commands will not work</p>
</li>
<li>
<p>--json - The output of the command will be presented in JSON format.
Good for scripting.</p>
</li>
<li>
<p>--progress - Prints the operation&#8217;s feedback directly to STDOUT. Press
Ctrl+C to interrupt the output. The operation itself won&#8217;t be
interrupted.</p>
</li>
<li>
<p>--sync - Runs the command in synchronous mode, waiting for the operation&#8217;s execution to end and returning an exit code relevant with the operation&#8217;s result among the following:</p>
<div class="ulist">
<ul>
<li>
<p>0 - Successful</p>
</li>
<li>
<p>1 - Failed</p>
</li>
<li>
<p>2 - Stopped</p>
</li>
<li>
<p>3 - Removed</p>
</li>
<li>
<p>4 - Interrupted</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Online Help:</strong> An Online Help for every command is available through
<em>zxsuite help {module} [command]</em>. Omitting the command will display
the full list of available commands.</p>
</div>
</div>
<div class="sect3">
<h4 id="core-cli">Core CLI</h4>
<div class="paragraph">
<p>Basic Usage:</p>
</div>
<div class="paragraph">
<p>zxsuite core {action} [options]</p>
</div>
<div class="sect4">
<h5 id="core-commands">Core Commands</h5>
<div class="paragraph">
<p>::
  <strong>getVersion</strong> - Display Network NG Modules version</p>
</div>
<div class="paragraph">
<p><code>zxsuite core getVersion</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getProperty</strong> - Get configuration properties</p>
</div>
<div class="paragraph">
<p><code>zxsuite core getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>setProperty</strong> - Set configuration property</p>
</div>
<div class="paragraph">
<p><code>zxsuite core setProperty {property_name} {property_value}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getLicenseInfo</strong> - Display Network NG Modules license informations</p>
</div>
<div class="paragraph">
<p><code>zxsuite core getLicenseInfo core getLicenseInfo</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doUploadLicense</strong> - Upload a Network NG license</p>
</div>
<div class="paragraph">
<p><code>zxsuite core doUploadLicense {license_path}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doLicenseChecks</strong> - Force Network NG license checks</p>
</div>
<div class="paragraph">
<p><code>zxsuite core doLicenseChecks</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAccountStats</strong> - Show statistic informations about provided account
  name or ID</p>
</div>
<div class="paragraph">
<p><code>zxsuite core getAccountStats {account}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getNotification</strong> - Shows Network NG notifications</p>
</div>
<div class="paragraph">
<p><code>zxsuite core getNotification [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doDeleteAllDelegatedRights</strong> - This command deletes both Admin NG and
  Zimbra&#8217;s own Admin Delegation settings</p>
</div>
<div class="paragraph">
<p><code>zxsuite core doDeleteAllDelegatedRights {confirmation string}</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="update-cli">Update CLI</h4>
<div class="paragraph">
<p>Basic Usage:</p>
</div>
<div class="paragraph">
<p>zxsuite update {action} [options]</p>
</div>
<div class="sect4">
<h5 id="update-commands">Update Commands</h5>
<div class="paragraph">
<p>::
  <strong>doCheckUpdate</strong> - Fetch update information</p>
</div>
<div class="paragraph">
<p><code>zxsuite update doCheckUpdate</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStartService</strong> - start a given service</p>
</div>
<div class="paragraph">
<p><code>zxsuite update doStartService {service_name}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStopService</strong> - stop a given service</p>
</div>
<div class="paragraph">
<p><code>zxsuite update doStopService {service_name}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>download</strong> - [BETA] Update Network NG with the latest update available, the
  version will be loaded on the next mailboxd restart</p>
</div>
<div class="paragraph">
<p><code>zxsuite update download</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>enable</strong> - [BETA] Enable Network NG automatic update capabilities</p>
</div>
<div class="paragraph">
<p><code>zxsuite update enable</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getServices</strong> - show current status of all services for this module</p>
</div>
<div class="paragraph">
<p><code>zxsuite update getServices</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>info</strong> - Info on Network NG updates</p>
</div>
<div class="paragraph">
<p><code>zxsuite update info</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>start</strong> - [BETA] Load a new Network NG version</p>
</div>
<div class="paragraph">
<p><code>zxsuite update start [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="backup-ng-cli">Backup NG CLI</h4>
<div class="paragraph">
<p>Basic Usage:</p>
</div>
<div class="paragraph">
<p>zxsuite backup {action} [options]</p>
</div>
<div class="sect4">
<h5 id="backup-ng-commands">Backup NG Commands</h5>
<div class="paragraph">
<p>::
  <strong>getProperty</strong> - Get configuration properties</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>setProperty</strong> - Set configuration property</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup setProperty {property_name} {property_value}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doSmartScan</strong> - Perform a Smart Scan</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doSmartScan [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doAccountScan</strong> - Perform a Full Scan on a single account</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doAccountScan {account} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doExport</strong> - Perform an Export limited by domains</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doExport {destination_path} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doRestoreOnNewAccount</strong> - Perform a Restore on New Account</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doRestoreOnNewAccount {source_account} {destination_account} {dd/MM/yyyy HH:mm:ss|last} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doEnableDisableCOS</strong> - Enable or disable the backup for a specific COS</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doEnableDisableCOS {cos_name} {enable|disable}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doUndelete</strong> - Perform an Undelete Restore</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doUndelete {account} dd/MM/yyyy HH:mm:ss|first} dd/MM/yyyy HH:mm:ss|last} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doItemSearch</strong> - Search for an item</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doItemSearch {account} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doItemRestore</strong> - Restores a single item</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doItemRestore {account_name} {item_id}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doExternalRestore</strong> - Perform an External Restore</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doExternalRestore {source_path} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStopOperation</strong> - Stop a single running operation</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doStopOperation {operation_uuid}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStopAllOperations</strong> - Stops all running operations and empties the
  operations queue</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doStopAllOperations</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doCheckShares</strong> - Check all shares on local accounts</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doCheckShares</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doFixShares</strong> - Try to fix all shares on local accounts</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doFixShares {import_idmap_file}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doFixOrphans</strong> - Delete orphan digest files</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doFixOrphans [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doCoherencyCheck</strong> - Check backup coherency</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doCoherencyCheck {backup_path} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAccountInfo</strong> - Shows an account&#8217;s information</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getAccountInfo {account} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getBackupInfo</strong> - Displays informations about the backup system</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getBackupInfo [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getMap</strong> - Show binary Map object as human readable table</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getMap {file_path}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getItem</strong> - Display an item in a human-readable format.</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getItem {account} {item} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAvailableAccounts</strong> - Displays all accounts available for restore</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getAvailableAccounts [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAvailableDomains</strong> - Displays all domains available for restore</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getAvailableDomains {dd/MM/yyyy HH:mm:ss|last} {backup_path}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getServerConfig</strong> - Provides a list of stored server configs</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getServerConfig dd/MM/yyyy HH:mm:ss|last|all} {standard|customizations} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getCOSBackupStatus</strong> - Displays the backup status of all COS</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getCOSBackupStatus [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAllOperations</strong> - Displays all running and queued operations</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getAllOperations</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>monitor</strong> - Monitor a running operation</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup monitor {operation_uuid} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getServices</strong> - Show the current status of all the module&#8217;s services</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup getServices</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doBackupLDAP</strong> - Backup LDAP</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doBackupLDAP</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doRestartService</strong> - Restart one given service</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doRestartService {service_name}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doRestoreBlobs</strong> - Start a "restore blobs" operation which tries to restore broken zimbra blobs.</p>
</div>
<div class="paragraph">
<p><code>zxsuite backup doRestoreBlobs {volume_id} [attr1 value1 [attr2 value2&#8230;&#8203;]]</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="mobile-ng-cli">Mobile NG CLI</h4>
<div class="paragraph">
<p>Basic Usage:</p>
</div>
<div class="paragraph">
<p>zxsuite mobile {action} [options]</p>
</div>
<div class="sect4">
<h5 id="mobile-ng-commands">Mobile NG Commands</h5>
<div class="paragraph">
<p>::
  <strong>getProperty</strong> - Get configuration properties</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>setProperty</strong> - Set configuration property</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile setProperty {property_name} {property_value}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getDeviceList</strong> - Display all devices for the provided account</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getDeviceList {account}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getDeviceInfo</strong> - Display information about the provided device</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getDeviceInfo {account} {device_id}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doResetAccount</strong> - Reset ALL device states for the provided account</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doResetAccount {account}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doResetDevice</strong> - Resets the device&#8217;s SyncState for a single account</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doResetDevice {account} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAllSessions</strong> - Returns informations about all stored mobile sessions</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getAllSessions</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getActiveSessions</strong> - Returns all active mobile sessions</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getActiveSessions</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doRemoveDevice</strong> - Removes all the device&#8217;s SyncState and history from
  the server</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doRemoveDevice {account} {device_id}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAccountLoggers</strong> - Returns informations about all account loggers</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile getAccountLoggers</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doRemoveLogger</strong> - Removes an account logger</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doRemoveLogger {logger_id|all_loggers}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doAddAccountLogger</strong> - Add an account logger</p>
</div>
<div class="paragraph">
<p><code>zxsuite mobile doAddAccountLogger {account} {debug|info|warn|err|crit} {log_file}</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="hsm-ng-cli">HSM NG CLI</h4>
<div class="paragraph">
<p>Basic Usage:</p>
</div>
<div class="paragraph">
<p>zxsuite hsm {action} [options]</p>
</div>
<div class="sect4">
<h5 id="hsm-ng-commands">HSM NG Commands</h5>
<div class="paragraph">
<p>::
  <strong>+setHsmPolicy</strong> - Add an additional policy to HSM.</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm +setHsmPolicy {hsm_policy}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>addS3Store</strong> - Add an S3 compatible store</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm addS3Store {Name of the zimbra store} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doCheckBlobs</strong> - Start the doCheckBlobs operation.</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doCheckBlobs {start} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doCreateVolume</strong> - Create a volume on the server</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doCreateVolume {primary|secondary|index} {volume_name} {volume_path} {true|false} {compression_threshold_bytes}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doDeduplicate</strong> - Start a deduplication operation.</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doDeduplicate {volume_name} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doDeleteVolume</strong> - Delete a specific volume on the server</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doDeleteVolume {volume_id}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doMoveBlobs</strong> - Start the doMoveBlob operation.</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doMoveBlobs [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doRemoveHsmPolicy</strong> - Remove a policy from HSM.</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doRemoveHsmPolicy {hsm_policy}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doRestartService</strong> - restart a given service</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doRestartService {service_name}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStartService</strong> - start a given service</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doStartService {service_name}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStopAllOperations</strong> - Stops all running operations and empties the
  operations queue</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doStopAllOperations</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStopOperation</strong> - Stop a single running operation</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doStopOperation {operation_uuid}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStopService</strong> - stop a given service</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doStopService {service_name}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doUpdateVolume</strong> - Update a specific volume on the server</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doUpdateVolume {volume_id} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doVolumeToVolumeMove</strong> - Start the doMoveVolumeBlobs operation.</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm doVolumeToVolumeMove {source_volume_name} {destination_volume_name}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAllOperations</strong> - Displays all running and queued operations</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm getAllOperations [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAllVolumes</strong> - Prints all the volumes present in the server</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm getAllVolumes</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getHsmPolicy</strong> - Prints all the policies</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm getHsmPolicy</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getProperty</strong> - Get configuration properties</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getServices</strong> - show current status of all services for this module</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm getServices</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getVolumeStats</strong> - Show space occupation, number of items and blobs
  contained in a volume</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm getVolumeStats {volume_id} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>monitor</strong> - Monitor a running operation</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm monitor {operation_uuid} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>setHSMPolicy</strong> - Set the default HSM policy</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm setHSMPolicy {hsm_policy}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>setProperty</strong> - Set configuration property</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm setProperty {property_name} {property_value}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>testS3Connection</strong> - Test the connection to an S3 bucket.</p>
</div>
<div class="paragraph">
<p><code>zxsuite hsm testS3Connection {s3BucketConfigurationUuid}</code></p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="admin-ng-cli">Admin NG CLI</h4>
<div class="paragraph">
<p>Basic Usage:</p>
</div>
<div class="paragraph">
<p>zxsuite admin {action} [options]</p>
</div>
<div class="sect4">
<h5 id="admin-ng-commands">Admin NG Commands</h5>
<div class="paragraph">
<p>::
  <strong>getDelegationSettings</strong> - Shows delegated admins with their domains of
  competency, the viewMail attribute and the admin-assignable quota</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin getDelegationSettings [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doEditDelegationSettings</strong></p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doEditDelegationSettings {account} {domain} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doAddDelegationSettings</strong></p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doAddDelegationSettings {account} {domain} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  *doRemoveDelegationSettings</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doRemoveDelegationSettings {account} {domain}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getDomainSettings</strong> - Shows all domains' name, account number limit, and
  max account quota</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin getDomainSettings</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>setDomainSettings</strong> - Sets domain max account quota and account limit</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin setDomainSettings {domain} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>resetDomainSettings</strong> - Resets global account limit, account limit per
  cos, and domain account quota for the selected domain</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin resetDomainSettings {domain}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doShowAdminActivity</strong> - Shows all recorded admin activity</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doShowAdminActivity [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doEnableDisableAdminLogging</strong> - Enables or disables the logging of admin
  activities</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doEnableDisableAdminLogging {enable|disable}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>setProperty</strong> - Set configuration property</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin setProperty {property_name} {property_value}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getProperty</strong> - Get configuration properties</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin getProperty [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doMonthlyReport</strong> - Generate a report of admin activity in the specified
  month</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doMonthlyReport [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getMonthlyReport</strong> - Shows a report of admin activity in the specified
  *month</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin getMonthlyReport [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doSetZimletRights</strong> - Fixes the Administration Zimlet rights for all
  delegated admins.</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doSetZimletRights</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>getAllOperations</strong> - Displays all running and queued operations</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin getAllOperations</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStopAllOperations</strong> - Stops all running operations and empties the
  operations queue</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doStopAllOperations</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>doStopOperation</strong> - Stop a single running operation</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin doStopOperation {operation_uuid}</code></p>
</div>
<div class="paragraph">
<p>::
  <strong>monitor</strong> - Monitor a running operation</p>
</div>
<div class="paragraph">
<p><code>zxsuite admin monitor {operation_uuid} [attr1 value1 [attr2 value2&#8230;&#8203;</code></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="MIG-88-incremental-migration-with-backup-from-old-to-88">Incremental Migration to Zimbra 8.8.0 with Backup NG</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="MIG-88-description">Description</h3>
<div class="ulist">
<ul>
<li>
<p>This guide describes how to perform an Incremental Migration using
Backup NG.</p>
</li>
<li>
<p>It&#8217;s specifically designed for the migration of a production
environment, minimizing the downtime and aiming to be transparent for
the users.</p>
<div class="ulist">
<ul>
<li>
<p>If correctly planned and executed, your mail system won&#8217;t suffer any
downtime, and the impact on the users will be close to zero.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The source server of the migration requires either the Zextras Suite or Zimbra Suite Plus.</p>
<div class="ulist">
<ul>
<li>
<p>This guide applies for migrations from any Zimbra version supported by either of those to Zimbra 8.8.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All the CLI commands in this Guide must be executed as the Zimbra
user unless otherwise specified.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="MIG-88-what-will-be-migrated">What Will be Migrated?</h4>
<div class="ulist">
<ul>
<li>
<p>Email and email folders</p>
</li>
<li>
<p>Contacts and address books</p>
</li>
<li>
<p>Appointments and calendars</p>
</li>
<li>
<p>Tasks and task lists</p>
</li>
<li>
<p>Files and briefcases</p>
</li>
<li>
<p>Share informations</p>
</li>
<li>
<p>User preferences</p>
</li>
<li>
<p>User settings</p>
</li>
<li>
<p>Class of Service settings</p>
</li>
<li>
<p>Domain settings</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-what-will-not-be-migrated">What Will NOT be Migrated?</h4>
<div class="ulist">
<ul>
<li>
<p>Server settings (migrated for reference but not restored)</p>
</li>
<li>
<p>Global settings (migrated for reference but not restored)</p>
</li>
<li>
<p>Customizations (Postfix, Jetty, etc&#8230;&#8203;).</p>
</li>
<li>
<p>Items moved or deleted during the process will not be moved or deleted
on the destination server.</p>
</li>
<li>
<p>Preferences (e.g. passwords) changed during the process will be reset
upon each import.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The incremental migration is not designed to set up a
server-to-server mirroring. Using multiple imports to create a mirrored
copy of the source server won&#8217;t create a <strong>mirrored</strong> copy at all, since
no deletions are performed by the import process.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-source-data">Source Data</h3>
<div class="paragraph">
<p>Data from the source server is obtained through either Zextras Suite or Zimbra Suite Plus.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zextras Suite can be obtained on the Zextras Website at <a href="https://www.zextras.com" class="bare">https://www.zextras.com</a></p>
</li>
<li>
<p>Zimbra Suite Plus can be obtained on the Zimbra website at <a href="https://www.zimbra.com" class="bare">https://www.zimbra.com</a></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="MIG-88-software-installation">Software Installation</h4>
<div class="paragraph">
<p>Once you obtain either Zextras Suite or Zimbra Suite Plus, follow this
 installation process:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Copy the package to your server, in a directory owned by the root user.</p>
</li>
<li>
<p>Unpack the package using <code>tar zxf</code>.</p>
</li>
<li>
<p>Enter the newly created directory called either <code>zextras_suite-[version]</code>
or <code>zimbra_suite_plus-[version]</code>.</p>
</li>
<li>
<p>As root, run the installation script <code>./install.sh all</code>.</p>
</li>
<li>
<p>Follow the installation wizard, accepting the software EULA and installing
both the Core and the Zimlet component.</p>
</li>
<li>
<p>Once the installation is complete, proceed with the Guide.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Installing Zimbra Suite Plus or Zextras Suite requires a mailboxd
service restart, which will be performed during the installation.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-pre-migration-checks">Pre-migration Checks</h3>
<div class="sect3">
<h4 id="MIG-88-servers">Servers</h4>
<div class="ulist">
<ul>
<li>
<p>Source server: Any Zimbra server can be the source of your
migration, provided that it&#8217;s running Backup NG or Zimbra Suite Plus.</p>
</li>
<li>
<p>Destination server: Any Zimbra server can be the destination of
your migration, provided that it&#8217;s running Backup NG.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-storage">Storage</h4>
<div class="ulist">
<ul>
<li>
<p>Source server: If Backup NG is not currently enabled on the
source server, make sure you have an amount of free disk space
<em>comparable</em> to the size of the <code>/opt/zimbra/store/</code> folder (the
exported data is compressed through the gzip algorithm, and all zimbra
items are deduplicated, usually reducing the size of exported to the 70%
of the original size).</p>
</li>
<li>
<p>Destination server: Make sure you have an amount of free space
greater than the size of the <code>/opt/zimbra/store/</code> and of the <code>export</code>
folders on the source server combined.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-data-transfer">Data Transfer</h4>
<div class="paragraph">
<p>While you can choose to transfer the data in any way, rsync is our
method of choice as it&#8217;s a good compromise between speed and
convenience.</p>
</div>
<div class="paragraph">
<p>The main data transfer is executed while the source server is still
active and functional. However, since the transfer is performed via
the network, carefully plan your transfer in advance so that you&#8217;ll have
transferred <strong>all of your data</strong> before migrating.</p>
</div>
<div class="sect4">
<h5 id="MIG-88-alternative-ways-to-transfer-your-data">Alternative Ways to Transfer Your Data</h5>
<div class="paragraph">
<p>Anything spanning from remote mount to physical move of the drive is ok,
as long as it suits your needs.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Never underestimate the bandwidth of a station wagon full of tapes hurtling 
down the highway.
--Tanenbaum, Andrew S. (1996). Computer Networks. New Jersey: Prentice-Hall. 
p. 83. ISBN 0-13-349945-6.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-dns">DNS</h4>
<div class="paragraph">
<p>Set the TTL value of your MX record to 300 on your <code>real</code> DNS. This will
allow a fast switch between source and destination servers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-the-setup">Setting up the Migration</h3>
<div class="sect3">
<h4 id="MIG-88-step-1-coherency-checks">Step 1: Coherency Checks</h4>
<div class="paragraph">
<p>To avoid any possible data-related issues, run the following
checks on the source server:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://wiki.zimbra.com/wiki/Ajcody-Notes-No-Such-Blob#Zmblobchk_for_5.0.6.2B_Systems">zmblobchk</a>:
Checks the consistency between Zimbra&#8217;s metadata and BLOBs.</p>
</li>
<li>
<p><a href="http://wiki.zimbra.com/wiki/Zmdbintegrityreport">zmdbintegrityreport</a>:
Checks the integrity of the Zimbra&#8217;s database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Repair any error found as described in Zimbra&#8217;s official documentation.</p>
</div>
<div class="paragraph">
<p>Running a reindex of all mailboxes is also suggested.</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-2-network-ng-modules-setup">Step 2: Network NG Setup</h4>
<div class="paragraph">
<p>Disable the Real Time Scanner on both servers:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup setProperty ZxBackup_RealTimeScanner false</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
A dedicated device for the data export is strongly recommended
to improve the export performance and to lower the impact on the
performance of the running system.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Any device must be mounted on the <code>/opt/zimbra/backup/</code> path, and the
Zimbra user must have r/w permissions on it.</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-3-data-export-smartscan">Step 3: Data Export (SmartScan)</h4>
<div class="paragraph">
<p>Run a SmartScan on the source server:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doSmartScan</pre>
</div>
</div>
<div class="paragraph">
<p>All of your data will be exported to the default backup path
(/opt/zimbra/backup/ng/).</p>
</div>
<div class="sect4">
<h5 id="MIG-88-pro-tip-single-domains-export">Pro-Tip: Single Domains Export</h5>
<div class="paragraph">
<p>You can also choose to only migrate one or more domains instead of all
of them. To do so, run the following command <strong>instead</strong> of the SmartScan:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExport /path/to/export/folder/ domains yourdomain.com,yourdomain2.com[..]</pre>
</div>
</div>
<div class="paragraph">
<p>Mind that if you start with the <code>SmartScan</code> method, you&#8217;ll have to carry
on the migration with such method. If you start with the <code>Single
Domains</code> method ,you&#8217;ll have to carry on the migration with this one. The
two methods cannot be mixed.</p>
</div>
</div>
<div class="sect4">
<h5 id="MIG-88-data-export-smartscan-via-the-administration-zimlet">Data Export (SmartScan) via the Administration Zimlet</h5>
<div class="paragraph">
<p>You can also choose to export your data using the Administration Zimlet
as follows:</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-4-data-synchronization">Step 4: Data Synchronization</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
When you move the exported data to the destination server, make
sure that the destination folder is not Backup NG&#8217;s backup path on the
destination server, to avoid any issues if you already use
Backup NG or plan to do so on the destination server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>(You can skip this step if you choose to transfer your data by other
means than rsync.)</em></p>
</div>
<div class="paragraph">
<p>Using <em>rsync</em>, copy the data contained in
/opt/zimbra/backup/ng/ to a directory in the destination server
(make sure the Zimbra user has r/w permissions on the folder). Use a
terminal multiplexer like <em>screen</em> or <em>tmux</em>. This process command might
need A LOT of time depending on network speed and amount of data
involved.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[run this command as Root]
rsync -avH /opt/zimbra/backup/ng/ root@desinationserver:/path/for/the/data/</pre>
</div>
</div>
<div class="sect4">
<h5 id="MIG-88-alternate-synchronization-method">Alternate Synchronization Method</h5>
<div class="paragraph">
<p>While the suggested method is great for high-bandwidth situations, the
first synchronization can involve a lot of data. If you feel that the
rsync method is too slow, you might consider a physical move of the
device (or the proper disk file if running on a virtual environment).</p>
</div>
<div class="paragraph">
<p>After moving the disk, you can remotely mount it back to the source
server (e.g. via SSHFS), as the additional synchronizations needed for
the migration will involve much less data. In this case, be sure to
remount the device on the source server as <code>/opt/zimbra/backup/ng/</code>
with all due permissions.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-5-first-import">Step 5: First Import</h4>
<div class="paragraph">
<p>Import all exported data to the destination server:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/</pre>
</div>
</div>
<div class="paragraph">
<p>Now sit back and relax while Network NG imports your data on the
destination server.</p>
</div>
<div class="paragraph">
<p>''Warning: Do not edit or delete the backup path after this step.''</p>
</div>
<div class="sect4">
<h5 id="MIG-88-first-import-via-the-administration-zimlet">First Import via the Administration Zimlet</h5>
<div class="paragraph">
<p>You can also choose to import your data using the Administration Zimlet.
 While importing via the Administration Zimlet, be sure to
remove all system accounts (like GalSync, Ham, Spam, Quarantine etc.)
from the imported account list.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-5-alternate-first-import-for-large-migrations-advanced-users-only">Step 5 (alternate): First Import for Large Migrations</h4>
<div class="paragraph">
<p>If you are to migrate a very large infrastructure where an export/import
lasts for hours or even days, there is an alternative way to handle the
migration from this point forward.</p>
</div>
<div class="paragraph">
<p>Instead of importing all of your data to the destination server, you can
run a <code>Provisioning Only</code> import that will only create domains, Classes
of Service and accounts on the destination server, skipping all mailbox
contents.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/ provisioning_only TRUE</pre>
</div>
</div>
<div class="paragraph">
<p>After doing this, switch the mailflow to the new server and, when the
switch is completed, start the <code>real</code> import.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doExternalRestore /path/for/the/data/</pre>
</div>
</div>
<div class="paragraph">
<p>This way, your users will now connect to the new server where new emails
will be delivered while old emails are being restored.</p>
</div>
<div class="paragraph">
<p>This approach has it&#8217;s pros and cons, namely:</p>
</div>
<div class="paragraph">
<p><strong>Pros</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Since items are only imported once and never modified or deleted
afterwards, using this method will result in less discrepancies than the
<code>standard</code> incremental migration.</p>
</li>
<li>
<p>This is the option that has less impact on the source server (e.g.
good if you are in a hurry to decommission it).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Cons</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Depending on the timing of the operation, this method has a higher
impact on your users due to the fact that items are restored WHILE they
work on their mailbox.</p>
</li>
<li>
<p>Since the import is done on a running system, you might notice some
slowdowns.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-the-situation-so-far">The Situation so Far</h3>
<div class="paragraph">
<p>Right now, the vast majority of the data has already been imported to the
destination server. The source server is still active and functional,
and you are ready to perform the actual migration.</p>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-the-migration">The Migration</h3>
<div class="sect3">
<h4 id="MIG-88-step-6-pre-migration-checks">Step 6: Pre-migration Checks</h4>
<div class="paragraph">
<p>Before switching the mail flow, ALWAYS make sure that the new server is
ready to become active (check your firewall, your DNS settings, your
security systems etc.).</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-7-the-switch">Step 7: The Switch</h4>
<div class="paragraph">
<p>This is it, the migration moment has come! At the end of this step the
destination server will be active and functional.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Repeat step 3, step 4 and step 5 (only new data will be exported and
synchronized).</p>
</li>
<li>
<p>Switch the mail flow to the new server.</p>
</li>
<li>
<p>Once NO MORE EMAILS arrive to the source server, repeat step 3, step 4
and step 5.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Destination server is now active and functional.</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-8-post-migration-checks">Step 8: Post-migration Checks</h4>
<div class="paragraph">
<p>Run the following command to check for shares inconsistencies:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doCheckShares</pre>
</div>
</div>
<div class="paragraph">
<p>Should this command report any inconsistency, use the following command
to parse the import mapfile used as the first argument and fix
any broken shares.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zxsuite backup doFixShares</pre>
</div>
</div>
<div class="paragraph">
<p>Mapfiles can be found in the backup path of the destination server as
<code>map_[source_serverID]</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-9-galsync">Step 9: Galsync</h4>
<div class="paragraph">
<p>Delete any imported GalSync accounts from the Zimbra Administration
Console, then if needed, create new GalSync accounts on all the imported
domains and re-sync all the GalSync accounts with the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zmgsautil forceSync -a galsync.randomstring@domain.com -n [resourcename]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-step-10-message-deduplication">Step 10: Message Deduplication</h4>
<div class="paragraph">
<p>Running a Volume Deduplication using HSM NG is highly suggested
after a migration.</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-what-now-1">What Now?</h4>
<div class="ulist">
<ul>
<li>
<p>Initialize Backup NG on the new server to make sure all of your data is safe.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="MIG-88-incremental-migration-faq">Incremental Migration FAQ</h3>
<div class="sect3">
<h4 id="MIG-88-q-do-i-need-a-valid-license-in-order-to-perform-an-incremental-migration">Q: Do I need a valid license to perform an incremental migration?</h4>
<div class="paragraph">
<p>Yes. It can be either a trial License or a purchased one.</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-q-what-will-be-migrated">Q: What will be migrated?</h4>
<div class="paragraph">
<p>Everything except for the server configuration. This includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User data</p>
</li>
<li>
<p>User preferences</p>
</li>
<li>
<p>Classes of Service configuration</p>
</li>
<li>
<p>Domain configurations</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-q-will-i-lose-my-shares-will-i-need-to-re-configure-all-my-shares">Q: Will I lose my shares? Will I need to re-configure all my shares?</h4>
<div class="paragraph">
<p>Absolutely not!</p>
</div>
</div>
<div class="sect3">
<h4 id="MIG-88-q-how-should-i-transfer-the-exported-data-between-my-servers">Q: How should I transfer the exported data between my servers?</h4>
<div class="paragraph">
<p>Again, anything that suits your needs is ok. You just need to be very
sure about what your <strong>needs</strong> are.</p>
</div>
<div class="paragraph">
<p>Do you need to move the data very fast? Physically moving an USB disk
between your servers might not be a good idea.</p>
</div>
<div class="paragraph">
<p>Do you need to move the data in a very reliable way? Mounting the export
folder via SSHFS to the destination server might not be a good idea if
your internet connection is sloppy.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_chat">Zimbra Chat</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="about-this-document">About this document</h3>
<div class="paragraph">
<p>This document is written for system administrators, and it aims to provide both an
in-depth view of the product architecture to simplify
troubleshooting and the knowledge necessary for solid customizations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_overview_5">Overview</h3>
<div class="paragraph">
<p>Zimbra Chat is included in Zimbra starting in version 8.7.6 as Beta
software and version 8.8.0 as Stable. Zimbra Chat provides simple and
direct text-only chat between Zimbra accounts. It is
composed of a Zimlet and a Zimbra extension.</p>
</div>
<div class="paragraph">
<p>The Zimbra extension exposes an XMPP client so users can chat from
a standard XMPP client instead of using the Zimlet
through the Zimbra Web Client. Users can use both methods simultaneously.</p>
</div>
<div class="sect3">
<h4 id="general-architecture">General Architecture</h4>
<div class="paragraph">
<p>Zimbra Chat is designed for Zimbra. It runs as a Zimbra Server
Extension that implements an XMPP server and handles all the events
shared between the clients. The Zimbra Chat Server Extension uses
both XMPP and a custom protocol to communicate with the Chat Zimlet.</p>
</div>
<div class="paragraph">
<p>The server extension can handle multiple sessions for a single user,
without limits. Each session has its own delivery queue to ensure
that each session has exactly all of the events as any other
session of the user.</p>
</div>
<div class="paragraph">
<p>Sessions are not limited by type (XMPP or Chat Zimlet). A user can
use both the Zimbra Web Client and an XMPP client at the same time,
without worrying about interferences between the sessions.</p>
</div>
</div>
<div class="sect3">
<h4 id="components">Components</h4>
<div class="paragraph">
<p>Zimbra Chat is compose of two parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Chat Zimlet</p>
</li>
<li>
<p>Chat Extension</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Zimbra Chat Extension does not require the Chat Zimlet to
work properly. The Chat Zimlet is designed and built to work only
with the Zimbra Chat Extension.</p>
</div>
<div class="sect4">
<h5 id="zimlet">Zimlet</h5>
<div class="paragraph">
<p>The Chat Zimlet is the client component of Chat. It runs on
the Zimbra Web Client and is managed like any other Zimlet. It is fully
integrated in the Zimbra Web Client and uses the same graphics
libraries. The Zimlet can work only with the Chat Extension because the Zimlet
and Extension use a specific protocol to send and receive events. The
Chat Zimlet is supported on all browsers and versions
supported for the Zimbra Web Client.</p>
</div>
<div class="paragraph">
<p>Features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra Web Client integration.</p>
</li>
<li>
<p>Manage the buddy list. Users can add, edit and remove buddies from the
buddy list.</p>
</li>
<li>
<p>Open each `chat room' in a separate panel.</p>
</li>
<li>
<p>Manage personal status.</p>
</li>
<li>
<p>Send/Receive plain messages from users in the buddy list.</p>
</li>
<li>
<p>Send presence status to users in the buddy list.</p>
</li>
<li>
<p>View presence status of users in the buddy list.</p>
</li>
<li>
<p>Support for Emojis (emoticons) on conversations. Emojis are provided
free by EmojiOne <a href="http://emojione.com/" class="bare">http://emojione.com/</a>.</p>
</li>
<li>
<p>Send an entire conversation as email.</p>
</li>
<li>
<p>Search conversations in the chat history (if enabled in the Extension
options, see <a href="#sect:confkeys">Configuration Keys</a>).</p>
</li>
<li>
<p>Get desktop notifications for any incoming message.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="extension">Extension</h5>
<div class="paragraph">
<p>The Zimbra Chat Extension is the core of Zimbra Chat. It is a complete
chat server that manages the events between connected clients.</p>
</div>
<div class="paragraph">
<p>It uses the ZAL to integrate into the mailboxd service of Zimbra.</p>
</div>
<div class="paragraph">
<p>The Extension can handle two types of connections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SOAP connections incoming from the Chat Zimlet, using Zimbra’s
SOAP infrastructure.</p>
</li>
<li>
<p>XMPP connections from compatible clients.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Handle events from multiple sessions.</p>
</li>
<li>
<p>Handle SOAP connections for Chat Zimlet clients.</p>
</li>
<li>
<p>Handle XMPP (plain and SSL) connections for compatible clients
through a public port (see <a href="#sect:confkeys">Configuration Keys</a>)</p>
</li>
<li>
<p>Store the chat history for each conversation in a dedicated `chat'
folder in the user&#8217;s mailbox (if enabled, see <a href="#sect:confkeys">Configuration Keys</a>).</p>
</li>
<li>
<p>Store the relationships between users in the Zimbra database.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installation">Installation</h3>
<div class="paragraph">
<p>Zimbra Chat comes bundled with all Zimbra packages for version 8.8.0 and higher as a Zimbra package.</p>
</div>
<div class="paragraph">
<p>No dedicated installation steps are required.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In case the Zimbra Chat package was not installed during the system&#8217;s
installation or upgrade, please refer to the general documentation about package
installation to install it.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="upgrade">Upgrade</h3>
<div class="paragraph">
<p>Zimbra Chat is upgraded with the rest of the Zimbra platform.</p>
</div>
<div class="paragraph">
<p>No dedicated upgrade steps are needed.</p>
</div>
</div>
<div class="sect2">
<h3 id="troubleshooting">Troubleshooting</h3>
<div class="paragraph">
<p>This chapter helps the administrator find and solve any
issues. If no solution is found, the administrator is guided through the process to
report the issue.</p>
</div>
<div class="sect3">
<h4 id="looking-for-errors">Looking for Errors</h4>
<div class="paragraph">
<p>This process is fundamental to locating the source of an issue and
to find a solution or to correctly report it.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect:zim-err">Chat Zimlet Error</h4>
<div class="paragraph">
<p>To locate errors in the source code of the Chat Zimlet, enable developer
mode on the Zimbra Web Client by modifying the URL of the
Zimbra installation, appending <code>?dev=1</code> into the browser URL. Adding the
<code>dev=1</code> parameter to the URL forces Zimbra to load the entire Web
Client with all not minified sources, included the Zimlets. A longer
load time should be expected.</p>
</div>
<div class="paragraph">
<p>During the loading of the Zimbra Web Client, open the browser developer
tools.</p>
</div>
<div class="paragraph">
<p>In the browser developer tools console you will see logs from the
Chat Zimlet. If an error occurs, it will be printed into the console.</p>
</div>
<div class="paragraph">
<p>If no errors are printed, but you see an unwanted behavior, enable the
<code>break on exception</code> option in the developer tools. With that option
enabled, if an error occurs, the execution of the software will be paused on the
line where the error is generated.</p>
</div>
<div class="paragraph">
<p>If an error occurs, please escalate the issue by sending the file, the row and any
details about the error through the appropriate channels.</p>
</div>
<div class="paragraph">
<p>If no errors are detected, please see the "Chat Extension Error" section.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect:ext-err">Chat Extension Error</h4>
<div class="paragraph">
<p>Any exception thrown by the Chat Extension is written into the
<code>mailbox.log</code>. To check if there are any exceptions, please refer to
the appropriate section of this guide.</p>
</div>
<div class="paragraph">
<p>If you can’t find a solution for the exception in the FAQ,
please report the issue through the appropriate channels, including the complete
exception information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect:tools">Tools</h3>
<div class="sect3">
<h4 id="google-chrome-developer-tools">Google Chrome Developer Tools</h4>
<div class="paragraph">
<p>If the user is experiencing unexpected Zimlet behavior in
the Zimbra Web Client, use Google Chrome Developer Tools
to figure out the source of the issue.</p>
</div>
<div class="paragraph">
<p>To open the Google Chrome Developer Tools:
* Open the main menu.
* Find the <code>Other tools</code> menu option.
* Select <code>Developer Tools</code>.</p>
</div>
<div class="paragraph">
<p>A new panel with many tabs should appear. These tabs are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Console:: Like the server console, this tab will display some log information
and allow you to interact with the JS Runtime.</p>
</li>
<li>
<p>Network:: This tab will show any network activity, and it can be used to identify the
requests to the mailbox and the responses from it.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="firefox-developer-tools">Firefox Developer Tools</h4>
<div class="paragraph">
<p>To open the Firefox Developer Tools, open the
main menu and click the <code>Developer Tools</code> button.</p>
</div>
<div class="paragraph">
<p>A new panel with many tabs should appear. These tabs are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Console:: Like the server console, this tab will display some log information
and you allow to interact with the JS Runtime.</p>
</li>
<li>
<p>Network:: This tab will show any network activity, and it can be used to identify the
requests to the mailbox and the responses from it.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect:gatheringinfo">Gathering System Information</h3>
<div class="paragraph">
<p>Gathering System information is a vital part of the troubleshooting
process. This section helps the administrator collect useful
system information required to correctly report an issue (as described in the "How to escalate and issue" section).</p>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-zversion">Zimbra Version</h4>
<div class="paragraph">
<p>To see the version of Zimbra, type this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># As zimbra
zmcontrol -v</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-extension">Extension and Zimlet Version</h4>
<div class="paragraph">
<p>To see the version of the Extension and the Zimlet, type this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># As zimbra
java -cp /opt/zimbra/lib/ext/openchat/openchat.jar com.zextras.lib.OpenChat</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-listzimlets">List of the Deployed Zimlets</h4>
<div class="paragraph">
<p>To see the list of deployed Zimlets, type this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># As zimbra
zmzimletctl listZimlets</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-userzimlets">List of the Zimlets Enabled for the User</h4>
<div class="paragraph">
<p>To see the list of  Zimlets enabled for a user, type this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># As zimbra
zmprov getAccount user@domain.tld zimbraZimletAvailableZimlets</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sect:gatheringinfo-userzimlets-pref">List of Zimlet User Preferences</h4>
<div class="paragraph">
<p>To see the list of the preferences for the Zimlets enabled for a user,
type this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># As zimbra
zmprov getAccount user@domain.tld zimbraZimletUserProperties</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="sect:faq">F.A.Q.</h3>
<div class="sect3">
<h4 id="Chat-zimlet-issues">Chat Zimlet Issues</h4>
<div class="paragraph">
<p><strong>The Chat Zimlet is not working after the user login, and I see some
JavaScript Errors. What can I do?</strong></p>
</div>
<div class="paragraph">
<p>This is most commonly caused by caching issues. Refresh all the caches with
these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># As zimbra
zmprov flushCache -a zimlet com_zextras_chat_open</pre>
</div>
</div>
<div class="paragraph">
<p>If the problem persists, escalate the issue.</p>
</div>
<div class="paragraph">
<p><strong>The Chat Zimlet doesn’t start at login, and a popup appears informing
the user that the server is not available. What can I do?</strong></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Remember that the Chat Zimlet will not start if the logged user is using the delegated access feature (e.g. View Mail button
from the admin console) to protect the privacy of the user.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Check to see if the Chat Extension is loaded correctly in the <code>mailbox.log</code>
(see the appropriate section of this guide about how to read the <code>mailbox.log</code>).</p>
</div>
<div class="paragraph">
<p>Loading of the Zimbra Extension is granted by the following lines at
the mailbox startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xxxx-xx-xx xx:xx:xx,xxx INFO  [main] [] mailbox - OpenChat starting ...
xxxx-xx-xx xx:xx:xx,xxx INFO  [main] [] extensions - OpenChat started</pre>
</div>
</div>
<div class="paragraph">
<p>If the problem persists, report the issue, including the exception in the report.</p>
</div>
<div class="paragraph">
<p><strong>Another Zimlet is using the sidebar, and a user cannot see the
Chat buddy list. What can I do?</strong></p>
</div>
<div class="paragraph">
<p>The Chat Zimlet uses a container that can be used by other Zimlets. To
avoid collisions, try to detect if that container is
used or not.</p>
</div>
<div class="paragraph">
<p>The Chat Zimlet uses an internal <code>black list</code> to detect incompatible
Zimlets and disable the sidebar mode, switching to the docked mode.</p>
</div>
<div class="paragraph">
<p>The detection may fail if the Zimlet using the sidebar
container is not indexed in the internal blacklist.</p>
</div>
<div class="paragraph">
<p>If the problem persists, report the issue, mentioning the
name of the conflicting Zimlet.</p>
</div>
<div class="paragraph">
<p>If a user is stuck in the sidebar mode and another Zimlet has taken
control of the sidebar, you can reset the Zimlet user setting to use the
docked mode with these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># As zimbra
# Reset the involved zimlet user preference:
zmprov modifyAccount user@example.com \
    -zimbraZimletUserProperties "com_zextras_chat_open:zxchat_pref_dockmode:FALSE"
zmprov modifyAccount user@example.com \
    -zimbraZimletUserProperties "com_zextras_chat_open:zxchat_pref_dockmode:TRUE"
# Set the zimlet user preference to dock mode:
zmprov modifyAccount user@example.com \
    +zimbraZimletUserProperties "com_zextras_chat_open:zxchat_pref_dockmode:TRUE"</pre>
</div>
</div>
<div class="paragraph">
<p>Then reload the Zimbra Web Client to apply the modifications.</p>
</div>
<div class="paragraph">
<p>If the problem persists, report the issue.</p>
</div>
</div>
<div class="sect3">
<h4 id="Chat-extension-issues">Chat Extension Issues</h4>
<div class="paragraph">
<p><strong>Server to server messages are not delivered between the two servers. What
can I do?</strong></p>
</div>
<div class="paragraph">
<p>This issue can be caused by connection issues between two mailboxes.
Verify that the port <code>5269</code> is opened on each server and that the servers can
connect to each other.</p>
</div>
<div class="paragraph">
<p>To verify if the port is opened on the server, a simple check
can be done by trying to connect to port <code>5269</code> using a telnet client.</p>
</div>
<div class="paragraph">
<p>If everything seems to work properly, open the <code>mailbox.log</code> on both servers and
try to send an event (e.g. a text message). If an
exception appears, see if it provides a hint on the error. If there is no
meaningful exception, report the issue and include the exception in the report.</p>
</div>
</div>
<div class="sect3">
<h4 id="sect:how-to-escalate-an-issue">How to Escalate an Issue</h4>
<div class="paragraph">
<p>If you  found an issue and are not able to fix it, the following
information is vital to report:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A detailed description of the issue: What you are expecting and what
is really happening?</p>
</li>
<li>
<p>A detailed description of the steps to reproduce the issue.</p>
</li>
<li>
<p>A detailed description of the installation and the environment: (see
"Gathering System Information" section of this guide)</p>
<div class="ulist">
<ul>
<li>
<p>Server information: CPU, RAM, number of servers and for each
server:</p>
<div class="ulist">
<ul>
<li>
<p>Zimbra Version</p>
</li>
<li>
<p>Chat Version</p>
</li>
<li>
<p>List of the installed Zimlets</p>
</li>
</ul>
</div>
</li>
<li>
<p>Client information:</p>
<div class="ulist">
<ul>
<li>
<p>Browser name and version</p>
</li>
<li>
<p>Connectivity used between the servers and the client</p>
</li>
<li>
<p>Client Skin (theme)</p>
</li>
<li>
<p>Client Language</p>
</li>
<li>
<p>List of the Zimlets enabled for the user</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Any log involved for the issue:</p>
<div class="ulist">
<ul>
<li>
<p><code>mailbox.log</code></p>
<div class="paragraph">
<p>You can remove any personal information to protect users'
privacy.</p>
</div>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced-topics">Advanced Topics</h3>
<div class="sect3">
<h4 id="sect:sizing">Sizing</h4>
<div class="paragraph">
<p>Stress tests are being performed on Zimbra Chat.</p>
</div>
<div class="paragraph">
<p>We have noticed an increment of the workload stimabe at most 7% in an
Zimbra installation with 20000 users.</p>
</div>
<div class="paragraph">
<p>The history feature of the Zimbra Chat Extension has the most impact. When
a message is sent, a mime message is either
created or updated, meaning few kilobytes are read or written and some
database queries are performed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
We suggest disabling history in very large deployments. To edit the
configuration see <a href="#sect:confkeys">Configuration Keys</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="sect:confkeys">Configuration Keys</h4>
<div class="paragraph">
<p>The Chat Extension is easily configurable through the Zimbra CLI. All of
the configurations are stored in LDAP.<br></p>
</div>
<div class="paragraph">
<p>To edit an account configuration, run these commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre># As zimbra
zmprov modifyAccount account@example.tld {propertyName} {value}</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">zimbraChatServiceEnabled</dt>
<dd>
<p><code>[boolean]</code>, Default value: <code>true</code>.</p>
<div class="literalblock">
<div class="content">
<pre>Enable the Chat Service.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Can be applied to:
* Global
* Server</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatHistoryEnabled</dt>
<dd>
<p><code>[boolean]</code>, Default value: <code>true</code>, requires a mailbox restart to be
applied.</p>
<div class="literalblock">
<div class="content">
<pre>Enable the chat history writing inside the chat folder.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Can be applied to:
* Cos
* Account</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatConversationAuditEnabled</dt>
<dd>
<p><code>[boolean]</code>, Default value: <code>false</code>.</p>
<div class="literalblock">
<div class="content">
<pre>Enable the dedicated log for the chat conversations.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Can be applied to:
* Global
* Domain</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatXmppSslPortEnabled</dt>
<dd>
<p><code>[boolean]</code>, Default value: <code>false</code>, requires a mailbox restart to be
applied.</p>
<div class="literalblock">
<div class="content">
<pre>Enable the XMPP legacy SSL port.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Can be applied to:
* Global
* Server</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatAllowUnencryptedPassword</dt>
<dd>
<p><code>[boolean]</code>, Default value: <code>false</code>.</p>
<div class="literalblock">
<div class="content">
<pre>Allow unencrypted password login via XMPP.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Can be applied to:
* Global
* Server</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatXmppPort</dt>
<dd>
<p><code>[port]</code>, Default value: <code>5222</code>, requires a mailbox restart to be
applied.</p>
<div class="literalblock">
<div class="content">
<pre>The XMPP standard port, usually used with StartTLS.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Can be applied to:
* Global
* Server</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatXmppSslPort</dt>
<dd>
<p><code>[port]</code>, Default value: <code>5223</code>, requires a mailbox restart to be
applied.</p>
<div class="literalblock">
<div class="content">
<pre>The XMPP legacy SSL port.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Can be applied to:
* Global
* Server</pre>
</div>
</div>
</dd>
<dt class="hdlist1">zimbraChatAllowDlMemberAddAsFriend</dt>
<dd>
<p><code>[boolean]</code>, optional.</p>
<div class="literalblock">
<div class="content">
<pre>Add every member of the distribution list as buddies to each other.</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Can be applied to:
* Distribution list</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="sect:logs">Logs</h4>
<div class="sect4">
<h5 id="sect:mailboxlog">mailbox.log</h5>
<div class="paragraph">
<p>Mailbox log is a standard Log4j log. Here are some sample rows of
a <code>mailbox.log</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xxxx-xx-xx xx:xx:xx,xxx INFO  [qtp1912962767-310:https://123.123.123.123:8443/service/soap/ModifyPropertiesRequest] [name=user@example.com;mid=6;ip=172.17.0.2;ua=ZimbraWebClient - GC58 (Linux)/8.6.0_GA_1153;] soap - ModifyPropertiesRequest elapsed=4
xxxx-xx-xx xx:xx:xx,xxx INFO  [qtp1912962767-310:https://123.123.123.123:8443/service/soap/ZxChatRequest] [] extensions - user@example.com changed status to AVAILABLE
xxxx-xx-xx xx:xx:xx,xxx INFO  [qtp1912962767-310:https://123.123.123.123:8443/service/soap/ZxChatRequest] [] soap - ZxChatRequest elapsed=24</pre>
</div>
</div>
<div class="paragraph">
<p>Each row is composed of these elements:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">xxxx-xx-xx xx:xx:xx,xxx</dt>
<dd>
<p>Timestamp of the log row.</p>
</dd>
<dt class="hdlist1">INFO</dt>
<dd>
<p>The type of the log row.</p>
</dd>
<dt class="hdlist1">qtp…ModifyPropertiesRequest</dt>
<dd>
<p>Information on the threads that requested to write the log
row, which is usually the handler that triggered the log row.</p>
</dd>
<dt class="hdlist1">name=…</dt>
<dd>
<p>Information on the user session.</p>
</dd>
<dt class="hdlist1">soap -</dt>
<dd>
<p>Source of the log row.</p>
</dd>
<dt class="hdlist1">ModifyPropertiesRequest elapsed=4</dt>
<dd>
<p>The content of the log row.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="sect:zmmailboxdout">zmmailboxd.out</h5>
<div class="paragraph">
<p>Mailbox log is a standard Log4j log. Here are some sample rows of
a <code>zmmailboxd.out</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>xxxx-xx-xx xx:xx:xx.xxx:INFO:oejs.SetUIDListener:main: Opened ServerConnector@397fbdb{HTTP/1.1}{0.0.0.0:8080}
xxxx-xx-xx xx:xx:xx.xxx:INFO:oejs.SetUIDListener:main: Opened ServerConnector@36ebc363{SSL-http/1.1}{0.0.0.0:8443}
xxxx-xx-xx xx:xx:xx.xxx:INFO:oejs.SetUIDListener:main: Opened ServerConnector@54d9d12d{SSL-http/1.1}{0.0.0.0:7071}</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_connect">Zimbra Connect</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_zimbra_connect">What is Zimbra Connect</h3>
<div class="paragraph">
<p>New for Zimbra Collaboration 8.8.15,
Zimbra Connect integrates a fully fledged corporate instant messaging platform inside the Zimbra WebClient, including Group and Corporate Messaging, File Sharing, Screen Sharing and informal Video Chat capabilities.</p>
</div>
<div class="sect3">
<h4 id="_differences_with_zimbra_talk_v2">Differences with Zimbra Talk V2</h4>
<div class="paragraph">
<p>The main differences between Zimbra Connect and Zimbra Talk V2 implementation are the following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 61. Back-end</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Zimbra Talk V2</th>
<th class="tableblock halign-left valign-top">Zimbra Connect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supports XMPP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No XMPP Support</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No dedicated API Set</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Features a dedicated API set and client protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client/Server communication is SOAP-based</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client/Server communication is based on WebSockets</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 62. Front-end</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Zimbra Talk V2</th>
<th class="tableblock halign-left valign-top">Zimbra Connect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User interaction is based on a buddy list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User interaction is based on the GAL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Buddy-list-based minimal UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">History-based minimal UI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bulkier, more crowded UI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lighter, less cluttered UI</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Space settings are defined in the Space itself</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Space settings are defined by the Space&#8217;s "General" channel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-based video and audio feed control - users can autonomously mute/stop other user&#8217;s audio and video feed only affecting themselves.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host-based video and audio feed control - host can mute a participant or stop a video feed affecting all participants. Users can still mute/stop their feeds.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 63. Features</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Zimbra Talk V2</th>
<th class="tableblock halign-left valign-top">Zimbra Connect</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File exchange is available in Chats, Groups, and Channels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File exchange is available in Chats and Groups starting with Zimbra 8.8.15p3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instant Meeting is available</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instant Meeting is available starting with Zimbra 8.8.15p1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_frontend_features">Frontend Features</h4>
<div class="paragraph">
<p>Zimbra Connect includes the following front-end features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Message delivery and read awareness</p>
</li>
<li>
<p>1-to-1 Instant Messaging</p>
</li>
<li>
<p>Group Messaging</p>
</li>
<li>
<p>Corporate Messaging (Spaces and Channels)</p>
</li>
<li>
<p>Group Video Calls</p>
</li>
<li>
<p>Channel Video calls</p>
</li>
<li>
<p>File Sharing</p>
</li>
<li>
<p>Screen Sharing</p>
</li>
<li>
<p>Emojis</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_backend_features">Backend Features</h4>
<div class="paragraph">
<p>Zimbra Connect includes the following backend features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>COS and User availability</p>
</li>
<li>
<p>Built-in TURN server compatibility</p>
</li>
<li>
<p>No core installation needed. Zimlet installation through a package manager.</p>
</li>
<li>
<p>No configuration required</p>
</li>
<li>
<p>Peer-to-Peer WebRTC protocol to avoid server load</p>
</li>
<li>
<p>Dedicated audit log</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_licensing_2">Licensing</h3>
<div class="paragraph">
<p>Zimbra Connect is licensed on a per-user basis. License information is included in the Network Edition license file just as for any other Zimbra NE feature.
Global Admins can enable its Advanced features for any number of users up to the limit allowed by the license, and only "advanced" users count towards any licensing limit.</p>
</div>
<div class="paragraph">
<p>The total number of users who have the Advanced features active can be seen in the output of the <code>zxsuite core getLicenseInfo</code> command under <code>teamChatActiveCount</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@129efa51bd95:~$ zxsuite core getLicenseInfo

        dateStart                                           2021-06-11 00:00:00 UTC
        dateEnd                                             2021-12-31 17:00:00 UTC
        expired                                             false
        type                                                regular - Network Edition
        [...]
        teamchatActiveCount                                 999
        [...]</pre>
</div>
</div>
<div class="paragraph">
<p>This count is updated every 15 minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_chat_and_zimbra_connect">Zimbra Chat and Zimbra Connect</h3>
<div class="paragraph">
<p>Zimbra Chat and Zimbra Connect are neither compatible nor interoperable, meaning that the two products cannot coexist in any Zimbra NE infrastructure.
The Zimbra Chat zimlet gets uninstalled during the installation process of the Zimbra Connect Zimlet package.
However, Zimbra Connect includes all <em>basic</em> IM features provided by Zimbra Chat, which automatically gets enabled for all users who don’t have access to the <em>advanced</em> Zimbra Connect features.
<em>Advanced</em> users can use all of the product’s features with other <em>advanced</em> users and can use 1-to-1 Instant Messaging with <em>basic</em> users.
<em>Basic</em> users can use 1-to-1 features with all other users.</p>
</div>
<div class="paragraph">
<p>All users start as <em>Basic</em> users.
Global and Delegated admins can enable <em>Advanced</em> features.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_connect_zimlet_installation">Zimbra Connect Zimlet installation</h3>
<div class="paragraph">
<p>The Zimbra Connect Zimlet is available in the Zimbra repository and can be easily installed and upgraded through the operating system&#8217;s package manager.</p>
</div>
<div class="sect3">
<h4 id="_zimbra_connect_zimlet_installation_on_red_hat_and_centos">Zimbra Connect Zimlet installation on Red Hat and CentOS</h4>
<div class="paragraph">
<p>To install the Zimlet on Red Hat and CentOS, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>yum install zimbra-connect</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_connect_zimlet_installation_on_ubuntu">Zimbra Connect Zimlet installation on Ubuntu</h4>
<div class="paragraph">
<p>To install the Zimlet on Ubuntu, run:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>apt-get install zimbra-connect</pre>
</div>
</div>
<div class="paragraph">
<p>Installing the Zimlet removes any Zimbra Chat components from the server automatically.</p>
</div>
</div>
<div class="sect3">
<h4 id="_migrating_from_zimbra_talk_to_zimbra_connect">Migrating from Zimbra Talk to Zimbra Connect</h4>
<div class="paragraph">
<p>Zimbra Talk and Zimbra Connect are neither compatible nor interoperable, meaning that the two products cannot coexist in any Zimbra NE infrastructure.
To use Connect, the database content must first be migrated from Talk format to Connect format.</p>
</div>
<div class="paragraph">
<p>In order to migrate Talk data to Connect, use the <code>doImportChannels</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[zimbra@mailserver ~]$ zxsuite connect doImportChannels
Syntax:
   zxsuite connect doImportChannels [attr1 value1 [attr2 value2...]]


PARAMETER LIST

NAME                                   TYPE       EXPECTED VALUES
delete_destination_before_import(O)    Boolean    true|false

(M) == mandatory parameter, (O) == optional parameter</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This operation can execute multiple times, but it&#8217;s a one-way process and cannot be reverted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once the database content is migrated, uninstall Zimbra Talk and install Zimbra Connect.</p>
</div>
</div>
<div class="sect3">
<h4 id="_uninstall_zimbra_talk">Uninstall Zimbra Talk</h4>
<div class="paragraph">
<p>Starting Zimbra 8.8.15 GA, <code>zimbra-connect</code> replaces <code>zimbra-talk</code> hence it is important to remove <code>zimbra-talk</code> before installing <code>zimbra-connect</code>.</p>
</div>
<div class="paragraph">
<p>As <strong>root</strong> uninstall the package:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Redhat</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>yum remove zimbra-talk</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Ubuntu</dt>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>apt-get remove zimbra-talk</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_urls_and_ports">URLs and Ports</h3>
<div class="paragraph">
<p>To build URLs and links (e.g., for External Shares) Zimbra Connect uses the default Zimbra settings for the domain of the account in use - the <code>zimbraPublicServiceHostname</code> property is used for the URL itself while the <code>zimbraPublicServicePort</code> property is used for the port.</p>
</div>
<div class="paragraph">
<p>Should either of the two not be set up, the system falls back to the <code>zimbraServiceHostname</code> and <code>zimbraMailPort</code> or <code>zimbraMailSSLPort</code> server-level properties.</p>
</div>
<div class="paragraph">
<p>For Video Chats and Instant Meetings, the following rules apply:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Zimbra Connect will work through firewalls and NATs as long as the peers can communicate each with the other - either directly or through a TURN server (which together with proper network rules is usually the solution to any WebRTC connection problem).</p>
</li>
<li>
<p>When no TURN server is set up is not being used, a default STUN server is used so clients should be able to send outbound traffic to ports 19305/19307. The actual P2P connection is established between the clients on a random port between 0 and 65535 based on the client configuration and network.</p>
</li>
<li>
<p>The default handshake/negotiation port used by most TURN servers is 3478 (incoming, UDP), but a different port can be used as long as it is properly set up - on the Zimbra Connect side the port is specified when adding the TURN server and the clients clients will be instructed to connect through it. The default P2P connection range when using a TURN server is 49152-65535 (usually configurable on the TURN side) so clients should be able to send data to that port range to the TURN server.</p>
<div class="ulist">
<ul>
<li>
<p>Most TURN servers can also be configured to use TCP insted of UDP.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_connect_administration">Zimbra Connect administration</h3>
<div class="paragraph">
<p>Zimbra Connect features can be enabled and disabled via the <code>zxsuite config</code> command line utility:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enable Zimbra Connect «Advanced» features</p>
<div class="ulist">
<ul>
<li>
<p>Property: <code>teamChatEnabled</code></p>
</li>
<li>
<p>Available in: COS, account</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enable or disable the chat history</p>
<div class="ulist">
<ul>
<li>
<p>Property: <code>historyEnabled</code></p>
</li>
<li>
<p>Available in:  global, server, COS, account</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enable or disable Video Chat</p>
<div class="ulist">
<ul>
<li>
<p>Property: <code>videoChatEnabled</code></p>
</li>
<li>
<p>Available in: global, server, COS, account</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_browser_compatibility">Browser compatibility</h3>
<div class="paragraph">
<p>Zimbra Connect features are available on all browsers officially supported by the Zimbra Web Client, with some client-side limitations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Browser</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">OS</th>
<th class="tableblock halign-left valign-top">Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (Chromium)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (Chromium)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (EdgeHTML)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon red"><i class="fa fa-times-circle"></i></span> No</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Internet Explorer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon red"><i class="fa fa-times-circle"></i></span> No</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows/Linux/OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ESR</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> Yes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Google Chrome</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows/Linux/OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Google Chrome</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Safari</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Safari</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>While likely to work, items marked as "<span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited" are only supported on the browser&#8217;s two previous stable releases to the current one.</p>
</div>
<div class="paragraph">
<p>Google Chrome users must install the "Zextras Companion" extension to use the Screen Sharing feature, publicly available in the Chrome Web Store.</p>
</div>
<div class="paragraph">
<p>Firefox users must be sure to be running at least version 66 of the browser to be able to use the Screen Sharing feature.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ui">UI</h3>
<div class="paragraph">
<p>The Zimbra Connect UI is developed in PREACT and seamlessly integrated with the Zimbra Web Client.
It is composed of two client-side components: the Quick Access Sidebar and the fully-featured Connect Tab.</p>
</div>
<div class="paragraph">
<p>The Quick Access Sidebar allows for quick Instant Messaging, both for 1-to-1 and group conversations.
Advanced Zimbra Connect features such as File Sharing and Video Chat are available in the IM Pane only for users who have the Zimbra Connect feature set enabled either at an account or COS level.</p>
</div>
<div class="paragraph">
<p>The Connect Tab is the full-sized Zimbra Connect UI, which contains all corporate instant messaging features such as Spaces and Channels.
The tab itself is available for both Basic and Advanced users, but corporate features are only available to Advanced users.</p>
</div>
<div class="sect3">
<h4 id="_quick_access_sidebar">Quick Access Sidebar</h4>
<div class="paragraph">
<p>The Quick Access Sidebar displays the last people, groups, and channels the user has interacted with and allows to open a quick chat window with all of those.</p>
</div>
<div class="paragraph">
<p>It is available for both "Basic" users and "Advanced" users and provides additional features for the latter.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_quick_chat_1.png" alt="connect_quick_chat_1.png" height="200" title="connect_quick_chat_1.png"></span>
<span class="image"><img src="images/connect_quickaccess_sidebar_1.png" alt="connect_quickaccess_sidebar_1.png" height="400" title="connect_quickaccess_sidebar_1.png"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_connect_tab">Connect Tab</h4>
<div class="paragraph">
<p>The Connect Tab is a fully-fledged Zimbra feature tab that behaves similarly to all other feature tabs (e.g., Mail or Calendar).</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_home_1.jpg" alt="connect_home_1.jpg" title="connect_home_1.jpg"></span></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_instant_messaging_and_corporate_communication">Instant Messaging and Corporate Communication</h3>
<div class="sect3">
<h4 id="_1_to_1_chat">1-to-1 chat</h4>
<div class="paragraph">
<p>One-to-one Chats can start from either the Quick Access Sidebar or the Connect Tab:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>on the former, select one of the available entries (based on your chat history) and start chatting with that person right away</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_new_chat_2.png" alt="connect_new_chat_2.png" title="connect_new_chat_2.png"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>on the latter click on "New," then "New Chat" and select the person you want to chat with from the GAL</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_new_chat_1.png" alt="connect_new_chat_1.png" title="connect_new_chat_1.png"></span></p>
</div>
<div class="paragraph">
<p>Recent 1-to-1 chats appear in the "Conversations" section of the Connect Tab and the Quick Access Sidebar (round icon).</p>
</div>
</div>
<div class="sect3">
<h4 id="_groups">Groups</h4>
<div class="paragraph">
<p>Groups are how users communicate with multiple people at the same time (by default up to 5 total).
Those are non-persistent entities not tied to any specific space. Any user can create a group inviting people, and any group member can invite more people in the same way.
When all users leave a group, the group itself ceases to exist.</p>
</div>
<div class="sect4">
<h5 id="_groups_features">Groups Features</h5>
<div class="ulist">
<ul>
<li>
<p>A user in a Group can add more users to the Group itself up to the allowed limit.</p>
</li>
<li>
<p>A user in a Group can chat with all of the others.
All members of that Group can view all messages sent to the Group.</p>
</li>
<li>
<p>A user in a Group can send files to all of the others.
Files sent in a Group are available to all members of that Group.</p>
</li>
<li>
<p>An user in a Group can start a video chat with all of the others.
Group video chats can be joined at any time by all members of the Group.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Global Administrators can change the allowed maximum number of group members in the Zimbra Connect section of the Global Settings in the Admin Console.</p>
</div>
</div>
<div class="sect4">
<h5 id="_groups_ui">Groups UI</h5>
<div class="paragraph">
<p>Recent Group chats appear in the "Conversations" section of the Connect Tab and the Quick Access Sidebar (rounded square icon).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a Group</p>
<div class="paragraph">
<p>To create a new Group, click on the "New" button in the Connect Tab, and select "New Group."</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_create_new_group_1.jpg" alt="connect_create_new_group_1.jpg" title="connect_create_new_group_1.jpg"></span></p>
</div>
<div class="paragraph">
<p>then, add the Group&#8217;s title, select the buddies you wish to invite and click on "Create."</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_create_new_group_2.jpg" alt="connect_create_new_group_2.jpg" title="connect_create_new_group_2.jpg"></span></p>
</div>
</li>
<li>
<p>Inviting a participant to a Group</p>
<div class="paragraph">
<p>To invite one or more buddies to a Group expand the Group&#8217;s Info, select the users to be added and click on "Save."</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_add_user_to_group_1.jpg" alt="connect_add_user_to_group_1.jpg" title="connect_add_user_to_group_1.jpg"></span></p>
</div>
</li>
<li>
<p>Starting a Group Video Chat</p>
<div class="paragraph">
<p>To start a Group video chat, click on the "Camera" icon on the top of the Group&#8217;s chat window.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_group_start_videochat_1.jpg" alt="connect_group_start_videochat_1.jpg" title="connect_group_start_videochat_1.jpg"></span></p>
</div>
<div class="paragraph">
<p>Any member of the Group can join the call at any time by clicking on the same button.</p>
</div>
</li>
<li>
<p>Leaving a Group</p>
<div class="paragraph">
<p>To leave a Group, first, click on "Leave Group" in the Group&#8217;s Info</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_leave_group_1.png" alt="connect_leave_group_1.png" title="connect_leave_group_1.png"></span></p>
</div>
<div class="paragraph">
<p>then, click on "Yes" under the warning message.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_leave_group_2.png" alt="connect_leave_group_2.png" title="connect_leave_group_2.png"></span></p>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_spaces">Spaces</h4>
<div class="paragraph">
<p>Spaces are a themed container that can hold any number of Channels.
Think of a Space as a community center where people gather to discuss different topics in dedicated areas (named Channels).</p>
</div>
<div class="sect4">
<h5 id="_spaces_features">Spaces Features</h5>
<div class="ulist">
<ul>
<li>
<p>Each space has a unique name and topic.
You may change both the name and the Topic by clicking on the relevant field in the Space&#8217;s settings.</p>
</li>
<li>
<p>Members can leave a space at any time.</p>
</li>
<li>
<p>Space Administrators can create new channels and invite new people to the space using the appropriate buttons.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_spaces_ui">Spaces UI</h5>
<div class="paragraph">
<p>Spaces appear in a dedicated section of the Connect Tab, which gives access to all Space-related features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a Space</p>
<div class="paragraph">
<p>To create a new Space, click on the "New" button in the Connect Tab, and select "New Space."</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_new_space_1.jpg" alt="connect_new_space_1.jpg" title="connect_new_space_1.jpg"></span></p>
</div>
<div class="paragraph">
<p>then, enter the Space&#8217;s name and topic, select any users to invite and finally, click on "Save."</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_new_space_2.jpg" alt="connect_new_space_2.jpg" title="connect_new_space_2.jpg"></span></p>
</div>
</li>
<li>
<p>Leaving a Space</p>
<div class="paragraph">
<p>To leave a Space, click on the "Leave Space" in the Space&#8217;s General Channel Info.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Participants can leave a space at any time, while a Space Administrator can only leave a space if there is at least one other Space Administrator.</p>
</div>
<div class="paragraph">
<p>Both need to be invited to join the space again, and former Space Administrators get invited as regular participants but can be granted Administrator rights again.</p>
</div>
</div>
<div class="sect4">
<h5 id="_space_settings">Space Settings</h5>
<div class="paragraph">
<p>The General Channel Info in each Space defines its settings (see below).</p>
</div>
<div class="paragraph">
<p>The Space&#8217;s creator is also the first Space Administrator and can grant the same rights to any other user by clicking on the crown icon in the appropriate entry of the participant list.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_space_acls_1.png" alt="connect_space_acls_1.png" title="connect_space_acls_1.png"></span></p>
</div>
<div class="paragraph">
<p>Only Space Administrators can invite new participants, create new channels, kick people, and delete channels within the space.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_channels">Channels</h4>
<div class="paragraph">
<p>Channels are topic-defined areas inside of the same space.
Those can contain any number of users, and unlike Groups, users can autonomously join any Channel in a Space they are in instead of being invited to it by a member.</p>
</div>
<div class="paragraph">
<p>Each new Space has a "General" channel automatically created within it, which defines the space&#8217;s properties (e.g., Title and Topic) and which all users automatically join when they join the Space.</p>
</div>
<div class="sect4">
<h5 id="_channels_features">Channels Features</h5>
<div class="ulist">
<ul>
<li>
<p>A user in a Channel can chat with all of the others.
All members of that channel can view all messages sent on the Channel.</p>
</li>
<li>
<p>A user in a Channel can start a video chat with all of the others.
Channel video chats can be joined at any time by all members of the Channel.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_channnels_ui">Channnels UI</h5>
<div class="paragraph">
<p>Channels appear in Spaces within the Connect Tab, and all of the Channel-related features are managed there, by:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Creating a Channel</p>
<div class="paragraph">
<p>To create a new Channel, click on the "New" button, and select "New Channel."</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_new_channel_1.png" alt="connect_new_channel_1.png" title="connect_new_channel_1.png"></span></p>
</div>
<div class="paragraph">
<p>then select:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha">
<li>
<p>the Space that should contain the Channel (<em>mandatory</em>)</p>
</li>
<li>
<p>the Channel&#8217;s name (<em>mandatory</em>)</p>
</li>
<li>
<p>the Channel&#8217;s topic (<em>optional</em>)</p>
<div class="paragraph">
<p>finally, click on "Save."</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Joining a Channel</p>
<div class="paragraph">
<p>To join a Channel, click on the Channel label and then on "Join Channel."</p>
</div>
</li>
<li>
<p>Starting a Channel video chat</p>
<div class="paragraph">
<p>To start a Channel video chat, click on the "Camera" icon on the Channel&#8217;s chat window.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_group_start_videochat_1.jpg" alt="connect_group_start_videochat_1.jpg" title="connect_group_start_videochat_1.jpg"></span></p>
</div>
<div class="paragraph">
<p>Any member of the Channel can join the call at any time by clicking on the same button.</p>
</div>
</li>
<li>
<p>Leaving a Channel</p>
<div class="paragraph">
<p>To leave a Channel, first, click on the red "Leave Channel" entry in the Channel&#8217;s Info</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_leave_channel_1.png" alt="connect_leave_channel_1.png" title="connect_leave_channel_1.png"></span></p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both normal users and Space Admins can leave a channel at any time and join it afterward.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_file_sharing">File sharing</h3>
<div class="paragraph">
<p>Users can easily share files via Connect to Chats and Groups by dragging and dropping the files directly into the chat interface (both in the minichat and in the Connect tab) or by clicking the "paperclip" icon on the right of the message input field. Multiple files can be uploaded at once, and image files will show a preview of the file while other common filetypes will display a custom icon.</p>
</div>
<div class="paragraph">
<p>Clicking on a file within a chat window will download it to the local client using the browser&#8217;s own download interface.</p>
</div>
<div class="paragraph">
<p>Files shared via Connect will be stored inside a protected root folder on the sender&#8217;s Drive called <code>Connect sent files</code>, thus counting towards the sender&#8217;s mailbox quota, and will remain available for download in the chat window for all participants until deleted from Drive by the sender.</p>
</div>
</div>
<div class="sect2">
<h3 id="_video_chat">Video Chat</h3>
<div class="paragraph">
<p>Video Chat features are available in 1-to-1 chats, Groups, and Channels, allowing multiple people to communicate in real-time using a webcam and a headset, as well as allowing them to share their screen with all other attendees.</p>
</div>
<div class="paragraph">
<p>The WebRTC protocol is the foundation for this feature.
WebRTC is a peer-to-peer auto-adaptive technology that allows clients to communicate directly without overloading the server.
Call quality is automatically tweaked based on the available bandwidth, with the maximum quality being <em>Full HD</em> for both video and audio.
When starting their first video chat, users need to grant their browser access permissions to their camera and microphone.</p>
</div>
<div class="sect3">
<h4 id="_video_chat_ui">Video Chat UI</h4>
<div class="paragraph">
<p><span class="image"><img src="images/connect_group_videochat.png" alt="connect_group_videochat.png" title="connect_group_videochat.png"></span></p>
</div>
<div class="paragraph">
<p>The video chat UI has three main areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The center displays video streams with a single (main) stream on the top and multiple secondary streams on the bottom.
The total number depends on the screen&#8217;s resolution and window size.</p>
</li>
<li>
<p>On the left is the Group&#8217;s or Channel&#8217;s instant messaging chat.
This chat is visible and entirely usable, and its history gets retained in the group&#8217;s or channel&#8217;s chat history.</p>
</li>
<li>
<p>On the bottom left appear the user&#8217;s video feed and controls (disable video, mute microphone, and share screen).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users can disconnect from an ongoing video chat by pressing the "Hang up" button in their video stream&#8217;s frame on the bottom left of the screen.
Whenever a video chat is on, users belonging to the Group or Channel of the video chat see a "Call in progress" message below the name of the Group or Channel and may join by clicking on the "Camera" icon in the chat.</p>
</div>
<div class="sect4">
<h5 id="_video_stream_control">Video Stream Control</h5>
<div class="paragraph">
<p>Video streams are displayed in a "first come, first served" basis according to the connection order between the peers.</p>
</div>
<div class="paragraph">
<p>Every participant can mute their audio stream or stop their video stream.</p>
</div>
</div>
<div class="sect4">
<h5 id="_screen_sharing">Screen Sharing</h5>
<div class="paragraph">
<p><span class="image"><img src="images/connect_videochat_screensharing_1.png" alt="connect_videochat_screensharing_1.png" title="connect_videochat_screensharing_1.png"></span></p>
</div>
<div class="paragraph">
<p>When clicking on the Screen Share button, a pop-up window appears asking the user whether to share their entire screen or just a specific window.
After choosing, the screen sharing feed replaces the user&#8217;s webcam feed for all participants.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_instant_meetings">Instant Meetings</h3>
<div class="paragraph">
<p>Instant Meetings are one-shot Video Chats that can be attended by external users as well as internal users.
Only users with the Advanced Connect features enabled can start Instant Meetings, but any internal or external user can attend.</p>
</div>
<div class="paragraph">
<p>To create an Instant Meeting, click on the "New" button in the Connect Tab, and select Instant Meeting.</p>
</div>
<div class="paragraph">
<p>Then, fill in the attendee list by entering any internal or external email address in the text box and pressing enter to add it to the list.
Once all attendees are added, press "Save" to send an email notification to all participants and start the Instant Meeting.</p>
</div>
<div class="sect3">
<h4 id="_instant_meeting_urls">Instant Meeting URLs</h4>
<div class="paragraph">
<p>Both external and internal users can join an Instant Meetings through a dedicated URL that can be found both in the invitation email and in the information section of the Instant Meeting itself.</p>
</div>
<div class="paragraph">
<p>Such URLs are uniquely generated for each Instant Meeting and expire 10 minutes after the host leaves the meeting.</p>
</div>
</div>
<div class="sect3">
<h4 id="_instant_meeting_ui">Instant Meeting UI</h4>
<div class="paragraph">
<p>The Instant Meeting feature uses the very same UI as any internal Video Chat session.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_autocomplete">Autocomplete</h3>
<div class="paragraph">
<p>Autocomplete in Zimbra Connect is split in two different categories: <strong>Internal</strong> Autocomplete and <strong>External</strong> autocomplete.</p>
</div>
<div class="paragraph">
<p>Internal autocomplete kicks in when selecting a target for 1-1 Chats, Group Chats, Spaces and Channels, while External autocomplete is only used for Instant Meeting attendees.</p>
</div>
<div class="paragraph">
<p>This can be changed by setting the <code>teamCrossDomainSearchMode</code> COS property to either <code>local</code>, <code>extended</code> or <code>global</code> using the <code>zxsuite config [get/set/empty]</code> CLI toolset.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>local</em> mode, in which Internal Autocomplete will draw its information from the GAL, while External autocomplete will draw its information from the user&#8217;s Contacts and GAL.</p>
</li>
<li>
<p><em>extended</em> mode is a superset of <em>local</em> that also matches full email addresses of any user in the same infrastructure as internal users.</p>
<div class="ulist">
<ul>
<li>
<p>This allows to initiate a 1-1 Chat with or to add to a Group/Space/Channel any user that is on the same infrastructure but out of the GAL as long as the exact email address is entered.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>global</em> mode is a superset of <em>extended</em> that does not require an exact match on the email address to autocomplete users in the same infrastructure.</p>
<div class="ulist">
<ul>
<li>
<p>This allows to autocomplete any user in the infrastructure as opposed to the strict email addres match required in <em>extended</em> mode.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_autocomplete_management.jpeg" alt="connect_autocomplete_management.jpeg" title="connect_autocomplete_management.jpeg"></span></p>
</div>
<div class="paragraph">
<p>The default setting inherited by all COS is <em>local</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_presence">Presence</h3>
<div class="paragraph">
<p>Presence is managed automatically in Zimbra Connect: whenever a user logs in, regardless of whether the Connect Tab has the focus, they appear as <strong>online</strong>.</p>
</div>
<div class="paragraph">
<p>As part of the user presence system, all messages get displayed with a variable number of check symbols:
<span class="image"><img src="images/connect_message_delivered_1.png" alt="connect_message_delivered_1.png" title="connect_message_delivered_1.png"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>0 checks, message not delivered to the server</p>
</li>
<li>
<p>1 check, message delivered to the server</p>
</li>
<li>
<p>2 checks, message viewed by all users</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_unread_messages">Unread Messages</h3>
<div class="paragraph">
<p>The number of unread messages in any conversation, Group or Channel appears on the right side of the conversation, Group, or Channel.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/connect_unread_messages_1.png" alt="connect_unread_messages_1.png" title="connect_unread_messages_1.png"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_chat_history">Chat History</h3>
<div class="paragraph">
<p>Chat History for each 1-to-1 Chat, Group, and Channel is available in the very same window (e.g., enter a Channel to see all of that channel’s history) and messages delivered to offline users appear in the appropriate IM conversation, Group or Channel.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stunturn_server">STUN/TURN Server</h3>
<div class="paragraph">
<p>Since WebRTC is a peer-to-peer protocol, all users in a video chat must be able to reach each other&#8217;s client for the connections to get established.</p>
</div>
<div class="paragraph">
<p>Should this not be possible, because of NAT rules on the network or because of a Service Provider&#8217;s policy, using a TURN server ensures proper communication between all peers.
Zimbra Connect is designed to allow using a STUN/TURN server out of the box by simply adding the TURN server&#8217;s URL and login information in the zimlet configuration.</p>
</div>
<div class="sect3">
<h4 id="_setting_up_zimbra_connect_to_use_a_turn_server">Setting up Zimbra Connect to use a TURN server</h4>
<div class="paragraph">
<p>A dedicated set of TURN configuration tools is available via CLI through the <code>zxsuite connect iceServer</code> command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>zimbra@mailserver:~$ zxsuite connect iceServer

Edit the list of ICE servers used to establish connections for video calls.
Configuration scope can be global(default), cos, or account.

  add                      - add ice server candidates using global (default), cos or account
                             zxsuite connect iceServer add {turn:turn.example.com:3478?transport=udp} [attr1 value1 [attr2 value2...]]

  remove                   - remove ice server candidates using global (default), cos or account
                             zxsuite connect iceServer remove {turn:turn.example.com:3478?transport=udp} [attr1 value1 [attr2 value2...]]

  get                      - get ice server candidates using global (default), cos or account
                             zxsuite connect iceServer get [attr1 value1 [attr2 value2...]]</pre>
</div>
</div>
<div class="paragraph">
<p>The "add" subcommand is used to add a new TURN server:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Syntax:
   zxsuite connect iceServer add {turn:turn.example.com:3478?transport=udp} [attr1 value1 [attr2 value2...]]

PARAMETER LIST

NAME             TYPE      EXPECTED VALUES
url(M)           String    turn:turn.example.com:3478?transport=udp
username(O)      String    myuser
credential(O)    String    mysecretkey
account(O)       String    user@example.com
cos(O)           String    default

(M) == mandatory parameter, (O) == optional parameter

Usage example:

zxsuite connect iceServer add turn:turn.example.com credential mysecret username myuser
zxsuite connect iceServer add turn:turn.example.com credential mysecret username myuser account testaccount@example.com</pre>
</div>
</div>
<div class="paragraph">
<p>Multiple TURN servers can be added to handle different users or Classes of Service (defined through the <code>user</code> and <code>cos</code> optional parameters of the command above).</p>
</div>
<div class="paragraph">
<p>On the TURN-server side, it is strongly recommended to have a single user,  authenticated with a username and secret key, for ease-of-use reasons as a 1:1 correspondence between Zimbra users and TURN users is not necessary.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_connect_video_server">Zimbra Connect Video Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Zimbra Connect Video Server is a WebRTC stream aggregator that improves Connect&#8217;s performance by merging and decoding/re-encoding all streams in a Meeting.</p>
</div>
<div class="paragraph">
<p>While the default WebRTC creates one incoming and one outgoing stream per meeting participant, with the Zimbra Connect Video Server, each client will only have one aggregated inbound stream and one aggregated outbound stream. This applies for both video and audio.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>E.g. - 5 people meeting</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Without Video Server: each client generates 4x outgoing video/audio streams and receives 4 incoming video/audio streams</p>
</li>
<li>
<p>With Video Server: each client generates 1 outgoing video/audio stream and receives 1 incoming video/audio stream</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Video Server</th>
<th class="tableblock halign-left valign-top">Incoming Connections</th>
<th class="tableblock halign-left valign-top">Outgoing Connections</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 (1 from each other client)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 (1 to each other client)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="paragraph">
<p>By default, the Video Server uses conservative Codecs (VP8 and Opus) to ensure the broadest compatibility, but more codecs can be enabled. It also splits the Webcam and Screen Sharing streams and reserves the same bandwidth for both.</p>
</div>
<div class="paragraph">
<p>A properly set up Video Server will supersede the need of a TURN server, provided that all clients can reach the Video Server&#8217;s public IP and that UDP traffic is not filtered.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The Zimbra Connect Video Server is still in Beta stage, and thus only a single server is allowed per Zimbra infrastructure.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_requirements">Requirements</h3>
<div class="paragraph">
<p>The Zimbra Connect Video Server must be installed on a dedicated server and has the following requirements:</p>
</div>
<div class="paragraph">
<p><strong>System</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Minimum 4 CPU cores, suggested at least 8 to handle more than 100 users at the same time</p>
</li>
<li>
<p>1024mb of ram + 1mb of ram for each connected user</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The Zimbra Connect Video Server mainly scales on the CPU, so more CPU cores and power means more connected users.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Network</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>A public IP</p>
</li>
<li>
<p>A publicly resolvable FQDN</p>
</li>
<li>
<p>With the default settings, 200kb/s (0.2 mb/s) bandwidth for each connected user</p>
</li>
<li>
<p>WebSockets</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Ports</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The mailbox server will establish a WebSocket on port 8188 to communicate with the Video Server</p>
</li>
<li>
<p>Clients will use a random UDP port between 20000 and 40000</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_hostname_configuration">Hostname configuration</h4>
<div class="paragraph">
<p>In order for the installer to be fully functional, it&#8217;s advised to set up the Video Server&#8217;s hostname internally using <code>hostnamectl</code> before the installation in order to avoid a wrong or short-form hostname to be passed on from the OS to the Installer and to update the <code>/etc/hosts</code> and <code>/etc/hostnames</code> files accordingly to make the change permanent.</p>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>sudo hostnamectl set-hostname hostname.domain.tld

sudo vi /etc/hostname
  video-hostname.domain.tld

sudo vi /etc/hosts
  127.0.0.1 localhost
  ...
  xxx.yyy.zzz.zzz video-hostname.domain.tld
  ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Based on your system configuration, a system or service restart will be needed to apply the new configuration.</p>
</div>
<div class="paragraph">
<p>Adding the appropriate information to the /etc/hosts file the mailbox server will also ensure the correct resolution of the Video Server.</p>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="title">/etc/hosts (mailbox)</div>
<div class="content">
<pre class="CodeRay highlight"><code>...
xxx.yyy.zzz.zzz video-hostname.domain.tls
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s not necessary to add the mailbox server to the <code>/etc/hosts</code> of the Video Server as the connection is one way only, mailbox to video.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_client_configuration">Client Configuration</h3>
<div class="paragraph">
<p>No client configuration is needed, as the Connect Zimlet will autonomously detect whether a video server is set up an use it if available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_2">Installation</h3>
<div class="ulist">
<ul>
<li>
<p>Update your OS and packages through <code>apt-update &amp;&amp; apt-upgrade</code> (Ubuntu) or <code>yum update</code> (CentOS)</p>
</li>
<li>
<p>Download the installer package</p>
</li>
<li>
<p>Copy the installer package to the server</p>
</li>
<li>
<p>Unpack the installer package with <code>tar zxvf videoserver-[OS]-installer.tgz</code></p>
</li>
<li>
<p>Enter the unpacked direcotry: <code>cd videoserver-installer</code></p>
</li>
<li>
<p>Run the installation script: <code>./install.sh</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>root@196252589efe:~/videoserver-installer# ./install.sh

This script will install VideoServer, and all its runtime
dependencies onto the running system.

To complete the process a working network connection is required.


System will be modified, would you like to proceed? [Y]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The installer will first check for the needed dependencies and install any missing ones:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>software-properties-common not found. Would you like to install it? [Y]

[...]
The following additional packages will be installed:
  cron dirmngr distro-info-data gnupg gnupg-l10n gnupg-utils gpg gpg-agent gpg-wks-client gpg-wks-server gpgconf gpgsm iso-codes libapt-inst2.0 libasn1-8-heimdal libassuan0 libgssapi3-heimdal
  libhcrypto4-heimdal libheimbase1-heimdal libheimntlm0-heimdal libhx509-5-heimdal libkrb5-26-heimdal libksba8 libldap-2.4-2 libldap-common libnpth0 libroken18-heimdal libsasl2-2 libsasl2-modules
  libsasl2-modules-db libwind0-heimdal lsb-release pinentry-curses powermgmt-base python-apt-common python3-apt python3-software-properties unattended-upgrades
Suggested packages:
  anacron logrotate checksecurity exim4 | postfix | mail-transport-agent dbus-user-session pinentry-gnome3 tor parcimonie xloadimage scdaemon isoquery libsasl2-modules-gssapi-mit
  | libsasl2-modules-gssapi-heimdal libsasl2-modules-ldap libsasl2-modules-otp libsasl2-modules-sql lsb pinentry-doc python3-apt-dbg python-apt-doc bsd-mailx default-mta | mail-transport-agent needrestart
The following NEW packages will be installed:
  cron dirmngr distro-info-data gnupg gnupg-l10n gnupg-utils gpg gpg-agent gpg-wks-client gpg-wks-server gpgconf gpgsm iso-codes libapt-inst2.0 libasn1-8-heimdal libassuan0 libgssapi3-heimdal
  libhcrypto4-heimdal libheimbase1-heimdal libheimntlm0-heimdal libhx509-5-heimdal libkrb5-26-heimdal libksba8 libldap-2.4-2 libldap-common libnpth0 libroken18-heimdal libsasl2-2 libsasl2-modules
  libsasl2-modules-db libwind0-heimdal lsb-release pinentry-curses powermgmt-base python-apt-common python3-apt python3-software-properties software-properties-common unattended-upgrades
0 upgraded, 39 newly installed, 0 to remove and 4 not upgraded.
[...]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>You will be then prompted to install the actual Video Server packages:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Would you like to install VideoServer? [Y]
Reading package lists... Done
Building dependency tree
Reading state information... Done
Note, selecting 'zimbra-ffmpeg' instead of '/root/videoserver-installer/packages/zimbra-ffmpeg_4.3.1-1_amd64.deb'
Note, selecting 'zimbra-libfdk-aac' instead of '/root/videoserver-installer/packages/zimbra-libfdk-aac_2.0.1-1_amd64.deb'
Note, selecting 'zimbra-libnice' instead of '/root/videoserver-installer/packages/zimbra-libnice_0.1.18-1_amd64.deb'
Note, selecting 'zimbra-libopus' instead of '/root/videoserver-installer/packages/zimbra-libopus_1.3.1-1_amd64.deb'
Note, selecting 'zimbra-libsrtp' instead of '/root/videoserver-installer/packages/zimbra-libsrtp_2.3.0-1_amd64.deb'
Note, selecting 'zimbra-libusrsctp' instead of '/root/videoserver-installer/packages/zimbra-libusrsctp_0.9.3.0-1_amd64.deb'
Note, selecting 'zimbra-libvpx' instead of '/root/videoserver-installer/packages/zimbra-libvpx_1.9.0-1_amd64.deb'
Note, selecting 'zimbra-libwebsockets' instead of '/root/videoserver-installer/packages/zimbra-libwebsockets_4.1.4-1_amd64.deb'
Note, selecting 'zimbra-videoserver-confs' instead of '/root/videoserver-installer/packages/zimbra-videoserver-confs_0.10.5-1_amd64.deb'
Note, selecting 'zimbra-videoserver' instead of '/root/videoserver-installer/packages/zimbra-videoserver_0.10.5-1_amd64.deb'
[...]</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Once all packages are installed, you will be asked the <strong>Public IP Address</strong> of the video server itself:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Configuring zimbra-videoserver
------------------------------



Please insert the Public IP server to bind with.

.: Public IP server :.</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>This is the only bit of configuration required. The installer will set up the Video Server and then return two commands that must be executed on any Mailbox Server of the infrastructure to set up the connection with the Video Server and enable it for all servers:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>Please execute these commands in a mailbox node as zimbra user to complete the setup of the video server:

zxsuite config global set attribute teamVideoServerSharedSecret value [SERVER HASH]
zxsuite config global set attribute teamVideoServerHostname value [HOSTNAME]:8188</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_service_control">Service Control</h3>
<div class="paragraph">
<p>The Video Server service can be controlled through the <code>zxsuite connect</code> CLI from any mailbox server.</p>
</div>
<div class="paragraph">
<p>To stop the service run <code>zxsuite connect doStopService team-videoserver-pool</code>, to start it run <code>zxsuite connect doStartService team-videoserver-pool</code>.</p>
</div>
<div class="paragraph">
<p>To check the Video Server&#8217;s status, run <code>zxsuite connect clusterstatus</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[zimbra@mail ~]$ zxsuite connect clusterstatus

        isFullySynced                                       true
        servers
        meeting_servers
            &lt;ip_videoserver&gt;:8188
                id                                                          123
                hostname                                                    &lt;ip_videoserver&gt;:8188
                status                                                      online
                last_failure
                num_meetings                                                -1</pre>
</div>
</div>
<div class="paragraph">
<p>Should the remote Video Server be offline or unreachable, an output similar to the following will be displayed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[zimbra@mail ~]$ zxsuite connect clusterstatus

[...]
                status                                                      offline
                last_failure
                num_meetings                                                -1</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bandwidth_and_codecs">Bandwidth and Codecs</h3>
<div class="sect3">
<h4 id="_video_bandwidth">Video Bandwidth</h4>
<div class="paragraph">
<p>The administrator can set the webcam stream quality and the screenshare stream quality specifing the relative bitrate <em>in Kbps</em>. The values must be at least 100 Kbps and can be increased as desired.</p>
</div>
<div class="paragraph">
<p>Higher values mean more quality but more used bandwidth.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zxsuite config global set attribute teamChatWebcamBitrateCap value 200</code>: is the command for the webcam stream quality/bandwidth</p>
</li>
<li>
<p><code>zxsuite config global set attribute teamChatScreenBitrateCap value 200</code>: is the command for the screenshare stream qualitybandwidth</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default both the webcam bandwidth and the screen sharing bandwidth are set to 200 Kbps.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_video_codecs">Video Codecs</h4>
<div class="paragraph">
<p>By default, the VP8 video codec is used. This is to ensure the best compatibility, as this codec is available in all supported browsers, but other codecs can be enabled:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AV1: <code>zxsuite config global set attribute teamChatVideoCodecAV1 value true</code></p>
</li>
<li>
<p>H264: <code>zxsuite config global set attribute teamChatVideoCodecH264 value true</code></p>
</li>
<li>
<p>H265: <code>zxsuite config global set attribute teamChatVideoCodecH265 value true</code></p>
</li>
<li>
<p>VP8: <code>zxsuite config global set attribute teamChatVideoCodecVP8 value true</code></p>
</li>
<li>
<p>VP9: <code>zxsuite config global set attribute teamChatVideoCodecVP9 value true</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Only one codec can be enabled at the time, so before enabling a new codec remember to disable the previous one using the same command as the one in the list above but substituting <code>value true</code> with <code>value false</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>E.g. to enable the H264 codec run:</p>
</div>
<div class="paragraph">
<p><code>zxsuite config global set attribute teamChatVideoCodecVP8 value false</code></p>
</div>
<div class="paragraph">
<p><code>zxsuite config global set attribute teamChatVideoCodecH264 value true</code></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_audio_codec">Audio Codec</h4>
<div class="paragraph">
<p>The audio codec used by the Zimbra Connect Video Server is Opus. No other codecs are supported, as Opus is currently the only reliable one available across all supported browsers.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_settings">Advanced settings</h3>
<div class="paragraph">
<p>The following settings influence the audio experience,</p>
</div>
<div class="sect3">
<h4 id="_audio_quality">Audio Quality</h4>
<div class="paragraph">
<p>The administrator can set the Opus audio quality by setting the sampling rate (in Hz) in the <code>teamChatAudioSamplingRate</code> global attribute.</p>
</div>
<div class="paragraph">
<p>The available values are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>8000  &#8594; represents the narrowband bandwidth</p>
</li>
<li>
<p>12000 &#8594; represents the mediumband bandwidth</p>
</li>
<li>
<p>16000 &#8594; represents the wideband bandwidth</p>
</li>
<li>
<p>24000 &#8594; represents the superwideband bandwidth</p>
</li>
<li>
<p>48000 &#8594; represents the fullband bandwidth</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>(see: <a href="https://en.wikipedia.org/wiki/Opus_(audio_format)#Bandwidth_and_sampling_rate" class="bare">https://en.wikipedia.org/wiki/Opus_(audio_format)#Bandwidth_and_sampling_rate</a> )</p>
</div>
<div class="paragraph">
<p>The 16000 Hz is the default value.</p>
</div>
<div class="sect4">
<h5 id="_audio_sensitivity">Audio Sensitivity</h5>
<div class="paragraph">
<p>The administrator can optimize the audio sensitivity with these two commands:</p>
</div>
<div class="paragraph">
<p><code>zxsuite config global set attribute teamChatAudioLevelSensitivity value 25</code></p>
</div>
<div class="paragraph">
<p><code>zxsuite config global set attribute teamChatAudioSamplingSensitivityInterval value 2</code></p>
</div>
<div class="paragraph">
<p>The audio level sensitivity defines how much the audio should be normalized between all the audio sources.
The value has a range between 0 and 100 where 0 represents the audio muted and 100 the maximum audio level (too loud).</p>
</div>
<div class="paragraph">
<p>By default the value is set to 25.</p>
</div>
<div class="paragraph">
<p>The audio sampling sensitivity interval defines the interval in seconds used to compute the audio sensitivity level.
By default the value is set to 2 seconds, this means that the video server normalizes the audio level considering the audio sources of the last 2 seconds.</p>
</div>
<div class="paragraph">
<p>The value should be at least 0.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_uninstallation">Uninstallation</h3>
<div class="paragraph">
<p>In order to uninstall the Video Server, use the system&#8217;s package manager to remove the following packages:</p>
</div>
<div class="paragraph">
<p><code>zimbra-libvpx, zimbra-libopus, zimbra-libfdk-aac, zimbra-ffmpeg, zimbra-libwebsockets, zimbra-libsrtp, zimbra-libnice, zimbra-libusrsctp, zimbra-videoserver</code></p>
</div>
<div class="paragraph">
<p>On CentOS, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>sudo systemctl stop videoserver.service
sudo systemctl disable videoserver.service
sudo yum remove zimbra-libvpx zimbra-libopus zimbra-libfdk-aac zimbra-ffmpeg zimbra-libwebsockets zimbra-libsrtp zimbra-libnice zimbra-libusrsctp zimbra-videoserver</code></pre>
</div>
</div>
<div class="paragraph">
<p>On Ubuntu, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>sudo systemctl stop videoserver.service
sudo systemctl disable videoserver.service
sudo apt remove zimbra-libvpx zimbra-libopus zimbra-libfdk-aac zimbra-ffmpeg zimbra-libwebsockets zimbra-libsrtp zimbra-libnice zimbra-libusrsctp zimbra-videoserver</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_open_drive">Zimbra Open Drive</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong><em>Zimbra Open Drive has been deprecated and replaced with Zimbra Drive V2.  If attempting to use Zimbra Open Drive, there are known issues with connecting to the latest versions of Nextcloud and ownCloud which will not be addressed.</em></strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zimbra Open Drive is a client that interfaces Zimbra to third party products and services.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Prior to version 8.8.11, Zimbra Open Drive was known as Zimbra Drive.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Zimbra Open Drive currently works with:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Nextcloud</p>
</li>
<li>
<p>ownCloud</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Data on Zimbra Open Drive is not hosted on the Zimbra server or on any other
Zimbra product. Likewise, the data is not managed by Zimbra or any incorporated
service. Therefore, Zimbra Support does not support issues related to Nextcloud
and ownCloud servers.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_about_this_document">About this Document</h3>
<div class="paragraph">
<p>This document is written for system administrators, and it aims to provide an
in-depth view of the product architecture and the knowledge necessary
for solid customizations.</p>
</div>
<div class="paragraph">
<p>Zimbra Open Drive is included in Zimbra starting in version 8.7.6 as Beta
software and version 8.8.0 as Stable. Zimbra Open Drive is provided as an included
package of Zimbra Collaboration Suite, so Zimbra Open Drive can be installed
during the Zimbra installation process.</p>
</div>
<div class="paragraph">
<p>The <code>Installation</code> and <code>Configuration</code> chapters
cover the installation and the configuration of
the product in the supported environments respectively.<br>
The upgrade process and compatibility information is covered in the <code>Upgrade</code> chapter.<br>
The <code>Uninstallation</code> chapter contains the procedure to uninstall
Zimbra Open Drive. Advanced topics, such as how to build the software from the
sources, are in the <code>Advanced Topics</code> chapter.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Backups, archiving, access security and user management is not done by
or within Zimbra.<br>
Malfunctions, data and access security as well as storage management and data
archiving on any third party product is not managed by Zimbra or through Zimbra
software nor falls under any Zimbra Support contract as stated in section
2.4(a) of Zimbra&#8217;s "Maintenance &amp; Support Terms and Conditions".
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_overview_6">Overview</h3>
<div class="sect3">
<h4 id="general_architecture">General Architecture</h4>
<div class="paragraph">
<p>The purpose of Zimbra Open Drive is to connect the Zimbra end user to a
cloud service, external to Zimbra.</p>
</div>
<div class="paragraph">
<p>Zimbra Open Drive has three parts: Zimbra Extension, Zimlet and
Cloud App. These parts integrate external storage services and
an authentication mechanism into the Zimbra
Web Interface. Each Zimbra account will be linked to the external storage
service account.</p>
</div>
</div>
<div class="sect3">
<h4 id="_components_2">Components</h4>
<div class="paragraph">
<p>Zimbra Open Drive includes the following components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zimbra Open Drive Extension</p>
</li>
<li>
<p>Zimlet</p>
</li>
<li>
<p>Cloud App</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Each component is mandatory and requires careful configuration.
However, errors in installation or configuration won’t affect Zimbra
usability.</p>
</div>
</div>
<div class="sect3">
<h4 id="_extension">Extension</h4>
<div class="paragraph">
<p>The Zimbra Open Drive extension is installed in the <code>mailboxd</code> component. The extension
acts between the Zimbra Open Drive Zimlet and the Cloud App,
providing services like authentication and item actions to the Zimlet.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zimlet">Zimlet</h4>
<div class="paragraph">
<p>The Zimbra Open Drive Zimlet adds a new <em>Open Drive</em> tab to the user Zimbra interface, before
the Preferences tab. With the Zimlet, user can search in the linked cloud.<br>
The Zimlet component is contained in the package <code>com_zextras_drive_open.zip</code>.
The Zimlet name is <code><em>com_zextras_drive_open</em></code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="supportedClouds">Cloud App</h4>
<div class="paragraph">
<p>The external services of cloud storage need a specific app with a dedicated
API to communicate with the Zimbra Open Drive Extension. Zimbra Open Drive provides an
app for each of the services supported.</p>
</div>
<div class="sect4">
<h5 id="nextcloudowncloud">Nextcloud/ownCloud</h5>
<div class="paragraph">
<p>The Nextcloud/ownCloud app is a specific application for Nextcloud and
ownCloud. It provides transparent authentication in ownCloud and
Nextcloud using Zimbra credentials and a layer of compatibility that
abstracts the version of ownCloud and Nextcloud for the extension.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_installation_3">Installation</h3>
<div class="paragraph">
<p>This chapter guides the administrator through the manual installation of Zimbra Open Drive.</p>
</div>
<div class="sect3">
<h4 id="requirements">Requirements</h4>
<div class="ulist">
<ul>
<li>
<p>Root-level access to the underlying operating system.</p>
</li>
<li>
<p>Administrative access to an external cloud supported service (see
<a href="#supportedClouds">Cloud App</a>).<br>
Supported versions:</p>
<div class="ulist">
<ul>
<li>
<p>Nextcloud 9, 10, 11</p>
</li>
<li>
<p>ownCloud 9.0, 9.1, 10</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="zimbra-packages-installation">Zimbra Packages Installation</h4>
<div class="paragraph">
<p>This section describes how to install the Zimbra Open Drive Extension
and the Zimbra Open Drive Zimlet.</p>
</div>
<div class="paragraph">
<p>Both the Zimbra Open Drive Extension and the Zimlet are installed through the official Zimbra
installer. The Zimbra installer prompts you as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Use Zimbra's package repository [Y] Yes
...
Install zimbra-drive [Y] Yes</pre>
</div>
</div>
<div class="sect4">
<h5 id="zimbra-already-installed">Zimbra Already Installed</h5>
<div class="paragraph">
<p>The Zimbra installation adds the Zimbra repositories to apt sources
list, so Zimbra Open Drive can be installed through the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As root, when apt-get is available
apt-get update
apt-get install zimbra-drive
# As root, when yum is available
yum update
yum install zimbra-drive</pre>
</div>
</div>
<div class="paragraph">
<p>Hereafter, the Zimbra Open Drive Extension will be enabled with the zimlet deploy
command and a mailbox restart:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmzimletctl deploy /opt/zimbra/zimlets/com_zextras_drive_open.zip
zmmailboxd  restart</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-app-installation">Cloud App Installation</h4>
<div class="paragraph">
<p>Here are the steps to install the Zimbra Open Drive Cloud App to the
specific supported cloud.</p>
</div>
<div class="paragraph">
<p>The cloud services currently supported are Nextcloud and ownCloud with
the archive <code>zimbradrive.tar.gz</code>.</p>
</div>
<div class="sect4">
<h5 id="subsec:NextcloudownCloudInstallation">Nextcloud/ownCloud</h5>
<div class="paragraph">
<p>Nextcloud and ownCloud require the same following installation steps.<br>
The placeholder <code>PATHTOCLOUD</code> is the path of the Nextcloud/ownCloud
service in server:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy <code>zimbradrive.tar.gz</code> in Nextcloud/ownCloud drive:<br>
<code>scp zimbradrive.tar.gz root@cloud:/tmp</code></p>
</li>
<li>
<p>In Nextcloud/ownCloud server, extract <code>zimbradrive.tar.gz</code> in
<code>PATHTOCLOUD/apps</code>:<br>
<code>tar -xvzf zimbradrive.tar.gz -C PATHTOCLOUD/apps</code></p>
</li>
<li>
<p>Change permissions of the extracted folder
<code>PATHTOCLOUD/apps/zimbradrive</code> with the user owner of Nextcloud/ownCloud
(E.g.: www-data):<br>
<code>chown -R www-data:www-data PATHTOCLOUD/apps/zimbradrive/</code></p>
</li>
<li>
<p>Enable Zimbra Open Drive App from Nextcloud/ownCloud Admin Interface or
with command:<br>
<code>sudo -u www-data php PATHTOCLOUD/occ app:enable zimbradrive</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At this point, the Nextcloud/ownCloud Zimbra Open Drive App is installed and
requires configuration.</p>
</div>
<div class="paragraph">
<p>On Apache Web Server, Zimbra Open Drive doesn’t work if the server is not
correctly configured. Refer to these instructions for <em>Apache Web Server
Configuration</em> in the Nextcloud manual:
<a href="https://docs.nextcloud.com/server/11/admin_manual/installation/source_installation.html#apache-web-server-configuration">Nextcloud
installation</a> or in the ownCloud manual:
<a href="https://doc.owncloud.org/server/10.0/admin_manual/installation/manual_installation.html#configure-the-web-server">ownCloud
installation</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuration">Configuration</h3>
<div class="paragraph">
<p>Zimbra Open Drive configuration is split into the Zimbra side and the Cloud side.
The Zimbra Open Drive Zimlet doesn’t need more than standard Zimlet
configuration, so the Zimbra side requires only Zimbra Open Drive
Extension configuration. On the Cloud side, each supported cloud service
configuration will be shown later. These are independent, and you need
only configure for your desired cloud service.</p>
</div>
<div class="sect3">
<h4 id="zimbra-extension-configuration">Zimbra Extension Configuration</h4>
<div class="paragraph">
<p>The Zimbra Extension setup requires the URL of the cloud service that will
be paired. This URL has to be set in the domain attribute
<code>zimbraDriveOwnCloudURL</code>, and it is common to all users belonging the same
domain. Different domains may have different cloud service URLs.<br>
The command to set the cloud service URL is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmprov md domainExample.com zimbraDriveOwnCloudURL CLOUD_URL</pre>
</div>
</div>
<div class="paragraph">
<p>The cloud service URL (<code>CLOUD_URL</code>) has to be in the form:
<code>protocol://cloudHost/path</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>protocol</code>: can be <code>http</code> or <code>https</code></p>
</li>
<li>
<p><code>cloudHost</code>: hostname of the server with the cloud service</p>
</li>
<li>
<p><code>path</code>: path in server of the targeted cloud service</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each cloud service has its entry point.<br>
In Nextcloud/ownCloud, the URL has to target <code>index.php</code>
<code>protocol://cloudHost/path/index.php</code></p>
</div>
</div>
<div class="sect3">
<h4 id="cloud-app-configuration">Cloud App Configuration</h4>
<div class="sect4">
<h5 id="NextcloudownCloudInstallation">Nextcloud/ownCloud</h5>
<div class="paragraph">
<p>When everything is correctly configured, the Zimbra end user creates a
private account in the cloud service that will be paired with the Zimbra
user account. This new cloud account inherits the Zimbra user credentials
and appears in the user&#8217;s list of Nextcloud/ownCloud interface; however
this account is not active until the Zimbra Open Drive app is enabled.</p>
</div>
<div class="paragraph">
<p>Nextcloud and ownCloud have the same following configuration entries. In the
Nextcloud/ownCloud administration panel, it must appear as a new <code>Zimbra
Open Drive</code> entry in the left sidebar that redirect to the configuration
view. There are the following configurations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>(CheckBox) <strong>Enable Zimbra authentication back end</strong><br>
(Mandatory checked) On check, adds a configuration in config.php that lets
Nextcloud/ownCloud use Zimbra Open Drive App class. On uncheck, removes this
configuration.</p>
</li>
<li>
<p>(CheckBox) <strong>Allow Zimbra’s users to log in</strong><br>
(Mandatory checked) Allows Zimbra users to use Nextcloud/ownCloud with
their Zimbra credentials.</p>
</li>
<li>
<p>(InputField) <strong>Zimbra Server</strong><br>
(Mandatory) Zimbra webmail host or ip.</p>
</li>
<li>
<p>(InputField) <strong>Zimbra Port</strong><br>
(Mandatory) Zimbra webmail port.</p>
</li>
<li>
<p>(CheckBox) <strong>Use SSL</strong><br>
Check if the Zimbra webmail port uses SSL certification.</p>
</li>
<li>
<p>(CheckBox) <strong>Enable certification verification</strong><br>
Disable only if Zimbra has an untrusted certificate.</p>
</li>
<li>
<p>(InputField) <strong>Domain Preauth Key</strong><br>
After the Zimbra end user creates a private account with the first
successful access in Zimbra Open Drive, he can log into the Nextcloud/ownCloud web
interface using Zimbra credentials. In the Nextcloud/ownCloud web
interface, he will find a Zimbra icon in the Apps menu that opens a new
Zimbra webmail tab without a login step.<br>
This feature works only if the Zimbra Domain PreAuth Key is copied. In
Zimbra, run the following command to show the desired Zimbra
Domain PreAuth Key:<br>
<code># As zimbra</code><br>
<code>zmprov getDomain example.com zimbraPreAuthKey</code><br>
<code># If response is empty, generate with</code><br>
<code>zmprov generateDomainPreAuthKey domainExample.com</code><br></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_upgrade">Upgrade</h3>
<div class="paragraph">
<p>This chapter guides administrators through the manual upgrade of
Zimbra Open Drive. It’s important to pay attention to the version of each
component: the compatibility is granted only if each component has the
same version.<br>
The Zimbra Open Drive Zimlet and extension  can be upgraded a with Zimbra upgrade,
but the Zimbra Open Drive App must be manually updated.</p>
</div>
<div class="sect3">
<h4 id="zimbra-extension-and-zimlet-upgrade">Zimbra Extension and Zimlet Upgrade</h4>
<div class="paragraph">
<p>When Zimbra is upgraded, Zimbra Open Drive can be
installed directly from the installation. Zimbra Open Drive can be kept
upgraded in the same Zimbra major.minor versions with apt-get or yum:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As root, when apt-get is available
apt-get update; apt-get install zimbra-drive
# As root, when yum is available
yum update; yum install zimbra-drive</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cloud-app-upgrade">Cloud App Upgrade</h4>
<div class="paragraph">
<p>Unlike the Zimbra Open Drive Zimlet and the Extension, the Zimbra Open Drive Cloud app has to be
manually upgraded on every version change.</p>
</div>
<div class="paragraph">
<p>The upgrade of Zimbra Open Drive App in Nextcloud/ownCloud requires that
files are replaced. Perform these steps at
installation(<a href="#subsec:NextcloudownCloudInstallation">Nextcloud/ownCloud</a>):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Copy <code>zimbradrive.tar.gz</code> in Nextcloud/ownCloud drive<br>
<code>scp zimbradrive.tar.gz root@cloud:/tmp</code></p>
</li>
<li>
<p>In the Nextcloud/ownCloud server, extract <code>zimbradrive.tar.gz</code> in
<code>PATHTOCLOUD/apps</code>:<br>
<code>tar -xvzf zimbradrive.tar.gz -C PATHTOCLOUD/apps/apps</code></p>
</li>
<li>
<p>Change permissions of the extracted folder
<code>PATHTOCLOUD/apps/zimbradrive</code> with the user owner of Nextcloud/ownCloud
(E.g.: www-data):<br>
<code>chown -R www-data:www-data PATHTOCLOUD/apps/zimbradrive/</code></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>On ugrade from version 0.0.1, remove the table oc_zimbradrive_users that
are no longer used. In mysql, execute the following command:<br>
<code>DROP TABLE oc_zimbradrive_users;</code></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="uninstallation">Uninstallation</h3>
<div class="paragraph">
<p>This chapter guides the administrator through the manual
uninstallation of Zimbra Open Drive and cleanup of the system.</p>
</div>
<div class="sect3">
<h4 id="disablePackages">Disable Zimbra Open Drive Packages</h4>
<div class="paragraph">
<p>Since the Zimbra Open Drive Extension and the Zimbra Open Drive Zimlet are installed as
Zimbra packages, their uninstallation is unexpected. To disable Zimbra Open Drive,
disable the Zimbra Open Drive Zimlet from the desired user, domain or class of service.</p>
</div>
</div>
<div class="sect3">
<h4 id="remove-cloud-app">Remove Cloud App</h4>
<div class="sect4">
<h5 id="NextcloudownCloudUninstallation">Nextcloud/ownCloud</h5>
<div class="paragraph">
<p>The removal of the Nextcloud/ownCloud App has two steps:
clean up and app uninstall.</p>
</div>
<div class="paragraph">
<p>The clean up step deletes all Zimbra users' data from
Nextcloud/ownCloud and is not reversible. It <strong>requires</strong> that Zimbra
Open Drive is installed and enabled.<br>
However, this clean up step can be skipped. The Zimbra Open Drive App can be
uninstalled without removing the Zimbra users' data.</p>
</div>
<div class="paragraph">
<p><strong>Clean Up</strong></p>
</div>
<div class="paragraph">
<p>Before starting clean up, it’s recommended to disable Zimbra users'
access: the configuration <strong>Allow Zimbra’s users to log in</strong> should be
unchecked.</p>
</div>
<div class="paragraph">
<p>The following commands delete the users created by the Zimbra Open Drive App and
clean up the table containing references to Zimbra users (replace correctly
<code>mysql_pwd</code> and <code>occ_db</code>):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>cd /var/www/cloud           # Go to the OCC path
mysql_pwd='password'        # database password
occ_db='cloud'              # database name for the Nextcloud / ownCloud

# In ownCloud
user_id_column='user_id'    # column name in table oc_accounts of ownCloud
# In Nextcloud
user_id_column='uid'        # column name in table oc_accounts of Nextcloud

mysql -u root --password="${mysql_pwd}" "${occ_db}" -N -s \
    -e 'SELECT uid FROM oc_group_user WHERE gid = "zimbra"' \
    | while read uid; do \
        sudo -u www-data php ./occ user:delete "${uid}"; \
        mysql -u root --password="${mysql_pwd}" "${occ_db}" \
            -e "DELETE FROM oc_accounts WHERE ${user_id_column} = '${uid}' LIMIT 1"; \
      done</pre>
</div>
</div>
<div class="paragraph">
<p><strong>App Uninstall</strong></p>
</div>
<div class="paragraph">
<p>The Zimbra Open Drive App can be removed from the Nextcloud/ownCloud Admin
Interface. The configuration should be restored by unchecking
<strong>Enable Zimbra authentication back end</strong>, then the Zimbra
Open Drive App must be disabled from the <code>Enabled Apps'' tab and uninstalled
from the </code>Disabled Apps``.</p>
</div>
<div class="paragraph">
<p>With the previous steps, the Zimbra Open Drive App folder
(<code>PATHTOCLOUD/apps/zimbradrive</code>) is deleted but all the users' files
still remain in the cloud service drive: any configuration or file that
was not previously cleaned up is retrieved on reinstallation of the
Zimbra Open Drive App.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="advanced">Advanced Topics</h3>
<div class="sect3">
<h4 id="build-from-sources">Build from Sources</h4>
<div class="paragraph">
<p>This section describes the steps to build the Zimbra Open Drive components. The
official Zimbra Open Drive source repository is hosted on
<a href="https://github.com/ZeXtras/zimbra-drive">GitHub.com/ZeXtras/zimbra-drive</a>.</p>
</div>
<div class="paragraph">
<p>The build system uses a relative path. The following example assumes that
the working path is <code>/tmp/</code>, but it can be changed at will.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># Clean the folder that will be used for the build
rm -rf /tmp/ZimbraDrive &amp;&amp; cd /tmp/

# Clone the source repository
git clone --recursive git@github.com:ZeXtras/ZimbraDrive.git

# Jump into the source folder
cd ZimbraDrive

# Checkout the correct branch for the Zimbra release (assuming Zimbra 8.8.0 )
git checkout release/8.8.0

# Build the whole package, setting the target Zimbra (can take some minutes)
make clean &amp;&amp; make ZAL_ZIMBRA_VERSION=8.8.0</pre>
</div>
</div>
<div class="paragraph">
<p>The final artifact <code>zimbra_drive.tgz</code> will be placed in the folder
<code>/tmp/zimbradrive/dist</code>.</p>
</div>
<div class="paragraph">
<p>The <code>dist</code> folder:</p>
</div>
<div class="paragraph">
<p>The archive zimbra_drive.tgz contains all components of Zimbra Open Drive:</p>
</div>
</div>
<div class="sect3">
<h4 id="manual-installation">Manual Installation</h4>
<div class="paragraph">
<p>Manual installation is not supported.</p>
</div>
<div class="paragraph">
<p>The Zimbra Open Drive Zimlet and the Extension are installed during the Zimbra
installation. Any modification to the installed Zimbra packages may lead
to a fail during the Zimbra upgrade.</p>
</div>
<div class="sect4">
<h5 id="extension-1">Extension</h5>
<div class="paragraph">
<p>The files <code>zimbradrive-extension.jar</code> and <code>zal.jar</code> must be copied in the
right place; then a mailbox restart is required to load the extension.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As root
mkdir -p /opt/zimbra/lib/ext/zimbradrive
cp zimbradrive-extension.jar /opt/zimbra/lib/ext/zimbradrive/
cp zal.jar /opt/zimbra/lib/ext/zimbradrive/

# As zimbra
mailboxdctl restart</pre>
</div>
</div>
<div class="paragraph">
<p>Everything is successfully done only if the extension starts correctly. The
following string should be logged in <code>ZIMBRA_HOME/log/mailbox.log</code>
at the moment of the last mailbox restart:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Initialized extension Zimbra Abstraction Layer for: zimbradrive</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="zimlet-1">Zimlet</h5>
<div class="paragraph">
<p>Deploy the Zimbra Open Drive Zimlet with the following command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmzimletctl deploy com_zextras_drive_open.zip</pre>
</div>
</div>
<div class="paragraph">
<p>By default, the Zimlet is enabled for the ‘default‘ COS. The Zimlet can
be enabled on any required COS from the administration console.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="manual-upgrade">Manual Upgrade</h3>
<div class="paragraph">
<p>Manual upgrade is not supported.</p>
</div>
<div class="paragraph">
<p>The Zimbra Open Drive Zimlet and the Extension are upgraded during the the Zimbra
upgrade. Any modification to the installed Zimbra packages may lead to a
fail during the Zimbra upgrade.</p>
</div>
<div class="sect3">
<h4 id="extension-2">Extension</h4>
<div class="paragraph">
<p>The Zimbra Open Drive Extension can be upgraded replacing the
<code>zimbra-extension.jar</code> and <code>zal.jar</code> files in
<code>/opt/zimbra/lib/ext/zimbradrive/</code> and performing a mailbox restart.</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As root
cp zimbradrive-extension.jar /opt/zimbra/lib/ext/zimbradrive/
cp zal.jar /opt/zimbra/lib/ext/zimbradrive/

# As zimbra
mailboxdctl restart</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="zimlet-2">Zimlet</h4>
<div class="paragraph">
<p>The Zimbra Open Drive Zimlet can be upgraded by deploying the newest version and
flushing cache:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmzimletctl deploy com_zextras_drive_open.zip
zmprov fc zimlet</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="manual-uninstall">Manual Uninstall</h4>
<div class="paragraph">
<p>Manual uninstallation is not supported.</p>
</div>
<div class="paragraph">
<p>Please consider disabling Zimbra Open Drive (see:
<a href="#disablePackages">Disable Zimbra Open Drive Packages</a>) instead of uninstalling it. Any modification
to the installed Zimbra packages may lead to a fail during the Zimbra
upgrade.</p>
</div>
<div class="paragraph">
<p>The manual uninstallation process of the Zimbra Open Drive Zimlet and the Zimbra
Open Drive extension requires you to undeploy the Zimlet and clean the extension folder
from zimbra.</p>
</div>
<div class="paragraph">
<p>To remove the Zimbra Open Drive Zimlet:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmzimletctl undeploy com_zextras_drive_open</pre>
</div>
</div>
<div class="paragraph">
<p>To remove the Zimbra Open Drive extension:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As root
rm -rf /opt/zimbra/lib/ext/zimbradrive/

# As zimbra
zmmailboxdctl restart</pre>
</div>
</div>
<div class="paragraph">
<p>The last, but not necessary, step is to clean the domain attribute with
the command<br>
`zmprov md domainExample.com zimbraDriveOwnCloudURL `</p>
</div>
</div>
<div class="sect3">
<h4 id="how_to_report_an_issue">How to Report an Issue</h4>
<div class="paragraph">
<p>If an issue is found, Zimbra Support requires the following
information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A detailed description of the issue: What you are expecting and what
is really happening.</p>
</li>
<li>
<p>A detailed description of the steps to reproduce the issue.</p>
</li>
<li>
<p>A detailed description of the installation and the environment: (see
"Gathering System Information" section of this guide)</p>
<div class="ulist">
<ul>
<li>
<p>Cloud information:</p>
</li>
<li>
<p>Server information: CPU, RAM, number of servers and for each
server:</p>
<div class="ulist">
<ul>
<li>
<p>Zimbra version</p>
</li>
<li>
<p>Zimbra Open Drive version</p>
</li>
<li>
<p>List of the installed Zimlets</p>
</li>
</ul>
</div>
</li>
<li>
<p>Client information:</p>
<div class="ulist">
<ul>
<li>
<p>Browser name and version</p>
</li>
<li>
<p>Connectivity used between the servers and the client</p>
</li>
<li>
<p>Client skin (theme)</p>
</li>
<li>
<p>Client language</p>
</li>
<li>
<p>List of the Zimlets enabled for the user</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Any log involved in the issue:</p>
<div class="ulist">
<ul>
<li>
<p><code>mailbox.log</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any personal information can be removed to protect the privacy.</p>
</div>
</div>
<div class="sect3">
<h4 id="gatheringinfo">Gathering System Information</h4>
<div class="paragraph">
<p>This section helps the administrator to collect useful system
information that is required to escalate an issue to Zimbra Support.</p>
</div>
<div class="sect4">
<h5 id="gatheringinfo-zversion">Zimbra Version</h5>
<div class="paragraph">
<p>To see the version of Zimbra, type this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmcontrol -v</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gatheringinfo-listzimlets">List of Deployed Zimlets</h5>
<div class="paragraph">
<p>To see the list of deployed Zimlets, type this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmzimletctl listZimlets</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gatheringinfo-userzimlets">List of Zimlets Enabled for the User</h5>
<div class="paragraph">
<p>To see the list of Zimlets enabled for a user, type this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmprov getAccount user@domain.tld zimbraZimletAvailableZimlets</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gatheringinfo-userzimlets-pref">List of Zimlet User Preferences</h5>
<div class="paragraph">
<p>To see the list of preferences for the Zimlets enabled for a user,
type this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
zmprov getAccount user@domain.tld zimbraZimletUserProperties</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="gatheringinfo-extension">Extension and Zimlet Versions</h5>
<div class="paragraph">
<p>To see the version of the extension and the Zimlet, type this command:</p>
</div>
<div class="literalblock">
<div class="content">
<pre># As zimbra
java -cp /opt/zimbra/lib/ext/zimbradrive/zimbradrive-extension.jar \
    com.zextras.lib.ZimbraDrive</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_drive">Zimbra Drive</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2">Introduction</h3>
<div class="paragraph">
<p>Zimbra Drive is an optional Zimbra component that provides both a fully-fledged file storage system integrated with the Zimbra WebClient, and a replacement for the old "Briefcase" component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_browser_compatibility_2">Browser compatibility</h3>
<div class="paragraph">
<p>Zimbra Drive features are available on all browsers officially supported by the Zimbra Web Client, with some client-side limitations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Browser</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">OS</th>
<th class="tableblock halign-left valign-top">Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (Chromium)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (Chromium)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (EdgeHTML)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon red"><i class="fa fa-times-circle"></i></span> No</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Internet Explorer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon red"><i class="fa fa-times-circle"></i></span> No</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows/Linux/OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ESR</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> Yes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Google Chrome</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows/Linux/OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Google Chrome</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Safari</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Safari</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>While likely to work, items marked as "<span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited" are only supported on the browser&#8217;s two previous stable releases to the current one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_features">Features</h3>
<div class="sect3">
<h4 id="_frontend">Frontend</h4>
<div class="ulist">
<ul>
<li>
<p>Upload, manage and download files</p>
</li>
<li>
<p>Organize files within navigable folders</p>
</li>
<li>
<p>Preview files</p>
</li>
<li>
<p>Mark files as "preferred" for quick access</p>
</li>
<li>
<p>Add custom notes (descriptions) to files</p>
</li>
<li>
<p>Share files to internal users</p>
</li>
<li>
<p>Share files to external users (NYI)</p>
</li>
<li>
<p>Integration with Zimbra Docs</p>
</li>
<li>
<p>File search</p>
</li>
<li>
<p>Folder-based navigation</p>
</li>
<li>
<p>Quick "stateful" navigation</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_backend">Backend</h4>
<div class="ulist">
<ul>
<li>
<p>Option to store files on dedicated Zimbra volumes</p>
</li>
<li>
<p><code>zxsuite drive</code> CLI</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_differences_between_briefcase_and_zimbra_drive">Differences between Briefcase and Zimbra Drive</h3>
<div class="paragraph">
<p>Zimbra Drive does not follow the usual mailbox-driven behaviors when it comes to file storage, navigation, sharing, and item deletion.
See each feature’s dedicated paragraph for a complete explanation of the differences and of the features themselves.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_drive_ui">Zimbra Drive UI</h3>
<div class="imageblock">
<div class="content">
<img src="images/drive_ui.png" alt="Zimbra Drive UI">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Quick Access navigation panel;</p>
</li>
<li>
<p>Folder navigation panel;</p>
</li>
<li>
<p>InfoBox control;</p>
</li>
<li>
<p>New, Upload and Search features;</p>
</li>
<li>
<p>Folder list;</p>
</li>
<li>
<p>File list;</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_feature_description">Feature Description</h3>
<div class="sect3">
<h4 id="_upload_and_download">Upload and Download</h4>
<div class="paragraph">
<p>To upload a file to Zimbra Drive, either click on the "Upload" button above the file list or drag and drop any number of files from your computer to the main Zimbra Drive window.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_upload.png" alt="Upload a file">
</div>
</div>
<div class="paragraph">
<p>To download a file from Zimbra Drive, right-click on it and select "Download":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_download.png" alt="Download a file">
</div>
</div>
<div class="paragraph">
<p>Any file and folder in Zimbra Drive can be renamed by right-clicking on it and selecting the "Rename" option in the context menu.</p>
</div>
</div>
<div class="sect3">
<h4 id="_navigation">Navigation</h4>
<div class="paragraph">
<p>Briefcase items are part of the mailbox’s folder and item hierarchy, while Zimbra Drive has its own internal folder structure and navigation.
Navigating through Zimbra Drive folders is done through the Navigation Bar on top of the UI instead of through a tree view and folders are visible in the main section of the UI above files.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_navigation.png" alt="Navigate through folders and files">
</div>
</div>
<div class="paragraph">
<p>On top of the standard folder-based navigation, a "Quick Access" menu is available on the left side of the UI, which allows to quickly view the following types of items:
• "Preferred Items" – items marked with the "Star" option available in the right-click context menu;
• "Recently Edited" – items edited recently, sorted from the most recently edited;
• "Shared with me" – items shared by other users
• "Shared by me" – items shared to other users
• "Marked for deletion" – items marked for deletion</p>
</div>
</div>
<div class="sect3">
<h4 id="_folder_creation">Folder Creation</h4>
<div class="paragraph">
<p>To create a folder in Zimbra Drive, click on the "New" button above the file list and select "Folder":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_newfolder.png" alt="Create a new folder">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_file_and_folder_naming">File and Folder naming</h4>
<div class="paragraph">
<p>The following characters cannot be used in Zimbra Drive folders and files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Slash - <code>/</code></p>
</li>
<li>
<p>Backslash - <code>\</code></p>
</li>
<li>
<p>Semicolon - <code>:</code></p>
</li>
<li>
<p>Question Mark - <code>?</code></p>
</li>
<li>
<p>Plus sign - <code>+</code></p>
</li>
<li>
<p>Asterisk - <code>*</code></p>
</li>
<li>
<p>Percent sign - <code>%</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_sharing">Sharing</h4>
<div class="paragraph">
<p>Being separated from the mailbox’s item hierarchy, Zimbra Drive files and folders can be shared independently.
Sharing permissions can be chosen among 3 options: "View", "Edit" and "Edit and Share" – the latter two options include the "View" right by default.</p>
</div>
<div class="paragraph">
<p>To share a file or a folder, right-click on it and select "Edit Shares". After entering the email address of the destination user and selecting the sharing permissions, click the (+) button to add the share to the list:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_addshare.png" alt="Share an item (folder or file)">
</div>
</div>
<div class="paragraph">
<p>To edit or delete a share, simply click on the dropdown permission selector to change the sharing permissions of the file/folder or click the trash bin icon to delete the share:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_editshare.png" alt="Edit an existing share">
</div>
</div>
<div class="paragraph">
<p>In Zimbra Drive, sharing rights are only "additive", so it’s not possible to share an item with a lower permission than its parent, e.g. if a folder is shared with "Edit" permissions it’s not possible to share one of its items with "View" rights with the same person.</p>
</div>
</div>
<div class="sect3">
<h4 id="_item_deletion">Item Deletion</h4>
<div class="paragraph">
<p>When deleted, Zimbra Drive items are not put into the Trash like every other item type in Zimbra, as such items are marked for deletion instead.
To mark a file or a folder for deletion, right-click on it and select "Mark for Deletion":</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_deletefile.png" alt="Mark an item for deletion">
</div>
</div>
<div class="paragraph">
<p>Items marked for deletion are displayed on the bottom of the file list with a strikethrough line and can be deleted permanently clicking on the "Delete Permanently" entry within the right-click context menu of a file marked for deletion while the "Restore" entry will unmark the file:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_restorepermdelete.png" alt="Restore or permanently delete a file">
</div>
</div>
<div class="paragraph">
<p>While any user with "Edit" or "Edit and Share" rights on an item or folder can mark it for deletion, only the original owner can delete it permanently.</p>
</div>
<div class="paragraph">
<p>Items marked for deletion cannot be accessed, so should a user try to do so a pop-up message will ask whether to restore the item and access it or to stop the attempt and leave it as marked for deletion.</p>
</div>
</div>
<div class="sect3">
<h4 id="_infobox">InfoBox</h4>
<div class="paragraph">
<p>The InfoBox is a collapsible element that contains all information and controls for the selected file or folder, as well as a preview of the file itself if in a compatible format (pictures, PDFs and more).</p>
</div>
<div class="paragraph">
<p>To display the Infobox, click on the "(i)" button on the top-right of the Zimbra Drive UI:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_infobutton.png" alt="Open the InfoBox">
</div>
</div>
<div class="paragraph">
<p>The infobox will appear on the right side of the screen:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_infobox.png" alt="The InfoBox">
</div>
</div>
<div class="paragraph">
<p>Top-to-bottom, the InfoBox contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name of the selected file</p>
</li>
<li>
<p>The preview of the file (or a format icon for unsupported formats)</p>
</li>
<li>
<p>All action items available in the right-click context menu</p>
</li>
<li>
<p>Share information</p>
</li>
<li>
<p>Creation and edit information</p>
</li>
<li>
<p>A customizable "Description" field</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_technical_information">Technical information</h3>
<div class="sect3">
<h4 id="_file_storage">File Storage</h4>
<div class="paragraph">
<p>While Briefcase files are stored as mail-like items within the mailbox’s folder tree, Zimbra Drive features a detached folder hierarchy based on nodes: thus, Zimbra Drive folders do not appear as mailbox folders (e.g. in the output of <code>zmmailbox getAllFolders</code>).
Zimbra Drive metadata are stored in a dedicated HSQL Database while all files (including previous file versions and file previews) are stored in a dedicated folder within a volume’s root.
File naming is now hash-based instead of id-based to achieve native deduplication, compression rules follow the volume’s settings</p>
</div>
<div class="paragraph">
<p>e.g.
Filesystem path for a briefcase file: /opt/zimbra/store/0/[mID]/msg/0/[itemid]-[revision].msg
Filesystem path for a Zimbra Drive file: /opt/zimbra/store/drive/[hash]-[revision].[extension]</p>
</div>
</div>
<div class="sect3">
<h4 id="_volumes">Volumes</h4>
<div class="paragraph">
<p>As of this release, Zimbra Drive files are stored in the Current Primary volume as any other item.</p>
</div>
<div class="paragraph">
<p>Integration with Zimbra Docs
If the Zimbra Docs zimlet is correctly installed, dedicated document options will appear in the "New" button above the file list:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_docsintegration.png" alt="Create documents with Zimbra Docs">
</div>
</div>
<div class="paragraph">
<p>When right-clicking on a compatible file, an "Open with Docs" option will also appear:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/drive_openwithdocs.png" alt="Open files stored in Zimbra Drive with Zimbra Docs">
</div>
</div>
<div class="paragraph">
<p>Furthermore, Zimbra Docs will also allow for previews of compatible document formats to be displayed in the InfoBox.</p>
</div>
</div>
<div class="sect3">
<h4 id="_urls_and_ports_2">URLs and Ports</h4>
<div class="paragraph">
<p>To build URLs and links (e.g. for External Shares) Zimbra Drive uses the default Zimbra settings for the domain of the account in use - the <code>zimbraPublicServiceHostname</code> property is used for the URL itself while the <code>zimbraPublicServicePort</code> property is used for the port.</p>
</div>
<div class="paragraph">
<p>Should any of the two not be set up, the system will always fall back to the <code>zimbraServiceHostname</code> and <code>zimbraMailPort</code> or <code>zimbraMailSSLPort</code> server-level properties.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_drive_backup_and_hsm">Zimbra Drive Backup and HSM</h3>
<div class="sect3">
<h4 id="_backup_ng">Backup NG</h4>
<div class="paragraph">
<p>Zimbra Drive files are included in Backup NG, and both the RealTime Scanner and the SmartScan are aware of those and no additional actions must be taken in order to ensure the files' safety.</p>
</div>
<div class="paragraph">
<p>The Restore on New Account and External Restore modes will also restore Zimbra Drive files, while other restore modes such as the Undelete Restore do not operate on such files.</p>
</div>
</div>
<div class="sect3">
<h4 id="_hsm_ng">HSM NG</h4>
<div class="paragraph">
<p>Zimbra Drive can store its data on a different volume than the default Current Primary one, and HSM policies can move Zimbra Drive files onto a different volume than the Current Secondary one, thus effectively allowing independent storage management for Zimbra Drive files.</p>
</div>
<div class="paragraph">
<p>When an HSM policy is applied, Zimbra Drive files will be handled under the "document" item type.</p>
</div>
<div class="paragraph">
<p>This setting is applied at the server level so that different mailbox servers can use different volumes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_the_zimbra_drive_primary_volume">Setting the Zimbra Drive Primary volume</h4>
<div class="paragraph">
<p>To set the Zimbra Drive Primary volume, first find out the volumeID of the target volume by running <code>zxsuite hsm getAllVolumes</code>.</p>
</div>
<div class="paragraph">
<p>Once the volumeID has been identified, simply run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>zxsuite config server set `zmhostname` attribute driveStore value [volumeID]</code></pre>
</div>
</div>
<div class="paragraph">
<p>(where [volumeID] is the ID found with the previous command)</p>
</div>
</div>
<div class="sect3">
<h4 id="_setting_the_zimbra_drive_secondary_volume">Setting the Zimbra Drive Secondary volume</h4>
<div class="paragraph">
<p>To set the Zimbra Drive Secondary volume, find out the volumeID of the target volume as described in the previous paragraph and then run the following command</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>zxsuite config server set `zmhostname` attribute driveSecondaryStore value [volumeID]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_zimbra_drive_installation_and_migration">Zimbra Drive Installation and Migration</h3>
<div class="sect3">
<h4 id="_manually_install_or_upgrade_zimbra_drive_ng">Manually Install or Upgrade <code>zimbra-drive-ng</code></h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>As the <code>root</code> user, instruct <code>yum</code> to install the package.</p>
<div class="literalblock">
<div class="content">
<pre>yum install zimbra-drive-ng</pre>
</div>
</div>
</li>
<li>
<p>Switch to user <code>zimbra</code>.</p>
<div class="literalblock">
<div class="content">
<pre>su - zimbra</pre>
</div>
</div>
</li>
<li>
<p>Restart the Zimbra mailbox service for changes to take effect.</p>
<div class="literalblock">
<div class="content">
<pre>zmmailboxdctl restart
zxsuite config server set `zmhostname` attribute driveAllowOnUnsupportedZimbraVersion value true
zxsuite drive doStartService module</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_briefcase_migration">Briefcase Migration</h4>
<div class="paragraph">
<p>Briefcase data can be migrated to Zimbra Drive using the dedicated <code>doImport</code> CLI command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>zimbra@test:~$ zxsuite drive doImport

Syntax:
   zxsuite drive doImport {john@example.com,test.com[,...]} [attr1 value1 [attr2 value2...]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command accepts a comma-separated list of targets to migrate, which can be either mailboxes or domains, and different target types can be used on the same command.</p>
</div>
<div class="paragraph">
<p>The following attributes can be used to customize the migration:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">NAME</th>
<th class="tableblock halign-left valign-top">TYPE</th>
<th class="tableblock halign-left valign-top">EXPECTED VALUES</th>
<th class="tableblock halign-left valign-top">DEFAULT</th>
<th class="tableblock halign-left valign-top">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">targets(M)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String[,..]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:john@example.com">john@example.com</a>,test.com[,&#8230;&#8203;]</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Comma separated list of targets to migrate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">dryRun(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true or false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Only perform a test run without affecting the data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allVersions(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true or false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Migrate all versions of every file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deleteSources(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true or false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete migrated files from the Briefcase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">overwrite(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true or false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overwrite existing files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">showIgnoredAccounts(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true or false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ignoreQuota(O)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boolean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true or false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ignore mailbox quota when migrating</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_zimbra_docs">Zimbra Docs</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_3">Introduction</h3>
<div class="paragraph">
<p>Zimbra Docs is based on a customized LibreOffice online (LOOL) package that allows collaborative editing of documents, spreadsheets and presentations from within the Zimbra WebClient.</p>
</div>
</div>
<div class="sect2">
<h3 id="_components_3">Components</h3>
<div class="sect3">
<h4 id="_zimbra_docs_server">Zimbra Docs Server</h4>
<div class="paragraph">
<p>The Zimbra Docs server is the heart of the service.
The service hosts each document opened through a LibreOffice engine and responds to the client with every keystroke and change.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Install this component on one or more dedicated nodes running Ubuntu 16.04 LTS, Ubuntu 18.04 LTS, or Red Hat CentOS 7.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_docs_extension">Zimbra Docs Extension</h4>
<div class="paragraph">
<p>The extension is the component that coordinates everything.
Its main tasks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select which Docs server upon which to open the next document.</p>
</li>
<li>
<p>Redirect the client when it needs to open a document.</p>
</li>
<li>
<p>Read and write documents to and from system storage on behalf of the Docs server.</p>
</li>
<li>
<p>Connect to each Docs server via an administrative WebSocket.
Keep track of the availability and the resource usage of each.</p>
</li>
<li>
<p>Orchestrate concurrent user connections to the same document in the same server. (document sharing)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NG Modules package contains the Zimbra Docs Extension together with the NG Core.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_docs_zimlet">Zimbra Docs Zimlet</h4>
<div class="paragraph">
<p>A Zimbra Docs Zimlet handles the integration with Briefcase and with email attachments.
It is a thin web client that connects to a native server instance via WebSocket, renders a document, and only sends changes to the client to keep the fidelity of the document on par with a desktop client while limiting network bandwidth consumption to the bare minimum.</p>
</div>
<div class="paragraph">
<p>Documents in preview and attachments are shown in read-only mode with a simplified interface, while edit mode has a full interface.</p>
</div>
<div class="paragraph">
<p>Its main tasks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Change the <b class="button">Create</b> button in the Web Client to the related Docs feature.</p>
</li>
<li>
<p>Change the Web Client preview feature to use Docs.</p>
</li>
<li>
<p>Allow the preview of documents.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_browser_compatibility_3">Browser compatibility</h3>
<div class="paragraph">
<p>Zimbra Docs features are available on all browsers officially supported by the Zimbra Web Client, with some client-side limitations:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Browser</th>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">OS</th>
<th class="tableblock halign-left valign-top">Supported</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (Chromium)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (Chromium)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Microsoft Edge (EdgeHTML)</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon red"><i class="fa fa-times-circle"></i></span> No</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Internet Explorer</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Any</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon red"><i class="fa fa-times-circle"></i></span> No</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows/Linux/OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>ESR</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> Yes</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Mozilla Firefox</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Google Chrome</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Windows/Linux/OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Google Chrome</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Windows/Linux/OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Safari</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Latest</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>OSX</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon green"><i class="fa fa-check-circle"></i></span> <strong>Yes</strong></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><strong>Safari</strong></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Others</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OSX</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>While likely to work, items marked as "<span class="icon yellow"><i class="fa fa-check-circle"></i></span> Limited" are only supported on the browser&#8217;s two previous stable releases to the current one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_document_management_flow">Document Management Flow</h3>
<div class="paragraph">
<p>Here is what happens behind the scenes when a user creates a document:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Zimlet prompts the Extension to create a new, empty document</p>
</li>
<li>
<p>The Extension creates the document and returns its ID to the client</p>
</li>
<li>
<p>The Zimlet opens a new Zimbra tab containing an iframe pointing towards <code>/service/extension/wopi-proxy</code></p>
</li>
<li>
<p>The extension receives the request from the client, creates a unique token for the needed document, and replies with a new URL</p>
</li>
<li>
<p>The URL points toward <code>/docs/[docs-node-id]/[token]</code>, which will be proxied by nginx to the specific Docs Server node</p>
</li>
<li>
<p>The Docs Server will respond with the web application in Javascript</p>
</li>
<li>
<p>The web application opens a WebSocket connection, going through nginx</p>
</li>
<li>
<p>Docs Server receives the WebSocket connection along with a token, sends a <code>read wopi</code> command towards the mailbox URL indicated
in the parameters (after validating the URL against allowed nodes)</p>
</li>
<li>
<p>The Extension validates the token and replies with information and content</p>
</li>
<li>
<p>The Docs Server node parses the document, renders it, and sends it back to the client.</p>
</li>
<li>
<p>The document is fully opened and editable.</p>
</li>
</ol>
</div>
<div class="literalblock">
<div class="content">
<pre>Open document
                                  redirect to docs
    +------------------------+             +----------------------+
    |     Zimbra Proxy       |             |       Mailbox        |
    |                        +-------------&gt;                      |
    |      Nginx             |             | Zimbra Docs Extension|
    +------------------------+             +----------------------+
                      |                        |              ^
                      |                        |              |
                      |                        |             WOPI:
                      |                   Admin Web          Read/Write
                      |                   Socket             Documents
                      |                        |              |
                      |                        |              |
                      |                        |              |
                      |                    +---v----------------+
                      |                    |                    |
                      +--------------------&gt;   Docs Server      |
                   Load Client             |                    |
                   Open client websocket   +--------------------+</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_networking_and_ports">Networking and ports</h3>
<div class="paragraph">
<p>All mailbox servers will need to be able to directly communicate with the Docs Server over port 8443 (HTTPS Backend), which must be open on both ends.</p>
</div>
<div class="paragraph">
<p>The Docs Server communicates with the Extension through port 9980, so incoming traffic from all mailbox and proxy servers to that port must be allowed.
The Docs Server component must also be able to directly communicate with the master LDAP server as well as with all Mailbox servers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installation_and_configuration">Installation and Configuration</h3>
<div class="sect3">
<h4 id="_docs_nodes">Docs Nodes</h4>
<div class="paragraph">
<p>Download the <code>zimbra-docs tgz</code> standalone installer, extract it and as the <em>root</em> user execute the <code>install.sh</code> script contained in the package.</p>
</div>
<div class="paragraph">
<p>To obtain the information required for the initial Docs Server setup, run the following command on any mailbox server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>zimbra@mbx1:~$ zmlocalconfig -s ldap_master_url zimbra_ldap_user zimbra_ldap_userdn zimbra_ldap_password</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will return the info you need in the following format:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ldap_master_url = ldap://ldap01.cfd6a9e5.test.domain.com:389
zimbra_ldap_user = zimbra
zimbra_ldap_userdn = uid=zimbra,cn=admins,cn=zimbra
zimbra_ldap_password = Deyked4ofMarj</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script will install the Zimbra Docs package and then ask for information about the master LDAP, URL, username, and password, all needed to add a new server in the LDAP with just the 'docs' service installed/enabled.
Every Docs Server will be visible by every node, and will read the LDAP to write the configuration in <code>/opt/zimbra/conf/docs/loolwsd.xml</code>.</p>
</div>
<div class="paragraph">
<p>After completing the setup, you need no other configuration.</p>
</div>
<div class="sect4">
<h5 id="_adding_custom_fonts_to_the_docs_server_to_add_custom_fonts_to_your_docs_server_simply_copy_the_ttf_font_files_in_the_optzimbradocszimbra_docs_coresharefontscustom_directory_then_generate_the_new_font_cache_and_restart_the_docs_server_running_zdocs_restart_as_root">Adding Custom Fonts to the Docs Server To add Custom Fonts to your Docs Server, simply copy the <code>.ttf</code> font files in the <code>/opt/zimbra/docs/zimbra-docs-core/share/fonts/custom/</code> directory, then generate the new font cache and restart the docs server running <code>zdocs restart</code> as <code>root</code>.</h5>
<div class="paragraph">
<p>To generate the new font cache, run the following command based on the Docs Server&#8217;s Operating System:</p>
</div>
<div class="paragraph">
<div class="title">Ubuntu 16 and Ubuntu 18</div>
<p><code>dpkg-reconfigure zimbra-docs-server</code></p>
</div>
<div class="paragraph">
<div class="title">CentOS 7</div>
<p><code>fc-cache /opt/zimbra/docs/zimbra-docs-core/share/fonts</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The server will briefly be unavailable during a restart, and clients will need to close and re-open documents to see the new fonts in the list.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mailbox_nodes">Mailbox Nodes</h4>
<div class="paragraph">
<p>While the NG modules contain the Zimbra Docs extension, the com_zextras_docs Zimlet needs to be deployed on the server and enabled for all users and COS that need to have access to the Zimbra Docs features.</p>
</div>
<div class="paragraph">
<p>The <code>com_zextras_docs</code> Zimlet is available in the Zimbra repository, so it can be easily downloaded and deployed by running <code>apt-get install zimbra-docs</code>.</p>
</div>
<div class="paragraph">
<p>No configuration on the mailboxd side is needed after the Zimlet has been deployed and enabled.</p>
</div>
</div>
<div class="sect3">
<h4 id="_proxy_nodes">Proxy Nodes</h4>
<div class="paragraph">
<p>The proxy configuration must be re-generated after adding one or more Zimbra Docs Servers to the infrastructure: to do so, run <code>/opt/zimbra/libexec/zmproxyconfgen</code> as the <em>zimbra</em> user and then restart the proxy service running <code>zmproxyctl restart</code> as the same user.</p>
</div>
<div class="paragraph">
<p>The new docs nodes' addresses get distributed via LDAP, so no manual configuration is needed.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_licensing_3">Licensing</h3>
<div class="paragraph">
<div class="title">Zimbra Docs will be available on every NG for the same amount users allowed by the Network Edition license.</div>
<p>The standalone installer is released under the MPLv2 license while the extension and Zimlet are under a proprietary license.</p>
</div>
</div>
<div class="sect2">
<h3 id="_removal">Removal</h3>
<div class="paragraph">
<p>Before uninstalling the software, the node must be removed from LDAP either from the docs node via the command:</p>
</div>
<div class="paragraph">
<p><code>zdocs remove-local-server</code></p>
</div>
<div class="paragraph">
<p>or via the <code>zmprov</code> command from any Zimbra node</p>
</div>
<div class="paragraph">
<p><code>zmprov deleteServer {servername}</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_commands">Commands</h3>
<div class="sect3">
<h4 id="_zimbra_docs_server_cli_zdocs">Zimbra Docs Server CLI - <code>zdocs</code></h4>
<div class="paragraph">
<p>On a Docs server, the <code>zdocs</code> (<code>/usr/local/bin/zdocs</code> as <code>root</code>) command can generate the config for LOOL (it’s already on cron), add/remove the docs server from LDAP, test configuration and manage the service.</p>
</div>
<div class="listingblock">
<div class="title"><code>zdocs</code> command</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">usage: zdocs [-h] [--auto-restart] [--ldap-dn LDAP_DN] [--ldap-pass LDAP_PASS]
             [--ldap-url LDAP_URL] [--hostname HOSTNAME] [--debug][--cron]

{genkey,write-local-server,remove-local-server,generate-config,ldap-write-config,ldap-test,start,stop,restart,status,setup}

Manage Zimbra Docs service.

Available commands:
  genkey                Generate a private key needed for authentication between docs and mailbox servers.
  write-local-server    Add or update in ldap the necessary server entry for this server in order to be reachable from other servers.
  remove-local-server   Remove local server entry in LDAP.
  generate-config       Populate the config template with LDAP values and write a new configuration file.
  ldap-write-config     Write new configuration about the ldap access needed to generate the docs configuration file.
  ldap-test             Check the ldap connection.
  start                 Start the service.
  stop                  Stop the service.
  restart               Restart the service.
  status                Print service status.
  setup                 Start the initial setup.

positional arguments:
{genkey,write-local-server,remove-local-server,generate-config,ldap-write-config,ldap-test,start,stop,restart,status,setup}                                   Command to execute

optional arguments:
  -h, --help            show this help message and exit
  --auto-restart        Automatically restart the service if configuration is changed (to be used with generate-config)
  --ldap-dn LDAP_DN     Ldap dn (distinguish name) to bind to (to be used with ldap-test and ldap-settings)
  --ldap-pass LDAP_PASS Ldap password used of the DN (to be used with ldap-test and ldap-settings)
  --ldap-url LDAP_URL   Ldap url completed with schema (ex.: ldaps://ldap.example.com, to be used with ldap-test and ldap-settings)
  --hostname HOSTNAME   Hostname of this server (to be used with add-local-server)
  --debug               Show complete errors when things go bad.
  --cron                Start in cron mode, avoid any output unless there is an error (to be used with generate-config).

examples:
#regenerate the config and restart the server if config changed
  zdocs --auto-restart generate-config
#restart the service
  zdocs restart
#check ldap connection availability using current settings
  zdocs ldap-test
#check ldap connection using custom settings
  zdocs --ldap-url ldaps://ldap.example.com/ --ldap-dn 'uid=zimbra,cn=admins,cn=zimbra' --ldap-pass password ldap-test
#change the ldap connection settings
  zdocs --ldap-url ldap://ldap2.example.com/ --ldap-dn 'uid=zimbra,cn=admins,cn=zimbra' --ldap-pass password
ldap-write-config
#add the local server
  zdocs write-local-server
#add the local server with a custom hostname in LDAP, this command should be already invoked during setup.
  zdocs --hostname myhostname write-local-server
#remove the local server from LDAP, useful when destroying the server, you can also use 'zmprov deleteServer' from a mailbox server.
  zdocs remove-local-server</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zimbra_docs_extension_cli_zxsuite_docs">Zimbra Docs Extension CLI - zxsuite docs</h4>
<div class="paragraph">
<p>On a Mailbox server, the <code>zxsuite docs</code> command is available.
This command allows you to check and control the Docs service&#8217;s status, to force a configuration to reload, and to see the Docs Servers' status.</p>
</div>
<div class="listingblock">
<div class="title">zxsuite docs</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zxsuite docs

Commands regarding docs module

  doReloadConfig           - reload docs configuration from ldap, which
would happen once a minute.
                             zxsuite docs doReloadConfig

  doRestartService         - restart a given service
                             zxsuite docs doRestartService
{service_name}

  doStartService           - start a given service
                             zxsuite docs doStartService {service_name}

  doStopService            - stop a given service
                             zxsuite docs doStopService {service_name}

  getServices              - show current status of all services for
this module
                             zxsuite docs getServices

  status                   - show zimbra docs servers status with their
resource usage (if connected).
                             zxsuite docs status</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting">Troubleshooting</h3>
<div class="paragraph">
<div class="title"><span class="underline">Nothing happens when opening a document/extension requests returns 503.</span></div>
<p>This problem is most likely due to a connection issue between the mailbox server and the Docs server.
Check the <code>mailbox.log</code> and see the reason for the connection failure.
If there are no connection errors, check the Docs server with <code>zdocs status</code> on the docs node.</p>
</div>
<div class="paragraph">
<p>The mailbox will log every connection and disconnection for each Docs server.</p>
</div>
<div class="paragraph">
<div class="title"><span class="underline">404 error code instead of docs</span></div>
<p>The proxy configuration needs to be re-generated, and the proxy restarted.</p>
</div>
<div class="paragraph">
<div class="title"><span class="underline">Docs opens but a message “this is embarrassing&#8230;&#8203;” appears instead of the document.</span></div>
<p>You may see this happen if the Docs server cannot connect back to the mailbox server to read and write the document.
Check name resolution and SSL certificate of <code>mailboxd</code>, which must be valid for the Docs server that does not inherit Zimbra certificate management.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="command_line_utilities">Appendix A: Command Line Utilities</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Command Line Interface (CLI) can be used to create, modify and delete
certain features and functions of the Zimbra Collaboration.  The Administration
Console is the main tool for maintaining the Zimbra Collaboration, but some
functions can only be changed from CLI utilities.</p>
</div>
<div class="paragraph">
<p>The CLI utilities can be used for the following purposes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Provisioning accounts</p>
</li>
<li>
<p>Backup and Restore</p>
</li>
<li>
<p>Starting and stopping a service</p>
</li>
<li>
<p>Move mailboxes</p>
</li>
<li>
<p>Cross-mailbox searches</p>
</li>
<li>
<p>Installing self-signed certificates</p>
</li>
<li>
<p>Local configuration</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In general, provisioning and managing accounts should be performed from the
Administration Console.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_general_tool_information">General Tool Information</h3>
<div class="paragraph">
<p>The Zimbra Collaboration command-line utilities follow standard UNIX
command-line conventions.  Use the following general guidelines with the
CLI:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CLI commands are run as the zimbra user:<br>
<code>su - zimbra</code></p>
</li>
<li>
<p>The CLI commands are case-sensitive.  You must type them in lower case.</p>
</li>
<li>
<p>Press <strong>ENTER</strong> after you type a command.</p>
</li>
<li>
<p>To display usage information about a command, type the CLI command with
<code>-h</code>.</p>
<div class="paragraph">
<p>Example: <code>zmprov -h</code> lists all the options available for the <code>zmprov</code>
utility.</p>
</div>
</li>
<li>
<p>Each operation is invoked through command-line options.  Many have a
long name and a short name.  For example, these two commands are
equivalent:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov createAccount joe@domain.com test123

zmprov ca joe@domain.com test123</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_syntax_conventions">Syntax Conventions</h4>
<div class="paragraph">
<p>When demonstrating the syntax of each tool, the following conventions
indicate required, optional, and alternate values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>{<code>attribute</code>} in curly brackets is required information.</p>
</li>
<li>
<p>[<code>attribute</code>] in square brackets are optional arguments or information.</p>
</li>
<li>
<p>{<code>a|b|c</code>} or [<code>a|b|c</code>] options separated by the pipe character <code>|</code> means
"a" OR "b" OR "c"</p>
</li>
<li>
<p>For attribute names that may contain spaces, surround the name with
double quotes.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_location_of_command_line_utilities">Location of Command-Line Utilities</h4>
<div class="paragraph">
<p>The command-line tools available for administrators are all located in
the <code>/opt/zimbra/bin</code> folder on the Zimbra Collaboration server.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cli_commands">Zimbra CLI Commands</h3>
<div class="paragraph">
<p><span class="image"><img src="images/cli.png" alt="CLI"></span></p>
</div>
<div class="paragraph">
<p>The table below lists the CLI commands in <code>/opt/zimbra/bin</code>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CLI</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>antispam-mysqladmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anti-spam SQL server admin utility</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>antispam-mysql</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anti-spam SQL client</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>antispam-mysql.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop the anti-spam SQL instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, or find the status of Zimbra LDAP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldapsearch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Perform a search on an LDAP server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>logmysqladmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send mysqladmin commands to the logger SQL instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mysql</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enters interactive command-line for the mailbox SQL instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mysql.server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop the mailbox SQL instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mysqladmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Send admin commands to the mailbox SQL instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postconf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Postfix command to view or modify the postfix configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>postfix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, reload, flush, check, upgrade-configuration of postfix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>qshape</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Examine postfix queue in relation to time and sender/recipient domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmaccts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists the accounts and gives the status of accounts on domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmamavisdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, restart, or find the status of the Amavis-D New</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmantispamctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, reload, status for anti-spam service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmantivirusctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, reload, status for the anti-virus service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmantispamdbpasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes anti-spam SQL database password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmapachectl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, reload, or check status of Apache service (for spell check)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmarchiveconfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Command to view, modify, or configure archiving</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmarchivectl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, reload, status for archiving</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmarchivesearch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search archives on the account</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmauditswatchctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, restart, reload, status of the auditswatch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmbackup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs full backups and incremental backups for a designated mail host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmbackupabort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stops a backup that is in process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmbackupquery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find a specific full backup set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmblobchk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check consistency of the Zimbra blob store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcalchk</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check consistency of appointments and attendees in the Zimbra calendar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcbpolicydctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, and restart the cluebringer policyd service, if enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmconfigdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, kill, restart status of the MTA configuration daemon.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcertmgr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage self-signed and commercial certificates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmclamdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, or find the status of Clam AV</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcleaniplanetics</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clean iPlanet ICS calendar files</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmcontrol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, restart, status of the Zimbra servers.  Also can use to find
the Zimbra version installed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmconvertctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, the conversion server or find the status of the converted
attachments conversion/indexing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmdevicesstats</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of unique ActiveSync device IDs per server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmgdcutil</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(get devices count) gives the total devices system wide without the need of
specifying individual servers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmdumpenv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General information about the server environment is displayed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmgsautil</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Global Address Book (GAL) synchronization utility.
Create, delete the GAL sync account and initiate manual syncs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmhostname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Find the hostname of the Zimbra server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmhsm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop and status of a HSM session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmitemdatafile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extracts and packs tgz files that ZCS uses for REST import/export</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmjava</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute Java with Zimbra-specific environment settings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmjavaext</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute Java and Zimbra-specific environment settings including extension
based jars.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmldappasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes the LDAP password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmlicense</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View and install your Zimbra license</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmlmtpinject</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Testing tool</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmlocalconfig</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to set or get the local configuration of a Zimbra server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmloggerctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, reload, or find the status of the Zimbra logger service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmloggerhostmap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to manually map a DNS hostname to a zmhostname.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmlogswatchctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, status of the swatch that is monitoring logging.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs mailbox management tasks</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailboxdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, reload, or find the status of the mailbox components
(zmmailboxd, MariaDB, convert)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmboxsearch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Cross Mailbox Search) Search across mailboxes to find messages and
attachments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmboxmove</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.1.3 and later.  Used to move selected mailboxes from one Zimbra server to
another.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmboxmovequery</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.1.3 and later.  Used to query ongoing mailbox moves on a server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmpurgeoldmbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.1.3 and later.  Purges a mailbox from the old server after a mailbox move</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmemcachedctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, and restart</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmetadump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support tool that dumps an item&#8217;s metadata in a human-readable form</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmilterctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, and restart the Zimbra milter server if enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmtaconfigdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beginning in ZCS 7.0, this command is not used.  Use <code>zmconfigdctl</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmtactl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, or find the status of the MTA</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmypasswd</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change SQL passwords</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmysqlstatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Status of mailbox SQL instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmnginxconf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output the reverse proxy configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmnginxctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, and restart the Zimbra reverse proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmplayredo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs data restore using backed up snapshots taken periodically.  Users
who use snapshots to backup and restore their information from a standby
site use this command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmprov</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs all provisioning tasks in Zimbra LDAP, including creating
accounts, domains, distribution lists and aliases</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmproxyconfgen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates configuration for the nginx proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmproxyctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, restart, and find the status of the IMAP proxy service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmproxypurge</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purges POP/IMAP routing information from one or more memcached servers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmpython</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ability to write Python scripts that access Zimbra Java libraries.  It sets
the Zimbra class path and starts the Jython interpreter.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmredodump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Support tool for dumping contents of a redolog file for debugging purposes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmrestore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Performs full restores and incremental restores for a designated mail host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmrestoreldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restore accounts from the LDAP backup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmrestoreoffline</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(Offline Restore) Performs full restore when the Zimbra server (i.e.,
the <code>mailboxd</code> process) is down</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsaslauthdctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, or find the status of saslauthd (authentication)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmschedulebackup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schedule backups and add the command to your cron table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmshutil</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used for other zm scripts, do not use</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmskindeploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy skins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsoap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Print mail, account, and admin information in the SOAP format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmspellctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, or find the status of the spell check server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsshkeygen</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate Zimbra&#8217;s SSH encryption keys</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstat-chart</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate charts from zmstat data collected in a directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstat-chart-config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Outputs an XML configuration that describes the current state of the data
gathered from zmstat-chart to generate charts on the Administration
Console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstatctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, check status, or rotate logs of zmstat data collectors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmstorectl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, or find the status of Zimbra store services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmswatchctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Start, stop, or find the status of the Swatch process, which is used in
monitoring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmsyncreverseproxy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Decodes the sync request/responses and logs them when verbose mode is
turned on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmthrdump</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initiate a thread dump and save the data to a file with a timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmtlsctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set the Web server mode to the communication protocol options:
HTTP, HTTPS or mixed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmtrainsa</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to train the anti-spam filter to recognize what is spam or ham</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmtzupdate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides mechanism to process time zone changes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmupdateauthkeys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to fetch the ssh encryption keys created by <code>zmsshkeygen</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmvolume</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manage storage volumes on your Zimbra Mailbox server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmzimletctl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy and configure Zimlets</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_using_non_ascii_characters_in_clis">Using non-ASCII Characters in CLIs</h4>
<div class="paragraph">
<p>If you use non-ASCII characters in the CLI, in order for the characters to
display correctly, you must change this setting to the desired UTF-8 before
running the CLI command.  To change this, type</p>
</div>
<div class="paragraph">
<p><code>export LC_All=&lt;UTF_locale&gt;</code></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The default locale on the zimbra user system account is LANG=C.  This
setting is necessary for starting ZCS services.  Changing the default
LANG=C setting may cause performance issues with amavisd-new.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmprov_provisioning">zmprov (Provisioning)</h4>
<div class="paragraph">
<p>The <code>zmprov</code> tool performs all provisioning tasks in Zimbra LDAP, including
creating accounts, aliases, domains, COS, distribution lists, and calendar
resources.  Each operation is invoked through command-line options, each of
which has a long name and a short name.</p>
</div>
<div class="paragraph">
<p>The syntax is <code>zmprov [cmd] [argument]</code>.</p>
</div>
<div class="paragraph">
<p>The syntax for modify can include the prefix &#8220;+&#8221; or &#8220;-&#8221; so that you can
make changes to the attributes affected and do not need to reenter
attributes that are not changing.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Use <code>+</code> to add a new instance of the specified attribute name without
changing any existing attributes.</p>
</li>
<li>
<p>Use <code>-</code> to remove a particular instance of an attribute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following example would add the attribute <code>zimbraZimletUserProperties</code>
with the value "blue" to user 1 and would not change the value of any other
instances of that attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma user1 +zimbraZimletUserProperties &quot;com_company_testing:favoriteColor:blue&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The attributes for the tasks zmprov can be used with are listed when you
type <code>zmprov -h</code>.  The task area divided into the following sections:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Syntax, Example, and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">display usage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use file as input stream</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{host}[:{port}] server hostname and optional port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">provision via LDAP instead of SOAP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--logpropertyfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-L</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log4j property file, valid only with <code>-l</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account {name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">account name to auth as</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password {pass}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password for account</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--passfile {file}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read password from file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use Zimbra admin name/password from localconfig for admin/password</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--authtoken {authtoken}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use auth token string (has to be in JSON format) from command line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--authtokenfile {authtoken-file}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use auth token string (has to be in JSON format) from a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">verbose mode (dumps full exception stack trace)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug mode (dumps SOAP messages)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--master</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use LDAP master.  This only valid with <code>-l</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--replace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">allow replacement of safe-guarded multi-value attribute configured in
localconfig key <code>zmprov_saveguarded_attrs</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The commands are categorized and briefly described in the following
topics:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#account_provisioning_cmds">Account Provisioning Commands</a></p>
</li>
<li>
<p><a href="#calendar_resource_provisioning_cmds">Calendar Resource Provisioning
Commands</a></p>
</li>
<li>
<p><a href="#free_busy_cmds">Free Busy Commands</a></p>
</li>
<li>
<p><a href="#domain_provisioning_cmds">Domain Provisioning Commands</a></p>
</li>
<li>
<p><a href="#cos_provisioning_cmds">COS Provisioning Commands</a></p>
</li>
<li>
<p><a href="#server_provisioning_cmds">Server Provisioning Commands</a></p>
</li>
<li>
<p><a href="#config_provisioning_cmds">Config Provisioning Commands</a></p>
</li>
<li>
<p><a href="#distribution_list_provisioning_cmds">Distribution List Provisioning
Commands</a></p>
</li>
<li>
<p><a href="#mailbox_cmds">Mailbox Commands</a></p>
</li>
<li>
<p><a href="#logs_cmds">Logs Commands</a></p>
</li>
<li>
<p><a href="#search_cmds">Search Commands</a></p>
</li>
<li>
<p><a href="#share_provisioning_cmds">Share Provisioning Commands</a></p>
</li>
<li>
<p><a href="#unified_communication_service_cmds">Unified Communication Service
Commands</a></p>
</li>
<li>
<p><a href="#imap_pop_proxy_cmds">IMAP/POP Proxy Commands</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="account_provisioning_cmds">Account Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 64. <code>zmprov</code>&#8201;&#8212;&#8201;Account Provisioning Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addAccountAlias (aaa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} {alias@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov aaa joe@domain.com joe.smith@engr.domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>checkPasswordStrength (cps)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@doman | id} {password}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cps joe@domain.com test123</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This command does not check the password age or history.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createAccount (ca)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} {password} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ca joe@domain.com test123 displayName JSmith</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createDataSource (cds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} {ds-type} {ds-name} zimbraDataSourceEnabled {TRUE | FALSE} zimbraDataSourceFolderId {folder-id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createIdentity (cid)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} {identity-name} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createSignature (csig)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} {signature-name} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteAccount (da)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov da joe@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteDataSource (dds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {ds-name | ds-id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteIdentity (did)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {identity-name}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteSignature (dsig)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {signature-name}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAccount (ga)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ga joe@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAccountMembership (gam)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllAccounts (gaa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v] [domain]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Must include <code>-l</code>/<code>--ldap</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov -l gaa
zmprov -l gaa -v domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllAdminAccounts (gaaa)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gaaa</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDataSources (gds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} [arg1 [arg2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getIdentities (gid)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} [arg1 [arg2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getSignatures (gsig)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} [arg1 [arg2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyAccount (ma)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma joe@domain.com zimbraAccountStatus maintenance</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyDataSource (mds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {ds-name | ds-id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyIdentity (mid)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {identity-name} [attr1 value1 [attr2 value 2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifySignature (msig)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {signature-name | signature-id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeAccountAlias (raa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} {alias@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov raa joe@domain.com joe.smith@engr.domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameAccount (ra)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {newname@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ra joe@domain.com joe23@domain.com</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
After you rename an account, you should run a full backup for that account.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -f -s &lt;servername.com&gt; -a &lt;newaccountname@servername.com&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setAccountCOS (sac)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} {cos-name | cos-id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov sac joe@domain.com FieldTechnician</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setPassword (sp)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id | adminName} {password}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov sp joe@domain.com test321</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Passwords cannot included accented characters in the string.  Example of
accented characters that cannot be used: ã, é, í, ú, ü, ñ.
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="calendar_resource_provisioning_cmds">Calendar Resource Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 65. <code>zmprov</code>&#8201;&#8212;&#8201;Calendar Resource Provisioning Commands</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createCalendarResource (ccr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain} [attr1 value1 [attr2 value2]&#8230;&#8203;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteCalendarResource (dcr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain | id}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllCalendarResources (gacr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-v] [domain]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getCalendarResource (gcr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain | id}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyCalendarResource (mcr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain | id} [attr1 value1 {attr2 value2]&#8230;&#8203;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>purgeAccountCalendarCache (pacc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain} [&#8230;&#8203;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameCalendarResource (rcr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{name@domain | id} {newName@domain}</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="free_busy_cmds">Free Busy Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 66. <code>zmprov</code>&#8201;&#8212;&#8201;Free Busy Commands</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllFbp (gafbp)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[-v]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getFreebusyQueueInfo (gfbqi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[{provider-name}]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pushFreebusy (pfb)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{domain | account-id} [account-id&#8230;&#8203;]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pushFreebusyDomain (pfbd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">{domain}</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>purgeFreebusyQueue (pfbg)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[{provider-name}]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="domain_provisioning_cmds">Domain Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 67. <code>zmprov</code>&#8201;&#8212;&#8201;Domain Provisioning Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countAccount (cta)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This lists each COS, the COS ID and the number of accounts assigned to each
COS</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createAliasDomain (cad)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{alias-domain-name} {local-domain-name | id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createDomain (cd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cd mktng.domain.com zimbraAuthMech zimbra</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteDomain (dd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov dd mktng.domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDomain (gd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gd mktng.domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDomainInfo (gdi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name | id | virtualHostname {value} [attr1 [attr2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllDomains (gad)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyDomain (md)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md domain.com zimbraGalMaxResults 500</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Do not modify <code>zimbraDomainRenameInfo</code> manually.  This is automatically
updated when a domain is renamed.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameDomain (rd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id} {newDomain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>renameDomain</code> can only be used with <code>zmprov -l/--ldap</code>
</td>
</tr>
</table>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="cos_provisioning_cmds">COS Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 68. <code>zmprov</code>&#8201;&#8212;&#8201;COS Provisioning Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>copyCos (cpc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{src-cos-name | id} {dest-cos-name}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createCos (cc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cc Executive zimbraAttachmentsBlocked FALSE zimbraAuthTokenLifetime 60m zimbraMailQuota 100M zimbraMailMessageLifetime 0</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteCos (dc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov dc Executive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getCos (gc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gc Executive</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllCos (gac)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gac -v</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyCos (mc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc Executive zimbraAttachmentsBlocked TRUE</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameCos (rc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} {newName}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rc Executive Business</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="server_provisioning_cmds">Server Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 69. <code>zmprov</code>&#8201;&#8212;&#8201;Server Provisioning Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createServer (cs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteServer (ds)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ds domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getServer (gs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gs domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllServers (gas)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gas</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyServer (ms)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} [attr1 value1]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms domain.com zimbraVirusDefinitionsUpdateFrequency 2h</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllMtaAuthURLs (gamau)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used to publish into <code>saslauthd.conf</code> what servers should be used for
<code>saslauthd.conf</code> MTA auth</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllMemcachedServers (gamcs)</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Used to list memcached servers (for nginix use).</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="config_provisioning_cmds">Config Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 70. <code>zmprov</code>&#8201;&#8212;&#8201;Config Provisioning Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllConfig (gacf)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>All LDAP settings are displayed</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getConfig (gcf)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyConfig (mcf)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>attr1 value1</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Modifies the LDAP settings.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createXMPPComponent (csc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{short-name} {domain} {server} {classname} {category} {type} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteXMPPComponent (dxc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{xmpp-component-name}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getXMPPComponent (gxc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} [attr1 [attr2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyXMPPComponent (mxc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="distribution_list_provisioning_cmds">Distribution List Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 71. <code>zmprov</code>&#8201;&#8212;&#8201;Distribution List Provisioning Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createDistributionList (cdl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cdl needlepoint-list@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDistributionListMember (adlm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} {member@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov adlm needlepoint-list@domain.com singer23@mail.free.net</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeDistributionListMember (rdlm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rdlm needlepoint-list@domain.com singer23@mail.free.net</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAlldistributionLists (gadl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDistributionListmembership (gdlm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>gdlm</code> can not be used for gynamic groups, as dynamic groups cannot be
nested.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getDistributionList (gdl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gdl list@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyDistributionList (mdl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} attr1 value1 [attr2 value2]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md list@domain.com</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteDistributionList (ddl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDistributionListAlias (adla)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} {alias@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeDistributionListAlias (rdla)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} {alias@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameDistributionList (rdl)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{list@domain | id} {newName@domain}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="mailbox_cmds">Mailbox Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 72. <code>zmprov</code>&#8201;&#8212;&#8201;Mailbox Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getMailboxInfo (gmi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{account}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getQuotaUsage (gqu)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{server}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>recalculateMailboxCounts (rmc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When unread message count and quota usage are out of sync with the data
in the mailbox, use this command to immediately recalculate the mailbox
quota usage and unread messages count.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Recalculating mailbox quota
usage and message count should be schedule to
run in off peak hours and used on one mailbox
at a time.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reIndexMailbox (rim)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {start | status | cancel} [type | id]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compactIndexMailbox (cim)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {start | status}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>verifyIndex (vi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getIndexStats (gis)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>selectMailbox (sm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{account-name} [{zmmailbox commands}]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unlockMailbox (ulm)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} [hostname]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Only specify the hostname parameter when unlocking a mailbox after a failed move attempt.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_miscellaneous_provisioning_commands">Miscellaneous Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 73. <code>zmprov</code>&#8201;&#8212;&#8201;Miscellaneous Provisioning Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>countObjects (cto)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{type} [-d {domain | id}]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>countObjects</code> can only be used with <code>zmprov -l/--ldap</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createBulkAccounts (cabulk)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} {namemask} {number of accounts to create}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>describe (desc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[[-v] [-ni] [{entry-type}]] | [-a {attribute-name}]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Prints all attribute names (account, domain, COS, servers, etc.).</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flushCache (fc)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-a] {acl | locale | skin | uistrings | license | all | account | config | glo | balgrant | cos | domain | galgroup | group | mime | server | zimlet | &lt;extension-cache-type&gt;} [name1 | id1 [name2 | i d2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Flush cached LDAP entries for a type.  See <a href="#zimbra_ldap_service">Zimbra LDAP Service</a>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generateDomainPreAuth Key (gdpak)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Generates a pre-authentication key to enable a trusted third party to
authenticate to allow for single-sign on.  Used in conjunction with
<code>GenerateDomainPreAuth</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>generateDomainPreAuth (gdpa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain | id} {name} {name | id | foreignPrincipal} {timestamp | 0} {expires | 0}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Generates preAuth values for comparison.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>syncGal (syg)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} [{token}]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAccountLogger (gal)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s /--server hostname] {name@domain | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="logs_cmds">Logs Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 74. <code>zmprov</code>&#8201;&#8212;&#8201;Logs Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addAccountLogger (aal)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name@domain | id} {logging-category} {debug | info | warn | error}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Creates custom logging for a single account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAccountLoggers (gal)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s/--server hostname] {name@domain | id} {logging-category} {debug | info | warn | error}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllAccountLoggers (gaal)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s/--server hostname]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Shows all individual custom logger account.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>removeAccountLogger (ral)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s/ --server hostname] {name@domain | id} {logging-category}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When name@domain is specified, removes the custom logger created for the
account otherwise removes all accounts all account loggers from the system.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resetAllLoggers (rlog)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-s/--server hostname]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This command removes all account loggers and
reloads <code>/opt/zimbra/conf/log4j.properties</code>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <a href="#zmprov_log_categories"><code>zmprov</code> Log Categories</a> for a list of
logging categories.</p>
</div>
</div>
<div class="sect4">
<h5 id="search_cmds">Search Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 75. <code>zmprov</code>&#8201;&#8212;&#8201;Search Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchGAL (sg)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} {name}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>zmprov sg joe</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>autoCompleteGal (acg)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{domain} {name}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchAccounts (sa)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v] {ldap-query} [limit] [offset] [sortBy {attribute}] [sortAscending 0 | 1] [domain {domain}]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>searchCalendarResources (scr)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v] domain {attr op value} [attr op value]&#8230;&#8203;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="share_provisioning_cmds">Share Provisioning Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 76. <code>zmprov</code>&#8201;&#8212;&#8201;Share Provisioning Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getShareInfo (gsi)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{owner-name | owner-id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="unified_communication_service_cmds">Unified Communication Service Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 77. <code>zmprov</code>&#8201;&#8212;&#8201;Unified Communication Service Commands</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Syntax</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createUCService (cucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteUCService (ducs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllUCServices (gaucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-v]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getUCService (gucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>[-e] {name | id} [attr1 [attr2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>modifyUCService (mucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} [attr1 value1 [attr2 value2]&#8230;&#8203;]</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>renameUCService (rucs)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>{name | id} {newName}</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="imap_pop_proxy_cmds">IMAP/POP Proxy Commands</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 78. <code>zmprov</code>&#8201;&#8212;&#8201;IMAP/POP Proxy Commands</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Example/Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllReverseProxyURLs (garpu)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to publish into nginx.conf the servers that should be used for reverse
proxy lookup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllReverseProxy Backends (garpb)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the list of servers that have
<code>zimbraReverseProxyLookupTarget=TRUE</code>.</p>
<p class="tableblock">Indicates whether a mailbox server is available for lookup requests from the
proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getAllReverseProxyDomains (garpd)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns a list of all domains configured with <code>ZimbraSSLCertificate
zimbraVirtualHostname</code> and <code>zimbraVirtualIPAddress</code> configured.  This
allows the proxy to configure a list of domains to serve customized/domain
certificates for.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_examplesusing_zmprov">Examples&#8201;&#8212;&#8201;using zmprov</h5>
<div class="exampleblock">
<div class="title">Example 44. Creating an account with a password that is assigned to the default COS</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ca name@domain.com password</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 45. Creating an account with a password that is assigned to a specified COS</div>
<div class="content">
<div class="paragraph">
<p>You must know the COS ID number.  To find a COS ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gc &lt;COSname&gt;

zmprov ca name@domain.com password zimbraCOS cosIDnumberstring</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 46. Creating an account when the password is not authenticated internally</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ca name@domain.com ''</code></pre>
</div>
</div>
<div class="paragraph">
<p>The empty single quote is required and indicates that there is no local
password.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 47. Using a batch process to create accounts</div>
<div class="content">
<div class="paragraph">
<p>See <a href="#provisioning_user_accounts">Provisioning User Accounts</a> for the
procedure.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 48. Bulk provisioning</div>
<div class="content">
<div class="paragraph">
<p>See the Zimbra wiki page <a href="https://wiki.zimbra.com/wiki/Bulk_Provisioning">Bulk_Provisioning</a>.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 49. Adding an alias to an account</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov aaa accountname@domain.com aliasname@domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 50. Creating a distribution list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cdl listname@domain.com</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ID of the distribution list is returned.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 51. Adding a member to a distribution list</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov adlm listname@domain.com member@domain.com</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can add multiple members to a list from the Administration Console.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 52. Changing the administrator&#8217;s password</div>
<div class="content">
<div class="paragraph">
<p>Use this command to change any password.  Enter the address of the password
to be changed.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov sp admin@domain.com password</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 53. Creating a domain that authenticates against Zimbra LDAP</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov cd marketing.domain.com zimbraAuthMech zimbra</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 54. Setting the default domain</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf zimbraDefaultDomain domain1.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 55. Listing all COSs and their attribute values</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gac -v</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 56. Listing all user accounts in a domain (domain.com)</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gaa domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 57. Listing all user accounts and their configurations</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gaa -v domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 58. Enabling logger on a single server</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms server.com +zimbraServiceEnabled logger</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then type zmloggerctl start, to start the logger.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 59. Querying a value for a multi-valued attribute</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov gs server.com attribute=value</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, <code>zmprov gs example.com zimbraServiceEnabled=ldap</code> to find out if
the ldap service is enabled.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 60. Modify the purge interval</div>
<div class="content">
<div class="paragraph">
<p>To modify the purge interval, set <code>zimbraMailPurgeSleepInterval</code> to the
duration of time that the server should "sleep" between every two
mailboxes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ms server.com zimbraMailPurgeSleepInterval &lt;Xm&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>X</strong> is the duration of time between mailbox purges; <strong>m</strong> represents
minutes. You could also set <strong>&lt;xh&gt;</strong> for hours.</p>
</div>
</div>
</div>
<div id="custom_new_mail_notification" class="exampleblock">
<div class="title">Example 61. Customize the notification email</div>
<div class="content">
<div class="paragraph">
<p>Modify <code>zimbraNewMailNotification</code> to customize the notification email
template.  A default email is sent from Postmaster notifying users that
they have received mail in another mailbox.  To change the template, you
modify the receiving mailbox account.  The variables are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>${SENDER_ADDRESS}</p>
</li>
<li>
<p>${RECIPIENT_ADDRESS}</p>
</li>
<li>
<p>${RECIPIENT_DOMAIN}</p>
</li>
<li>
<p>${NOTIFICATION_ADDRESSS}</p>
</li>
<li>
<p>${SUBJECT}</p>
</li>
<li>
<p>${NEWLINE}</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can specify which of the above variables appear in the <strong>Subject</strong>,
<strong>From</strong>, or <strong>Body</strong> of the email.  The following example is changing the
appearance of the message in the body of the notification email that is
received at <strong>name@domain.com</strong>.  You can also change the template in a class
ofservice, use <code>zmprov mc</code>.  The command is written on one line.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov ma name@domain.com zimbraNewMailNotificationBody 'Important message from ${SENDER_ADDRESS}.${NEWLINE}Subject:${SUBJECT}'</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 62. Enable the SMS notification by COS, account or domain</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;default&gt; zimbingaFeatureCalendarReminderDeviceEmailEnabled TRUE
zmprov ma &lt;user1&gt; zimbraFeatureCalendarReminderDeviceEmailEnabled TRUE
zmprov md &lt;domain&gt; zimbraFeatureCalendarReminderDeviceEmailEnabled TRUE</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 63. Enable the Activity Stream feature for a COS or set of users</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc &lt;default&gt; zimbraFeaturePriorityInboxEnabled TRUE
zmprov ma &lt;user1&gt; zimbraFeaturePriorityInboxEnabled TRUE</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_configure_auto_grouped_backup_from_the_cli">Configure Auto-Grouped Backup from the CLI</h5>
<div class="paragraph">
<p>Set the backup method in the global configuration, and you can override the
configuration on a per server basis if you do not want a server to use the
auto-grouped backup method.</p>
</div>
<div class="paragraph">
<p>To set up auto-grouped backup, you modify LDAP attributes using the zmprov
CLI.  Type the command as</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mcf &lt;ldap_attribute&gt; &lt;arg&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also set the attributes at the server level using <code>zmprov ms</code>.</p>
</div>
<div class="paragraph">
<p>The following LDAP attributes are modified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>zimbraBackupMode</code>&#8201;&#8212;&#8201; Set it to be <code>Auto-Grouped</code>. The default is
<code>Standard</code>.</p>
</li>
<li>
<p><code>zimbraBackupAutoGroupedInterval&#8201;&#8212;&#8201;Set this to the interval in either
days or weeks that backup sessions should run for a group.  The default is
`1d</code>.  Backup intervals can be 1 or more days, entered as <code>xd</code> (<code>1d</code>); or 1
or more weeks, entered as <code>xw</code> (<code>1w</code>).</p>
</li>
<li>
<p><code>zimbraBackupAutoGroupedNumGroups</code>&#8201;&#8212;&#8201;This the number of groups to spread
mailboxes over.  The default is 7 groups.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="conversation_threading">Changing Conversations Thread Default</h5>
<div class="paragraph">
<p>Messages can be grouped into conversations by a common thread.  The default
is to thread messages in a conversation by the References header.  If there
is no References header, the Subject is used to determine the conversation
thread.  The default options can be changed from the COS or for individual
accounts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov mc [cosname] zimbraMailThreadingAlgorithm [type]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The types include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>none</strong>&#8201;&#8212;&#8201;no conversation threading is performed.</p>
</li>
<li>
<p><strong>subject</strong>&#8201;&#8212;&#8201;the message will be threaded based solely on its normalized
subject.</p>
</li>
<li>
<p><strong>strict</strong>&#8201;&#8212;&#8201;only the threading message headers (References, In-Reply-To,
Message-ID, and Resent-Message-ID) are used to correlate messages.  No
checking of normalized subjects is performed.</p>
</li>
<li>
<p><strong>references</strong>&#8201;&#8212;&#8201;the same logic as "strict" with the constraints slightly
altered so that the non-standard Thread-Index header is considered when
threading messages and that a reply message lacking References and
In-Reply-To headers will fall back to using subject-based threading.</p>
</li>
<li>
<p><strong>subjrefs</strong>&#8201;&#8212;&#8201;the same logic as "references" with the further caveat
thatchanges in the normalized subject will break a thread in two.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_detecting_corrupted_indexes">Detecting Corrupted Indexes</h5>
<div class="paragraph">
<p>Run <code>zmprov verifyIndex</code> as a sanity check for the specified mailbox index.
Diagnostic information is written to stdout.  If problems are detected, a
failure status is returned.</p>
</div>
<div class="paragraph">
<p><code>verifyIndex</code> locks the index while it&#8217;s running, and checks every byte in
the index.  Therefore, it&#8217;s not recommended to run this on a regular basis
such as in a cron job.  The zmprov verifyIndex command should be used only
when you need to make a diagnosis.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov verifyIndex &lt;user@example.com&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>If <code>verifyIndex</code> reports that the index is corrupted, you can repair the
mailbox index by running <code>reIndexMailbox (rim)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov rim &lt;user@example.com&gt; start</code></pre>
</div>
</div>
<table id="zmprov_log_categories" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 79. <code>zmprov</code>&#8201;&#8212;&#8201;Log Categories</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.acl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACL operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backup and restore</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.cache</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inmemory cache operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.calendar</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.dav</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAV operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.dbconn</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Database connection tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.extensions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Server extension loading</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail filtering</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.gal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GAL operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.imap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMAP protocol operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.index</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Index operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filesystem operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LDAP operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.lmtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LMTP operations (incoming mail)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.mailbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General mailbox operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.misc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Miscellaneous</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.op</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes to mailbox state</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.pop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POP protocol operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.redolog</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redo log operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.security</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security events</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.session</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User session tracking</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.smtp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP operations (outgoing mail)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.soap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOAP protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.sqltrace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL tracing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.store</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mail store disk operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sync client operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.system</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Startup/shutdown and other system messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.wiki</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wiki operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbra.zimlet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zimlet operations</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmaccts">zmaccts</h4>
<div class="paragraph">
<p>Use <code>zmaccts</code> to run a report that lists all the accounts, their status,
when they were created and the last time anyone logged on.  The domain
summary shows the total number of accounts and their status.</p>
</div>
<div class="sect4">
<h5 id="_syntax">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmaccts</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmarchiveconfig">zmarchiveconfig</h4>
<div class="paragraph">
<p>Use <code>zmarchiveconfig</code> for configuring the archiving mailbox.  It has the
option of using short commands or full names for commands that lead to the
same function being carried out.</p>
</div>
<div class="sect4">
<h5 id="_syntax_2">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchiveconfig [args] [cmd] [cmd-args]...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(host)[:(port)] Displays the server hostname and optional port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(name) Returns the value of the account name to be authorized</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows archiving to be provisioned via LDAP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(pass) Returns the password for auth account</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--passfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(file) Allows password to be read from file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows use of Zimbra admin/password from local</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activates debug mode (dumps SOAP messages)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code><strong>Command in &#8230;&#8203;</strong></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enable &lt;account&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">[archive-address &lt;aaddr&gt; [archive-cos &lt;cos&gt;] [archive-create &lt;TRUE/FALSE&gt;]
[archive-password &lt;pa [zimbraAccountAttrName &lt;archive-attr-value]+</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disable &lt;account&gt;</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmarchivectl">zmarchivectl</h4>
<div class="paragraph">
<p>Use <code>zmarchivectl</code> to start, stop, reload, or check the status of the Zimbra
account archive.</p>
</div>
<div class="sect4">
<h5 id="_syntax_3">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchivectl start|stop|reload|status</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmarchivesearch">zmarchivesearch</h4>
<div class="paragraph">
<p>Use <code>zmarchivesearch</code> to search across account archives.  You can search
for archives that match specific criteria and save copies to a
directory.</p>
</div>
<div class="sect4">
<h5 id="_syntax_4">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchivesearch {-m &lt;user@domain.com&gt;} {-q &lt;query_string&gt;} [-o &lt;offset&gt;] [-l &lt;limit&gt;] [-d &lt;output_directory&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_2">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Folder to write messages to.  If none is specified, then only the
headers are fetched.  Filenames are generated in the form
<code>RESULTNUM_ACCOUNT-ID_MAILITEMID</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Sets the limit for the number of results returned.  The default is 25</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Name of archive account to search</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies where the hit list should begin.  The default is 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> The query string for archive search</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server hostname.  Default is localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows printing of status messages while the search is being executed</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 64. Search archives on a specified server and put a copy of the archive in a specified directory</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmarchivesearch -m user1@yourdomain.com -q &quot;in:sent&quot; -o 0 -l 30 -d /var/tmp</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmbackup">zmbackup</h4>
<div class="paragraph">
<p>Use <code>zmbackup</code> to perform full backups and incremental backups for a
designated mail host.</p>
</div>
<div class="paragraph">
<p>This utility has short option names and full names.  The short option is
preceded by a single dash, while the full option is preceded by a double
dash.  For example, <code>-f</code> is the same as <code>--fullBackup</code>.</p>
</div>
<div class="sect4">
<h5 id="_syntax_5">Syntax</h5>
<div class="paragraph">
<p>One of <code>-f</code>, <code>-i</code>, or <code>-del</code> must be specified.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup {-f | -i | del} {-a &lt;arg&gt;} [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_3">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Account email addresses separated by white space or all for all
accounts.  This option is not specified for auto-grouped backups since the
system knows which accounts to backup every night.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display diagnostics for debugging purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-del</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Deletes the backups including and prior to the specified label, date
(YYYY/MM/DD[-hh:mm:ss]) or period (nn(d | m | y]).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exclude blobs from full backup.  If unspecified, use server config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exclude blobs on HSM volumes from full backup; if unspecified, use server
config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exclude search index from full backup; if unspecified, use server config</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--fullBackup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starts a full backup.  In auto-grouped backup mode, this option also copies
the redologs since the last backup (which is the main function of an
incremental backup).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--incrementalBackup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starts an incremental backup.  This option is not available in the
auto-grouped backup mode.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include blobs in full backup.  If this is unspecified, the server config is
used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include blobs on HSM volumes in full backup.  If this is unspecified, the
server config is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include search index in full backup.  If this is unspecified, the server
config is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--noZip</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backs up blobs as individual files rather than in <code>zip</code> files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server host name.  For format, use either the plain host name or
the server.domain.com name.  The default is the localhost name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Runs full backup synchronously.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the target backup location.  The default is
<code>/opt/zimbra/backup</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backs up blobs in compressed <code>zip</code> files.  Ignored if <code>--zipStore</code> is
specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zipStore</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Backup blobs in <code>zip</code> file without compression.  (default)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_examples">Examples</h5>
<div class="paragraph">
<p>In these examples, the server (<code>-s</code>) is <code>server1.domain.com</code>.  The (<code>-t</code>)
is not required if the target is the default directory,
(<code>/opt/zimbra/backup</code>).</p>
</div>
<div class="exampleblock">
<div class="title">Example 65. Perform a full backup of all mailboxes on <strong>server1</strong></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -f -a all -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 66. Perform incremental backup of all mailboxes on <strong>server1</strong> since last full backup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -i -a all -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 67. Perform full backup of only <strong>user1</strong>'s mailbox on <strong>server1</strong>.</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -f -a user1@domain.com -s server1</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hostname does not need full domain if account is used.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 68. Perform incremental backup of <strong>user1</strong>'s mailbox on <strong>server1</strong></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackup -i -a user1@domain.com -s server1</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmblobchk">zmblobchk</h4>
<div class="paragraph">
<p>Use <code>zmblobchk</code> to check the consistency of the Zimbra blob store
(<code>/opt/zimbra/store</code>).  This command checks and records notes of files
without matching database metadata.  It also checks to make sure that size
information is correct for the files.</p>
</div>
<div class="sect4">
<h5 id="_syntax_6">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmblobchk [options] start</code></pre>
</div>
</div>
<div class="paragraph">
<p>The start command is required to avoid unintentionally running a blob
check.  The ID values are separated by commas.</p>
</div>
</div>
<div class="sect4">
<h5 id="_description_4">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--export-dir</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;path&gt; Target directory for database export files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mailboxes</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;mailbox-ids&gt; Specify which mailboxes to check.  If not specified, check
all mailboxes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--missing-blob-delete-item</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete any items that have a missing blob.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--no-export</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Delete items without exporting</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skip-size-check</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Skip blob size check</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--unexpected-blob-list</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;path&gt; Write the paths of any unexpected blobs to a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display verbose output; display stack trace on error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--volumes</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;volume-ids&gt; Specify which volumes to check.  If not specified, check all
volumes</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmcalchk">zmcalchk</h4>
<div class="paragraph">
<p>Use <code>zmcalchk</code> to check the consistency of appointments on the Zimbra
calendar and sends an email notification regarding inconsistencies.  For
example, it checks if all attendees and organizers of an event on the
calendar agree on start/stop times and occurrences of a meeting.</p>
</div>
<div class="paragraph">
<p>See the output of <code>zmmailbox help appointment</code> for details on
time-specs.</p>
</div>
<div class="sect4">
<h5 id="_syntax_7">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcalchk [-d] [-n &lt;type&gt;] &lt;user&gt; &lt;start-time-spec&gt; &lt;end-time-spec&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_5">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debugs verbose details</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows the user to specify the maximum number of attendees to check.  The
default value is 50.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n none | user | organizer | attendee | all</code></p>
<p class="tableblock">Send email notifications to selected users if they are out of sync for an
appointment</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmschedulebackup">zmschedulebackup</h4>
<div class="paragraph">
<p>Use <code>zmschedulebackup</code> to schedule backups and add the command to your cron
table.</p>
</div>
<div class="paragraph">
<p>The default schedule is as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Full backup, every Saturday at 1:00 a.m.  (<code>0 1 * * 6</code>)</p>
</li>
<li>
<p>Incremental backup, Sunday through Friday at 1:00 a.m.  (<code>0 1 * * 0-5</code>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each crontab entry is a single line composed of five fields separated by a
blank space.  Specify the fields as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>minute&#8201;&#8212;&#8201;0 through 59</p>
</li>
<li>
<p>hour&#8201;&#8212;&#8201;0 through 23</p>
</li>
<li>
<p>day of the (month)&#8201;&#8212;&#8201;1 through 31</p>
</li>
<li>
<p>month&#8201;&#8212;&#8201;1 through 12</p>
</li>
<li>
<p>day of the (week)&#8201;&#8212;&#8201;0 through 7 (0 or 7 is Sunday, or use names)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Type an asterisk (<code>*</code>) in the fields you are not using.</p>
</div>
<div class="paragraph">
<p>This command automatically writes the schedule to the crontab.</p>
</div>
<div class="sect4">
<h5 id="_syntax_8">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup {-q|-s|-A|-R|-F|-D}[f|i|d|] [&quot;schedule&quot;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_6">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Command Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays the usage options for this command.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Default command.  Displays the existing Zimbra backup schedule.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>save</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Save the schedule.  Allows you to save the schedule command to a text file
so that you can quickly regenerate the backup schedule when the system is
restored.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flush</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-F</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Removes the current schedule and cancels all scheduled backups.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>append</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-A</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Adds an additional specified backup to the current schedule.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>replace</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-R</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Replaces the current schedule with the specified schedule.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-D</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Replaces the current schedule with the default schedule.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code><strong>Options that will be passed to zmbackup</strong></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>no compression</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Backs up blobs as individual files rather than in <code>zip</code> files</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>compress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Backs up blobs in compressed <code>zip</code> files.  Ignored if <code>--zipStore</code> is
specified.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zipStore</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Backs up blobs in <code>zip</code> file without compression.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Can be used only to designate a full back target location.  The default is
<code>/opt/zimbra/backup</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You cannot designate a target for incremental backups.  If a target (<code>-t</code>)
location is added for incremental scheduled backups, it is ignored.
</td>
</tr>
</table>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Account specific.  The default is all accounts.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mail-report</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Send an email report to the admin user.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>server - Mail server hostname.  Default is localhost.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sync</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Runs full backup synchronously.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Exclude blobs from full backup.  If unspecified, server config is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Include blobs in full backup.  If unspecified, the server config is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Exclude blobs on HSM volumes from full backup.  If unspecified, the server
config is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Include blobs on HSM volumes in full backup.  If unspecified, the server
config is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Exclude search index form full backup.  If unspecified, the server config
is used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--includeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Include search index in full backup.  If unspecified, the server config is
used.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code><strong>Cron schedule</strong>&#8201;&#8212;&#8201;backup-type: <code>&lt;i | f | d arg&gt;</code></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>incremental backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><code>&lt;time specifier&gt;</code> Incremental backup.</p>
</div>
<div class="paragraph">
<p>Incremental backup is not used with the auto-grouped backup mode.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>full backup</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>f</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Full backup</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d &lt;arg&gt;</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Delete backups.  <code>&lt;arg&gt;</code> is <code>n(d | m | y)</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_backup_scheduling_examples">Backup Scheduling Examples</h5>
<div class="exampleblock">
<div class="title">Example 69. Schedule the default full and incremental backup</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -D</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 70. Replace the existing schedule with a new schedule</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -R f [&quot;schedule&quot;]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 71. Add an additional full backup to the existing schedule</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -A f [&quot;schedule&quot;]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 72. Add an additional incremental backup to the existing schedule</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -A i [&quot;schedule&quot;]</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 73. Display the existing schedules</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -q</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 74. Display the schedules on one line</div>
<div class="content">
<div class="paragraph">
<p>Display the schedules on one line as a command, so that they can be copied
to a text file and saved to be used if the application needs to be
restored.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmschedulebackup -s</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmbackupabort">zmbackupabort</h4>
<div class="paragraph">
<p>Use <code>zmbackupabort</code> to stop a backup process.  Before you can abort an
account you must know its backup label.  This label is displayed after you
start the backup procedure.  If you do not know the label, use
<code>zmbackupquery</code> to find the label name.</p>
</div>
<div class="paragraph">
<p><strong>To stop the restore process:</strong></p>
</div>
<div class="paragraph">
<p>The <code>zmbackupabort -r</code> interrupts an ongoing restore.  The restore process
is stopped after the current account is restored.  The command displays
message showing which accounts were not restored.</p>
</div>
<div class="sect4">
<h5 id="_syntax_9">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackupabort [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_7">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display diagnostics for debugging purposes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Label of the full backup to be aborted.</p>
<p class="tableblock">Use <code>zmbackupquery</code>, to find the label name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restore</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abort the restore in process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server host name.  For format, use either the plain host name
or the server.domain.com name.  The default is the localhost name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the target backup location.</p>
<p class="tableblock">The default is <code>/opt/zimbra/backup</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmbackupquery">zmbackupquery</h4>
<div class="paragraph">
<p>Use <code>zmbackupquery</code> to find full backup sets.  The command can be used to
find a specific full backup set or full backup sets since a specific date,
or all backup sets in the backup directory.</p>
</div>
<div class="paragraph">
<p>To find out the best full backup to use as the basis for point-in-time
restore of an account, run a command like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackupquery -a &lt;account email&gt; --type full --to &lt;restore-to time&gt;</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_syntax_10">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmbackupquery [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_8">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Account email addresses separated by white space or all for all
accounts</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display diagnostics for debugging purposes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--from</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> List backups whose start date/time is at or after the date/time
specified here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> The label of the full backup session to query.  An example of a
label is <code>backup202107121559510</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server host name.  For format, use either the plain host name
or the server.domain.com name.  The default is the localhost name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the backup target location (The default is
<code>/opt/zimbra/backup</code>.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--to</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> List backups whose start date/time is at or before the date/time
specified here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--type</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Backup set type to query.  "full" or "incremental", both are
queried if one is not specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns detailed status information</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Specify date/time in one of these formats:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 100%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2021/12/16 12:19:23</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2021/12/16 12:19:23 257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2021/12/16 12:19:23.257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2021/12/16-12:19:23-257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2021/12/16-12:19:23</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20211216.121923.257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20211216.121923</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20211216121923257</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20211216121923</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Specify year, month, date, hour, minute, second, and optionally
millisecond.</p>
</div>
<div class="paragraph">
<p>Month/date/hour/minute/second are 0-padded to 2 digits, millisecond to 3
digits.</p>
</div>
<div class="paragraph">
<p>Hour must be specified in 24-hour format, and time is in local time zone.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmrestore">zmrestore</h4>
<div class="paragraph">
<p>Use <code>zmrestore</code> to perform full restores and incremental restores for a
designated mail host.  You can either specify specific accounts, or, if no
accounts are specified, all accounts are in the backup are restored.  In
addition, you can restore to a specific point in time.</p>
</div>
<div class="paragraph">
<p>This utility has short option names and full names.  The short option is
preceded by a single dash, the full option is proceeded by a double dash.
For example, <code>-rf</code> is the same as <code>--restorefullBackupOnly</code>.</p>
</div>
<div class="sect4">
<h5 id="_syntax_11">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_9">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the account email addresses.  Separate accounts with a
blank space or type all to restore all accounts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--backedupRedologs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-br</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replays the redo logs in backup only, which Only excludes archived and
current redo logs of the system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--continueOnError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Continue to restore other accounts when an error occurs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--createAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores accounts to target accounts whose names are prepended with prefix.</p>
<p class="tableblock">(Can only be used in commands that use the <code>-pre</code> option.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display diagnostics for debugging purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not restore blobs (HSM or not).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeHsmBlobs</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not restore HSM blobs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--excludeSearchIndex</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not restore search index.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> The label of the full backup to restore.  Restores to the latest
full backup if this is omitted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> The prefix to pre-pend to the original account names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores the account in directory service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToIncrLabel</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replay redo logs up to and including this incremental backup</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToRedoSeq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replay up to and including this redo log sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replay redo logs until this time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restorefullBackupOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-rf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores to the full backup only, not any incremental backups since that
backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server host name.  For format, use either the plain host name
or the server.domain.com name.  The default is the localhost name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skipDeletes</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, do not execute delete operation during redo log replay.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skipDeletedAccounts</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not restore if named accounts were deleted or did not exist at backup
time.  (This option is always enabled with <code>-a all</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--systemData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores global tables and local config.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the backup target location.  The default is
<code>/opt/zimbra/backup</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_examples_2">Examples</h5>
<div class="exampleblock">
<div class="title">Example 75. Perform complete restore of all accounts on <strong>server1</strong></div>
<div class="content">
<div class="paragraph">
<p>Perform complete restore of all accounts on <strong>server1</strong>, including last
full backup and any incremental backups since last full backup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a all -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 76. Perform restore only to last full backup</div>
<div class="content">
<div class="paragraph">
<p>Perform restore only to last full backup, excluding incremental
backups since then, for all accounts on <strong>server1</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -rf -a all -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 77. Create a new account from a backup of the target account</div>
<div class="content">
<div class="paragraph">
<p>The name of the new account will be <a href="mailto:new_user1@domain.com">new_user1@domain.com</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestore -a user1@domain.com -ca -pre new_</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmrestoreoffline_offline_restore">zmrestoreoffline (Offline Restore)</h4>
<div class="paragraph">
<p><code>zmrestoreoffline</code> requires that the following is true:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mailboxd</code> IS NOT running</p>
</li>
<li>
<p>SQL database IS RUNNING</p>
</li>
<li>
<p>LDAP directory IS RUNNING</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Pre-requisites</p>
</div>
<div class="sect4">
<h5 id="_syntax_12">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_10">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the account email addresses.  Separate accounts with a
blank space or state <code>all</code> for restoring all accounts.  <strong>Required</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--backedupRedologsOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-br</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replays the redo logs in backup only, which excludes archived and current
redo logs of the system.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--continueOnError</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Continue to restore other accounts when an error occurs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--createAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ca</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores accounts to new target accounts whose names are pre-pended with
prefix.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display diagnostics for debugging purposes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ignoreRedoErrors</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, ignore all errors during redo log replay.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--label</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> The label of the full backup to restore.  Type this label to
specify a backup file other then the latest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-pre</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;prefix&gt;</code> The prefix to pre-pend to the original account names.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreAccount</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ra</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores the account in directory service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToIncrLabel</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replay redo logs up to and including this incremental backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToRedoSeq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replay up to and including this redo log sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreToTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replay redo logs until this time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--restoreFullBackupOnly</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-rf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores to the full backup only, not any incremental backups since that
backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server host name.  For format, use either the plain host name
or the server.domain.com name.  The default is the localhost name.  If <code>-s</code>
is specified, this must be localhost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--skipDeletedAccounts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-skipDeletedAccounts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not restore if named accounts were deleted or did not exist at backup
time.  (This option is always enabled with <code>-a all</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--systemData</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Restores global tables and local config.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the backup target location.  The default is
<code>/opt/zimbra/backup</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_examples_3">Examples</h5>
<div class="paragraph">
<p>Before you begin <code>zmrestoreoffline</code>, the LDAP directory server must be
running.</p>
</div>
<div class="exampleblock">
<div class="title">Example 78. Perform a complete restore of all accounts on <strong>server1</strong></div>
<div class="content">
<div class="paragraph">
<p>Perform a complete restore of all accounts on <strong>server1</strong>, including last
full backup and any incremental backups since last full backup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreoffline -s server1.domain.com</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmrestoreldap">zmrestoreldap</h4>
<div class="paragraph">
<p>Use <code>zmrestoreldap</code> to restore accounts from the LDAP backup.</p>
</div>
<div class="sect4">
<h5 id="_syntax_13">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmrestoreldap {-lb &lt;arg&gt;} {-t &lt;arg&gt;} [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_11">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lb</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Session label to restore from.  For example, <code>full202112291821113</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the backup target location.  The default is
<code>/opt/zimbra/backup</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lbs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists all session labels in backup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists accounts in file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Restores named account(s).  List account names separated by white
space.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmcontrol_startstoprestart_service">zmcontrol (Start/Stop/Restart Service)</h4>
<div class="paragraph">
<p>Use <code>zmcontrol</code> to start, to stop, or to restart services.  You can also
find which version of the Zimbra Collaboration is installed.</p>
</div>
<div class="sect4">
<h5 id="_syntax_14">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol [ -v -h ] command [args]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_12">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays ZCS software version.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-H</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host name (localhost).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock"><code><strong>Command in&#8230;&#8203;</strong></code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>maintenance</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Toggle maintenance mode.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>restart</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Restarts all services and manager on this host.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>shutdown</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Shutdown all services and manager on this host.  When the manager is
shutdown, you cannot query that status.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>start</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Startup manager and all services on this host.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>startup</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Startup manager and all services on this host.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>status</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Returns services information for the named host.</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><code>stop</code></code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Stop all services but leaves the manager running.</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmboxsearch_cross_mailbox_search">zmmboxsearch (Cross Mailbox Search)</h4>
<div class="paragraph">
<p>Use <code>zmmboxsearch</code> is used to search across mailboxes.  You can search
across mailboxes to find messages and attachments that match specific
criteria and save copies of these messages to a directory.</p>
</div>
<div class="sect4">
<h5 id="_syntax_15">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxsearch {-m &lt;arg&gt;} {-q &lt;arg&gt;} [-o &lt;arg&gt;] [-l &lt;arg&gt;] [-d &lt;arg&gt;] [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_13">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Folder to write the messages to.  If none is specified, then
only the headers are fetched.  Files names are generated in the form
<code>RESULTNUM_ACCOUNT-ID_MAILITEMID</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--limit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the limit for the number of results returned.  The default is 25.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Comma-separated list of mailboxes to search.  UIDs or email-address
or <code>/SERVER/MAILBOXID</code> or <code>*</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--offset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specify where the hit list should start.  The default is 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--query</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> The query string for the search.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server hostname.  default is the localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request that the status message print while the search is being executed.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_example_10">Example</h5>
<div class="paragraph">
<p>The following example performs a cross-mailbox search in the inbox folder
of two different mailboxes on the specified server and puts a copy of the found
messages in to the specified directory.</p>
</div>
<div class="exampleblock">
<div class="title">Example 79. Cross-mailbox search</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxsearch -m user1@yourdomain.com,user2@yourdomain.com -q &quot;in:inbox&quot; -d /var/tmp</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmmboxmove">zmmboxmove</h4>
<div class="paragraph">
<p>Use <code>zmmboxmove</code> to move mailboxes.  The destination server manages the
overall move process.  Using the <code>zmmboxmove</code> command significantly reduces
the account lockout time.</p>
</div>
<div class="paragraph">
<p>The CLI command <code>zmmboxmove</code> is used to move mailboxes from one Zimbra
server to another.  Mailboxes can be moved between Zimbra servers that
share the same LDAP server.  All the files are copied to the new server and
the LDAP is updated.  After the mailbox is moved to a new server a copy
still remains on the older server, but the status of the old mailbox is
<code>closed</code>.  Users cannot log on and mail is not delivered.  You should check
to see that all the mailbox content was moved successfully before purging
the old mailbox.</p>
</div>
<div class="sect4">
<h5 id="_syntax_16">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxmove -a &lt;email&gt; --from &lt;src&gt; --to &lt;dest&gt; [--sync]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_14">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Email address of account to move.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--from</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server hostname.  Server where the <code>--account</code> mailbox is
located.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--to</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Destination server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sync</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run synchronously</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmboxmovequery">zmmboxmovequery</h4>
<div class="paragraph">
<p>Use <code>zmmboxmovequery</code> to query ongoing mailbox moves on a server, both
move-ins and move-outs.</p>
</div>
<div class="sect4">
<h5 id="_syntax_17">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmboxmovequery -a &lt;account email&gt; [-s &lt;server to query&gt;]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmpurgeoldmbox">zmpurgeoldmbox</h4>
<div class="paragraph">
<p>Use <code>zmpurgeoldmbox</code> to purge the mailbox from the older server after a
mailbox move.</p>
</div>
<div class="sect4">
<h5 id="_syntax_18">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmpurgeoldmbox -a &lt;account email&gt; [-s &lt;server to purge&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_15">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Email address of account to purge.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the usage options for this command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server hostname.  Old server where the account existed</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmgsautil">zmgsautil</h4>
<div class="paragraph">
<p>Use <code>zmgsautil</code> to create or delete the GAL sync account, and to force
syncing of the LDAP data to the GAL sync account.</p>
</div>
<div class="paragraph">
<p>A GAL sync account is created when the GAL is configured on a domain.  This
account is created and the polling interval for performing a full sync is
managed from the Administration Console.</p>
</div>
<div class="paragraph">
<p>To see attributes and settings for a GAL sync account, run <code>zmprov gds</code>
against the account.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>createAccount</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Creates the GAL sync account.  This should be done from
the Administration Console.</p>
</div>
<div class="paragraph">
<p>The parameter "server" is required.</p>
</div>
<div class="paragraph">
<p><code>-a {account-name} -n {datasource-name} --domain {domain-name} -t zimbra|ldap -s {server} [-f {folder-name}] [-p {polling-interval}]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>addDataSource</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>When configuring a datasource for a server, specify a folder name other
than <code>/Contacts</code>.  The datasource folder name must be unique.</p>
</div>
<div class="paragraph">
<p><code>-a {account-name} -n {datasource-name} --domain {domain-name} -t zimbra|ldap [-f {folder-name}] [-p {polling-interval}]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deleteAccount</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Deletes the GAL sync account and the references to the LDAP server.  The
account can also be deleted from the Administration Console.</p>
</div>
<div class="paragraph">
<p><code>deleteAccount [-a {galsynceaccountname}|-i {account-id}]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>trickleSync</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This syncs new and updated contact data only.</p>
</div>
<div class="paragraph">
<p><code>[-a {galsynceaccountname}|-i {account-id}]</code><br>
<code>[-d {datasource-id}] [-n {datsource-name}]</code></p>
</div>
<div class="paragraph">
<p>The datasource ID the LDAP datasource ID.  The datasource name is the name
of the address book (folder) in the GAL account created to sync LDAP to.</p>
</div>
<div class="paragraph">
<p>A cron job can be set up to run <code>trickleSync</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fullSync</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This syncs all LDAP contact data.  You can also set this from the
Administration Console.</p>
</div>
<div class="paragraph">
<p><code>[-a {galsynceaccountname}|-i {account-id}]</code><br>
<code>[-d {datasource-id}] [-n {datsource-name}]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>forceSync</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>This should be used to reload the entire GAL if there is change in the
filter, attribute mapping or LDAP server parameters.</p>
</div>
<div class="paragraph">
<p><code>[-a {galsynceaccountname}|-i {account-id}]</code><br>
<code>[-d {datasource-id}] [-n {datsource-name}]</code></p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_zmldappasswd">zmldappasswd</h4>
<div class="paragraph">
<p>Use <code>zmldappasswd</code> to change the LDAP password on the local server.  In
multi node environments, this command must be run on the LDAP master server
only.</p>
</div>
<div class="paragraph">
<p>This CLI command used with options changes other passwords.</p>
</div>
<div class="paragraph">
<p>For better security and audit trails the following passwords are generated
in ZCS:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>LDAP Admin password</strong>.  This is the master LDAP password.</p>
</li>
<li>
<p><strong>LDAP Root password</strong>.  This is used for internal LDAP operations.</p>
</li>
<li>
<p><strong>LDAP Postfix password</strong>.  This is the password used by the <code>postfix</code> user
to identify itself to the LDAP server and must be configured on the MTA
server to be the same as the password on the LDAP master server.</p>
</li>
<li>
<p><strong>LDAP Amavis password</strong>.  This is the password used by the <code>amavis</code> user to
identify itself to the LDAP server and must be configured on the MTA server
to be the same as the password on the LDAP server.</p>
</li>
<li>
<p><strong>LDAP Replication password</strong>.  This is the password used by the
<code>LDAPreplication</code> user to identify itself to the LDAP master and must be the
same as the password on the LDAP master server.</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_syntax_19">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmldappasswd [-h] [-r] [-p] [-l] new-password</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_16">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Syntax, Example, Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the help.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes <code>ldap_amavis-password</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes <code>ldap_bes_searcher_password</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes <code>ldap_replication_password</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes <code>ldap_postfix_password</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes <code>ldap_nginx_password</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Changes <code>ldap_root_passwd</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updates the password in the config database on replicas.  Must be used with
<code>-1</code> and must be run on a replica after changing the password on the
master.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="2"><p class="tableblock"><code><strong>Only one of <code>a</code>, <code>l</code>, <code>p</code>, or <code>r</code> can be specified.  If options are not
included, the <code>zimbra_ldap_password</code> is changed.</strong></code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmlocalconfig">zmlocalconfig</h4>
<div class="paragraph">
<p>Use <code>zmlocalconfig</code> to set or get the local configuration for a Zimbra
server.  Use <code>zmlocalconfig -i</code> to see a list of supported properties that
can be configured by an administrator.</p>
</div>
<div class="sect4">
<h5 id="_syntax_20">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig [options]</code></pre>
</div>
</div>
<div class="paragraph">
<p>To see the local config type <code>zmlocalconfig</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_description_17">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> File in which the configuration is stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--default</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Show default values for keys listed in <code>[args]</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--edit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit the configuration file, change keys and values specified.  The
<code>[args]</code> is in the <code>key=value</code> form.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--force</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edit the keys whose change is known to be potentially dangerous.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the help for the usage options for this tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the list of supported properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--format</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Shows the values in one of these formats: <code>plain</code> (default), <code>xml</code>,
<code>shell</code>, <code>nokey</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--changed</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the values for only those keys listed in the <code>[args]</code> that have been
changed from their defaults.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows which configuration file will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--quiet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suppress logging.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--random</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This option is used with the edit option.  Specified key is set to a random
password string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--show</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Forces the display of the password strings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--unset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Remove a configuration key.  If this is a key with compiled-in defaults,
set its value to the empty string.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--expand</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expand values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zimbraAmavisMaxServers</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows control of the concurrency of Amavisd (default 10).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zimbraClamAVMaxThreads</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allows control of the concurrency of ClamAV (default 10).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmailbox">zmmailbox</h4>
<div class="paragraph">
<p>Use <code>zmmailbox</code> for mailbox management.  The command can help
administrators provision new mailboxes along with accounts, debug issues
with a mailbox, and help with migrations.</p>
</div>
<div class="paragraph">
<p>You can invoke the <code>zmmailbox</code> command from within the <code>zmprov</code> command.
You enter <code>selectMailbox</code> within <code>zmprov</code> to access the zmmailbox command
connected to that specified mailbox.  You can then enter <code>zmmailbox</code>
commands until you type exit.  Exit returns you to <code>zmprov</code>.  This is
useful when you want to create accounts and also pre-create some folders,
tags, or saved searches at the same time.</p>
</div>
<div class="sect4">
<h5 id="_syntax_21">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox [args] [cmd] [cmd-args]...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_18">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Syntax, Example, and Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Display usage.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--file</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use file as input stream.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>http[s]://{host}[:{port}]</code> server hostname and optional port.  Must use
admin port with <code>-z</code>/<code>-a</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account name to auth as <code>{name}</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use zimbra admin name/password from localconfig for admin/password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--authtoken {authtoken}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use authtoken string (has to be in JSON format) from command line.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Y</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--authtoken {authtoken-file}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use authtoken string (has to be in JSON format) from a file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mailbox {name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mailbox to open.  Can be used as both authenticated and targeted unless
other options are specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--auth {name}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Account name to authorize as.  Defaults to
<code>--mailbox</code> unless <code>--admin-priv</code> is used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-A</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--admin-priv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute requests with admin privilege.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password {pass}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for admin account and or mailbox.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--passfile {file}</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read password from file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--timeout</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout (in seconds).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verbose mode (dumps full exception stack trace)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug mode (dumps SOAP messages)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Specific CLI tools are available for the different components of a mailbox.
Usage is described in the CLI help for the following.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help admin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on admin-related commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help commands</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on all <code>zmmailbox</code> commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help appointment</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on appointment-related commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help contact</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on contact-related commands (address book).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help conversation</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on conversation-related commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help filter</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on filter-related commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help folder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on folder-related commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help item</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on item-related commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help message</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on message-related commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help misc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on miscellaneous commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help right</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on right commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help search</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on search-related commands.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zmmailbox help tag</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Help on tag-related commands.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_examples_4">Examples</h5>
<div class="exampleblock">
<div class="title">Example 80. Create tags and folders</div>
<div class="content">
<div class="paragraph">
<p>When you create an account, you may want to pre-create some tags and
folders.  You can invoke <code>zmmailbox</code> inside of <code>zmprov</code> by using
<code>selectMailbox(sm)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmprov
prov&gt; ca user10@domain.example.com test123
9a993516-aa49-4fa5-bc0d-f740a474f7a8
prov&gt; sm user10@domain.example.com
mailbox: user10@domain.example.com, size: 0 B, messages: 0, unread: 0
mbox user10@domain.example.com&gt; createFolder /Archive
257
mbox user10@domain.example.com&gt; createTag TODO
64
mbox user10@domain.example.com&gt; createSearchFolder /unread &quot;is:unread&quot;
258
mbox user10@domain.example.com&gt; exit
prov&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 81. Find the mailbox size for an account</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z-m user@example.com gms</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 82. Send requests to a mailbox using the admin auth token</div>
<div class="content">
<div class="paragraph">
<p>This is required when using the command <code>emptyDumpster</code>.  Use
<code>--admin-priv</code> to skip delegated auth as the target mailbox.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z --admin-priv -m foo@example.com emptyDumpster</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 83. Use <code>--admin-priv</code> with select Mailbox command</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z
mbox&gt; sm --admin-priv foo@domain.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 84. Authenticate as a delegated admin user</div>
<div class="content">
<div class="paragraph">
<p>This lets one user login to another user&#8217;s mailbox.  The authenticating
user must be a delegated admin account and must have the <code>adminLoginAs</code> right
on the target mailbox.  This auth option uses a non-admin auth token.  Use
the <code>--auth</code> option to specify the authenticating account.  To login as
user <code>bar</code> and open mailbox <code>foo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ zmmailbox --auth bar@example.com -p password -m foo@example.com</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 85. Find the mailbox size for an account</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m user@example.com gms</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 86. Backup mailbox content in a <code>zip</code> file</div>
<div class="content">
<div class="paragraph">
<p>When you use <code>zmmailbox</code> to backup individual mailboxes, you can save
the file as either a <code>zip</code> file or a tgz file.  The default settings for
the information that is saved in these formats is different.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">File</th>
<th class="tableblock halign-left valign-top">TGZ</th>
<th class="tableblock halign-left valign-top">ZIP</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Briefcase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Calendar</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conversations</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contacts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deleted Messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emailed Contacts</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inbox</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sent Messages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tasks</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To include all the mailbox content in a <code>zip</code> file, you must enable the meta
data.  Type as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmailbox -z -m user@example.com gru &quot;?fmt=zip&amp;meta=1&quot; &gt; &lt;filename.zip&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmtlsctl">zmtlsctl</h4>
<div class="paragraph">
<p>Use <code>zmtlsctl</code> to set the Web server <code>zimbraMailMode</code> to the communication
protocol options: HTTP, HTTPS, Mixed, Both and Redirect.  The default
setting is HTTPS.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The <code>zmtlsctl</code> setting also impacts the ZCO&#8217;s <strong>Use Secure Connection</strong>
setting.  ZCO users in a self-signed environment will encounter warnings
about connection security unless the root CA certificate is added to Window
Certificate Store.  See the Zimbra Wiki article
<a href="https://wiki.zimbra.com/wiki/ZCO_Connection_Security">ZCO Connection
Security</a> for more information.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>HTTP</strong>.  HTTP only, the user would browse to <code>http://zimbra.domain.com</code>.</p>
</li>
<li>
<p><strong>HTTPS.</strong> HTTPS only (default), the user would browse to <code>https://zimbra.domain.com</code>.
<code>http://</code> is denied.</p>
</li>
<li>
<p><strong>Mixed</strong> If the user goes to <code>http://</code> it will switch to <code>https://</code> for the
login only,then will revert to <code>http://</code> for normal session traffic.  If the
user browses to <code>https://</code>, then the user will stay <code>https://</code></p>
</li>
<li>
<p><strong>Both</strong> A user can go to <code>http://</code> or <code>https://</code> and will keep that mode for
the entire session.</p>
</li>
<li>
<p><strong>Redirect</strong> Like mixed if the user goes to <code>http://</code> it will switch to
<code>https://</code> but they will stay <code>https://</code> for their entire session.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All modes use TLS encryption for back-end administrative traffic.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Only <code>zimbraMailMode</code> <strong>HTTPS</strong> can ensure that no listener will be available
on HTTP/port 80, that no client application will try to auth over HTTP, and
that all data exchanged with the client application will be encrypted.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note, <code>mailboxd</code> has to be stopped and restarted for the change to take effect.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you switch to HTTPS, you use the self-signed certificate generated
during ZCS installation in /opt/zimbra/ssl/zimbra/server/server.crt.  For
ZCO users, secure ZCO profiles will display Certificate Trust dialogs
unless the root CA certificate is deployed to the server.  For more
information about ZCO certificates, see the Zimbra Wiki page
<a href="https://wiki.zimbra.com/wiki/ZCO_Connection_Security">ZCO Connection
Security</a>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_syntax_22">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmtlsctl [mode]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>mode</code> = <code>http</code>, <code>https</code>, <code>mixed</code>, <code>both</code>, <code>redirect</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_steps_to_run">Steps to run</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Type <code>zmtlsctl [mode]</code> and press <strong>ENTER</strong>.</p>
</li>
<li>
<p>Type <code>zmmailboxdctl stop</code> and press <strong>ENTER.</strong></p>
</li>
<li>
<p>When <code>mailboxd</code> is stopped, type <code>zmmailboxdctl start</code> and press <strong>ENTER.</strong></p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_limitations_when_using_redirect">Limitations When Using Redirect</h5>
<div class="ulist">
<ul>
<li>
<p>Many client applications send an auth request in the initial HTTP request
to the Server ("blind auth").  The implications of this are that this auth
request is sent in the clear/unencrypted prior to any possible opportunity
to redirect the client application to HTTPS.</p>
</li>
<li>
<p>Redirect mode allows for the possibility of a man-in-the-middle attack,
international/unintentional redirection to a non-valid server, or the
possibility that a user will mis type the server name and not have
certificate-based validity of the server.</p>
</li>
<li>
<p>In many client applications, it is impossible for users to tell if they
have been redirected (for example, ActiveSync), and therefore the users
continue to use HTTP even if the auth request is being sent unencrypted.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmhsm">zmhsm</h4>
<div class="paragraph">
<p>Use <code>zmhsm</code> to start, stop (abort), and see the status of a HSM session.
The threshold for when messages are moved to a storage volume is
configured from the Administration Console, <strong>Servers</strong> &#8594; <strong>Volumes</strong> page.</p>
</div>
<div class="sect4">
<h5 id="_syntax_23">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmhsm {abort|start|status} {server} &lt;name&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_19">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--abort</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Aborts the current HSM session.  If all the messages in a mailbox being
processed were not moved before you clicked <strong>Abort</strong>, no messages from that
mailbox are moved from the primary volume.  Messages for mailboxes that
have completed the move to the secondary volume are not moved back to the
primary volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the help for the usage options for this tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> The mail server host name.  The default is the localhost <code>[args]</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--start</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manually starts the HSM process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--status</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The status of the last HSM session is displayed.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmlicense">zmlicense</h4>
<div class="paragraph">
<p>Use <code>zmlicense</code> to view and install your Zimbra license.
The license can be viewed and installed from the Administration Console, <strong>Global Settings &#8594; License</strong> page.</p>
</div>
<div class="sect4">
<h5 id="_syntax_24">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlicense [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_20">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--check</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Check to see if a valid license is installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the help for the usage options for this tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--install</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Installs the specified license file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--ldap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install on LDAP only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--print</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the license information.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmetadump">zmmetadump</h4>
<div class="paragraph">
<p>The <code>zmmetadump</code> command is a support tool that dumps the contents of an
item&#8217;s metadata in a human readable form.</p>
</div>
<div class="sect4">
<h5 id="_syntax_25">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmetadump -m &lt;mailbox id/email&gt; -i &lt;item id&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmetadump -f &lt;file containing encoded metadata&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmmypasswd">zmmypasswd</h4>
<div class="paragraph">
<p>Use <code>zmmypasswd</code> to change <code>zimbra_mysql_password</code>.  If the <code>--root</code> option
is specified, the <code>mysql_root_passwd</code> is changed.  In both cases, MariaDB is
updated with the new passwords.  Refer to the MariaDB documentation to see
how you can start the MariaDB server temporarily to skip grant tables, to
override the root password.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This requires a restart for the change to take effect.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_syntax_26">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmmypasswd [--root] &lt;new_password&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmplayredo">zmplayredo</h4>
<div class="paragraph">
<p>Users who maintain a backup and restore mechanism using the snapshot
facility of the storage layer use <code>zmplayredo</code> to restore backed up data.
This command brings all backed up data to the current state so that there
is no loss of information during the restore process.</p>
</div>
<div class="sect4">
<h5 id="_syntax_27">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmplayredo &lt;option&gt;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_21">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--fromSeq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replays snapshots from the specified redolog sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--fromTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replays snapshots from the specified time.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the help information for this command.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--logfiles</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replays the specified logfiles in order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mailboxId</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replays snapshots for the specified mailbox.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--queueCapacity</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Used for specifying the queue capacity per player thread.  The
default value is 100.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--stopOnError</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stops the replay on occurrence of any error.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--threads</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the number of parallel redo threads.  The default value is
50.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--toSeq</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replays snapshots to the specified redolog sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--toTime</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Replays snapshots to the specified time.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Time is specified in the local time zone.  The year, month, date, hour,
minute, second, and optionally millisecond should be specified.
Month/date/hour/ minute/second are 0-padded to 2 digits, millisecond to
3 digits.  The hour must be specified in a 24-hour format.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmproxyconfgen">zmproxyconfgen</h4>
<div class="paragraph">
<p>Use <code>zmproxyconfgen</code> to generate the Nginx proxy configuration files.  It
reads LDAP settings to replace template variables and generates the
final Nginx configuration.</p>
</div>
<div class="sect4">
<h5 id="_syntax_28">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ProxyConfGen [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_22">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--config</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Overrides a config variable.  The <code>&lt;arg&gt;</code> format should be
<code>name=value</code>.  To see a list of names, use <code>-d</code> or <code>-D</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--defaults</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the default variable map.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--definitions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-D</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the Definitions variable map after loading LDAP configuration and
processing overrides.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--include-dir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Displays the directory path (relative to <code>$workdir/conf</code>), where
included configuration files are written.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--dry-run</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies not to write configuration and only display the files that would
be written.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Displays the config file prefix.  The default value is <code>nginx.conf</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--template-prefix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Displays the template file prefix.  The default value is <code>$prefix</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies a valid server object.  Configuration is generated based
on the specified server&#8217;s attributes.  The default is to generate
configuration based on global configuration values.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--templatedir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the proxy template directory.  The default value is
<code>$workdir/conf/nginx/templates</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays verbose data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--workdir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the proxy working directory.  The default value is
<code>/opt/zimbra</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmproxypurge">zmproxypurge</h4>
<div class="paragraph">
<p>Use <code>zmproxypurge</code> to purge POP/IMAP proxy routing information from one or
more memcached servers.  Available memcached servers are discovered by the
<code>zmprov gamcs</code> function.  Others can be specified if necessary using the
server port.</p>
</div>
<div class="sect4">
<h5 id="_syntax_29">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ProxyPurgeUtil [-v] [-i] -a account [-L accountlist] [cache1] [cache2]...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_23">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Shows the help for the usage options for this tool.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays verbose data.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--info</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays account routing information.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays account name.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-L</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Displays file containing list of accounts, one per line.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--output</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Specifies the format to be used for printing routing information with
information.  The fields that display by default are</p>
</div>
<div class="ulist">
<ul>
<li>
<p>cache server</p>
</li>
<li>
<p>account name</p>
</li>
<li>
<p>route information</p>
</li>
</ul>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cacheN</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>(optional command) Specifies additional memcache server in the form of
server:port.</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmredodump">zmredodump</h4>
<div class="paragraph">
<p>Use <code>zmredodump</code> for debugging purposes and to dump the contents of a
redolog file.  When users are debugging a problem, Zimbra support might
ask them to run <code>zmredodump</code> with specific options.</p>
</div>
<div class="paragraph">
<p>Multiple log files/directories can be specified with all redolog files
under each directory being sorted in ascending order and processed.</p>
</div>
<div class="sect4">
<h5 id="_syntax_30">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmredodump [options] &lt;redolog file/directory&gt; [...]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_24">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the mailbox ids separated by a comma or a space.  The entire list
of mailbox ids must be quoted if using space as a separator.</p>
<p class="tableblock">To dump contents of all the redolog files, omit this option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--no-offset</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies if file offsets and size for each redolog dump should not be
shown.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--quiet</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-q</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Activates the quiet mode.  Used to only print the log filename and errors,
if any.  Useful for verifying integrity of redologs with minimal output.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--show-blob</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows blob content.  The specified item&#8217;s blob is printed with <code>&lt;START OF
BLOB&gt;</code> and <code>&lt;END OF BLOB&gt;</code> marking the start and end of the blob.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmskindeploy">zmskindeploy</h4>
<div class="paragraph">
<p>Use <code>zmskindeploy</code> to simplify the process of deploying skins for the Web Client.
This tool processes the available skins, enables them for all users of the Zimbra deployment, and restarts the web server so that it recognizes the new skins.</p>
</div>
<div class="sect4">
<h5 id="_syntax_31">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmskindeploy &lt;path/to/skin/dir/or/zipfile&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmsoap">zmsoap</h4>
<div class="paragraph">
<p>Use <code>zmsoap</code> to print mail, account, and admin information in the SOAP format.</p>
</div>
<div class="sect4">
<h5 id="_syntax_32">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmsoap [options] {path1} [path2]...</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_25">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints usage information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--mailbox</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;name&gt;</code> Displays mailbox account name.  Mail and account requests are sent
to this account.  This attribute is also used for authentication if <code>-a</code>
and <code>-z</code> are not specified.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--target</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;name&gt;</code> Displays the target account name to which the requests are sent.
Used only for non-admin sessions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--admin name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;name&gt;</code> Displays the admin account name to authenticate as.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--zadmin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-z</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the Zimbra admin name and password to authenticate as.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;pass&gt;</code> Displays account password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--passfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-P</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;path&gt;</code> Reads password from a file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--element</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;path&gt;</code> Displays the root element path.  If specified, all path arguments
that do not start with a slash (<code>/</code>) are relative to this element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;type&gt;</code> Displays the SOAP request type.  Can either be <code>mail</code>, <code>account</code>,
or <code>admin</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--url</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-u</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;http[s]://&#8230;&#8203;&gt;</code> Displays the server hostname and optional port value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the SOAP request and other status information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>path</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;[path]&#8230;&#8203;&gt;</code> Displays the element or attribute path and value.  Roughly
follows the XPath syntax as: <code>[/]element1[/element2][/@attr][=value]</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmstat_chart">zmstat-chart</h4>
<div class="paragraph">
<p>Use <code>zmstat-chart</code> to collect statistical information for the CPU, IO,
<code>mailboxd</code>, MTAqueue, MariaDB, and other components and to run a script on the
csv files to display the usage details in various charts.  These csv files
are saved to <code>/opt/zimbra/zmstat/</code>.</p>
</div>
<div class="paragraph">
<p>You must enable <code>zmstat</code> to collect the performance charts data:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter <code>zmprov ms {hostname} zimbraServerEnable stats</code>.</p>
</li>
<li>
<p>Restart the server, Enter:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmcontrol stop
zmcontrol start</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_syntax_33">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmstat-chart -s &lt;arg&gt; -d &lt;arg&gt; [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_26">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--aggregate-end-at</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> If this is specified, the aggregate computation ends at this
timestamp.  Usage is <code>MM/dd/yyyy HH:mm:ss</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--aggregate-start-at</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> If this is specified, the aggregate computation starts at this
timestamp.  Usage is <code>MM/dd/yyyy HH:mm:ss</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--end-at</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> If this is specified, all samples after the specified timestamp are
ignored.  Usage is <code>MM/dd/yyyy HH:mm:ss</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--start-at</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> If this is specified, all samples before this timestamp are
ignored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--title</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> This gives the chart a title that displays.  Defaults to the last
directory name of srcdir.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--no-summary</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Summary data generation is not included.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--conf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Chart the configuration xml files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--destdir</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> The directory where the generated chart files are saved.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--srcdir</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One or more directories where the csv files are located.  The csv files are
moved to directories listed by date under <code>zmstat/</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmstat_chart_config">zmstat-chart-config</h4>
<div class="paragraph">
<p>Use <code>zmstat-chart-config</code> to generate an xml file
<code>/opt/zimbra/conf/zmstat-chart.xml</code> from a template, taking into account
the server setup including theLDAP node and the processes run, among other
specifications.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zmstatctl">zmstatctl</h4>
<div class="paragraph">
<p>Use <code>zmstatctl</code> to run a control script for checking <code>zmstat</code> data
collectors.  This instruction starts or stops monitoring processes, and
checks status or rotates logs.</p>
</div>
<div class="sect4">
<h5 id="_syntax_34">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmstatctl start|stop|status|rotate</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmthrdump">zmthrdump</h4>
<div class="paragraph">
<p>Use <code>zmthrdump</code> to invoke a thread dump in the ZCS server process and
print the output file.  This command also gives the option of saving the
thread dump to a file and inserts a timestamp on the logfile.</p>
</div>
<div class="sect4">
<h5 id="_syntax_35">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmthrdump [-h] [-i] [-t &lt;timeout seconds&gt;] [-p &lt;pid file&gt;] [-f &lt;file&gt;] [-o &lt;out-file&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_27">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Appends the timestamp to the LOGFILE before invoking SIGQUIT.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Returns the PID to send SIGQUIT.  The default value can be found in
<code>zmmailboxd_java.pid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the LOGFILE to save the thread dump output in.  The default value
is <code>zmmailbox.out</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the output file of the thread
dump.  The default value is stdout.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the timeout value (in seconds) to exit if the process becomes
unresponsive.  The default value is 30 seconds.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmtrainsa">zmtrainsa</h4>
<div class="paragraph">
<p>Use <code>zmtrainsa</code> to train the anti-spam filter.  This command is run
automatically every night to train the SpamAssasin filter from messages
users mark as "junk" / "not junk" from their mailbox.  See
<a href="#spamassassin_sa_update_tool">SpamAssassin&#8217;s sa-update tool</a>, which is
included with SpamAssassin.  This tool updates SpamAssassin rules from the
SA organization.  The tool is installed into <code>/opt/zimbra/common/bin</code>.</p>
</div>
<div class="paragraph">
<p>The <code>zmtrainsa</code> command can be run manually to forward any folder from any
mailbox to the spam training mailboxes.  If you do not enter a folder name
when you manually run <code>zmtrainsa</code> for an account, for spam, the default
folder is Junk.  For ham, the default folder is Inbox.</p>
</div>
<div class="sect4">
<h5 id="_syntax_36">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmtrainsa &lt;user&gt; &lt;spam|ham&gt; [folder]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_zmtzupdate">zmtzupdate</h4>
<div class="paragraph">
<p>Use <code>zmtzupdate</code> to update time zone changes in existing appointments for
specific users or all users.  An <code>.ics</code> rule file should first be created to
run with this command.  A rule file lists a series of rules to match a time
zone and the replacement time zone definitions.  More information about
this command can be found at:
<a href="https://wiki.zimbra.com/wiki/Changing_ZCS_Time_Zones" class="bare">https://wiki.zimbra.com/wiki/Changing_ZCS_Time_Zones</a>.</p>
</div>
<div class="sect4">
<h5 id="_syntax_37">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmtzupdate --rulefile &lt;rule file&gt; -a &lt;&quot;all&quot; or list of specific email addresses&gt; [--sync] [--after &lt;date/time stamp&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_28">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name*</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--account</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> account email addresses separated by a white space.  Use "all" for
all accounts to be updated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--after</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Appointments occurring after the specified date/time in this field
are updated.  The default cut off time is January 1st, 2008.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help information.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--rulefile</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the <code>.ics</code> XML file that should be used to update time zone
definitions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Specifies the mail server hostname.  The default value is
localhost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--sync</code></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If specified, this option causes the <code>zmtzupdate</code> command to block till the
server processes all requested accounts.  The default value is no.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmvolume">zmvolume</h4>
<div class="paragraph">
<p>Use <code>zmvolume</code> to manage storage volumes from the CLI.  Note that volumes
can be managed from the Administration Console, <strong>Server</strong> &#8594; <strong>Volumes</strong> page.</p>
</div>
<div class="sect4">
<h5 id="_syntax_38">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmvolume {-a|-d|-l|-e|-dc|-sc} [options]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_29">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Adds a volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--compress</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Compress BLOBs; "true" or "false".</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--compressionThreshold</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ct</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compression threshold; default 4KB.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deletes a volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--displayCurrent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-dc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays the current volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--edit</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Edits a volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the help for the usage options for this tool.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-id</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Volume ID.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--list</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-l</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lists volumes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--name</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-n</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Volume name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Root path.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--server</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Mail server hostname.  Default is localhost.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--setCurrent</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the current volume.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--type</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;arg&gt;</code> Volume type (primaryMessage, secondaryMessage, or index)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--turnOffSecondary</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns off the current secondary message volume.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmzimletctl">zmzimletctl</h4>
<div class="paragraph">
<p>Use <code>zmzimletctl</code> to manage Zimlets and to list all Zimlets on the server.
Additional information is provided in <a href="#zimlets">Zimlets</a>.  Most Zimlet
deployment can be completed from the Zimbra Administration Console.</p>
</div>
<div class="sect4">
<h5 id="_syntax_39">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmzimletctl [-l] {command} [&lt;zimlet.zip&gt;|&lt;config.xml&gt;|&lt;zimlet&gt;]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_30">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>deploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet.zip&gt;</code> Creates the Zimlet entry in the LDAP server, installs the
zimlet files on the Server, grants, access to the members of the default
COS, and turns on the Zimlet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>undeploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Uninstall a zimlet from the Zimbra server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>install</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet.zip&gt;</code> Installs the Zimlet files on the host.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ldapDeploy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Adds the Zimlet entry to the LDAP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>enable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Enables the Zimlet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>disable</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Disables the Zimlet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>acl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt; &lt;cos1&gt; {grant | deny} | [&lt;cos2&gt; {grant|deny}&#8230;&#8203;]</code></p>
<p class="tableblock">Sets the access control, grant|deny, to a COS.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listAcls</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Lists the ACLs for the Zimlets.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listZimlets</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">View details about all Zimlets on the server.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>getConfigTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet.zip&gt;</code> Extracts the configuration template from the Zimlet.zip file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>configure</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;config.xml&gt;</code> Installs the configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>listPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the current Zimlet priorities (0 is high, 9 is low)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>setPriority</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>&lt;zimlet&gt;</code> Sets the Zimlet priority.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmproxyconfig">zmproxyconfig</h4>
<div class="paragraph">
<p>Use <code>zmproxyconfig</code> to manage Zimbra proxy and should only be used when
you have to make changes to Zimbra proxy after it has been installed.
See <a href="#zimbra_proxy_server">Zimbra Proxy Server</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Previous to ZCS 6.0, this command was called <code>zmproxyinit</code>.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_syntax_40">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/zimbra/libexec/zmproxyconfig [-h] [-o] [-m] [-w] [-d [-r] [-s] [-a w1:w2:w3:w4] [-i p1:p2:p3:p4] [-p p1:p2:p3:p4] [-x mailmode]] [-e [-a w1:w2:w3:w4] [-i p1:p2:p3:p4] [-p p1:p2:p3:p4] [-x mailmode]] [-f] -H hostname</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_31">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Short Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-H</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hostname of the server on which enable/disable proxy functionality.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Colon separated list of Web ports to use.  Format:
<strong>HTTP-STORE:HTTP-PROXY:HTTPS-STORE:HTTPS-PROXY</strong> (Ex: 8080:80:8443:443)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable proxy.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Full reset on memcached port and search queries and POP/IMAP throttling.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Colon separated list of IMAP ports to use.  Format:
<strong>IMAP-STORE:IMAP-PROXY:IMAPS-STORE:IMAPS-PROXY</strong> (Ex: 7143:143:7993:993)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-m</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toggle mail proxy portions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Override enabled checks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Colon separated list of POP ports to use.  Format:
<strong>POP-STORE:POP-PROXY:POPS-STORE:POPS-PROXY</strong> (Ex: 7110:110:7995:995)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-r</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Run against a remote host.  Note that this requires the server to be
properly configured in the LDAP master.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Cleartext to FALSE (secure mode) on disable.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-t</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disable reverse proxy lookup target for the store server.  Only valid with
<code>-d</code>.  Make sure that you intend for all proxy functions for the server to
be disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toggle Web proxy portions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraMailMode</code> to use on disable (Default is HTTP)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>hostname</code> is the value of the <code>zimbra_server_hostname</code> LC key for the
server being modified.</p>
</div>
<div class="paragraph">
<p>Required options are <code>-f</code> by itself, or <code>-f</code> with <code>-d</code> or <code>-e</code>.</p>
</div>
<div class="paragraph">
<p><strong>Note that</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>-d</code> or <code>-e</code> require one or both of <code>-m</code> and <code>-w</code>.</p>
</li>
<li>
<p><code>-i</code> or <code>-p</code> require <code>-m</code>.</p>
</li>
<li>
<p><code>-a</code> requires <code>-w</code>.</p>
</li>
<li>
<p><code>-x</code> requires <code>-w</code> and <code>-d</code> for store.</p>
</li>
<li>
<p><code>-x</code> requires <code>-w</code> for proxy.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following are the defaults for <code>-a</code>, <code>-i</code>, <code>-p</code>, and <code>-x</code> if they are
not supplied as options.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default on enable: 8080:80:8443:443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default on disable: 80:0:443:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default on enable: 7143:143:7993:993</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default on disable: 143:7143:993:7993</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default on enable: 7110:110:7995:995</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default on disable: 110:7110:995:7995</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default on store disable: http</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default on proxy enable/disable: http</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmsyncreverseproxy">zmsyncreverseproxy</h4>
<div class="paragraph">
<p>Use <code>zmsyncreverseproxy</code> to reverse proxy mobile sync HTTP traffic
between the source and forwarding server and port.  Decodes the sync
requests/responses and logs them when verbose mode is turned on.</p>
</div>
<div class="sect4">
<h5 id="_syntax_41">Syntax</h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmsyncreverseproxy [-v] [-d] [-L log4j.properties] -p &lt;port number&gt; -fs &lt;fwd server&gt; -fp &lt;fwd port&gt; [-sv syncversions]</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_description_32">Description</h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Long Name</th>
<th class="tableblock halign-left valign-top">Short</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--help</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays help.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--verbose</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-v</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Verbose mode, dumps full exception stack trace.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--debug</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug mode, dumps decoded sync messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-p</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port this service listens on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--forwardserver</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-fs</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The server host to forward requests to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--forwardport</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-fp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The server port to forward requests to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--syncversions</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-sv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Active sync versions supported.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>--logpropertyfile</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-L</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>log4j</code> property file, valid only with <code>-l</code>.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_spnego_single_sign_on">Appendix B: Configuring SPNEGO Single Sign-On</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The SPNEGO protocol mechanism can be configured on ZCS for single sign-on authentication to the Zimbra Web Client, and to the Zimbra Connector for Outlook (ZCO).
For ZCO configuration see <a href="#setting_up_single_sign_on_options_for_zco">Setting Up Single Sign-On Options for ZCO</a>.</p>
</div>
<div class="paragraph">
<p>When users have authenticated to their Intranet through Active Directory, they can enter their Zimbra mailbox using Web Client without having to re-authenticate.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/SPNEGO-Architecture.png" alt="SPNEGO Architecture">
</div>
</div>
<div class="paragraph">
<p>The ZCS server configuration will redirect users attempting to log on to the Web Client to a URL under SPNEGO protection.
The server asks for authentication with Kerberos through SPNEGO, and redirects users to their Zimbra mailbox.
When users log out, they get redirected to a logout URL that displays a <b class="button">Launch</b> button.
When users click it, they get directed to the Zimbra login page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When users log on to their Zimbra accounts from the <em>Internet</em>, the Zimbra login page displays and they must enter their Zimbra password to log on.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
With SPNEGO SSO enabled on a domain, corresponding browser configuration is essential.
See <a href="#configure_your_browser">Configure Your Browser</a>.
Improperly configured browsers may bypass SPNEGO by opening an authentication dialog, thereby allowing a user to log in to the Zimbra mailbox by entering their correct AD domain username/password.
Some other browsers may display a "401 Unauthorized" error in that situation.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_configuration_process">Configuration Process</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create the Kerberos keytab file.</p>
<div class="ulist">
<ul>
<li>
<p>Create an Active Directory service account.
You use this account to generate the Kerberos keytab file.</p>
</li>
<li>
<p>Add the service Principal Names (SPN) directory property for an Active Directory service account.</p>
</li>
<li>
<p>Create the keytab file.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enable and configure the SPNEGO protocol on the ZCS server.</p>
</li>
<li>
<p>Configure browsers</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_kerberos_keytab_file">Create the Kerberos Keytab File</h3>
<div class="paragraph">
<p>Create an Active Directory service Domain account for each mailstore server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create an Active Directory service account.
You use this account to generate the Kerberos keytab file to add to the Zimbra server.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Go to the Active Directory <strong>Start &#8594; Programs &#8594; Administrative Tools &#8594; Active Directory Users and Computers</strong> console.</p>
</li>
<li>
<p>To create the service account, click the AD Domain name and from the expanded content right-click <strong>Users</strong> and select <strong>New &#8594; User</strong>.
Complete the New Object – User dialog.</p>
<div class="imageblock">
<div class="content">
<img src="images/Zimbra-spnego-001.png" alt="AD New User">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Full name</strong>: Enter the user display name for the AD service account.
We recommend using the ZCS mailbox server name as the full name.</p>
<div class="paragraph">
<p>Example: <strong>Zimbra SPNEGO</strong>.</p>
</div>
</li>
<li>
<p><strong>User Logon Name</strong>: This name is the value set for the <code>zimbraSpnegoAuthTargetName</code> server attribute in LDAP.
Write it down.</p>
<div class="paragraph">
<p>Example: <strong>zimbraspnego/zimbralab.local</strong>.</p>
</div>
</li>
<li>
<p><strong>User Logon Name (pre-Windows2000):</strong> This name is used for the <code>–mapUser</code> parameter in the <code>setspn</code> and <code>ktpass</code> commands.</p>
<div class="paragraph">
<p>Example: <strong>ZIMBRALAB\zimbraspnego</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Zimbra-spnego-002.png" alt="New AD User Dialog">
</div>
</div>
</li>
<li>
<p>Click <b class="button">Next</b>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Enter and confirm the password for the <code>–pass {AD-user-password}</code> parameter in the <code>ktpass</code> command, configured below.</p>
</li>
<li>
<p>Check <strong>Password never expires</strong> and <strong>User cannot change password</strong>, and click <b class="button">Next</b>.</p>
</li>
<li>
<p>Click <b class="button">Finish</b> to create the user.
The service account name displays in the Users directory.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Use the <code>setspn</code> command to map the mailbox server name to the user account as the Service Principal Name (SPN).
The SPN features in the process of mutual authentication between the client and the server hosting a particular service.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>From the command prompt, type <code>setspn –a {userlogonname} {serviceaccountname}</code></p>
<div class="exampleblock">
<div class="title">Example 87. Map mailbox server name as servie Principal Names to user account</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">setspn –a HTTP/mail1.example.com mail1</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p>To verify that the SPN is registered, type <code>C:\&gt;setspn –l {accountname}</code><br>
A list of registered SPNs is displayed.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create the keytab file used when signing into the Kerberos domain.
Use the <code>ktpass</code> tool from the Windows Server toolkit to create the Kerberos keytab.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A Kerberos keytab file contains a list of keys that are analogous to user passwords.
Restrict and monitor permissions on any keytab files you create.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The command to type follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ktpass -out {keytab-file-to-produce} -princ {Service-Principal-Name}@\{the-kerberos-realm} -mapUser {AD-user} -mapOp set -pass {AD-user-password} -crypto RC4-HMAC-NT -pType KRB5_NT_PRINCIPAL</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ktpass -out</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key is written to this output file.</p>
<p class="tableblock">Enter the directory location and keytab file name.
The keytab file name is <code>jetty.keytab</code>.</p>
<p class="tableblock">For example, <code>C:\Temp\spengo\jetty.keytab</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-princ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The principal name.</p>
<p class="tableblock">Enter the service Principal Name as used in <strong>Step 2</strong> of <a href="#_create_the_kerberos_keytab_file">Create the Kerberos Keytab File</a>.</p>
<p class="tableblock">For example, <code>HTTP/mail1.example.com@MY_COMPANY.COM</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mapUser</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maps the principal name from the <code>-princ</code> parameter to this user account.</p>
<p class="tableblock">Enter the name of the AD service account previously set as the <strong>User Logon Name (pre-Windows2000)</strong> in <strong>Step 1.b</strong> of <a href="#_create_the_kerberos_keytab_file">Create the Kerberos Keytab File</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mapOp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This option sets the mapping.
The value for this parameter is <strong>set</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-pass</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the password to use with the <code>-princ</code> account.</p>
<p class="tableblock">Enter the password entered in the <strong>User Logon Name (pre-Windows2000)</strong> set in <strong>Step 1.c</strong> of <a href="#_create_the_kerberos_keytab_file">Create the Kerberos Keytab File</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-crypto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The cryptosystem to use.</p>
<p class="tableblock">Enter <strong>RC4-HMAC-NT</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-pType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enter <strong>KRB5_NT_PRINCIPAL</strong>.</p>
<p class="tableblock">To avoid warning messages from the toolkit, enter this value.</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 88. Using <code>ktpass</code> to create a jetty.keytab file</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">ktpass -out C: \Temp\spengo\jetty.keytab -princ HTTP/mail1.example.com@MY_COMPANY.COM -mapUser mail1 -mapOp set - pass password123 -crypto RC4-HMAC-NT -pType KRB5_NT_PRINCIPAL</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command confirmation comes with something similar to the example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Targeting domain controller:
   ...

    Using legacy password setting method
    Successfully mapped HTTP/mail1.example.com to mail1.
    Key created.
    Output keytab to c:\Temp\spengo\jetty.keytab:
    Keytab version: 0x502

    keysize 71 HTTP HTTP/mail1.example.com@MY_COMPANY.COM ptype 1 (KRB5_NT_PRINCIPAL) vno3 etype 0x17 (RC4-HMAC) keylength 16 (0xc383f6a25f1e195d5aef495c980c2bfe)</pre>
</div>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Zimbra-spnego-003.png" alt="`spnegofile.keytab`">
</div>
</div>
</li>
<li>
<p>Transfer the keytab file (jetty.keytab) to the Zimbra server.
Copy the file created in step 3 to the following Zimbra server location:
<code>/opt/zimbra/data/mailboxd/spnego/jetty.keytab</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Do not rename the <code>jetty.keytab</code> file.
Many configuration files reference this filename.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Repeat steps 1 to 4 to create an create the keytab file (<code>jetty.keytab</code>) for each Zimbra mailstore server.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_zcs">Configure ZCS</h3>
<div class="paragraph">
<p>SPNEGO attributes get configured in Global Config and on each Zimbra server, and domain pre-authentication gets configured for the domain.
Use the <code>zmprov</code> command to modify the Zimbra server.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A ZCS installation may support only one Kerberos REALM.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Modify the following global config attributes, with the <code>zmprov mcf</code>
command.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthEnabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to TRUE.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthErrorURL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This value is the URL that users get redirected to when SPNEGO auth fails.
Setting it to <code>/zimbra/?ignoreLoginURL=1</code> redirects the user to the regular Zimbra login page, where the user enters their Zimbra user name and password.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthRealm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Kerberos realm in the domain controller; the domain name in the Active Directory. (<code>MY_COMPANY.COM</code>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To modify the global config attributes, type:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>zmprov mcf zimbraSpnegoAuthEnabled TRUE</code></p>
</li>
<li>
<p><code>zmprov mcf zimbraSpnegoAuthErrorURL '/zimbra/?ignoreLoginURL=1'</code></p>
</li>
<li>
<p><code>zmprov mcf zimbraSpnegoAuthRealm &lt;MY_COMPANY.COM&gt;</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>On each Zimbra server, modify the following global config attributes with the <code>zmprov ms</code> command.</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthTargetName</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the user logon name from Step 1 B, User Logon Name.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>zimbraSpnegoAuthPrincipal</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enter the user logon name set in <code>zimbraSpnegoAuthTargetName</code> and the address set in global config <code>zimbraSpnegoAuthRealm</code>.</p>
<p class="tableblock">Type as <code>zimbraSpnegoAuthTargetName@zimbraSpnegoAuthRealm</code>.</p>
<p class="tableblock">For example, <code>HTTP/mail1.example.com@MY_COMPANY.COM</code>.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To modify the server global config attributes, type:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>zmprov ms mail1.example.com zimbraSpnegoAuthTargetName HTTP/mail1.example.com</code></p>
</li>
<li>
<p><code>zmprov ms mail1.example.com zimbraSpnegoAuthPrincipal HTTP/mail1.example.com@MY_COMPANY.COM</code></p>
</li>
</ol>
</div>
</li>
<li>
<p>Set up the following for the domain.</p>
<div class="ulist">
<ul>
<li>
<p>Kerberos Realm</p>
</li>
<li>
<p>Virtual host</p>
</li>
<li>
<p>Web client login URL and UAs</p>
</li>
<li>
<p>Web client logout URL and UAs</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Set up the Kerberos Realm for the domain as the same realm set in the global config attribute <code>zimbraSpnegoAuthRealm</code>.
Type <code>zmprov md {domain} zimbraAuthKerberos5Realm {kerberosrealm}</code>.</p>
</li>
<li>
<p>Set up the virtual hosts for the domain.
Virtual-hostname-* are the hostnames you can browse to for the Zimbra Web Client UI.
Type:</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraVirtualHostname {virtual-hostname-1} +zimbraVirtualHostname {virtual-hostname-2}
...</code></pre>
</div>
</div>
</li>
<li>
<p>Setup the web client login URL, and UAs allowed for the login URL on the domain.</p>
<div class="ulist">
<ul>
<li>
<p>Set the login URL.
The login URL is the URL to redirect users to when the Zimbra auth token is expired. <code>zmprov md {domain} zimbraWebClientLoginURL '../service/spnego'</code>.</p>
</li>
<li>
<p>Honor only supported platforms and browsers.</p>
<div class="paragraph">
<p><strong>zimbraWebClientLoginURLAllowedUA</strong> is a multi-valued attribute,values are regex.
If this is not set, all UAs are allowed.
If multiple values are set, an UA is allowed as long as it matches any one of the values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraWebClientLoginURLAllowedUA {UA-regex-1} +zimbraWebClientLoginURLAllowedUA {UA-regex-2} ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, to honor <code>zimbraWebClientLoginURL</code> only for Firefox, Internet Explorer, Chrome, and Safari on computers running Windows, and Safari on Apple Mac computers, type the following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._Windows._Firefox/3.*'
zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._MSIE._Windows.*'
zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._Windows._Chrome.*'
zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._Windows._Safari.*'
zmprov md {domain} +zimbraWebClientLoginURLAllowedUA '._Macintosh._Safari.*'</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Setup the web client logout URL and UAs allowed for the logout URL on the domain.</p>
<div class="ulist">
<ul>
<li>
<p>Set the logout URL.
The logout URL is the URL to redirect users to when users click <b class="button">Logout</b>.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} zimbraWebClientLogoutURL '../?sso=1'</code></pre>
</div>
</div>
</li>
<li>
<p>Honor only supported platforms and browsers.
<code>zimbraWebClientLogoutURLAllowedUA</code> is a multi-valued attribute, where the accepted values are regex.
If this attribute has no set value, all UAs are allowed.
When it has multiple values, a UA is allowed as long as it matches any one of the values.</p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA {UA-regex-1} +zimbraWebClientLogoutURLAllowedUA {UA-regex-2} ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example, to honor zimbraWebClientLogoutURL only for Firefox, Internet Explorer, Chrome, and Safari on computers running Windows, and Safari on Apple Mac computers, type the following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA '._Windows._Firefox/3.*'
zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA '._MSIE._Windows.*'
zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA '._Windows._Chrome.*'
zmprov md {domain} +zimbraWebClientLogoutURLAllowedUA '._Windows._Safari.*'</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configure_your_browser">Configure Your Browser</h3>
<div class="paragraph">
<p>With the SPNEGO SSO feature enabled on your domain, you must configure users' browsers to use its Authentication mechanism.
Improperly configured browsers exhibit different behaviors depending on the browser.</p>
</div>
<div class="paragraph">
<p>The following browsers are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For computers running Windows:
Internet Explorer 10.0 or later, Edge, Firefox 52 or later, Chrome, Safari</p>
</li>
<li>
<p>Apple Mac computer: Safari</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Configuration steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Firefox browser for computers running Windows</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In the Firefox browser address field, type <code>about:config</code>.
The warning&#8201;&#8212;&#8201;<strong>This might void your warranty</strong>, is now displayed.</p>
</li>
<li>
<p>Click <b class="button">I’ll be careful, I promise!</b></p>
</li>
<li>
<p>Search in Filters, type <code>network.n</code>.
Enter a comma-delimited list of trusted domains or URLs.</p>
<div class="paragraph">
<p>Double-click <code>network.negotiate-auth.delegation-uris</code>.
Enter <code>http://,https://</code>.</p>
</div>
<div class="paragraph">
<p>Double-click <code>network.negotiate-auth.trusted-uris</code>.
Enter <code>http://,https://</code>.</p>
</div>
<div class="paragraph">
<p><em>Or, to set specific URLs,</em></p>
</div>
<div class="paragraph">
<p>Double-click <code>network.negotiate-auth.delegation-uris</code>.
Enter the domain addresses.
For example, <code>http://mail1.example.com,https://mail2.example.com</code>.</p>
</div>
<div class="paragraph">
<p>Double-click <code>network.negotiate-auth.trusted-uris</code>.
Enter the domain addresses.
For example, <code>http://mail1.example.com,https://mail2.example.com</code>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Internet Explorer, Chrome, and Safari for computers running Windows</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In these browsers, go to <strong>Tools &#8594; Internet Options &#8594; Security &#8594; Local Intranet &gt;Sites</strong>.
In the "Sites" dialog, check all items.</p>
</li>
<li>
<p>Select <strong>Advanced</strong>.
Add the domain server (hostname) URL, both <code>http://</code> and <code>https://</code>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> to close the file.</p>
</li>
<li>
<p>Go to <strong>Tools &#8594; Options &#8594; Advanced &#8594; Security</strong>. Locate and check <strong>Enable Integrated Windows Authentication</strong>.</p>
</li>
<li>
<p>Click <b class="button">OK</b> and close the browser.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Safari for Apple Mac computers.
No configuration is necessary.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_test_your_setup">Test your setup</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>On a Windows computer or an Apple Mac computer, log in to the computer as a domain user.</p>
<div class="paragraph">
<p>Your domain user token gets saved on the computer.
The token gets picked up by the SPNEGO-aware browser and sent to the Zimbra server in the Authorization header.</p>
</div>
</li>
<li>
<p>Browse to the Zimbra Web Client login page.
You should get redirected to your inbox without being prompted for your user name and password.</p>
<div class="paragraph">
<p>If SPNEGO auth fails, the user gets redirected to an error URL.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_setup">Troubleshooting setup</h3>
<div class="paragraph">
<p>Make sure the following are true.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The browser is in the Intranet zone.</p>
</li>
<li>
<p>The user is accessing the server using a Hostname rather than an IP address.</p>
</li>
<li>
<p><em>Integrated Windows Authentication</em> has been enabled in Internet Explorer, and the host has been "trusted" in Firefox.</p>
</li>
<li>
<p>The server is not local to the browser.</p>
</li>
<li>
<p>The client’s Kerberos system is authenticated to a domain controller.</p>
</li>
<li>
<p>If the browser displays "401 Unauthorized", it&#8217;s most likely that the browser either did not send another request with Authorization in response to the 401 or had sent an Authorization without using the GSS-API/SPNEGO scheme.</p>
<div class="paragraph">
<p>Check your browser settings and make sure it is one of the supported browsers/platforms.</p>
</div>
</li>
<li>
<p>If you get redirected to the error URL specified in <code>zimbraSpnegoAuthErrorURL</code>, it means that the SPNEGO authentication sequence does not work.</p>
<div class="paragraph">
<p>Take a network trace, make sure the browser sends Authorization header in response to the <code>401</code>.
Make sure the Negotiate is using GSS-API/ SPNEGO, not NTLM (use a network packet decoder like <em>Wireshark</em>).</p>
</div>
<div class="paragraph">
<p>After verifying that the browser is sending the correct Negotiate, if it still does not work, turn on the following debug and check Zimbra logs:</p>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p><strong>Add</strong> (do not replace) <code>-DDEBUG=true -Dsun.security.spnego.debug=all</code> to local config key <code>spnego_java_options</code>.</p>
</li>
<li>
<p>Add <code>log4j.logger.org.mortbay.log=DEBUG</code> in <code>log4j</code>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>Then restart the mailbox server.</p>
</div>
<div class="paragraph">
<p>Browse to the debug snoop page (<code>http://{server}:{port}/spnego/snoop.jsp</code>).
See if you can access <code>snoop.jsp</code>.</p>
</div>
<div class="paragraph">
<p>Check <code>zmmailboxd.out</code> and <code>mailox.log</code> for debugging output.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One of the errors at this stage could be because of clock skew on the jetty server.
If this is the case, it should get shown in <code>zmmailboxd.out</code>.
Fix the clock skew and try again.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_configure_kerberos_auth_with_spnego_auth">Configure Kerberos Auth with SPNEGO Auth</h3>
<div class="paragraph">
<p>Kerberos auth and SPNEGO can co-exist on a domain.
In this use case, you are using Kerberos as the mechanism for verifying a user&#8217;s principal/password against a KDC, instead of the native Zimbra LDAP, when the user cannot get in by SPNEGO.</p>
</div>
<div class="paragraph">
<p>In a properly configured browser, users are redirected to the Zimbra sign-in page when SPNEGO auth fails.
Users can enter their Zimbra username and password on the sign-in page to sign in manually.
The Domain attribute <code>zimbraAuthMech</code> controls the mechanism for verifying passwords.
If <code>zimbraAuthMech</code> is "kerberos5", the entered user name is used first to identify a valid Zimbra user (users must appear in the Zimbra LDAP).
The Zimbra user gets mapped to a Kerberos principal, and then the Kerberos principal + password is validated against a KDC.
This KDC could be different from, or the same as, the KDC used by the Active Directory domain controller (for SPNEGO auth).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Every Microsoft Active Directory domain controller acts as Kerberos KDC.
For SPNEGO auth, KDC does not get contacted by the mailbox server.
The Kerberos token sent from the Authorization HTTP header along with jetty&#8217;s keytab file can identify/authenticate the user.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For Kerberos auth (<code>zimbraAuthMech*="kerberos5"</code>), the mailbox server needs to contact KDC to validate principal+password.
For the java Kerberos client (i.e., Zimbra mailbox server), the default realm and KDC for the realm get specified in a Kerberos config file.
Specify the location of this config file in the optional JVM argument as <code>java.security.krb5.conf</code>.
If it is not specified, the default is <code>/etc/krb5.conf</code>.
When SPNEGO gets enabled in Zimbra, <code>java.security.krb5.conf</code> for the mailbox server is set to <code>/opt/zimbra/jetty/etc/krb5.ini</code>.
Therefore, that is the active file for configuring Kerberos auth.</p>
</div>
<div class="paragraph">
<p>Note that <code>/opt/zimbra/jetty/etc/krb5.ini</code> gets rewritten from <code>/opt/zimbra/jetty/etc/krb5.ini.in</code> each time the mailbox server restarts.
For persistent configuration then, you need to modify the <code>/opt/zimbra/jetty/etc/krb5.ini.in</code> file, not <code>/opt/zimbra/jetty/etc/krb5.ini</code>.</p>
</div>
<div class="paragraph">
<p>Under the [realms] section, KDC and admin_server get left unset for SPNEGO auth, but Kerberos auth requires them.</p>
</div>
<div class="paragraph">
<p>To configure:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Edit <code>/opt/zimbra/jetty/etc/krb5.ini.in</code>.</p>
</li>
<li>
<p>Change:</p>
<div class="listingblock">
<div class="content">
<pre>[realms]
%%zimbraSpnegoAuthRealm%% = {
default_domain = %%zimbraSpnegoAuthRealm%%
}</pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre>%%zimbraSpnegoAuthRealm%% = {
             kdc = YOUR-KDC
             admin_server = YOUR-ADMIN-SERVER
             default_domain = %%zimbraSpnegoAuthRealm%%
}</pre>
</div>
</div>
</li>
<li>
<p>Replace YOUR-KDC and YOUR-ADMIN-SERVER to the hostname on which the <code>kdc/admin_server</code> for Kerberos auth is running.</p>
</li>
<li>
<p>Save the file and restart the mailbox server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>An important restriction is that the realm for SPNEGO and Kerberos auth must be the same.
For SPNEGO auth, the Kerberos principal in the Authorization header gets mapped to a unique Zimbra account.
For Kerberos auth, the Zimbra account gets mapped to a unique Kerberos principal.
The mapping (by domain attribute <code>zimbraAuthKerberos5Realm</code>) is the same for both.</p>
</div>
</div>
<div class="sect2">
<h3 id="setting_up_single_sign_on_options_for_zco">Setting Up Single Sign-On Options for ZCO</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To use SSO, SPNEGO must be configured on the ZCS server to use this option.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The single sign-on option works with a specific server.
The server name used in the ZCO profile must match that in the SPNEGO configuration.
Make sure that the server name gets incorporated into the <code>.msi</code> file before installation.</p>
</div>
<div class="paragraph">
<p>To set up the single sign-on option in the <code>.msi</code> customization script:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Set the server name to be the server name configured for SPNEGO, enter <code>-sn &lt;spnegoserver.example.com&gt;</code>.</p>
</li>
<li>
<p>Set the password rule, enter <code>-pw 0</code>.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cscript ZmCustomizeMsi.js &lt;path/msi-filename&gt; -sn &lt;spnegoserver.example.com&gt; -pw 0</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="zcs_crontab_jobs">Appendix C: ZCS Crontab Jobs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The crontab is used to schedule commands to be executed periodically on the
Zimbra servers.</p>
</div>
<div class="sect2">
<h3 id="_how_to_read_the_crontab">How to read the crontab</h3>
<div class="paragraph">
<p>Each entry in a crontab file consists of six fields, specified in the
following order: minute, hour, day, month, weekday, command</p>
</div>
<div class="paragraph">
<p>The fields are separated by blank spaces or tabs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 through 59</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hour</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 through 23</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day of the (month)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 through 31</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">month</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 through 12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">day of the (week)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0 through 7 (0 or 7 is Sunday, 1 is Monday, etc., or use names)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">command</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the complete sequence of commands to be executed for the job</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When an asterisk (*) is displayed, it means all possible values for the
field. For example, an asterisk in the hour time field would be
equivalent to "every hour".</p>
</div>
</div>
<div class="sect2">
<h3 id="_zcs_cron_jobs">ZCS Cron Jobs</h3>
<div class="paragraph">
<p>You can view the ZCS crontab by logging on as zimbra and typing
<code>crontab -l</code>.</p>
</div>
<div class="sect3">
<h4 id="_scheduled_jobs">Scheduled jobs</h4>
<div class="paragraph">
<p>The following cron jobs are scheduled to run for ZCS:</p>
</div>
<div class="sect4">
<h5 id="_log_pruning">Log pruning</h5>
<div class="paragraph">
<p>The log pruning deletes logs from <code>/opt/zimbra/log</code> that are over eight
days old. The job runs at 2:30 a.m.</p>
</div>
</div>
<div class="sect4">
<h5 id="_status_logging">Status logging</h5>
<div class="paragraph">
<p><code>zmstatuslog</code> calls <code>zmcontrol status</code> and outputs it data into syslog.</p>
</div>
<div class="paragraph">
<p>This is primarily so that logger can read the data and keep the
administration console status up-to-date.</p>
</div>
<div class="paragraph">
<p>Status logging job runs every 2 minutes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_backups">Backups</h5>
<div class="paragraph">
<p>Full and increment backups are scheduled to run according to the schedule
defined by <code>zmschedulebackup</code> command. By default the full backup is
scheduled for 1:00 a.m., every Saturday. The incremental backups are
scheduled for 1:00 a.m., Sunday through Friday.</p>
</div>
<div class="paragraph">
<p>By default, backups older then a month are deleted on the first of each
month at 12 a.m.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jobs_for_crontab_store">Jobs for crontab.store</h4>
<div class="sect4">
<h5 id="_log_pruning_2">Log pruning</h5>
<div class="paragraph">
<p>The log pruning deletes logs from <code>/opt/zimbra/mailboxd/logs</code> that are over
eight days old. The job runs at 2:30 a.m.</p>
</div>
</div>
<div class="sect4">
<h5 id="_clean_up_the_quarantine_dir">Clean up the quarantine dir</h5>
<div class="paragraph">
<p>Mail identified with a virus or spam are not dropped immediately, but
are put in quarantine. Messages older than seven days are deleted at
1:00 a.m daily.</p>
</div>
</div>
<div class="sect4">
<h5 id="_table_maintenance">Table maintenance</h5>
<div class="paragraph">
<p>The <code>ANALYZE TABLE</code> statement is run on all tables in the database to
update the statistics for all indexes. This is done to make sure that the
SQL query optimizer picks the correct indexes when executing SQL
statements. This script is run 1:30 a.m. on Sunday.</p>
</div>
</div>
<div class="sect4">
<h5 id="_report_on_any_database_inconsistencies">Report on any database inconsistencies</h5>
<div class="paragraph">
<p><code>zmdbintegrityreport</code> is run weekly to check the SQL database for
corruption and will notify the administrator if any corruption is found.
When this is run, it may consume a significant amount of I/O. If you find
that it is an issue, you may want to change the frequency with which
<code>zmdbintegrityreport</code> is run by editing the ZCS crontab entry.
This report runs at 11:00 p.m. Sundays.</p>
</div>
<div class="paragraph">
<p>Large sites may opt to disable this by setting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">zmlocalconfig -e zmdbintegrityreport_disabled=TRUE</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you choose to disable this, it is recommended that the integrity report
be run by hand during the normal maintenance windows and prior to running
any ZCS upgrades.</p>
</div>
</div>
<div class="sect4">
<h5 id="_monitor_for_multiple_mysqld_to_prevent_corruption">Monitor for multiple mysqld to prevent corruption</h5>
<div class="paragraph">
<p>A script is executed to see if mysqld process is running to detect cases
where corruption is likely to be caused. An email is generated if it finds
more than 1 mysqld process running. The script runs every 5 minutes.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jobs_for_crontab_logger">Jobs for crontab.logger</h4>
<div class="sect4">
<h5 id="_process_logs">process logs</h5>
<div class="paragraph">
<p><code>zmlogprocess</code> runs every 10 minutes to parse logs and produce MTA
metrics (as/av, volume, count, etc).</p>
</div>
</div>
<div class="sect4">
<h5 id="_daily_reports">Daily reports</h5>
<div class="paragraph">
<p>When the <code>logger</code> package is installed, a daily mail report is automatically
scheduled in the crontab. The report runs every morning at 11:30 and is
sent to the administrator&#8217;s email address.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jobs_for_crontab_mta">Jobs for crontab.mta</h4>
<div class="sect4">
<h5 id="_queue_logging">Queue logging</h5>
<div class="paragraph">
<p>The <code>zmqueue</code> report status via the syslog is reviewed. This is logger
data. The status is updated every 10 minutes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_spam_training">Spam training</h5>
<div class="paragraph">
<p>The <code>zmtrainsa</code> script is enabled to feed mail that has been classified as
spam or a non-spam to the SpamAssassin application. SpamAssassin learns
what signs are likely to mean spam or ham. This job should run only on one
Zimbra MTA. The job runs at 11:00 p.m.</p>
</div>
</div>
<div class="sect4">
<h5 id="_spam_training_cleanup">Spam training cleanup</h5>
<div class="paragraph">
<p><code>zmtrainsa</code> empties the spam and ham mailboxes each day. The job runs at
11:45 p.m.</p>
</div>
</div>
<div class="sect4">
<h5 id="_spam_bayes_auto_expiry">Spam Bayes auto-expiry</h5>
<div class="paragraph">
<p>Spam bayes auto-expiry maintains the SpamAssassin Bayes database. This
keeps the database to manageable size ensuring spam processing remains as
quick as possible. This runs every day at 11:20 p.m.</p>
</div>
</div>
<div class="sect4">
<h5 id="_clean_up_amavisdtmp">Clean up amavisd/tmp</h5>
<div class="paragraph">
<p>This job is used to clean up the amavisd temp files. It runs at 5:15
a.m. and at 8:15 p.m.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_single_server_crontab_l_example">Single Server Crontab -l Example</h3>
<div class="exampleblock">
<div class="title">Example 89. Output of <code>crontab -l</code></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre># ZIMBRASTART -- DO NOT EDIT ANYTHING BETWEEN THIS LINE AND ZIMBRAEND
#
# Log pruning
#
30 2 * * * find /opt/zimbra/log/ -type f -name *.log* -mtime +8 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
35 2 * * * find /opt/zimbra/log/ -type f -name *.out.???????????? -mtime +8 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
#
# Status logging
#
*/2 * * * * /opt/zimbra/libexec/zmstatuslog
#
# Backups
#
# BACKUP BEGIN
# BACKUP END
#
# crontab.ldap
#
#
#
# crontab.store
#
# Log pruning
#
30 2 * * * find /opt/zimbra/mailboxd/logs/ -type f -name \*log\* -mtime +8 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
30 2 * * * find /opt/zimbra/log/ -type f -name stacktrace.\* -mtime +8 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
#
# Table maintenance
#
30 1 * * 7 /opt/zimbra/libexec/zmmaintaintables &gt;&gt; /dev/null 2&gt;&amp;1
#

# # Report on any database inconsistencies
#
0 23 * * 7 /opt/zimbra/libexec/zmdbintegrityreport -m
#
# Monitor for multiple mysqld to prevent corruption

*/5 * * * * /opt/zimbra/libexec/zmcheckduplicatemysqld -e &gt; /dev/null 2&gt;&amp;1
#
# crontab.logger
#
# process logs
#
00,10,20,30,40,50 * * * * /opt/zimbra/libexec/zmlogprocess &gt; /tmp/logprocess.out 2&gt;&amp;1
#
# Graph generation
#
10 * * * * /opt/zimbra/libexec/zmgengraphs &gt;&gt; /tmp/gengraphs.out 2&gt;&amp;1
#
# Daily reports
10 1 * * * /opt/zimbra/libexec/zmdailyreport -m
#

#
crontab.mta
#
#
# Queue logging
#
0,10,20,30,40,50 * * * * /opt/zimbra/libexec/zmqueuelog
#
# Spam training
0 23 * * * /opt/zimbra/bin/zmtrainsa &gt;&gt; /opt/zimbra/log/spamtrain.log 2&gt;&amp;1
#
# Spam training cleanup
#
45 23 * * * /opt/zimbra/bin/zmtrainsa --cleanup &gt;&gt; /opt/zimbra/log/spamtrain.log 2&gt;&amp;1
#
# Dspam cleanup
#
0 1 * * * [ -d /opt/zimbra/data/dspam/data/z/i/zimbra/zimbra.sig ] &amp;&amp; find /opt/zimbra/dspam/var/dspam/data/z/i/zimbra/zimbra.sig/ -type f -name \*sig -mtime +7 -exec rm {} \; &gt; /dev/null 2&gt;&amp;1
8 4 * * * [ -f /opt/zimbra/data/dspam/system.log ] &amp;&amp; /opt/zimbra/dspam/bin/dspam_logrotate -a 60 -l /opt/zimbra/data/dspam/system.log
8 8 * * * [ -f /opt/zimbra/data/dspam/data/z/i/zimbra/zimbra.log ] &amp;&amp; /opt/zimbra/dspam/bin/dspam_logrotate -a 60 -l /opt/zimbra/data/dspam/data/z/i/zimbra/zimbra.log
#
# Spam Bayes auto-expiry
#
20 23 * * * /opt/zimbra/libexec/sa-learn -p /opt/zimbra/conf/salocal.cf --dbpath /opt/zimbra/data/amavisd/.spamassassin --siteconfigpath /opt/zimbra/conf/spamassassin --force-expire --sync &gt; /dev/null 2&gt;&amp;1
#
# Clean up amavisd/tmp
#
15 5,20 * * * find /opt/zimbra/data/amavisd/tmp -maxdepth 1 -type d -name 'amavis-*' -mtime +1 -exec rm -rf {} \; &gt; /dev/null 2&gt;&amp;1
#
# Clean up the quarantine dir
#
0 1 * * * find /opt/zimbra/data/amavisd/quarantine -type f -mtime +7 -exec rm -f {} \; &gt; /dev/null 2&gt;&amp;1

ZIMBRAEND -- DO NOT EDIT ANYTHING BETWEEN THIS LINE AND ZIMBRASTART</pre>
</div>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_abq_soap_api">Appendix D: ABQ - SOAP API</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_4">Introduction</h3>
<div class="paragraph">
<p>The "Allow/Block/Quarantine" feature allows for granular access control of mobile devices connecting to the server.
For more details about the feature, refer to the <a href="#ng-abq">ABQ Service documentation</a>.</p>
</div>
<div class="paragraph">
<p>This appendix introduces the SOAP API support for the ABQ service.</p>
</div>
<div class="sect3">
<h4 id="_zimbra_soap">Zimbra SOAP</h4>
<div class="paragraph">
<p>Zimbra implements the Simple Object Access Protocol (SOAP) for integration with clients. For more information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://wiki.zimbra.com/wiki/SOAP_API_Reference_Material_Beginning_with_ZCS_8">SOAP API Reference Material beginning with Zimbra Collaboration 8.0</a></p>
</li>
<li>
<p>and <a href="https://github.com/search?q=zimbra+soap&amp;type=Repositories">here are</a> a couple of libraries that
simplify access to that API.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Zimbra&#8217;s SOAP implementation comprises a <code>soap:Header</code> and a <code>soap:Body</code>, as in this example of a SOAP request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="tag">&lt;soap:Envelope</span> <span class="attribute-name">xmlns:soap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2003/05/soap-envelope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;soap:Header&gt;</span>
        <span class="tag">&lt;context</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;authToken&gt;</span>$token<span class="tag">&lt;/authToken&gt;</span>
            <span class="tag">&lt;format</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/context&gt;</span>
    <span class="tag">&lt;/soap:Header&gt;</span>
    <span class="tag">&lt;soap:Body&gt;</span>
        $xml
    <span class="tag">&lt;/soap:Body&gt;</span>
<span class="tag">&lt;/soap:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here <code>$xml</code> should replaced with the SOAP request that we want to issue, and <code>$token</code> should be a valid token granted by Zimbra after the client has successfully authenticated.</p>
</div>
</div>
<div class="sect3">
<h4 id="_login">Login</h4>
<div class="paragraph">
<p>To get access to Zimbra, first authenticate yourself and obtain a valid token. Here is the XML request to do so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;AuthRequest</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbraAdmin</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;account</span> <span class="attribute-name">by</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>&quot;user@example.com&quot;<span class="tag">&lt;/account&gt;</span>
    <span class="tag">&lt;password&gt;</span>password<span class="tag">&lt;/password&gt;</span>
<span class="tag">&lt;/AuthRequest&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here an example of a reply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;soap:Envelope</span> <span class="attribute-name">xmlns:soap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2003/05/soap-envelope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;soap:Header&gt;</span>
        <span class="tag">&lt;context</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;change</span> <span class="attribute-name">token</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">699</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/context&gt;</span>
    <span class="tag">&lt;/soap:Header&gt;</span>
    <span class="tag">&lt;soap:Body&gt;</span>
        <span class="tag">&lt;AuthResponse</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbraAdmin</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;authToken&gt;</span>0_2ebb6bdada2b1987c4fa625f95862d2a299b2e4c_69643d33363a34623065356237342d366135612d343435372d393032662d6630313833343131386666363b6578703d31333a313532393335333836373330303b61646d696e3d313a313b747970653d363a7a696d6272613b753d313a613b7469643d31303a313031323636373733383b76657273696f6e3d31333a382e382e385f47415f323030393b<span class="tag">&lt;/authToken&gt;</span>
            <span class="tag">&lt;lifetime&gt;</span>43199998<span class="tag">&lt;/lifetime&gt;</span>
        <span class="tag">&lt;/AuthResponse&gt;</span>
    <span class="tag">&lt;/soap:Body&gt;</span>
<span class="tag">&lt;/soap:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After we have a valid token we can use it in subsequent calls placing it into the <code>&lt;authToken&gt;$token&lt;/authToken&gt;</code> of <code>soap:Header</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_abq_api">ABQ API</h3>
<div class="paragraph">
<p>All ABQ calls have a common XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;zextras</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbraAdmin</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;module&gt;</span>ZxMobile<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;action&gt;</span>$action<span class="tag">&lt;/action&gt;</span>
<span class="tag">&lt;/zextras&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>$action</code> can be: <code>getDeviceControlList</code>, <code>getDeviceStatus</code> or <code>setDeviceStatus</code> followed by a parameter if needed. Here is an example of a reply:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;soap:Envelope</span> <span class="attribute-name">xmlns:soap</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2003/05/soap-envelope</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;soap:Header&gt;</span>
        <span class="tag">&lt;context</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbra</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;change</span> <span class="attribute-name">token</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">699</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/context&gt;</span>
    <span class="tag">&lt;/soap:Header&gt;</span>
    <span class="tag">&lt;soap:Body&gt;</span>
        <span class="tag">&lt;response</span> <span class="attribute-name">content</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">{</span><span class="delimiter">&quot;</span></span><span class="attribute-name">response</span><span class="error">&quot;</span><span class="attribute-name">:</span><span class="error">{</span><span class="error">&quot;</span><span class="attribute-name">devices</span><span class="error">&quot;</span><span class="attribute-name">:</span><span class="error">[</span><span class="error">{</span><span class="error">&quot;</span><span class="attribute-name">device_id</span><span class="error">&quot;</span><span class="attribute-name">:</span><span class="error">&quot;</span><span class="attribute-name">device4</span><span class="error">&quot;</span><span class="error">,</span><span class="error">&quot;</span><span class="attribute-name">status</span><span class="error">&quot;</span><span class="attribute-name">:</span><span class="error">&quot;</span><span class="attribute-name">device1</span>=<span class="attribute-value">allowed</span><span class="error">;</span><span class="attribute-name">device2</span>=<span class="attribute-value">quarantined</span><span class="error">;</span><span class="attribute-name">device3</span>=<span class="attribute-value">Blocked</span><span class="error">&quot;</span><span class="error">}</span><span class="error">]</span><span class="error">}</span><span class="error">,</span>
        <span class="error">&quot;</span><span class="attribute-name">ok</span><span class="error">&quot;</span><span class="attribute-name">:true</span><span class="error">}</span><span class="error">&quot;</span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/soap:Body&gt;</span>
<span class="tag">&lt;/soap:Envelope&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>All ABQ replies are standard and they are placed into a <code>&lt;response&gt;</code> tag with a <code>content</code> attribute. Content is formatted as JSON with only one <code>JSONObject: "response"</code> and <code>Boolean: "ok"</code>. The former contains the reply and the latter indicates if the request succeeded or not.</p>
</div>
<div class="sect3">
<h4 id="_getdevicecontrollist">getDeviceControlList</h4>
<div class="paragraph">
<p>Returns a list of all ABQ devices filtered by status: “all”, ”allowed”, ”quarantined” or ”blocked” (case insensitive)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;zextras</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbraAdmin</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;module&gt;</span>ZxMobile<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;action&gt;</span>getDeviceControlList<span class="tag">&lt;/action&gt;</span>
    <span class="tag">&lt;status&gt;</span>all<span class="tag">&lt;/status&gt;</span>
<span class="tag">&lt;/zextras&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_getdevicestatus">getDeviceStatus</h4>
<div class="paragraph">
<p>Returns a list of ABQ devices status given a device list (semicolon separated)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;zextras</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbraAdmin</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;module&gt;</span>ZxMobile<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;action&gt;</span>getDeviceStatus<span class="tag">&lt;/action&gt;</span>
    <span class="tag">&lt;device&gt;</span>device01;device02<span class="tag">&lt;/device&gt;</span>
<span class="tag">&lt;/zextras&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The reply contains a JSON array called <code>devices</code>, each with a pair of string attributes : <code>"device_id"</code> and <code>"status"</code>. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">devices</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">device_id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">device1</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Allowed</span><span class="delimiter">&quot;</span></span>}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">ok</span><span class="delimiter">&quot;</span></span>:<span class="value">true</span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the requested device is not found in ABQ, it is simply omitted from the response.</p>
</div>
</div>
<div class="sect3">
<h4 id="_setdevicestatus">setDeviceStatus</h4>
<div class="paragraph">
<p>Sets the device status for a given device or list of devices. The list is semicolon separated and each element is composed of <code>device_id = $status</code> where <code>$status</code> can
be <code>Allowed</code>, <code>Quarantined</code> or <code>Blocked</code> (case insensitive). Returns a list of failed devices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;zextras</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:zimbraAdmin</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;module&gt;</span>ZxMobile<span class="tag">&lt;/module&gt;</span>
    <span class="tag">&lt;action&gt;</span>setDeviceStatus<span class="tag">&lt;/action&gt;</span>
    <span class="tag">&lt;deviceStatus&gt;</span>device01=allowed;device02=blocked<span class="tag">&lt;/deviceStatus&gt;</span>
<span class="tag">&lt;/zextras&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The reply contains a JSON array called <code>devices</code>, each with a pair of string attributes : <code>"device_id"</code> and <code>"status"</code>. Here is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">    {<span class="key"><span class="delimiter">&quot;</span><span class="content">response</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">devices</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">device_id</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">device4</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">wrong</span><span class="delimiter">&quot;</span></span>}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">ok</span><span class="delimiter">&quot;</span></span>:<span class="value">true</span>}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_example_11">Example</h5>
<div class="paragraph">
<p>AbqClient is a simple java example to show access to ABQ api. It&#8217;s self contained and can be build with ant:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ant build</pre>
</div>
</div>
<div class="paragraph">
<p>and executed by:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ ant run</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_glossary">Glossary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Glossary lists terms and acronyms used in this document, and includes
both industry terms and application-specific terms.  If a general industry
concept or practice has been implemented in a specific way within the
product, that is noted as well.</p>
</div>
<div class="dlist glossary">
<dl>
<dt>A record</dt>
<dd>
<p>A (for "Address") records map the hostname to the numeric IP address.  For
Zimbra, the A record is the IP address for the Zimbra server.</p>
</dd>
<dt>ABQ</dt>
<dd>
<p>The Allow/Block/Quarantine function provided by the NG Modules
gives system administrators control over which devices are allowed
to sync via ActiveSync.</p>
</dd>
<dt>Account Policy</dt>
<dd>
<p>Class of Service as exposed in Zimbra administration console.</p>
</dd>
<dt>AD</dt>
<dd>
<p>Microsoft Active Directory Server.  Used in Zimbra Collaboration as an
optional choice for authentication and GAL, along with OpenLDAP for all
other Zimbra Collaboration functions.</p>
</dd>
<dt>Alias</dt>
<dd>
<p>An &#8220;also known as&#8221; email address, which should be routed to a user at a
different email address.</p>
</dd>
<dt>Attribute</dt>
<dd>
<p>Contains object-related data for directory server entries.  Attributes
store information such as a server host name or email forwarding
address.</p>
</dd>
<dt>Authentication</dt>
<dd>
<p>Process by which user-supplied login information is used to validate
that user’s authority to enter a system.</p>
</dd>
<dt>Blacklist</dt>
<dd>
<p>Anti-spam term, indicates a known bad IP address.  This could be one
that has been hijacked by spammers, or also one from a poorly
maintained but legitimate site that allows mail relaying from
unauthorized parties.</p>
</dd>
<dt>BLOB</dt>
<dd>
<p>Binary Large Object.</p>
</dd>
<dt>Class of Service (COS)</dt>
<dd>
<p>Describes an object in the Zimbra Collaboration LDAP data schema, which
contains settings for things like user mail quotas.  Each
Zimbra Collaboration account includes a COS, and the account inherits all the
settings from the selected COS.</p>
</dd>
<dt>CLI</dt>
<dd>
<p>Command-Line Interface.  Used to refer to the collective set of
Zimbra Collaboration command-line tools, such as <code>zmprov</code>.</p>
</dd>
<dt>Cluster</dt>
<dd>
<p>A type of network configuration for high availability, using clusters
of servers (nodes).  If one server fails or drops off the network, a
spare takes over.</p>
</dd>
<dt>Contacts</dt>
<dd>
<p>Within Zimbra Collaboration, Contacts are a user-interface feature
listing that user’s personal collection of address and contact
information.</p>
</dd>
<dt>Conversation</dt>
<dd>
<p>Within Zimbra Collaboration, Conversations are a user-interface feature
that presents email threads (emails sharing the same subject line) as
a single Conversation listing.  Users can expand the Conversation to
view all emails within it.</p>
</dd>
<dt>DHTML</dt>
<dd>
<p>Dynamic HTML.  A technology employed in the Zimbra Web Client.</p>
</dd>
<dt>DNS</dt>
<dd>
<p>Domain Name System is an Internet directory service.  DNS is how domain
names are translated into IP addresses and DNS also controls email
delivery.  Correctly configured DNS is required for Postfix to route
messages to remote destinations</p>
</dd>
<dt>Edge MTA</dt>
<dd>
<p>Generic term used to refer to any mail transfer agent that is the first
line of defense in handling incoming email traffic.  Functions that may
occur on the Edge MTA include spam filtering.</p>
</dd>
<dt>Entry</dt>
<dd>
<p>An item in the directory server, such as an account or mail host.</p>
</dd>
<dt>Ephemeral Data</dt>
<dd>
<p>Data which is short lived or fast changing in nature. Login timestamps, authentication tokens, etc.</p>
</dd>
<dt>Failover</dt>
<dd>
<p>Takeover process where a spare server machine detects that a main
server is unavailable, and the spare takes over processing for that
server.</p>
</dd>
<dt>FQDN</dt>
<dd>
<p>Fully qualified domain name.  The hostname and the path to the host.
For example, <code>www.zimbra.com</code> is a fully qualified domain name where <code>www</code> is
the host, <code>zimbra</code> is the second-level domain, and <code>.com</code> is the top level
domain.</p>
</dd>
<dt>GAL</dt>
<dd>
<p>Global Address List, the Outlook version of a company directory.  Lists
contact information, including email addresses, for all employees
within an organization.</p>
</dd>
<dt>Global Configuration</dt>
<dd>
<p>A Zimbra Collaboration object containing default settings for servers
and Class of Service.</p>
</dd>
<dt>High Availability</dt>
<dd>
<p>Abbreviated as HA, high availability refers to the availability of
resources in a computer system in the wake of component failures in the
system.</p>
</dd>
<dt>HTTP</dt>
<dd>
<p>HyperText Transfer Protocol, used along with SOAP for UI integration.</p>
</dd>
<dt>IMAP</dt>
<dd>
<p>Internet Message Access Protocol is a method of accessing mail from a
remote message store as if the users were local.</p>
</dd>
<dt>Store</dt>
<dd>
<p>Within Zimbra Collaboration, a directory area that stores all the
indexing information for mail messages on a particular mailbox server.</p>
</dd>
<dt>Indexing</dt>
<dd>
<p>The process of parsing incoming email messages for search words.</p>
</dd>
<dt>Java</dt>
<dd>
<p>Java is an industry standard object-oriented programming language.
Used for the core Zimbra Collaboration application server.</p>
</dd>
<dt>JavaScript</dt>
<dd>
<p>Scripting largely developed by Netscape that can interact with HTML
source code.  Technology used in the Zimbra Web Client.</p>
</dd>
<dt>LDAP</dt>
<dd>
<p>Lightweight Directory Access Protocol, an industry standard protocol
used for authentication.</p>
</dd>
<dt>LMTP</dt>
<dd>
<p>Local Mail Transfer Protocol, used for transferring messages from
Postfix MTA to the Zimbra Collaboration server for final delivery.</p>
</dd>
<dt>Mailbox Server</dt>
<dd>
<p>Alternative term for Zimbra Collaboration server.</p>
</dd>
<dt>MAPI</dt>
<dd>
<p>Messaging Application Programming Interface.  A system built into
Microsoft Windows to enable different email applications to work
together.</p>
</dd>
<dt>Message Store</dt>
<dd>
<p>Within Zimbra Collaboration, a directory area that stores the mail
messages on a particular mailbox server.</p>
</dd>
<dt>MDA</dt>
<dd>
<p>Mail Delivery Agent, sometimes known as a mail host.  The
Zimbra Collaboration server functions as an MDA.</p>
</dd>
<dt>Metadata</dt>
<dd>
<p>Data that describes other data, rather than actual content.  Within
Zimbra Collaboration, metadata consists of user folders, threads,
message titles and tags, and pointers.</p>
</dd>
<dt>MIME</dt>
<dd>
<p>Multipurpose Internet Mail Extensions, a specification for formatting
non-ASCII Internet message content such as image files.  Format used to
store messages in Message Store.</p>
</dd>
<dt>MTA</dt>
<dd>
<p>Message Transfer Agent.  MTA is a program that delivers mail and
transports it between machines.  A Zimbra Collaboration deployment
assumes both the Postfix MTA and an edge MTA.</p>
</dd>
<dt>MX Record</dt>
<dd>
<p>Mail eXchange.  An MX record is an entry in a domain name database that
identifies the mail server that is responsible for handling emails for
that domain name.  The email system relies on DNS MX records to
transmit emails between domains.  When mail is processed, the MX record
is checked before the A record for the destination address.</p>
</dd>
<dt>OOTO</dt>
<dd>
<p>Common shorthand for “out of the office”, used when sending vacation
messages.</p>
</dd>
<dt>Open Source</dt>
<dd>
<p>Refers to software created by groups of users for non-commercial
distribution, where source code is published rather than proprietary.</p>
</dd>
<dt>OS</dt>
<dd>
<p>Operating system, such as Linux, UNIX, or Microsoft Windows.</p>
</dd>
<dt>POP</dt>
<dd>
<p>Post Office Protocol is used to retrieve email from a remote server
over TCP/IP and save it to the local computer.</p>
</dd>
<dt>Provisioning</dt>
<dd>
<p>The process of creating accounts or other data, usually in batch or
automated fashion.</p>
</dd>
<dt>RBH</dt>
<dd>
<p>Real-time black hole.  Usually refers to web sites that, as a public
service, provide lists of known bad IP addresses from which mail should
be blocked, because the servers are either known to be spammers, or are
unsecured and exploited by spammers.</p>
</dd>
<dt>Redo Logs</dt>
<dd>
<p>Detailed transaction log for the Zimbra Collaboration server, used for replay and
replication.</p>
</dd>
<dt>SAN</dt>
<dd>
<p>Storage Array Network.  A high-availability data storage area.</p>
</dd>
<dt>Schema</dt>
<dd>
<p>Describes the data structures in use for by directory services at a
particular organizational site.</p>
</dd>
<dt>SMTP</dt>
<dd>
<p>Simple Mail Transfer Protocol.  Used in Zimbra Collaboration
deployments between the Edge MTA and the Postfix MTA.</p>
</dd>
<dt>SNMP</dt>
<dd>
<p>Simple Network Monitoring Protocol.  Used by monitoring software to
pick up critical errors from system logs.</p>
</dd>
<dt>SOAP</dt>
<dd>
<p>Simple Object Access Protocol, an XML-based messaging protocol used for
sending requests for Web services.  The Zimbra Collaboration servers
use SOAP for receiving and processing requests, which can come from
Zimbra Collaboration command-line tools or Zimbra Collaboration user
interfaces.</p>
</dd>
<dt>Spam</dt>
<dd>
<p>Unsolicited commercial email.  Spammers refer to their output as &#8220;bulk
business email&#8221;.</p>
</dd>
<dt>SQL</dt>
<dd>
<p>Structured Query Language, used to look up messages in the Message
Store.</p>
</dd>
<dt>SSL</dt>
<dd>
<p>Secure Sockets Layer.</p>
</dd>
<dt>Tags</dt>
<dd>
<p>A Zimbra Web Client feature.  Users can define tags and apply them to
mail messages for searching.</p>
</dd>
<dt>TCO</dt>
<dd>
<p>Total Cost of Ownership.  Zimbra Collaboration reduces total cost of
ownership (TCO) by reducing requirements for server hardware, OS
licensing fees, supporting application license fees, disk storage
requirements, and personnel (IT, help desk, consulting).</p>
</dd>
<dt>TLS</dt>
<dd>
<p>Transport Layer Security.</p>
</dd>
<dt>UCE</dt>
<dd>
<p>Unsolicited commercial email, also known as spam.</p>
</dd>
<dt>Virtual Alias</dt>
<dd>
<p>A type of mail alias recognized in the Postfix MTA.</p>
</dd>
<dt>Whitelist</dt>
<dd>
<p>Anti-spam term for a known good mail or IP address.  Mail coming from
such an address may be &#8220;automatically trusted&#8221;.</p>
</dd>
<dt>XML</dt>
<dd>
<p>eXtended Markup Language.</p>
</dd>
<dt>Zimbra administration console</dt>
<dd>
<p>The Zimbra Collaboration administrator interface.</p>
</dd>
<dt>Zimbra Web Client</dt>
<dd>
<p>Refers to any of the end-user interfaces provided over the Web as part of a Zimbra server.</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version Zimbra Network Edition V 8.8.15<br>
Last updated 2022-12-12 12:40:14 +0530
</div>
</div>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</body>
</html>